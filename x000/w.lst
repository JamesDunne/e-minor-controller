MP2COD 3.94, COFF to COD File Converter
Copyright (c) 2005 Microchip Technology Inc.
Listing File Generated: Wed Mar 22 13:07:03 2006


Address  Value    Disassembly              Source                                                                           File
-------  -------  -----------------------  -------------------------------------------------------------------------------  -----
                                           //############################################################################## C:\fw\picscopefw\x017\main.c
                                           //	Test code                                                                     C:\fw\picscopefw\x017\main.c
                                           //############################################################################## C:\fw\picscopefw\x017\main.c
                                           //------------------------------------------------------------------------------ C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           #include "c_compiler.h"                                                          C:\fw\picscopefw\x017\main.c
                                           #include "p18cxxx.h"                                                             C:\fw\picscopefw\x017\main.c
                                           #include "c_cnstdef.h"                                                           C:\fw\picscopefw\x017\main.c
                                           #include "c_ramdef.h"                                                            C:\fw\picscopefw\x017\main.c
                                           #include "c_portdef.h"                                                           C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           #include "usb.h"                                                                 C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           unsigned char	ADC_CONVERSION(unsigned char Channel);                             C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           extern unsigned char InputDataPointer;                                           C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           void	ServiceUSB(void);                                                           C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           #define	RX_TRIS_BIT		TRISCbits.TRISC7		// Receive direction bit                  C:\fw\picscopefw\x017\main.c
                                           #define	TX_TRIS_BIT		TRISCbits.TRISC6		// Transmit direction bit                 C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
001c46   cfd9     MOVFF     0xfd9,0xfe6    void main() {                                                                    C:\fw\picscopefw\x017\main.c
001c48   ffe6                                                                                                               
001c4a   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001c4c   ffd9                                                                                                               
001c4e   0e02     MOVLW     0x2                                                                                             
001c50   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           	unsigned char i, test;                                                          C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
001c52   6a96     CLRF      0x96,0x0       	TRISE = 0x00;		//assert all pins on portd as outputs                            C:\fw\picscopefw\x017\main.c
001c54   6a95     CLRF      0x95,0x0       	TRISD = 0x00;		//assert all pins on portd as outputs                            C:\fw\picscopefw\x017\main.c
001c56   0ebf     MOVLW     0xbf           	TRISC = 0xBF;                                                                   C:\fw\picscopefw\x017\main.c
001c58   6e94     MOVWF     0x94,0x0                                                                                        
                                           //	TRISCbits.TRISC6 = false;                                                     C:\fw\picscopefw\x017\main.c
                                           //	RCSTA = 0x90;                                                                 C:\fw\picscopefw\x017\main.c
                                           //	TXSTA = 0xA2;		//0x46;                                                        C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           //	SPBRG = 204;                                                                  C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           //	TRISD = 0x00;		//assert all pins on portd as outputs                          C:\fw\picscopefw\x017\main.c
                                           //Initialize the USART control registers                                         C:\fw\picscopefw\x017\main.c
001c5a   0ea6     MOVLW     0xa6           	TXSTA = 0xA6;			//master,8bit,async,high speed                                  C:\fw\picscopefw\x017\main.c
001c5c   6eac     MOVWF     0xac,0x0                                                                                        
001c5e   0e90     MOVLW     0x90           	RCSTA = 0x90;			//enabled,8bit, continuous                                      C:\fw\picscopefw\x017\main.c
001c60   6eab     MOVWF     0xab,0x0                                                                                        
                                           //	BAUDCONbits.BRG16 = true;                                                     C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           //These constants setup the application's MCU Analog-to-Digital Converter module. C:\fw\picscopefw\x017\main.c
001c62   0e40     MOVLW     0x40           	ADCON0	= 0b01000000;		//AN0, off                                                C:\fw\picscopefw\x017\main.c
001c64   6ec2     MOVWF     0xc2,0x0                                                                                        
001c66   0e09     MOVLW     0x9            	ADCON1	= 0b00001001;		//6 analog + 2 digital channels                           C:\fw\picscopefw\x017\main.c
001c68   6ec1     MOVWF     0xc1,0x0                                                                                        
001c6a   0e86     MOVLW     0x86           	ADCON2	= 0b10000110;		//Right justified, 0 TAD(manual), FOSC/32                 C:\fw\picscopefw\x017\main.c
001c6c   6ec0     MOVWF     0xc0,0x0                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
001c6e   0e10     MOVLW     0x10           	SPBRG = 16;			//115200 baud                                                     C:\fw\picscopefw\x017\main.c
001c70   6eaf     MOVWF     0xaf,0x0                                                                                        
001c72   0e01     MOVLW     0x1            	SPBRGH = 0x01;                                                                  C:\fw\picscopefw\x017\main.c
001c74   6eb0     MOVWF     0xb0,0x0                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\main.c
001c76   0e14     MOVLW     0x14           	mInitializeUSBDriver();                                                         C:\fw\picscopefw\x017\main.c
001c78   6e6f     MOVWF     0x6f,0x0                                                                                        
001c7a   0100     MOVLB     0x0                                                                                             
001c7c   6bef     CLRF      0xef,0x1                                                                                        
001c7e   0100     MOVLB     0x0                                                                                             
001c80   6bf0     CLRF      0xf0,0x1                                                                                        
001c82   0100     MOVLB     0x0                                                                                             
001c84   6bf1     CLRF      0xf1,0x1                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\main.c
001d0c   d7bc     BRA       0x1c86         	for(;;) {                                                                       C:\fw\picscopefw\x017\main.c
001c86   0e01     MOVLW     0x1            		Sample = ADC_CONVERSION((unsigned char)0x01);		//read channel AN0              C:\fw\picscopefw\x017\main.c
001c88   6ee6     MOVWF     0xe6,0x0                                                                                        
001c8a   d847     RCALL     0x1d1a                                                                                          
001c8c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001c8e   0101     MOVLB     0x1                                                                                             
001c90   6f00     MOVWF     0x0,0x1                                                                                         
001c92   c100     MOVFF     0x100,0xf8c    		LATD = Sample;                                                                 C:\fw\picscopefw\x017\main.c
001c94   ff8c                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\main.c
001c96   0e55     MOVLW     0x55           		LATE = 0x55;                                                                   C:\fw\picscopefw\x017\main.c
001c98   6e8d     MOVWF     0x8d,0x0                                                                                        
001c9a   52de     MOVF      0xde,0x1,0x0   		test = 0xAA;                                                                   C:\fw\picscopefw\x017\main.c
001c9c   0eaa     MOVLW     0xaa                                                                                            
001c9e   6edd     MOVWF     0xdd,0x0                                                                                        
001d0a   d7ca     BRA       0x1ca0         		for (;;) {                                                                     C:\fw\picscopefw\x017\main.c
001ca0   6adf     CLRF      0xdf,0x0       			for(i=0;i<220;i++) {                                                          C:\fw\picscopefw\x017\main.c
001ca2   50df     MOVF      0xdf,0x0,0x0                                                                                    
001ca4   6e02     MOVWF     0x2,0x0                                                                                         
001ca6   6a03     CLRF      0x3,0x0                                                                                         
001ca8   90d8     BCF       0xd8,0x0,0x0                                                                                    
001caa   5003     MOVF      0x3,0x0,0x0                                                                                     
001cac   e604     BN        0x1cb6                                                                                          
001cae   0edc     MOVLW     0xdc                                                                                            
001cb0   5c02     SUBWF     0x2,0x0,0x0                                                                                     
001cb2   0e00     MOVLW     0x0                                                                                             
001cb4   5803     SUBWFB    0x3,0x0,0x0                                                                                     
001cb6   e219     BC        0x1cea                                                                                          
001ce6   2adf     INCF      0xdf,0x1,0x0                                                                                    
001ce8   d7dc     BRA       0x1ca2                                                                                          
                                           				//ServiceUSB();                                                              C:\fw\picscopefw\x017\main.c
001cb8   0e01     MOVLW     0x1            				ADC_CONVERSION((unsigned char)0x01);		//read channel AN0                     C:\fw\picscopefw\x017\main.c
001cba   6ee6     MOVWF     0xe6,0x0                                                                                        
001cbc   d82e     RCALL     0x1d1a                                                                                          
001cbe   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           	                                                                                C:\fw\picscopefw\x017\main.c
                                           //	adcHI = (char)((adcValue >> 5)& 0x1f);	// 0|0|0|d9|d8|d7|d6|d5                C:\fw\picscopefw\x017\main.c
                                           //	adcLO = (char)((adcValue & 0x1f)|0x80);	// 1|0|0|d4|d3|d2|d1|d0               C:\fw\picscopefw\x017\main.c
                                           				//result in ADRESH:ADRESL                                                    C:\fw\picscopefw\x017\main.c
001cc0   cfc3     MOVFF     0xfc3,0x101    				SampleData.s_form = ADRES;                                                   C:\fw\picscopefw\x017\main.c
001cc2   f101                                                                                                               
001cc4   cfc4     MOVFF     0xfc4,0x102                                                                                     
001cc6   f102                                                                                                               
                                           //				SampleData.b_form.low = (ADRESL&0x1F)|0x80;                                C:\fw\picscopefw\x017\main.c
                                           	                                                                                C:\fw\picscopefw\x017\main.c
001cc8   6aea     CLRF      0xea,0x0       				DataBuffer[i].s_form = SampleData.s_form;			//store sample in buffer.        C:\fw\picscopefw\x017\main.c
001cca   34df     RLCF      0xdf,0x0,0x0                                                                                    
001ccc   0bfe     ANDLW     0xfe                                                                                            
001cce   36ea     RLCF      0xea,0x1,0x0                                                                                    
001cd0   6ee9     MOVWF     0xe9,0x0                                                                                        
001cd2   0e03     MOVLW     0x3                                                                                             
001cd4   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001cd6   0e01     MOVLW     0x1                                                                                             
001cd8   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001cda   c101     MOVFF     0x101,0xfee                                                                                     
001cdc   ffee                                                                                                               
001cde   c102     MOVFF     0x102,0xfed                                                                                     
001ce0   ffed                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           				//flicker test leds to indicate sampling rate..                              C:\fw\picscopefw\x017\main.c
001ce2   1c8d     COMF      0x8d,0x0,0x0   				LATE = ~LATE;                                                                C:\fw\picscopefw\x017\main.c
001ce4   6e8d     MOVWF     0x8d,0x0                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           			}                                                                             C:\fw\picscopefw\x017\main.c
001cea   0100     MOVLB     0x0            			InputDataPointer = 0;                                                         C:\fw\picscopefw\x017\main.c
001cec   6bee     CLRF      0xee,0x1                                                                                        
                                           			do {                                                                          C:\fw\picscopefw\x017\main.c
001cee   d82d     RCALL     0x1d4a         				ServiceUSB();                                                                C:\fw\picscopefw\x017\main.c
001cf0   0e01     MOVLW     0x1            				ADC_CONVERSION((unsigned char)0x01);		//This is just to provide a short delay between sets of TX data. C:\fw\picscopefw\x017\main.c
001cf2   6ee6     MOVWF     0xe6,0x0                                                                                        
001cf4   d812     RCALL     0x1d1a                                                                                          
001cf6   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001cf8   0100     MOVLB     0x0            			} while (InputDataPointer != 255);                                            C:\fw\picscopefw\x017\main.c
001cfa   51ee     MOVF      0xee,0x0,0x1                                                                                    
001cfc   6e02     MOVWF     0x2,0x0                                                                                         
001cfe   6a03     CLRF      0x3,0x0                                                                                         
001d00   0eff     MOVLW     0xff                                                                                            
001d02   1802     XORWF     0x2,0x0,0x0                                                                                     
001d04   e101     BNZ       0x1d08                                                                                          
001d06   5003     MOVF      0x3,0x0,0x0                                                                                     
001d08   e1f2     BNZ       0x1cee                                                                                          
                                           		}                                                                              C:\fw\picscopefw\x017\main.c
                                           	}                                                                               C:\fw\picscopefw\x017\main.c
001d0e   cfd9     MOVFF     0xfd9,0xfe1    }                                                                                C:\fw\picscopefw\x017\main.c
001d10   ffe1                                                                                                               
001d12   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001d14   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001d16   ffd9                                                                                                               
001d18   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\picscopefw\x017\main.c
001d1a   cfd9     MOVFF     0xfd9,0xfe6    unsigned char	ADC_CONVERSION(unsigned char Channel) {                            C:\fw\picscopefw\x017\main.c
001d1c   ffe6                                                                                                               
001d1e   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001d20   ffd9                                                                                                               
001d22   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           	unsigned char tempcntr;                                                         C:\fw\picscopefw\x017\main.c
001d24   0efe     MOVLW     0xfe           	ADCON0 = Channel;                                                               C:\fw\picscopefw\x017\main.c
001d26   50db     MOVF      0xdb,0x0,0x0                                                                                    
001d28   6ec2     MOVWF     0xc2,0x0                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           //Wait for the converter's holding capacitor to charge up.                       C:\fw\picscopefw\x017\main.c
                                           ADC_CHARGING_DELAY_LOOP:                                                         C:\fw\picscopefw\x017\main.c
001d2a   0e0a     MOVLW     0xa            	for(tempcntr = 10;tempcntr!=0;tempcntr--);                                      C:\fw\picscopefw\x017\main.c
001d2c   6edf     MOVWF     0xdf,0x0                                                                                        
001d2e   50df     MOVF      0xdf,0x0,0x0                                                                                    
001d30   e002     BZ        0x1d36                                                                                          
001d32   06df     DECF      0xdf,0x1,0x0                                                                                    
001d34   d7fc     BRA       0x1d2e                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           //Start the conversion                                                           C:\fw\picscopefw\x017\main.c
001d36   82c2     BSF       0xc2,0x1,0x0   	ADCON0bits.GO = true;                                                           C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           //Wait for the conversion to complete, then exit                                 C:\fw\picscopefw\x017\main.c
                                           ADC_CONVERSION_DELAY:                                                            C:\fw\picscopefw\x017\main.c
001d38   b2c2     BTFSC     0xc2,0x1,0x0   	for(;ADCON0bits.GO;);                                                           C:\fw\picscopefw\x017\main.c
001d3a   d7fe     BRA       0x1d38                                                                                          
                                           	                                                                                C:\fw\picscopefw\x017\main.c
001d3c   50c4     MOVF      0xc4,0x0,0x0   	return ADRESH;                                                                  C:\fw\picscopefw\x017\main.c
001d3e   d000     BRA       0x1d40                                                                                          
001d40   52e5     MOVF      0xe5,0x1,0x0   }                                                                                C:\fw\picscopefw\x017\main.c
001d42   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001d44   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001d46   ffd9                                                                                                               
001d48   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                                                                                                            C:\fw\picscopefw\x017\main.c
                                           void	ServiceUSB(void) {                                                          C:\fw\picscopefw\x017\main.c
001d4a   ec50     CALL      0x18a0,0x0     	USBCheckBusStatus();                    // Must use polling method              C:\fw\picscopefw\x017\main.c
001d4c   f00c                                                                                                               
001d4e   be6f     BTFSC     0x6f,0x7,0x0       if(UCFGbits.UTEYE!=1) {                                                      C:\fw\picscopefw\x017\main.c
001d50   d002     BRA       0x1d56                                                                                          
001d52   ec6f     CALL      0x18de,0x0             USBDriverService();                 // Interrupt or polling method       C:\fw\picscopefw\x017\main.c
001d54   f00c                                                                                                               
                                           	}                                                                               C:\fw\picscopefw\x017\main.c
001d56   0012     RETURN    0x0            }                                                                                C:\fw\picscopefw\x017\main.c
                                           /* $Id: c018i.c,v 1.3 2004/07/30 17:28:43 ConnerJ Exp $ */                       C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                           /* Copyright (c)1999 Microchip Technology */                                     C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                           /* MPLAB-C18 startup code, including initialized data */                         C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                           /* external reference to the user's main routine */                              C:\fw\picscopefw\x017\startup.c
                                           extern void main (void);                                                         C:\fw\picscopefw\x017\startup.c
                                           /* prototype for the startup function */                                         C:\fw\picscopefw\x017\startup.c
                                           void _entry (void);                                                              C:\fw\picscopefw\x017\startup.c
                                           void _startup (void);                                                            C:\fw\picscopefw\x017\startup.c
                                           /* prototype for the initialized data setup */                                   C:\fw\picscopefw\x017\startup.c
                                           void _do_cinit (void);                                                           C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                           extern volatile near unsigned long short TBLPTR;                                 C:\fw\picscopefw\x017\startup.c
                                           extern near unsigned FSR0;                                                       C:\fw\picscopefw\x017\startup.c
                                           extern near char FPFLAGS;                                                        C:\fw\picscopefw\x017\startup.c
                                           #define RND 6                                                                    C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                           #pragma code _entry_scn=0x000A00                                                 C:\fw\picscopefw\x017\startup.c
                                           void                                                                             C:\fw\picscopefw\x017\startup.c
                                           _entry (void)                                                                    C:\fw\picscopefw\x017\startup.c
                                           {                                                                                C:\fw\picscopefw\x017\startup.c
000a00   efe5     GOTO      0x1fca         _asm goto _startup _endasm                                                       C:\fw\picscopefw\x017\startup.c
000a02   f00f                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\startup.c
000a04   0012     RETURN    0x0            }                                                                                C:\fw\picscopefw\x017\startup.c
                                           #pragma code _startup_scn                                                        C:\fw\picscopefw\x017\startup.c
                                           void                                                                             C:\fw\picscopefw\x017\startup.c
                                           _startup (void)                                                                  C:\fw\picscopefw\x017\startup.c
                                           {                                                                                C:\fw\picscopefw\x017\startup.c
                                             _asm                                                                           C:\fw\picscopefw\x017\startup.c
                                               // Initialize the stack pointer                                              C:\fw\picscopefw\x017\startup.c
001fca   ee17     LFSR      0x1,0x700          lfsr 1, _stack                                                               C:\fw\picscopefw\x017\startup.c
001fcc   f000                                                                                                               
001fce   ee27     LFSR      0x2,0x700          lfsr 2, _stack                                                               C:\fw\picscopefw\x017\startup.c
001fd0   f000                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\startup.c
001fd2   6af8     CLRF      0xf8,0x0           clrf TBLPTRU, 0 // 1st silicon doesn't do this on POR                        C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
001fd4   9c01     BCF       0x1,0x6,0x0        bcf FPFLAGS,RND,0 // Initialize rounding flag for floating point libs        C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                               _endasm                                                                      C:\fw\picscopefw\x017\startup.c
001fd6   ec96     CALL      0x1f2c,0x0         _do_cinit ();                                                                C:\fw\picscopefw\x017\startup.c
001fd8   f00f                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                           loop:                                                                            C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                             // Call the user's main routine                                                C:\fw\picscopefw\x017\startup.c
001fda   ec23     CALL      0x1c46,0x0       main ();                                                                       C:\fw\picscopefw\x017\startup.c
001fdc   f00e                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\startup.c
001fde   d7fd     BRA       0x1fda           goto loop;                                                                     C:\fw\picscopefw\x017\startup.c
001fe0   0012     RETURN    0x0            }                               /* end _startup() */                             C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                           /* MPLAB-C18 initialized data memory support */                                  C:\fw\picscopefw\x017\startup.c
                                           /* The linker will populate the _cinit table */                                  C:\fw\picscopefw\x017\startup.c
                                           extern far rom struct                                                            C:\fw\picscopefw\x017\startup.c
                                           {                                                                                C:\fw\picscopefw\x017\startup.c
                                             unsigned short num_init;                                                       C:\fw\picscopefw\x017\startup.c
                                             struct _init_entry                                                             C:\fw\picscopefw\x017\startup.c
                                             {                                                                              C:\fw\picscopefw\x017\startup.c
                                               unsigned long from;                                                          C:\fw\picscopefw\x017\startup.c
                                               unsigned long to;                                                            C:\fw\picscopefw\x017\startup.c
                                               unsigned long size;                                                          C:\fw\picscopefw\x017\startup.c
                                             }                                                                              C:\fw\picscopefw\x017\startup.c
                                             entries[];                                                                     C:\fw\picscopefw\x017\startup.c
                                           }                                                                                C:\fw\picscopefw\x017\startup.c
                                           _cinit;                                                                          C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                           #pragma code _cinit_scn                                                          C:\fw\picscopefw\x017\startup.c
                                           void                                                                             C:\fw\picscopefw\x017\startup.c
                                           _do_cinit (void)                                                                 C:\fw\picscopefw\x017\startup.c
                                           {                                                                                C:\fw\picscopefw\x017\startup.c
                                             /* we'll make the assumption in the following code that these statics          C:\fw\picscopefw\x017\startup.c
                                              * will be allocated into the same bank.                                       C:\fw\picscopefw\x017\startup.c
                                              */                                                                            C:\fw\picscopefw\x017\startup.c
                                             static short long prom;                                                        C:\fw\picscopefw\x017\startup.c
                                             static unsigned short curr_byte;                                               C:\fw\picscopefw\x017\startup.c
                                             static unsigned short curr_entry;                                              C:\fw\picscopefw\x017\startup.c
                                             static short long data_ptr;                                                    C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                             // Initialized data...                                                         C:\fw\picscopefw\x017\startup.c
001f2c   0e2a     MOVLW     0x2a             TBLPTR = (short long)&_cinit;                                                  C:\fw\picscopefw\x017\startup.c
001f2e   6ef6     MOVWF     0xf6,0x0                                                                                        
001f30   0e0a     MOVLW     0xa                                                                                             
001f32   6ef7     MOVWF     0xf7,0x0                                                                                        
001f34   0e00     MOVLW     0x0                                                                                             
001f36   6ef8     MOVWF     0xf8,0x0                                                                                        
                                             _asm                                                                           C:\fw\picscopefw\x017\startup.c
001f38   0103     MOVLB     0x3                movlb data_ptr                                                               C:\fw\picscopefw\x017\startup.c
001f3a   0009     TBLRDPOSTINC                 tblrdpostinc                                                                 C:\fw\picscopefw\x017\startup.c
001f3c   50f5     MOVF      0xf5,0x0,0x0       movf TABLAT, 0, 0                                                            C:\fw\picscopefw\x017\startup.c
001f3e   6f21     MOVWF     0x21,0x1           movwf curr_entry, 1                                                          C:\fw\picscopefw\x017\startup.c
001f40   0009     TBLRDPOSTINC                 tblrdpostinc                                                                 C:\fw\picscopefw\x017\startup.c
001f42   50f5     MOVF      0xf5,0x0,0x0       movf TABLAT, 0, 0                                                            C:\fw\picscopefw\x017\startup.c
001f44   6f22     MOVWF     0x22,0x1           movwf curr_entry+1, 1                                                        C:\fw\picscopefw\x017\startup.c
                                             _endasm                                                                        C:\fw\picscopefw\x017\startup.c
                                               //while (curr_entry)                                                         C:\fw\picscopefw\x017\startup.c
                                               //{                                                                          C:\fw\picscopefw\x017\startup.c
                                               test:                                                                        C:\fw\picscopefw\x017\startup.c
                                               _asm                                                                         C:\fw\picscopefw\x017\startup.c
001f46   e103     BNZ       0x1f4e              bnz 3                                                                       C:\fw\picscopefw\x017\startup.c
001f48   6721     TSTFSZ    0x21,0x1           tstfsz curr_entry, 1                                                         C:\fw\picscopefw\x017\startup.c
001f4a   d001     BRA       0x1f4e             bra 1                                                                        C:\fw\picscopefw\x017\startup.c
                                               _endasm                                                                      C:\fw\picscopefw\x017\startup.c
001f4c   d03d     BRA       0x1fc8             goto done;                                                                   C:\fw\picscopefw\x017\startup.c
                                                 /* Count down so we only have to look up the data in _cinit                C:\fw\picscopefw\x017\startup.c
                                                  * once.                                                                   C:\fw\picscopefw\x017\startup.c
                                                  *                                                                         C:\fw\picscopefw\x017\startup.c
                                                  * At this point we know that TBLPTR points to the top of the current      C:\fw\picscopefw\x017\startup.c
                                                  * entry in _cinit, so we can just start reading the from, to, and         C:\fw\picscopefw\x017\startup.c
                                                  * size values.                                                            C:\fw\picscopefw\x017\startup.c
                                                  */                                                                        C:\fw\picscopefw\x017\startup.c
                                                 _asm                                                                       C:\fw\picscopefw\x017\startup.c
                                           	/* read the source address */                                                   C:\fw\picscopefw\x017\startup.c
001f4e   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
001f50   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\fw\picscopefw\x017\startup.c
001f52   6f1c     MOVWF     0x1c,0x1       	movwf prom, 1                                                                   C:\fw\picscopefw\x017\startup.c
001f54   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
001f56   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\fw\picscopefw\x017\startup.c
001f58   6f1d     MOVWF     0x1d,0x1       	movwf prom+1, 1                                                                 C:\fw\picscopefw\x017\startup.c
001f5a   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
001f5c   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\fw\picscopefw\x017\startup.c
001f5e   6f1e     MOVWF     0x1e,0x1       	movwf prom+2, 1                                                                 C:\fw\picscopefw\x017\startup.c
                                           	/* skip a byte since it's stored as a 32bit int */                              C:\fw\picscopefw\x017\startup.c
001f60   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
                                           	/* read the destination address directly into FSR0 */                           C:\fw\picscopefw\x017\startup.c
001f62   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
001f64   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\fw\picscopefw\x017\startup.c
001f66   6ee9     MOVWF     0xe9,0x0       	movwf FSR0L, 0                                                                  C:\fw\picscopefw\x017\startup.c
001f68   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
001f6a   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\fw\picscopefw\x017\startup.c
001f6c   6eea     MOVWF     0xea,0x0       	movwf FSR0H, 0                                                                  C:\fw\picscopefw\x017\startup.c
                                           	/* skip two bytes since it's stored as a 32bit int */                           C:\fw\picscopefw\x017\startup.c
001f6e   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
001f70   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
                                           	/* read the destination address directly into FSR0 */                           C:\fw\picscopefw\x017\startup.c
001f72   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
001f74   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\fw\picscopefw\x017\startup.c
001f76   6f1f     MOVWF     0x1f,0x1       	movwf curr_byte, 1                                                              C:\fw\picscopefw\x017\startup.c
001f78   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
001f7a   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\fw\picscopefw\x017\startup.c
001f7c   6f20     MOVWF     0x20,0x1       	movwf curr_byte+1, 1                                                            C:\fw\picscopefw\x017\startup.c
                                           	/* skip two bytes since it's stored as a 32bit int */                           C:\fw\picscopefw\x017\startup.c
001f7e   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
001f80   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
                                                 _endasm                                                                    C:\fw\picscopefw\x017\startup.c
                                                 //prom = data_ptr->from;                                                   C:\fw\picscopefw\x017\startup.c
                                                 //FSR0 = data_ptr->to;                                                     C:\fw\picscopefw\x017\startup.c
                                                 //curr_byte = (unsigned short) data_ptr->size;                             C:\fw\picscopefw\x017\startup.c
                                                 /* the table pointer now points to the next entry. Save it                 C:\fw\picscopefw\x017\startup.c
                                                  * off since we'll be using the table pointer to do the copying            C:\fw\picscopefw\x017\startup.c
                                                  * for the entry.                                                          C:\fw\picscopefw\x017\startup.c
                                                  */                                                                        C:\fw\picscopefw\x017\startup.c
001f82   cff6     MOVFF     0xff6,0x323          data_ptr = TBLPTR;                                                         C:\fw\picscopefw\x017\startup.c
001f84   f323                                                                                                               
001f86   cff7     MOVFF     0xff7,0x324                                                                                     
001f88   f324                                                                                                               
001f8a   cff8     MOVFF     0xff8,0x325                                                                                     
001f8c   f325                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                                 /* now assign the source address to the table pointer */                   C:\fw\picscopefw\x017\startup.c
001f8e   c31c     MOVFF     0x31c,0xff6          TBLPTR = prom;                                                             C:\fw\picscopefw\x017\startup.c
001f90   fff6                                                                                                               
001f92   c31d     MOVFF     0x31d,0xff7                                                                                     
001f94   fff7                                                                                                               
001f96   c31e     MOVFF     0x31e,0xff8                                                                                     
001f98   fff8                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                                 /* do the copy loop */                                                     C:\fw\picscopefw\x017\startup.c
                                                 _asm                                                                       C:\fw\picscopefw\x017\startup.c
                                                   // determine if we have any more bytes to copy                           C:\fw\picscopefw\x017\startup.c
001f9a   0103     MOVLB     0x3            	movlb curr_byte                                                                 C:\fw\picscopefw\x017\startup.c
001f9c   531f     MOVF      0x1f,0x1,0x1   	movf curr_byte, 1, 1                                                            C:\fw\picscopefw\x017\startup.c
                                           copy_loop:                                                                       C:\fw\picscopefw\x017\startup.c
001f9e   e102     BNZ       0x1fa4         	bnz 2 // copy_one_byte                                                          C:\fw\picscopefw\x017\startup.c
001fa0   5320     MOVF      0x20,0x1,0x1   	movf curr_byte + 1, 1, 1                                                        C:\fw\picscopefw\x017\startup.c
001fa2   e007     BZ        0x1fb2         	bz 7 // done_copying                                                            C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                           copy_one_byte:                                                                   C:\fw\picscopefw\x017\startup.c
001fa4   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\fw\picscopefw\x017\startup.c
001fa6   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\fw\picscopefw\x017\startup.c
001fa8   6eee     MOVWF     0xee,0x0       	movwf POSTINC0, 0                                                               C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                           	// decrement byte counter                                                       C:\fw\picscopefw\x017\startup.c
001faa   071f     DECF      0x1f,0x1,0x1   	decf curr_byte, 1, 1                                                            C:\fw\picscopefw\x017\startup.c
001fac   e2f8     BC        0x1f9e         	bc -8 // copy_loop                                                              C:\fw\picscopefw\x017\startup.c
001fae   0720     DECF      0x20,0x1,0x1           decf curr_byte + 1, 1, 1                                                 C:\fw\picscopefw\x017\startup.c
001fb0   d7f9     BRA       0x1fa4         	bra -7 // copy_one_byte                                                         C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                           done_copying:                                                                    C:\fw\picscopefw\x017\startup.c
                                                                                                                            C:\fw\picscopefw\x017\startup.c
                                                 _endasm                                                                    C:\fw\picscopefw\x017\startup.c
                                                 /* restore the table pointer for the next entry */                         C:\fw\picscopefw\x017\startup.c
001fb2   c323     MOVFF     0x323,0xff6          TBLPTR = data_ptr;                                                         C:\fw\picscopefw\x017\startup.c
001fb4   fff6                                                                                                               
001fb6   c324     MOVFF     0x324,0xff7                                                                                     
001fb8   fff7                                                                                                               
001fba   c325     MOVFF     0x325,0xff8                                                                                     
001fbc   fff8                                                                                                               
                                                 /* next entry... */                                                        C:\fw\picscopefw\x017\startup.c
001fbe   0103     MOVLB     0x3                  curr_entry--;                                                              C:\fw\picscopefw\x017\startup.c
001fc0   0721     DECF      0x21,0x1,0x1                                                                                    
001fc2   0e00     MOVLW     0x0                                                                                             
001fc4   5b22     SUBWFB    0x22,0x1,0x1                                                                                    
001fc6   d7bf     BRA       0x1f46               goto test;                                                                 C:\fw\picscopefw\x017\startup.c
                                           done:                                                                            C:\fw\picscopefw\x017\startup.c
                                           ;                                                                                C:\fw\picscopefw\x017\startup.c
001fc8   0012     RETURN    0x0            }                                                                                C:\fw\picscopefw\x017\startup.c
                                           /*********************************************************************           C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *                Microchip USB C18 Firmware Version 1.0                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *********************************************************************           C:\fw\picscopefw\x017\usb.c
                                            * FileName:        usb9.c                                                       C:\fw\picscopefw\x017\usb.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\picscopefw\x017\usb.c
                                            * Processor:       PIC18                                                        C:\fw\picscopefw\x017\usb.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\picscopefw\x017\usb.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Software License Agreement                                                    C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\picscopefw\x017\usb.c
                                            * (the Company) for its PICmicro Microcontroller is intended and             C:\fw\picscopefw\x017\usb.c
                                            * supplied to you, the Companys customer, for use solely and                   C:\fw\picscopefw\x017\usb.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\picscopefw\x017\usb.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\picscopefw\x017\usb.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\picscopefw\x017\usb.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\picscopefw\x017\usb.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\picscopefw\x017\usb.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\picscopefw\x017\usb.c
                                            * license.                                                                      C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * THIS SOFTWARE IS PROVIDED IN AN AS IS CONDITION. NO WARRANTIES,             C:\fw\picscopefw\x017\usb.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\picscopefw\x017\usb.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\picscopefw\x017\usb.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\picscopefw\x017\usb.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\picscopefw\x017\usb.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Author               Date        Comment                                      C:\fw\picscopefw\x017\usb.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           C:\fw\picscopefw\x017\usb.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    C:\fw\picscopefw\x017\usb.c
                                            ********************************************************************/           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\picscopefw\x017\usb.c
                                           #include <p18cxxx.h>                                                             C:\fw\picscopefw\x017\usb.c
                                           #include "typedefs.h"                                                            C:\fw\picscopefw\x017\usb.c
                                           #include "usb.h"                                                                 C:\fw\picscopefw\x017\usb.c
                                           //#include "io_cfg.h"                     // Required for self_power status      C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\picscopefw\x017\usb.c
                                           #pragma udata usb5                                                               C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBStdGetDscHandler(void);                                                  C:\fw\picscopefw\x017\usb.c
                                           void USBStdSetCfgHandler(void);                                                  C:\fw\picscopefw\x017\usb.c
                                           void USBStdGetStatusHandler(void);                                               C:\fw\picscopefw\x017\usb.c
                                           void USBStdFeatureReqHandler(void);                                              C:\fw\picscopefw\x017\usb.c
                                           void HIDSetReportHandler(void);                                                  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\picscopefw\x017\usb.c
                                           #pragma code                                                                     C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBCheckStdRequest(void)                                C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine checks the setup data packet to see if it       C:\fw\picscopefw\x017\usb.c
                                            *                  knows how to handle it                                       C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBCheckStdRequest(void)                                                    C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
001292   0104     MOVLB     0x4                if(SetupPkt.RequestType != STANDARD) return;                                 C:\fw\picscopefw\x017\usb.c
001294   5110     MOVF      0x10,0x0,0x1                                                                                    
001296   0b60     ANDLW     0x60                                                                                            
001298   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00129a   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00129c   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00129e   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0012a0   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0012a2   0900     IORLW     0x0                                                                                             
0012a4   e001     BZ        0x12a8                                                                                          
0012a6   d04f     BRA       0x1346                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0012a8   5111     MOVF      0x11,0x0,0x1       switch(SetupPkt.bRequest)                                                    C:\fw\picscopefw\x017\usb.c
0012aa   0a07     XORLW     0x7                                                                                             
0012ac   e04b     BZ        0x1344                                                                                          
0012ae   0a0b     XORLW     0xb                                                                                             
0012b0   e049     BZ        0x1344                                                                                          
0012b2   0a07     XORLW     0x7                                                                                             
0012b4   e03a     BZ        0x132a                                                                                          
0012b6   0a01     XORLW     0x1                                                                                             
0012b8   e028     BZ        0x130a                                                                                          
0012ba   0a0b     XORLW     0xb                                                                                             
0012bc   e024     BZ        0x1306                                                                                          
0012be   0a02     XORLW     0x2                                                                                             
0012c0   e022     BZ        0x1306                                                                                          
0012c2   0a03     XORLW     0x3                                                                                             
0012c4   e01e     BZ        0x1302                                                                                          
0012c6   0a08     XORLW     0x8                                                                                             
0012c8   e011     BZ        0x12ec                                                                                          
0012ca   0a01     XORLW     0x1                                                                                             
0012cc   e00d     BZ        0x12e8                                                                                          
0012ce   0a0f     XORLW     0xf                                                                                             
0012d0   e009     BZ        0x12e4                                                                                          
0012d2   0a03     XORLW     0x3                                                                                             
0012d4   e001     BZ        0x12d8                                                                                          
0012d6   d036     BRA       0x1344                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
                                                   case SET_ADR:                                                            C:\fw\picscopefw\x017\usb.c
0012d8   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\picscopefw\x017\usb.c
0012da   0e01     MOVLW     0x1                                                                                             
0012dc   6ff4     MOVWF     0xf4,0x1                                                                                        
0012de   0e04     MOVLW     0x4                        usb_device_state = ADR_PENDING_STATE;       // Update state only     C:\fw\picscopefw\x017\usb.c
0012e0   6fef     MOVWF     0xef,0x1                                                                                        
                                                       /* See USBCtrlTrfInHandler() in usbctrltrf.c for the next step */    C:\fw\picscopefw\x017\usb.c
0012e2   d031     BRA       0x1346                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                                   case GET_DSC:                                                            C:\fw\picscopefw\x017\usb.c
0012e4   d831     RCALL     0x1348                     USBStdGetDscHandler();                                               C:\fw\picscopefw\x017\usb.c
0012e6   d02f     BRA       0x1346                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                                   case SET_CFG:                                                            C:\fw\picscopefw\x017\usb.c
0012e8   d8b1     RCALL     0x144c                     USBStdSetCfgHandler();                                               C:\fw\picscopefw\x017\usb.c
0012ea   d02d     BRA       0x1346                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                                   case GET_CFG:                                                            C:\fw\picscopefw\x017\usb.c
0012ec   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\picscopefw\x017\usb.c
0012ee   0e01     MOVLW     0x1                                                                                             
0012f0   6ff4     MOVWF     0xf4,0x1                                                                                        
0012f2   0ef1     MOVLW     0xf1                       pSrc.bRam = (byte*)&usb_active_cfg;         // Set Source            C:\fw\picscopefw\x017\usb.c
0012f4   6ff5     MOVWF     0xf5,0x1                                                                                        
0012f6   0e00     MOVLW     0x0                                                                                             
0012f8   6ff6     MOVWF     0xf6,0x1                                                                                        
0012fa   93f0     BCF       0xf0,0x1,0x1               usb_stat.ctrl_trf_mem = _RAM;               // Set memory type       C:\fw\picscopefw\x017\usb.c
0012fc   0e01     MOVLW     0x1                        LSB(wCount) = 1;                            // Set data count        C:\fw\picscopefw\x017\usb.c
0012fe   6ff9     MOVWF     0xf9,0x1                                                                                        
001300   d022     BRA       0x1346                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                                   case GET_STATUS:                                                         C:\fw\picscopefw\x017\usb.c
001302   d8ca     RCALL     0x1498                     USBStdGetStatusHandler();                                            C:\fw\picscopefw\x017\usb.c
001304   d020     BRA       0x1346                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                                   case CLR_FEATURE:                                                        C:\fw\picscopefw\x017\usb.c
                                                   case SET_FEATURE:                                                        C:\fw\picscopefw\x017\usb.c
001306   d912     RCALL     0x152c                     USBStdFeatureReqHandler();                                           C:\fw\picscopefw\x017\usb.c
001308   d01e     BRA       0x1346                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                                   case GET_INTF:                                                           C:\fw\picscopefw\x017\usb.c
00130a   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\picscopefw\x017\usb.c
00130c   0e01     MOVLW     0x1                                                                                             
00130e   6ff4     MOVWF     0xf4,0x1                                                                                        
001310   0104     MOVLB     0x4                        pSrc.bRam = (byte*)&usb_alt_intf+SetupPkt.bIntfID;  // Set source    C:\fw\picscopefw\x017\usb.c
001312   5114     MOVF      0x14,0x0,0x1                                                                                    
001314   0100     MOVLB     0x0                                                                                             
001316   6ff5     MOVWF     0xf5,0x1                                                                                        
001318   6bf6     CLRF      0xf6,0x1                                                                                        
00131a   0ef2     MOVLW     0xf2                                                                                            
00131c   27f5     ADDWF     0xf5,0x1,0x1                                                                                    
00131e   0e00     MOVLW     0x0                                                                                             
001320   23f6     ADDWFC    0xf6,0x1,0x1                                                                                    
001322   93f0     BCF       0xf0,0x1,0x1               usb_stat.ctrl_trf_mem = _RAM;               // Set memory type       C:\fw\picscopefw\x017\usb.c
001324   0e01     MOVLW     0x1                        LSB(wCount) = 1;                            // Set data count        C:\fw\picscopefw\x017\usb.c
001326   6ff9     MOVWF     0xf9,0x1                                                                                        
001328   d00e     BRA       0x1346                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                                   case SET_INTF:                                                           C:\fw\picscopefw\x017\usb.c
00132a   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\picscopefw\x017\usb.c
00132c   0e01     MOVLW     0x1                                                                                             
00132e   6ff4     MOVWF     0xf4,0x1                                                                                        
001330   0104     MOVLB     0x4                        usb_alt_intf[SetupPkt.bIntfID] = SetupPkt.bAltID;                    C:\fw\picscopefw\x017\usb.c
001332   5114     MOVF      0x14,0x0,0x1                                                                                    
001334   6aea     CLRF      0xea,0x0                                                                                        
001336   0ff2     ADDLW     0xf2                                                                                            
001338   6ee9     MOVWF     0xe9,0x0                                                                                        
00133a   0e00     MOVLW     0x0                                                                                             
00133c   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
00133e   c412     MOVFF     0x412,0xfef                                                                                     
001340   ffef                                                                                                               
001342   d001     BRA       0x1346                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                                   case SET_DSC:                                                            C:\fw\picscopefw\x017\usb.c
                                                   case SYNCH_FRAME:                                                        C:\fw\picscopefw\x017\usb.c
                                                   default:                                                                 C:\fw\picscopefw\x017\usb.c
001344   d000     BRA       0x1346                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                               }//end switch                                                                C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001346   0012     RETURN    0x0            }//end USBCheckStdRequest                                                        C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBStdGetDscHandler(void)                               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine handles the standard GET_DESCRIPTOR request.    C:\fw\picscopefw\x017\usb.c
                                            *                  It utilizes tables dynamically looks up descriptor size.     C:\fw\picscopefw\x017\usb.c
                                            *                  This routine should never have to be modified if the tables  C:\fw\picscopefw\x017\usb.c
                                            *                  in usbdsc.c are declared correctly.                          C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBStdGetDscHandler(void)                                                   C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
001348   0e80     MOVLW     0x80               if(SetupPkt.bmRequestType == 0x80)                                           C:\fw\picscopefw\x017\usb.c
00134a   0104     MOVLB     0x4                                                                                             
00134c   5d10     SUBWF     0x10,0x0,0x1                                                                                    
00134e   e001     BZ        0x1352                                                                                          
001350   d07c     BRA       0x144a                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
001352   5113     MOVF      0x13,0x0,0x1           switch(SetupPkt.bDscType)                                                C:\fw\picscopefw\x017\usb.c
001354   0a03     XORLW     0x3                                                                                             
001356   e032     BZ        0x13bc                                                                                          
001358   0a01     XORLW     0x1                                                                                             
00135a   e00e     BZ        0x1378                                                                                          
00135c   0a03     XORLW     0x3                                                                                             
00135e   e001     BZ        0x1362                                                                                          
001360   d06b     BRA       0x1438                                                                                          
                                                   {                                                                        C:\fw\picscopefw\x017\usb.c
                                                       case DSC_DEV:                                                        C:\fw\picscopefw\x017\usb.c
001362   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_USB9;                              C:\fw\picscopefw\x017\usb.c
001364   0e01     MOVLW     0x1                                                                                             
001366   6ff4     MOVWF     0xf4,0x1                                                                                        
001368   0e52     MOVLW     0x52                           pSrc.bRom = (rom byte*)&device_dsc;                              C:\fw\picscopefw\x017\usb.c
00136a   6ff5     MOVWF     0xf5,0x1                                                                                        
00136c   0e1e     MOVLW     0x1e                                                                                            
00136e   6ff6     MOVWF     0xf6,0x1                                                                                        
001370   0e12     MOVLW     0x12                           wCount._word = sizeof(device_dsc);          // Set data count    C:\fw\picscopefw\x017\usb.c
001372   6ff9     MOVWF     0xf9,0x1                                                                                        
001374   6bfa     CLRF      0xfa,0x1                                                                                        
001376   d060     BRA       0x1438                         break;                                                           C:\fw\picscopefw\x017\usb.c
                                                       case DSC_CFG:                                                        C:\fw\picscopefw\x017\usb.c
001378   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_USB9;                              C:\fw\picscopefw\x017\usb.c
00137a   0e01     MOVLW     0x1                                                                                             
00137c   6ff4     MOVWF     0xf4,0x1                                                                                        
00137e   0104     MOVLB     0x4                            pSrc.bRom = *(USB_CD_Ptr+SetupPkt.bDscIndex);                    C:\fw\picscopefw\x017\usb.c
001380   5112     MOVF      0x12,0x0,0x1                                                                                    
001382   6ef6     MOVWF     0xf6,0x0                                                                                        
001384   6af7     CLRF      0xf7,0x0                                                                                        
001386   90d8     BCF       0xd8,0x0,0x0                                                                                    
001388   36f6     RLCF      0xf6,0x1,0x0                                                                                    
00138a   36f7     RLCF      0xf7,0x1,0x0                                                                                    
00138c   0e1c     MOVLW     0x1c                                                                                            
00138e   26f6     ADDWF     0xf6,0x1,0x0                                                                                    
001390   0e1f     MOVLW     0x1f                                                                                            
001392   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
001394   0009     TBLRDPOSTINC                                                                                              
001396   cff5     MOVFF     0xff5,0xf5                                                                                      
001398   f0f5                                                                                                               
00139a   000a     TBLRDPOSTDEC                                                                                              
00139c   cff5     MOVFF     0xff5,0xf6                                                                                      
00139e   f0f6                                                                                                               
0013a0   0e02     MOVLW     0x2                            wCount._word = *(pSrc.wRom+1);              // Set data count    C:\fw\picscopefw\x017\usb.c
0013a2   0100     MOVLB     0x0                                                                                             
0013a4   6af7     CLRF      0xf7,0x0                                                                                        
0013a6   25f5     ADDWF     0xf5,0x0,0x1                                                                                    
0013a8   6ef6     MOVWF     0xf6,0x0                                                                                        
0013aa   51f6     MOVF      0xf6,0x0,0x1                                                                                    
0013ac   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
0013ae   0009     TBLRDPOSTINC                                                                                              
0013b0   cff5     MOVFF     0xff5,0xf9                                                                                      
0013b2   f0f9                                                                                                               
0013b4   000a     TBLRDPOSTDEC                                                                                              
0013b6   cff5     MOVFF     0xff5,0xfa                                                                                      
0013b8   f0fa                                                                                                               
0013ba   d03e     BRA       0x1438                         break;                                                           C:\fw\picscopefw\x017\usb.c
                                                       case DSC_STR:                                                        C:\fw\picscopefw\x017\usb.c
0013bc   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_USB9;                              C:\fw\picscopefw\x017\usb.c
0013be   0e01     MOVLW     0x1                                                                                             
0013c0   6ff4     MOVWF     0xf4,0x1                                                                                        
0013c2   0e02     MOVLW     0x2                            if (SetupPkt.bDscIndex == INDEX_NAME || SetupPkt.bDscIndex == INDEX_SERIALNUM) { //handle as ram read C:\fw\picscopefw\x017\usb.c
0013c4   0104     MOVLB     0x4                                                                                             
0013c6   5d12     SUBWF     0x12,0x0,0x1                                                                                    
0013c8   e003     BZ        0x13d0                                                                                          
0013ca   0e03     MOVLW     0x3                                                                                             
0013cc   5d12     SUBWF     0x12,0x0,0x1                                                                                    
0013ce   e11a     BNZ       0x1404                                                                                          
0013d0   5112     MOVF      0x12,0x0,0x1                   	pSrc.bRam = *(USB_SD_Ptr+SetupPkt.bDscIndex);                   C:\fw\picscopefw\x017\usb.c
0013d2   6ef6     MOVWF     0xf6,0x0                                                                                        
0013d4   6af7     CLRF      0xf7,0x0                                                                                        
0013d6   90d8     BCF       0xd8,0x0,0x0                                                                                    
0013d8   36f6     RLCF      0xf6,0x1,0x0                                                                                    
0013da   36f7     RLCF      0xf7,0x1,0x0                                                                                    
0013dc   0e20     MOVLW     0x20                                                                                            
0013de   26f6     ADDWF     0xf6,0x1,0x0                                                                                    
0013e0   0e1f     MOVLW     0x1f                                                                                            
0013e2   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
0013e4   0009     TBLRDPOSTINC                                                                                              
0013e6   cff5     MOVFF     0xff5,0xf5                                                                                      
0013e8   f0f5                                                                                                               
0013ea   000a     TBLRDPOSTDEC                                                                                              
0013ec   cff5     MOVFF     0xff5,0xf6                                                                                      
0013ee   f0f6                                                                                                               
0013f0   0100     MOVLB     0x0            					usb_stat.ctrl_trf_mem = _RAM;       // Set memory type                      C:\fw\picscopefw\x017\usb.c
0013f2   93f0     BCF       0xf0,0x1,0x1                                                                                    
0013f4   c0f5     MOVFF     0xf5,0xfe9     	                wCount._word = *pSrc.bRam;                  // Set data count   C:\fw\picscopefw\x017\usb.c
0013f6   ffe9                                                                                                               
0013f8   c0f6     MOVFF     0xf6,0xfea                                                                                      
0013fa   ffea                                                                                                               
0013fc   50ef     MOVF      0xef,0x0,0x0                                                                                    
0013fe   6ff9     MOVWF     0xf9,0x1                                                                                        
001400   6bfa     CLRF      0xfa,0x1                                                                                        
                                                           }                                                                C:\fw\picscopefw\x017\usb.c
001402   d019     BRA       0x1436                         else {                                                           C:\fw\picscopefw\x017\usb.c
001404   5112     MOVF      0x12,0x0,0x1                   	pSrc.bRom = *(USB_SD_Ptr+SetupPkt.bDscIndex);                   C:\fw\picscopefw\x017\usb.c
001406   6ef6     MOVWF     0xf6,0x0                                                                                        
001408   6af7     CLRF      0xf7,0x0                                                                                        
00140a   90d8     BCF       0xd8,0x0,0x0                                                                                    
00140c   36f6     RLCF      0xf6,0x1,0x0                                                                                    
00140e   36f7     RLCF      0xf7,0x1,0x0                                                                                    
001410   0e20     MOVLW     0x20                                                                                            
001412   26f6     ADDWF     0xf6,0x1,0x0                                                                                    
001414   0e1f     MOVLW     0x1f                                                                                            
001416   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
001418   0009     TBLRDPOSTINC                                                                                              
00141a   cff5     MOVFF     0xff5,0xf5                                                                                      
00141c   f0f5                                                                                                               
00141e   000a     TBLRDPOSTDEC                                                                                              
001420   cff5     MOVFF     0xff5,0xf6                                                                                      
001422   f0f6                                                                                                               
001424   c0f5     MOVFF     0xf5,0xff6     	                wCount._word = *pSrc.bRom;                  // Set data count   C:\fw\picscopefw\x017\usb.c
001426   fff6                                                                                                               
001428   c0f6     MOVFF     0xf6,0xff7                                                                                      
00142a   fff7                                                                                                               
00142c   0008     TBLRD                                                                                                     
00142e   50f5     MOVF      0xf5,0x0,0x0                                                                                    
001430   0100     MOVLB     0x0                                                                                             
001432   6ff9     MOVWF     0xf9,0x1                                                                                        
001434   6bfa     CLRF      0xfa,0x1                                                                                        
                                                          	}                                                                C:\fw\picscopefw\x017\usb.c
001436   d000     BRA       0x1438                         break;                                                           C:\fw\picscopefw\x017\usb.c
                                                   }//end switch                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001438   0e02     MOVLW     0x2            		if (SetupPkt.bDscIndex != INDEX_NAME && SetupPkt.bDscIndex != INDEX_SERIALNUM) { //handle as NVR (or ram) read C:\fw\picscopefw\x017\usb.c
00143a   0104     MOVLB     0x4                                                                                             
00143c   5d12     SUBWF     0x12,0x0,0x1                                                                                    
00143e   e005     BZ        0x144a                                                                                          
001440   0e03     MOVLW     0x3                                                                                             
001442   5d12     SUBWF     0x12,0x0,0x1                                                                                    
001444   e002     BZ        0x144a                                                                                          
001446   0100     MOVLB     0x0                    	usb_stat.ctrl_trf_mem = _ROM;                       // Set memory type  C:\fw\picscopefw\x017\usb.c
001448   83f0     BSF       0xf0,0x1,0x1                                                                                    
                                                   }                                                                        C:\fw\picscopefw\x017\usb.c
                                               }//end if                                                                    C:\fw\picscopefw\x017\usb.c
00144a   0012     RETURN    0x0            }//end USBStdGetDscHandler                                                       C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBStdSetCfgHandler(void)                               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine first disables all endpoints by clearing        C:\fw\picscopefw\x017\usb.c
                                            *                  UEP registers. It then configures (initializes) endpoints    C:\fw\picscopefw\x017\usb.c
                                            *                  specified in the modifiable section.                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBStdSetCfgHandler(void)                                                   C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
00144c   0100     MOVLB     0x0                ctrl_trf_session_owner = MUID_USB9;                                          C:\fw\picscopefw\x017\usb.c
00144e   0e01     MOVLW     0x1                                                                                             
001450   6ff4     MOVWF     0xf4,0x1                                                                                        
001452   0e0f     MOVLW     0xf                mDisableEP1to15();                          // See usbdrv.h                  C:\fw\picscopefw\x017\usb.c
001454   6ee6     MOVWF     0xe6,0x0                                                                                        
001456   0e71     MOVLW     0x71                                                                                            
001458   6ee6     MOVWF     0xe6,0x0                                                                                        
00145a   0e0f     MOVLW     0xf                                                                                             
00145c   6ee6     MOVWF     0xe6,0x0                                                                                        
00145e   dac1     RCALL     0x19e2                                                                                          
001460   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001462   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001464   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001466   0e01     MOVLW     0x1                ClearArray((byte*)&usb_alt_intf,MAX_NUM_INT);                                C:\fw\picscopefw\x017\usb.c
001468   6ee6     MOVWF     0xe6,0x0                                                                                        
00146a   0ef2     MOVLW     0xf2                                                                                            
00146c   6ee6     MOVWF     0xe6,0x0                                                                                        
00146e   0e00     MOVLW     0x0                                                                                             
001470   6ee6     MOVWF     0xe6,0x0                                                                                        
001472   dab7     RCALL     0x19e2                                                                                          
001474   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001476   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001478   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00147a   c412     MOVFF     0x412,0xf1         usb_active_cfg = SetupPkt.bCfgValue;                                         C:\fw\picscopefw\x017\usb.c
00147c   f0f1                                                                                                               
00147e   0104     MOVLB     0x4                if(SetupPkt.bCfgValue == 0)                                                  C:\fw\picscopefw\x017\usb.c
001480   5112     MOVF      0x12,0x0,0x1                                                                                    
001482   e104     BNZ       0x148c                                                                                          
001484   0100     MOVLB     0x0                    usb_device_state = ADDRESS_STATE;                                        C:\fw\picscopefw\x017\usb.c
001486   0e05     MOVLW     0x5                                                                                             
001488   6fef     MOVWF     0xef,0x1                                                                                        
00148a   d005     BRA       0x1496             else                                                                         C:\fw\picscopefw\x017\usb.c
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
00148c   0100     MOVLB     0x0                    usb_device_state = CONFIGURED_STATE;                                     C:\fw\picscopefw\x017\usb.c
00148e   0e06     MOVLW     0x6                                                                                             
001490   6fef     MOVWF     0xef,0x1                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                   /* Modifiable Section */                                                 C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                   #if defined(USB_USE_HID)                // See autofiles\usbcfg.h        C:\fw\picscopefw\x017\usb.c
001492   ec93     CALL      0x1b26,0x0             HIDInitEP();                                                             C:\fw\picscopefw\x017\usb.c
001494   f00d                                                                                                               
                                                   #endif                                                                   C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                   /* End modifiable section */                                             C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               }//end if(SetupPkt.bcfgValue == 0)                                           C:\fw\picscopefw\x017\usb.c
001496   0012     RETURN    0x0            }//end USBStdSetCfgHandler                                                       C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBStdGetStatusHandler(void)                            C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine handles the standard GET_STATUS request         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBStdGetStatusHandler(void)                                                C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
001498   0104     MOVLB     0x4                CtrlTrfData._byte0 = 0;                         // Initialize content        C:\fw\picscopefw\x017\usb.c
00149a   6b18     CLRF      0x18,0x1                                                                                        
00149c   6b19     CLRF      0x19,0x1           CtrlTrfData._byte1 = 0;                                                      C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
00149e   5110     MOVF      0x10,0x0,0x1       switch(SetupPkt.Recipient)                                                   C:\fw\picscopefw\x017\usb.c
0014a0   0b1f     ANDLW     0x1f                                                                                            
0014a2   0a02     XORLW     0x2                                                                                             
0014a4   e014     BZ        0x14ce                                                                                          
0014a6   0a03     XORLW     0x3                                                                                             
0014a8   e00e     BZ        0x14c6                                                                                          
0014aa   0a01     XORLW     0x1                                                                                             
0014ac   e001     BZ        0x14b0                                                                                          
0014ae   d033     BRA       0x1516                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
                                                   case RCPT_DEV:                                                           C:\fw\picscopefw\x017\usb.c
0014b0   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\picscopefw\x017\usb.c
0014b2   0e01     MOVLW     0x1                                                                                             
0014b4   6ff4     MOVWF     0xf4,0x1                                                                                        
                                                       /*                                                                   C:\fw\picscopefw\x017\usb.c
                                                        * _byte0: bit0: Self-Powered Status [0] Bus-Powered [1] Self-Powered C:\fw\picscopefw\x017\usb.c
                                                        *         bit1: RemoteWakeup        [0] Disabled    [1] Enabled     C:\fw\picscopefw\x017\usb.c
                                                        */                                                                  C:\fw\picscopefw\x017\usb.c
                                                       if(self_power == 1)                     // self_power defined in io_cfg.h C:\fw\picscopefw\x017\usb.c
0014b6   0104     MOVLB     0x4                            CtrlTrfData._byte0|=0b000000001;    // Set bit0                  C:\fw\picscopefw\x017\usb.c
0014b8   8118     BSF       0x18,0x0,0x1                                                                                    
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0014ba   0100     MOVLB     0x0                        if(usb_stat.RemoteWakeup == 1)          // usb_stat defined in usbmmap.c C:\fw\picscopefw\x017\usb.c
0014bc   a1f0     BTFSS     0xf0,0x0,0x1                                                                                    
0014be   d002     BRA       0x14c4                                                                                          
0014c0   0104     MOVLB     0x4                            CtrlTrfData._byte0|=0b00000010;     // Set bit1                  C:\fw\picscopefw\x017\usb.c
0014c2   8318     BSF       0x18,0x1,0x1                                                                                    
0014c4   d028     BRA       0x1516                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                                   case RCPT_INTF:                                                          C:\fw\picscopefw\x017\usb.c
0014c6   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;     // No data to update         C:\fw\picscopefw\x017\usb.c
0014c8   0e01     MOVLW     0x1                                                                                             
0014ca   6ff4     MOVWF     0xf4,0x1                                                                                        
0014cc   d024     BRA       0x1516                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                                   case RCPT_EP:                                                            C:\fw\picscopefw\x017\usb.c
0014ce   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\picscopefw\x017\usb.c
0014d0   0e01     MOVLW     0x1                                                                                             
0014d2   6ff4     MOVWF     0xf4,0x1                                                                                        
                                                       /*                                                                   C:\fw\picscopefw\x017\usb.c
                                                        * _byte0: bit0: Halt Status [0] Not Halted [1] Halted               C:\fw\picscopefw\x017\usb.c
                                                        */                                                                  C:\fw\picscopefw\x017\usb.c
0014d4   0104     MOVLB     0x4                        pDst.bRam = (byte*)&ep0Bo+(SetupPkt.EPNum*8)+(SetupPkt.EPDir*4);     C:\fw\picscopefw\x017\usb.c
0014d6   5114     MOVF      0x14,0x0,0x1                                                                                    
0014d8   0b0f     ANDLW     0xf                                                                                             
0014da   0d08     MULLW     0x8                                                                                             
0014dc   50f3     MOVF      0xf3,0x0,0x0                                                                                    
0014de   6a03     CLRF      0x3,0x0                                                                                         
0014e0   0f00     ADDLW     0x0                                                                                             
0014e2   6e02     MOVWF     0x2,0x0                                                                                         
0014e4   0e04     MOVLW     0x4                                                                                             
0014e6   2203     ADDWFC    0x3,0x1,0x0                                                                                     
0014e8   5114     MOVF      0x14,0x0,0x1                                                                                    
0014ea   0b80     ANDLW     0x80                                                                                            
0014ec   e001     BZ        0x14f0                                                                                          
0014ee   0e01     MOVLW     0x1                                                                                             
0014f0   0d04     MULLW     0x4                                                                                             
0014f2   50f3     MOVF      0xf3,0x0,0x0                                                                                    
0014f4   0100     MOVLB     0x0                                                                                             
0014f6   2402     ADDWF     0x2,0x0,0x0                                                                                     
0014f8   6ff7     MOVWF     0xf7,0x1                                                                                        
0014fa   0e00     MOVLW     0x0                                                                                             
0014fc   2003     ADDWFC    0x3,0x0,0x0                                                                                     
0014fe   6ff8     MOVWF     0xf8,0x1                                                                                        
001500   c0f7     MOVFF     0xf7,0xfe9                 if(*pDst.bRam & _BSTALL)    // Use _BSTALL as a bit mask             C:\fw\picscopefw\x017\usb.c
001502   ffe9                                                                                                               
001504   c0f8     MOVFF     0xf8,0xfea                                                                                      
001506   ffea                                                                                                               
001508   50ef     MOVF      0xef,0x0,0x0                                                                                    
00150a   0b04     ANDLW     0x4                                                                                             
00150c   e003     BZ        0x1514                                                                                          
00150e   0104     MOVLB     0x4                            CtrlTrfData._byte0=0x01;// Set bit0                              C:\fw\picscopefw\x017\usb.c
001510   0e01     MOVLW     0x1                                                                                             
001512   6f18     MOVWF     0x18,0x1                                                                                        
001514   d000     BRA       0x1516                     break;                                                               C:\fw\picscopefw\x017\usb.c
                                               }//end switch                                                                C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001516   0100     MOVLB     0x0                if(ctrl_trf_session_owner == MUID_USB9)                                      C:\fw\picscopefw\x017\usb.c
001518   05f4     DECF      0xf4,0x0,0x1                                                                                    
00151a   e107     BNZ       0x152a                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
00151c   0e18     MOVLW     0x18                   pSrc.bRam = (byte*)&CtrlTrfData;            // Set Source                C:\fw\picscopefw\x017\usb.c
00151e   6ff5     MOVWF     0xf5,0x1                                                                                        
001520   0e04     MOVLW     0x4                                                                                             
001522   6ff6     MOVWF     0xf6,0x1                                                                                        
001524   93f0     BCF       0xf0,0x1,0x1           usb_stat.ctrl_trf_mem = _RAM;               // Set memory type           C:\fw\picscopefw\x017\usb.c
001526   0e02     MOVLW     0x2                    LSB(wCount) = 2;                            // Set data count            C:\fw\picscopefw\x017\usb.c
001528   6ff9     MOVWF     0xf9,0x1                                                                                        
                                               }//end if(...)                                                               C:\fw\picscopefw\x017\usb.c
00152a   0012     RETURN    0x0            }//end USBStdGetStatusHandler                                                    C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBStdFeatureReqHandler(void)                           C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine handles the standard SET & CLEAR FEATURES       C:\fw\picscopefw\x017\usb.c
                                            *                  requests                                                     C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBStdFeatureReqHandler(void)                                               C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
00152c   0104     MOVLB     0x4                if((SetupPkt.bFeature == DEVICE_REMOTE_WAKEUP)&&                             C:\fw\picscopefw\x017\usb.c
00152e   0512     DECF      0x12,0x0,0x1                                                                                    
001530   e110     BNZ       0x1552                (SetupPkt.Recipient == RCPT_DEV))                                         C:\fw\picscopefw\x017\usb.c
001532   5110     MOVF      0x10,0x0,0x1                                                                                    
001534   0b1f     ANDLW     0x1f                                                                                            
001536   0900     IORLW     0x0                                                                                             
001538   e10c     BNZ       0x1552                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
00153a   0100     MOVLB     0x0                    ctrl_trf_session_owner = MUID_USB9;                                      C:\fw\picscopefw\x017\usb.c
00153c   0e01     MOVLW     0x1                                                                                             
00153e   6ff4     MOVWF     0xf4,0x1                                                                                        
001540   0e03     MOVLW     0x3                    if(SetupPkt.bRequest == SET_FEATURE)                                     C:\fw\picscopefw\x017\usb.c
001542   0104     MOVLB     0x4                                                                                             
001544   5d11     SUBWF     0x11,0x0,0x1                                                                                    
001546   e103     BNZ       0x154e                                                                                          
001548   0100     MOVLB     0x0                        usb_stat.RemoteWakeup = 1;                                           C:\fw\picscopefw\x017\usb.c
00154a   81f0     BSF       0xf0,0x0,0x1                                                                                    
00154c   d002     BRA       0x1552                 else                                                                     C:\fw\picscopefw\x017\usb.c
00154e   0100     MOVLB     0x0                        usb_stat.RemoteWakeup = 0;                                           C:\fw\picscopefw\x017\usb.c
001550   91f0     BCF       0xf0,0x0,0x1                                                                                    
                                               }//end if                                                                    C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001552   0104     MOVLB     0x4                if((SetupPkt.bFeature == ENDPOINT_HALT)&&                                    C:\fw\picscopefw\x017\usb.c
001554   5112     MOVF      0x12,0x0,0x1                                                                                    
001556   e13a     BNZ       0x15cc                (SetupPkt.Recipient == RCPT_EP)&&                                         C:\fw\picscopefw\x017\usb.c
001558   5110     MOVF      0x10,0x0,0x1                                                                                    
00155a   0b1f     ANDLW     0x1f                                                                                            
00155c   0802     SUBLW     0x2                                                                                             
00155e   e136     BNZ       0x15cc                                                                                          
001560   5114     MOVF      0x14,0x0,0x1          (SetupPkt.EPNum != 0))                                                    C:\fw\picscopefw\x017\usb.c
001562   0b0f     ANDLW     0xf                                                                                             
001564   0900     IORLW     0x0                                                                                             
001566   e032     BZ        0x15cc                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
001568   0100     MOVLB     0x0                    ctrl_trf_session_owner = MUID_USB9;                                      C:\fw\picscopefw\x017\usb.c
00156a   0e01     MOVLW     0x1                                                                                             
00156c   6ff4     MOVWF     0xf4,0x1                                                                                        
                                                   /* Must do address calculation here */                                   C:\fw\picscopefw\x017\usb.c
00156e   0104     MOVLB     0x4                    pDst.bRam = (byte*)&ep0Bo+(SetupPkt.EPNum*8)+(SetupPkt.EPDir*4);         C:\fw\picscopefw\x017\usb.c
001570   5114     MOVF      0x14,0x0,0x1                                                                                    
001572   0b0f     ANDLW     0xf                                                                                             
001574   0d08     MULLW     0x8                                                                                             
001576   50f3     MOVF      0xf3,0x0,0x0                                                                                    
001578   6a03     CLRF      0x3,0x0                                                                                         
00157a   0f00     ADDLW     0x0                                                                                             
00157c   6e02     MOVWF     0x2,0x0                                                                                         
00157e   0e04     MOVLW     0x4                                                                                             
001580   2203     ADDWFC    0x3,0x1,0x0                                                                                     
001582   5114     MOVF      0x14,0x0,0x1                                                                                    
001584   0b80     ANDLW     0x80                                                                                            
001586   e001     BZ        0x158a                                                                                          
001588   0e01     MOVLW     0x1                                                                                             
00158a   0d04     MULLW     0x4                                                                                             
00158c   50f3     MOVF      0xf3,0x0,0x0                                                                                    
00158e   0100     MOVLB     0x0                                                                                             
001590   2402     ADDWF     0x2,0x0,0x0                                                                                     
001592   6ff7     MOVWF     0xf7,0x1                                                                                        
001594   0e00     MOVLW     0x0                                                                                             
001596   2003     ADDWFC    0x3,0x0,0x0                                                                                     
001598   6ff8     MOVWF     0xf8,0x1                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\usb.c
00159a   0e03     MOVLW     0x3                    if(SetupPkt.bRequest == SET_FEATURE)                                     C:\fw\picscopefw\x017\usb.c
00159c   0104     MOVLB     0x4                                                                                             
00159e   5d11     SUBWF     0x11,0x0,0x1                                                                                    
0015a0   e107     BNZ       0x15b0                                                                                          
0015a2   0e84     MOVLW     0x84                       *pDst.bRam = _USIE|_BSTALL;                                          C:\fw\picscopefw\x017\usb.c
0015a4   c0f7     MOVFF     0xf7,0xfe9                                                                                      
0015a6   ffe9                                                                                                               
0015a8   c0f8     MOVFF     0xf8,0xfea                                                                                      
0015aa   ffea                                                                                                               
0015ac   6eef     MOVWF     0xef,0x0                                                                                        
0015ae   d00e     BRA       0x15cc                 else                                                                     C:\fw\picscopefw\x017\usb.c
                                                   {                                                                        C:\fw\picscopefw\x017\usb.c
0015b0   af14     BTFSS     0x14,0x7,0x1               if(SetupPkt.EPDir == 1) // IN                                        C:\fw\picscopefw\x017\usb.c
0015b2   d006     BRA       0x15c0                                                                                          
0015b4   c0f7     MOVFF     0xf7,0xfe9                     *pDst.bRam = _UCPU;                                              C:\fw\picscopefw\x017\usb.c
0015b6   ffe9                                                                                                               
0015b8   c0f8     MOVFF     0xf8,0xfea                                                                                      
0015ba   ffea                                                                                                               
0015bc   6aef     CLRF      0xef,0x0                                                                                        
0015be   d006     BRA       0x15cc                     else                                                                 C:\fw\picscopefw\x017\usb.c
0015c0   0e88     MOVLW     0x88                           *pDst.bRam = _USIE|_DAT0|_DTSEN;                                 C:\fw\picscopefw\x017\usb.c
0015c2   c0f7     MOVFF     0xf7,0xfe9                                                                                      
0015c4   ffe9                                                                                                               
0015c6   c0f8     MOVFF     0xf8,0xfea                                                                                      
0015c8   ffea                                                                                                               
0015ca   6eef     MOVWF     0xef,0x0                                                                                        
                                                   }//end if                                                                C:\fw\picscopefw\x017\usb.c
                                               }//end if                                                                    C:\fw\picscopefw\x017\usb.c
0015cc   0012     RETURN    0x0            }//end USBStdFeatureReqHandler                                                   C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** EOF usb9.c ***************************************************************/  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           //usbmmap.c                                                                      C:\fw\picscopefw\x017\usb.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\picscopefw\x017\usb.c
                                           #include "typedefs.h"                                                            C:\fw\picscopefw\x017\usb.c
                                           #include "usb.h"                                                                 C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** U S B  G L O B A L  V A R I A B L E S ************************************/  C:\fw\picscopefw\x017\usb.c
                                           #pragma udata usb5                                                               C:\fw\picscopefw\x017\usb.c
                                           byte usb_device_state;          // Device States: DETACHED, ATTACHED, ...        C:\fw\picscopefw\x017\usb.c
                                           USB_DEVICE_STATUS usb_stat;     // Global USB flags                              C:\fw\picscopefw\x017\usb.c
                                           byte usb_active_cfg;            // Value of current configuration                C:\fw\picscopefw\x017\usb.c
                                           byte usb_alt_intf[MAX_NUM_INT]; // Array to keep track of the current alternate  C:\fw\picscopefw\x017\usb.c
                                                                           // setting for each interface ID                 C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** U S B  F I X E D  L O C A T I O N  V A R I A B L E S *********************/  C:\fw\picscopefw\x017\usb.c
                                           //#pragma udata usbram4=0x400     //See Linker Script,usb4:0x400-0x4FF(256-byte) C:\fw\picscopefw\x017\usb.c
                                           #pragma udata overlay usbram4=0x400     //See Linker Script,usb4:0x400-0x4FF(256-byte) C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Section A: Buffer Descriptor Table                                            C:\fw\picscopefw\x017\usb.c
                                            * - 0x400 - 0x4FF(max)                                                          C:\fw\picscopefw\x017\usb.c
                                            * - MAX_EP_NUMBER is defined in autofiles\usbcfg.h                              C:\fw\picscopefw\x017\usb.c
                                            * - BDT data type is defined in system\usb\usbmmap.h                            C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(0 <= MAX_EP_NUMBER)                                                          C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep0Bo;         //Endpoint #0 BD Out                             C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep0Bi;         //Endpoint #0 BD In                              C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(1 <= MAX_EP_NUMBER)                                                          C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep1Bo;         //Endpoint #1 BD Out                             C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep1Bi;         //Endpoint #1 BD In                              C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(2 <= MAX_EP_NUMBER)                                                          C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep2Bo;         //Endpoint #2 BD Out                             C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep2Bi;         //Endpoint #2 BD In                              C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(3 <= MAX_EP_NUMBER)                                                          C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep3Bo;         //Endpoint #3 BD Out                             C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep3Bi;         //Endpoint #3 BD In                              C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(4 <= MAX_EP_NUMBER)                                                          C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep4Bo;         //Endpoint #4 BD Out                             C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep4Bi;         //Endpoint #4 BD In                              C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(5 <= MAX_EP_NUMBER)                                                          C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep5Bo;         //Endpoint #5 BD Out                             C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep5Bi;         //Endpoint #5 BD In                              C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(6 <= MAX_EP_NUMBER)                                                          C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep6Bo;         //Endpoint #6 BD Out                             C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep6Bi;         //Endpoint #6 BD In                              C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(7 <= MAX_EP_NUMBER)                                                          C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep7Bo;         //Endpoint #7 BD Out                             C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep7Bi;         //Endpoint #7 BD In                              C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(8 <= MAX_EP_NUMBER)                                                          C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep8Bo;         //Endpoint #8 BD Out                             C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep8Bi;         //Endpoint #8 BD In                              C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(9 <= MAX_EP_NUMBER)                                                          C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep9Bo;         //Endpoint #9 BD Out                             C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep9Bi;         //Endpoint #9 BD In                              C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(10 <= MAX_EP_NUMBER)                                                         C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep10Bo;        //Endpoint #10 BD Out                            C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep10Bi;        //Endpoint #10 BD In                             C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(11 <= MAX_EP_NUMBER)                                                         C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep11Bo;        //Endpoint #11 BD Out                            C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep11Bi;        //Endpoint #11 BD In                             C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(12 <= MAX_EP_NUMBER)                                                         C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep12Bo;        //Endpoint #12 BD Out                            C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep12Bi;        //Endpoint #12 BD In                             C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(13 <= MAX_EP_NUMBER)                                                         C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep13Bo;        //Endpoint #13 BD Out                            C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep13Bi;        //Endpoint #13 BD In                             C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(14 <= MAX_EP_NUMBER)                                                         C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep14Bo;        //Endpoint #14 BD Out                            C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep14Bi;        //Endpoint #14 BD In                             C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #if(15 <= MAX_EP_NUMBER)                                                         C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep15Bo;        //Endpoint #15 BD Out                            C:\fw\picscopefw\x017\usb.c
                                           volatile far BDT ep15Bi;        //Endpoint #15 BD In                             C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Section B: EP0 Buffer Space                                                   C:\fw\picscopefw\x017\usb.c
                                            ******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * - Two buffer areas are defined:                                               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *   A. CTRL_TRF_SETUP                                                           C:\fw\picscopefw\x017\usb.c
                                            *      - Size = EP0_BUFF_SIZE as defined in autofiles\usbcfg.h                  C:\fw\picscopefw\x017\usb.c
                                            *      - Detailed data structure allows direct adddressing of bits and bytes.   C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *   B. CTRL_TRF_DATA                                                            C:\fw\picscopefw\x017\usb.c
                                            *      - Size = EP0_BUFF_SIZE as defined in autofiles\usbcfg.h                  C:\fw\picscopefw\x017\usb.c
                                            *      - Data structure allows direct adddressing of the first 8 bytes.         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * - Both data types are defined in system\usb\usbdefs\usbdefs_ep0_buff.h        C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           volatile far CTRL_TRF_SETUP SetupPkt;                                            C:\fw\picscopefw\x017\usb.c
                                           volatile far CTRL_TRF_DATA CtrlTrfData;                                          C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Section C: HID Buffer                                                         C:\fw\picscopefw\x017\usb.c
                                            ******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           #if defined(USB_USE_HID)                                                         C:\fw\picscopefw\x017\usb.c
                                           volatile far unsigned char hid_report_out[HID_INT_OUT_EP_SIZE];                  C:\fw\picscopefw\x017\usb.c
                                           volatile far unsigned char hid_report_in[HID_INT_IN_EP_SIZE];                    C:\fw\picscopefw\x017\usb.c
                                           #endif                                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           #pragma udata usb5                                                               C:\fw\picscopefw\x017\usb.c
                                           /** EOF usbmmap.c ************************************************************/  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           //usbctrltrf.c                                                                   C:\fw\picscopefw\x017\usb.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\picscopefw\x017\usb.c
                                           #include <p18cxxx.h>                                                             C:\fw\picscopefw\x017\usb.c
                                           #include "typedefs.h"                                                            C:\fw\picscopefw\x017\usb.c
                                           #include "usb.h"                                                                 C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\picscopefw\x017\usb.c
                                           #pragma udata usb5                                                               C:\fw\picscopefw\x017\usb.c
                                           byte ctrl_trf_state;                // Control Transfer State                    C:\fw\picscopefw\x017\usb.c
                                           byte ctrl_trf_session_owner;        // Current transfer session owner            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           POINTER pSrc;                       // Data source pointer                       C:\fw\picscopefw\x017\usb.c
                                           POINTER pDst;                       // Data destination pointer                  C:\fw\picscopefw\x017\usb.c
                                           WORD wCount;                        // Data counter                              C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBCtrlTrfSetupHandler(void);                                               C:\fw\picscopefw\x017\usb.c
                                           void USBCtrlTrfOutHandler(void);                                                 C:\fw\picscopefw\x017\usb.c
                                           void USBCtrlTrfInHandler(void);                                                  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\picscopefw\x017\usb.c
                                           #pragma code                                                                     C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBCtrlEPService(void)                                  C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    USTAT is loaded with a valid endpoint address.               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        USBCtrlEPService checks for three transaction types that     C:\fw\picscopefw\x017\usb.c
                                            *                  it knows how to service and services them:                   C:\fw\picscopefw\x017\usb.c
                                            *                  1. EP0 SETUP                                                 C:\fw\picscopefw\x017\usb.c
                                            *                  2. EP0 OUT                                                   C:\fw\picscopefw\x017\usb.c
                                            *                  3. EP0 IN                                                    C:\fw\picscopefw\x017\usb.c
                                            *                  It ignores all other types (i.e. EP1, EP2, etc.)             C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBCtrlEPService(void)                                                      C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
0015ce   506c     MOVF      0x6c,0x0,0x0       if(USTAT == EP00_OUT)                                                        C:\fw\picscopefw\x017\usb.c
0015d0   e10b     BNZ       0x15e8                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
0015d2   0104     MOVLB     0x4                    if(ep0Bo.Stat.PID == SETUP_TOKEN)           // EP0 SETUP                 C:\fw\picscopefw\x017\usb.c
0015d4   5100     MOVF      0x0,0x0,0x1                                                                                     
0015d6   0b3c     ANDLW     0x3c                                                                                            
0015d8   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0015da   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0015dc   080d     SUBLW     0xd                                                                                             
0015de   e102     BNZ       0x15e4                                                                                          
0015e0   d808     RCALL     0x15f2                     USBCtrlTrfSetupHandler();                                            C:\fw\picscopefw\x017\usb.c
0015e2   d001     BRA       0x15e6                 else                                        // EP0 OUT                   C:\fw\picscopefw\x017\usb.c
0015e4   d83b     RCALL     0x165c                     USBCtrlTrfOutHandler();                                              C:\fw\picscopefw\x017\usb.c
                                               }                                                                            C:\fw\picscopefw\x017\usb.c
0015e6   d004     BRA       0x15f0             else if(USTAT == EP00_IN)                       // EP0 IN                    C:\fw\picscopefw\x017\usb.c
0015e8   0e04     MOVLW     0x4                                                                                             
0015ea   5c6c     SUBWF     0x6c,0x0,0x0                                                                                    
0015ec   e101     BNZ       0x15f0                                                                                          
0015ee   d846     RCALL     0x167c                 USBCtrlTrfInHandler();                                                   C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0015f0   0012     RETURN    0x0            }//end USBCtrlEPService                                                          C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBCtrlTrfSetupHandler(void)                            C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    SetupPkt buffer is loaded with valid USB Setup Data          C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine is a task dispatcher and has 3 stages.          C:\fw\picscopefw\x017\usb.c
                                            *                  1. It initializes the control transfer state machine.        C:\fw\picscopefw\x017\usb.c
                                            *                  2. It calls on each of the module that may know how to       C:\fw\picscopefw\x017\usb.c
                                            *                     service the Setup Request from the host.                  C:\fw\picscopefw\x017\usb.c
                                            *                     Module Example: USB9, HID, CDC, MSD, ...                  C:\fw\picscopefw\x017\usb.c
                                            *                     As new classes are added, ClassReqHandler table in        C:\fw\picscopefw\x017\usb.c
                                            *                     usbdsc.c should be updated to call all available          C:\fw\picscopefw\x017\usb.c
                                            *                     class handlers.                                           C:\fw\picscopefw\x017\usb.c
                                            *                  3. Once each of the modules has had a chance to check if     C:\fw\picscopefw\x017\usb.c
                                            *                     it is responsible for servicing the request, stage 3      C:\fw\picscopefw\x017\usb.c
                                            *                     then checks direction of the transfer to determine how    C:\fw\picscopefw\x017\usb.c
                                            *                     to prepare EP0 for the control transfer.                  C:\fw\picscopefw\x017\usb.c
                                            *                     Refer to USBCtrlEPServiceComplete() for more details.     C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            Microchip USB Firmware has three different states for        C:\fw\picscopefw\x017\usb.c
                                            *                  the control transfer state machine:                          C:\fw\picscopefw\x017\usb.c
                                            *                  1. WAIT_SETUP                                                C:\fw\picscopefw\x017\usb.c
                                            *                  2. CTRL_TRF_TX                                               C:\fw\picscopefw\x017\usb.c
                                            *                  3. CTRL_TRF_RX                                               C:\fw\picscopefw\x017\usb.c
                                            *                  Refer to firmware manual to find out how one state           C:\fw\picscopefw\x017\usb.c
                                            *                  is transitioned to another.                                  C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *                  A Control Transfer is composed of many USB transactions.     C:\fw\picscopefw\x017\usb.c
                                            *                  When transferring data over multiple transactions,           C:\fw\picscopefw\x017\usb.c
                                            *                  it is important to keep track of data source, data           C:\fw\picscopefw\x017\usb.c
                                            *                  destination, and data count. These three parameters are      C:\fw\picscopefw\x017\usb.c
                                            *                  stored in pSrc,pDst, and wCount. A flag is used to           C:\fw\picscopefw\x017\usb.c
                                            *                  note if the data source is from ROM or RAM.                  C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
0015f2   cfd9     MOVFF     0xfd9,0xfe6    void USBCtrlTrfSetupHandler(void)                                                C:\fw\picscopefw\x017\usb.c
0015f4   ffe6                                                                                                               
0015f6   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
0015f8   ffd9                                                                                                               
0015fa   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
                                               byte i;                                                                      C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /* Stage 1 */                                                                C:\fw\picscopefw\x017\usb.c
0015fc   0100     MOVLB     0x0                ctrl_trf_state = WAIT_SETUP;                                                 C:\fw\picscopefw\x017\usb.c
0015fe   6bf3     CLRF      0xf3,0x1                                                                                        
001600   6bf4     CLRF      0xf4,0x1           ctrl_trf_session_owner = MUID_NULL;     // Set owner to NULL                 C:\fw\picscopefw\x017\usb.c
001602   6bf9     CLRF      0xf9,0x1           wCount._word = 0;                                                            C:\fw\picscopefw\x017\usb.c
001604   6bfa     CLRF      0xfa,0x1                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /* Stage 2 */                                                                C:\fw\picscopefw\x017\usb.c
001606   de45     RCALL     0x1292             USBCheckStdRequest();                   // See system\usb9\usb9.c            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /* Modifiable Section */                                                     C:\fw\picscopefw\x017\usb.c
001608   6adf     CLRF      0xdf,0x0           for(i=0;i < (sizeof(ClassReqHandler)/sizeof(pFunc));i++)                     C:\fw\picscopefw\x017\usb.c
00160a   50df     MOVF      0xdf,0x0,0x0                                                                                    
00160c   6e02     MOVWF     0x2,0x0                                                                                         
00160e   6a03     CLRF      0x3,0x0                                                                                         
001610   0e01     MOVLW     0x1                                                                                             
001612   5c02     SUBWF     0x2,0x0,0x0                                                                                     
001614   0e00     MOVLW     0x0                                                                                             
001616   5803     SUBWFB    0x3,0x0,0x0                                                                                     
001618   e21b     BC        0x1650                                                                                          
00164c   2adf     INCF      0xdf,0x1,0x0                                                                                    
00164e   d7dd     BRA       0x160a                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
00161a   0100     MOVLB     0x0                    if(ctrl_trf_session_owner != MUID_NULL)break;                            C:\fw\picscopefw\x017\usb.c
00161c   51f4     MOVF      0xf4,0x0,0x1                                                                                    
00161e   e001     BZ        0x1622                                                                                          
001620   d017     BRA       0x1650                                                                                          
001622   6af7     CLRF      0xf7,0x0               ClassReqHandler[i]();               // See autofiles\usbdsc.c            C:\fw\picscopefw\x017\usb.c
001624   34df     RLCF      0xdf,0x0,0x0                                                                                    
001626   0bfe     ANDLW     0xfe                                                                                            
001628   36f7     RLCF      0xf7,0x1,0x0                                                                                    
00162a   6ef6     MOVWF     0xf6,0x0                                                                                        
00162c   0e2a     MOVLW     0x2a                                                                                            
00162e   26f6     ADDWF     0xf6,0x1,0x0                                                                                    
001630   0e1f     MOVLW     0x1f                                                                                            
001632   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
001634   0009     TBLRDPOSTINC                                                                                              
001636   cff5     MOVFF     0xff5,0x2                                                                                       
001638   f002                                                                                                               
00163a   0008     TBLRD                                                                                                     
00163c   cff5     MOVFF     0xff5,0x3                                                                                       
00163e   f003                                                                                                               
001640   d004     BRA       0x164a                                                                                          
001642   c003     MOVFF     0x3,0xffa                                                                                       
001644   fffa                                                                                                               
001646   5002     MOVF      0x2,0x0,0x0                                                                                     
001648   6ef9     MOVWF     0xf9,0x0                                                                                        
00164a   dffb     RCALL     0x1642                                                                                          
                                               }//end while                                                                 C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /* End Modifiable Section */                                                 C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /* Stage 3 */                                                                C:\fw\picscopefw\x017\usb.c
001650   d8d7     RCALL     0x1800             USBCtrlEPServiceComplete();                                                  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001652   52e5     MOVF      0xe5,0x1,0x0   }//end USBCtrlTrfSetupHandler                                                    C:\fw\picscopefw\x017\usb.c
001654   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001656   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001658   ffd9                                                                                                               
00165a   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBCtrlTrfOutHandler(void)                              C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine handles an OUT transaction according to         C:\fw\picscopefw\x017\usb.c
                                            *                  which control transfer state is currently active.            C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            Note that if the the control transfer was from               C:\fw\picscopefw\x017\usb.c
                                            *                  host to device, the session owner should be notified         C:\fw\picscopefw\x017\usb.c
                                            *                  at the end of each OUT transaction to service the            C:\fw\picscopefw\x017\usb.c
                                            *                  received data.                                               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBCtrlTrfOutHandler(void)                                                  C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
00165c   0e02     MOVLW     0x2                if(ctrl_trf_state == CTRL_TRF_RX)                                            C:\fw\picscopefw\x017\usb.c
00165e   0100     MOVLB     0x0                                                                                             
001660   5df3     SUBWF     0xf3,0x0,0x1                                                                                    
001662   e10a     BNZ       0x1678                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
001664   d894     RCALL     0x178e                 USBCtrlTrfRxService();                                                   C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                   /*                                                                       C:\fw\picscopefw\x017\usb.c
                                                    * Don't have to worry about overwriting _KEEP bit                       C:\fw\picscopefw\x017\usb.c
                                                    * because if _KEEP was set, TRNIF would not have been                   C:\fw\picscopefw\x017\usb.c
                                                    * generated in the first place.                                         C:\fw\picscopefw\x017\usb.c
                                                    */                                                                      C:\fw\picscopefw\x017\usb.c
001666   0104     MOVLB     0x4                    if(ep0Bo.Stat.DTS == 0)                                                  C:\fw\picscopefw\x017\usb.c
001668   bd00     BTFSC     0x0,0x6,0x1                                                                                     
00166a   d003     BRA       0x1672                                                                                          
00166c   0ec8     MOVLW     0xc8                       ep0Bo.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\picscopefw\x017\usb.c
00166e   6f00     MOVWF     0x0,0x1                                                                                         
001670   d002     BRA       0x1676                 else                                                                     C:\fw\picscopefw\x017\usb.c
001672   0e88     MOVLW     0x88                       ep0Bo.Stat._byte = _USIE|_DAT0|_DTSEN;                               C:\fw\picscopefw\x017\usb.c
001674   6f00     MOVWF     0x0,0x1                                                                                         
                                               }                                                                            C:\fw\picscopefw\x017\usb.c
001676   d001     BRA       0x167a             else    // CTRL_TRF_TX                                                       C:\fw\picscopefw\x017\usb.c
001678   d906     RCALL     0x1886                 USBPrepareForNextSetupTrf();                                             C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
00167a   0012     RETURN    0x0            }//end USBCtrlTrfOutHandler                                                      C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBCtrlTrfInHandler(void)                               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine handles an IN transaction according to          C:\fw\picscopefw\x017\usb.c
                                            *                  which control transfer state is currently active.            C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            A Set Address Request must not change the acutal address     C:\fw\picscopefw\x017\usb.c
                                            *                  of the device until the completion of the control            C:\fw\picscopefw\x017\usb.c
                                            *                  transfer. The end of the control transfer for Set Address    C:\fw\picscopefw\x017\usb.c
                                            *                  Request is an IN transaction. Therefore it is necessary      C:\fw\picscopefw\x017\usb.c
                                            *                  to service this unique situation when the condition is       C:\fw\picscopefw\x017\usb.c
                                            *                  right. Macro mUSBCheckAdrPendingState is defined in          C:\fw\picscopefw\x017\usb.c
                                            *                  usb9.h and its function is to specifically service this      C:\fw\picscopefw\x017\usb.c
                                            *                  event.                                                       C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBCtrlTrfInHandler(void)                                                   C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
00167c   0e04     MOVLW     0x4                mUSBCheckAdrPendingState();         // Must check if in ADR_PENDING_STATE    C:\fw\picscopefw\x017\usb.c
00167e   0100     MOVLB     0x0                                                                                             
001680   5def     SUBWF     0xef,0x0,0x1                                                                                    
001682   e10a     BNZ       0x1698                                                                                          
001684   c412     MOVFF     0x412,0xf6e                                                                                     
001686   ff6e                                                                                                               
001688   506e     MOVF      0x6e,0x0,0x0                                                                                    
00168a   0800     SUBLW     0x0                                                                                             
00168c   e203     BC        0x1694                                                                                          
00168e   0e05     MOVLW     0x5                                                                                             
001690   6fef     MOVWF     0xef,0x1                                                                                        
001692   d002     BRA       0x1698                                                                                          
001694   0e03     MOVLW     0x3                                                                                             
001696   6fef     MOVWF     0xef,0x1                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001698   05f3     DECF      0xf3,0x0,0x1       if(ctrl_trf_state == CTRL_TRF_TX)                                            C:\fw\picscopefw\x017\usb.c
00169a   e10a     BNZ       0x16b0                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
00169c   d811     RCALL     0x16c0                 USBCtrlTrfTxService();                                                   C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
00169e   0104     MOVLB     0x4                    if(ep0Bi.Stat.DTS == 0)                                                  C:\fw\picscopefw\x017\usb.c
0016a0   bd04     BTFSC     0x4,0x6,0x1                                                                                     
0016a2   d003     BRA       0x16aa                                                                                          
0016a4   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\picscopefw\x017\usb.c
0016a6   6f04     MOVWF     0x4,0x1                                                                                         
0016a8   d002     BRA       0x16ae                 else                                                                     C:\fw\picscopefw\x017\usb.c
0016aa   0e88     MOVLW     0x88                       ep0Bi.Stat._byte = _USIE|_DAT0|_DTSEN;                               C:\fw\picscopefw\x017\usb.c
0016ac   6f04     MOVWF     0x4,0x1                                                                                         
                                               }                                                                            C:\fw\picscopefw\x017\usb.c
0016ae   d007     BRA       0x16be             else { // CTRL_TRF_RX                                                        C:\fw\picscopefw\x017\usb.c
                                           //Rawin's code change to handle setreport data:                                  C:\fw\picscopefw\x017\usb.c
0016b0   0e09     MOVLW     0x9            		if (SetupPkt.bRequest == SET_REPORT) {                                         C:\fw\picscopefw\x017\usb.c
0016b2   0104     MOVLB     0x4                                                                                             
0016b4   5d11     SUBWF     0x11,0x0,0x1                                                                                    
0016b6   e102     BNZ       0x16bc                                                                                          
0016b8   ecac     CALL      0x1d58,0x0     			HIDSetReportHandler();                                                        C:\fw\picscopefw\x017\usb.c
0016ba   f00e                                                                                                               
                                           		}                                                                              C:\fw\picscopefw\x017\usb.c
0016bc   d8e4     RCALL     0x1886         		USBPrepareForNextSetupTrf();                                                   C:\fw\picscopefw\x017\usb.c
                                           	}                                                                               C:\fw\picscopefw\x017\usb.c
0016be   0012     RETURN    0x0            }//end USBCtrlTrfInHandler                                                       C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBCtrlTrfTxService(void)                               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    pSrc, wCount, and usb_stat.ctrl_trf_mem are setup properly.  C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine should be called from only two places.          C:\fw\picscopefw\x017\usb.c
                                            *                  One from USBCtrlEPServiceComplete() and one from             C:\fw\picscopefw\x017\usb.c
                                            *                  USBCtrlTrfInHandler(). It takes care of managing a           C:\fw\picscopefw\x017\usb.c
                                            *                  transfer over multiple USB transactions.                     C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            This routine works with isochronous endpoint larger than     C:\fw\picscopefw\x017\usb.c
                                            *                  256 bytes and is shown here as an example of how to deal     C:\fw\picscopefw\x017\usb.c
                                            *                  with BC9 and BC8. In reality, a control endpoint can never   C:\fw\picscopefw\x017\usb.c
                                            *                  be larger than 64 bytes.                                     C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
0016c0   cfd9     MOVFF     0xfd9,0xfe6    void USBCtrlTrfTxService(void)                                                   C:\fw\picscopefw\x017\usb.c
0016c2   ffe6                                                                                                               
0016c4   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
0016c6   ffd9                                                                                                               
0016c8   0e02     MOVLW     0x2                                                                                             
0016ca   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
                                               WORD byte_to_send;                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * First, have to figure out how many byte of data to send.                  C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
0016cc   0100     MOVLB     0x0                if(wCount._word < EP0_BUFF_SIZE)                                             C:\fw\picscopefw\x017\usb.c
0016ce   0e08     MOVLW     0x8                                                                                             
0016d0   5df9     SUBWF     0xf9,0x0,0x1                                                                                    
0016d2   0e00     MOVLW     0x0                                                                                             
0016d4   59fa     SUBWFB    0xfa,0x0,0x1                                                                                    
0016d6   e205     BC        0x16e2                                                                                          
0016d8   c0f9     MOVFF     0xf9,0xfde             byte_to_send._word = wCount._word;                                       C:\fw\picscopefw\x017\usb.c
0016da   ffde                                                                                                               
0016dc   c0fa     MOVFF     0xfa,0xfdd                                                                                      
0016de   ffdd                                                                                                               
0016e0   d003     BRA       0x16e8             else                                                                         C:\fw\picscopefw\x017\usb.c
0016e2   0e08     MOVLW     0x8                    byte_to_send._word = EP0_BUFF_SIZE;                                      C:\fw\picscopefw\x017\usb.c
0016e4   6ede     MOVWF     0xde,0x0                                                                                        
0016e6   6add     CLRF      0xdd,0x0                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * Next, load the number of bytes to send to BC9..0 in buffer descriptor     C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
0016e8   0104     MOVLB     0x4                ep0Bi.Stat.BC9 = 0;                                                          C:\fw\picscopefw\x017\usb.c
0016ea   9304     BCF       0x4,0x1,0x1                                                                                     
0016ec   9104     BCF       0x4,0x0,0x1        ep0Bi.Stat.BC8 = 0;                                                          C:\fw\picscopefw\x017\usb.c
0016ee   0e01     MOVLW     0x1                ep0Bi.Stat._byte |= MSB(byte_to_send);                                       C:\fw\picscopefw\x017\usb.c
0016f0   50db     MOVF      0xdb,0x0,0x0                                                                                    
0016f2   1304     IORWF     0x4,0x1,0x1                                                                                     
0016f4   cfdf     MOVFF     0xfdf,0x405        ep0Bi.Cnt = LSB(byte_to_send);                                               C:\fw\picscopefw\x017\usb.c
0016f6   f405                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * Subtract the number of bytes just about to be sent from the total.        C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
0016f8   0e00     MOVLW     0x0                wCount._word = wCount._word - byte_to_send._word;                            C:\fw\picscopefw\x017\usb.c
0016fa   50db     MOVF      0xdb,0x0,0x0                                                                                    
0016fc   0100     MOVLB     0x0                                                                                             
0016fe   5ff9     SUBWF     0xf9,0x1,0x1                                                                                    
001700   0e01     MOVLW     0x1                                                                                             
001702   50db     MOVF      0xdb,0x0,0x0                                                                                    
001704   5bfa     SUBWFB    0xfa,0x1,0x1                                                                                    
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001706   0e18     MOVLW     0x18               pDst.bRam = (byte*)&CtrlTrfData;        // Set destination pointer           C:\fw\picscopefw\x017\usb.c
001708   6ff7     MOVWF     0xf7,0x1                                                                                        
00170a   0e04     MOVLW     0x4                                                                                             
00170c   6ff8     MOVWF     0xf8,0x1                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\usb.c
00170e   a3f0     BTFSS     0xf0,0x1,0x1       if(usb_stat.ctrl_trf_mem == _ROM)       // Determine type of memory source   C:\fw\picscopefw\x017\usb.c
001710   d01d     BRA       0x174c                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
001712   cfd9     MOVFF     0xfd9,0xfe9            while(byte_to_send._word)                                                C:\fw\picscopefw\x017\usb.c
001714   ffe9                                                                                                               
001716   cfda     MOVFF     0xfda,0xfea                                                                                     
001718   ffea                                                                                                               
00171a   50ee     MOVF      0xee,0x0,0x0                                                                                    
00171c   10ed     IORWF     0xed,0x0,0x0                                                                                    
00171e   e015     BZ        0x174a                                                                                          
001748   d7e4     BRA       0x1712                                                                                          
                                                   {                                                                        C:\fw\picscopefw\x017\usb.c
001720   c0f5     MOVFF     0xf5,0xff6                 *pDst.bRam = *pSrc.bRom;                                             C:\fw\picscopefw\x017\usb.c
001722   fff6                                                                                                               
001724   c0f6     MOVFF     0xf6,0xff7                                                                                      
001726   fff7                                                                                                               
001728   0008     TBLRD                                                                                                     
00172a   50f5     MOVF      0xf5,0x0,0x0                                                                                    
00172c   c0f7     MOVFF     0xf7,0xfe9                                                                                      
00172e   ffe9                                                                                                               
001730   c0f8     MOVFF     0xf8,0xfea                                                                                      
001732   ffea                                                                                                               
001734   6eef     MOVWF     0xef,0x0                                                                                        
001736   2bf7     INCF      0xf7,0x1,0x1               pDst.bRam++;                                                         C:\fw\picscopefw\x017\usb.c
001738   0e00     MOVLW     0x0                                                                                             
00173a   23f8     ADDWFC    0xf8,0x1,0x1                                                                                    
00173c   2bf5     INCF      0xf5,0x1,0x1               pSrc.bRom++;                                                         C:\fw\picscopefw\x017\usb.c
00173e   23f6     ADDWFC    0xf6,0x1,0x1                                                                                    
001740   06df     DECF      0xdf,0x1,0x0               byte_to_send._word--;                                                C:\fw\picscopefw\x017\usb.c
001742   0e01     MOVLW     0x1                                                                                             
001744   e201     BC        0x1748                                                                                          
001746   06db     DECF      0xdb,0x1,0x0                                                                                    
                                                   }//end while(byte_to_send._word)                                         C:\fw\picscopefw\x017\usb.c
                                               }                                                                            C:\fw\picscopefw\x017\usb.c
00174a   d01b     BRA       0x1782             else // RAM                                                                  C:\fw\picscopefw\x017\usb.c
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
00174c   cfd9     MOVFF     0xfd9,0xfe9            while(byte_to_send._word)                                                C:\fw\picscopefw\x017\usb.c
00174e   ffe9                                                                                                               
001750   cfda     MOVFF     0xfda,0xfea                                                                                     
001752   ffea                                                                                                               
001754   50ee     MOVF      0xee,0x0,0x0                                                                                    
001756   10ed     IORWF     0xed,0x0,0x0                                                                                    
001758   e014     BZ        0x1782                                                                                          
001780   d7e5     BRA       0x174c                                                                                          
                                                   {                                                                        C:\fw\picscopefw\x017\usb.c
00175a   c0f5     MOVFF     0xf5,0xfe9                 *pDst.bRam = *pSrc.bRam;                                             C:\fw\picscopefw\x017\usb.c
00175c   ffe9                                                                                                               
00175e   c0f6     MOVFF     0xf6,0xfea                                                                                      
001760   ffea                                                                                                               
001762   50ef     MOVF      0xef,0x0,0x0                                                                                    
001764   c0f7     MOVFF     0xf7,0xfe9                                                                                      
001766   ffe9                                                                                                               
001768   c0f8     MOVFF     0xf8,0xfea                                                                                      
00176a   ffea                                                                                                               
00176c   6eef     MOVWF     0xef,0x0                                                                                        
00176e   2bf7     INCF      0xf7,0x1,0x1               pDst.bRam++;                                                         C:\fw\picscopefw\x017\usb.c
001770   0e00     MOVLW     0x0                                                                                             
001772   23f8     ADDWFC    0xf8,0x1,0x1                                                                                    
001774   2bf5     INCF      0xf5,0x1,0x1               pSrc.bRam++;                                                         C:\fw\picscopefw\x017\usb.c
001776   23f6     ADDWFC    0xf6,0x1,0x1                                                                                    
001778   06df     DECF      0xdf,0x1,0x0               byte_to_send._word--;                                                C:\fw\picscopefw\x017\usb.c
00177a   0e01     MOVLW     0x1                                                                                             
00177c   e201     BC        0x1780                                                                                          
00177e   06db     DECF      0xdb,0x1,0x0                                                                                    
                                                   }//end while(byte_to_send._word)                                         C:\fw\picscopefw\x017\usb.c
                                               }//end if(usb_stat.ctrl_trf_mem == _ROM)                                     C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001782   cfd9     MOVFF     0xfd9,0xfe1    }//end USBCtrlTrfTxService                                                       C:\fw\picscopefw\x017\usb.c
001784   ffe1                                                                                                               
001786   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001788   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
00178a   ffd9                                                                                                               
00178c   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBCtrlTrfRxService(void)                               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    pDst and wCount are setup properly.                          C:\fw\picscopefw\x017\usb.c
                                            *                  pSrc is always &CtrlTrfData                                  C:\fw\picscopefw\x017\usb.c
                                            *                  usb_stat.ctrl_trf_mem is always _RAM.                        C:\fw\picscopefw\x017\usb.c
                                            *                  wCount should be set to 0 at the start of each control       C:\fw\picscopefw\x017\usb.c
                                            *                  transfer.                                                    C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        *** This routine is only partially complete. Check for       C:\fw\picscopefw\x017\usb.c
                                            *                  new version of the firmware.                                 C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
00178e   cfd9     MOVFF     0xfd9,0xfe6    void USBCtrlTrfRxService(void)                                                   C:\fw\picscopefw\x017\usb.c
001790   ffe6                                                                                                               
001792   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001794   ffd9                                                                                                               
001796   0e02     MOVLW     0x2                                                                                             
001798   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
                                               WORD byte_to_read;                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
00179a   0e03     MOVLW     0x3                MSB(byte_to_read) = 0x03 & ep0Bo.Stat._byte;    // Filter out last 2 bits    C:\fw\picscopefw\x017\usb.c
00179c   0104     MOVLB     0x4                                                                                             
00179e   1500     ANDWF     0x0,0x0,0x1                                                                                     
0017a0   6ee7     MOVWF     0xe7,0x0                                                                                        
0017a2   0e01     MOVLW     0x1                                                                                             
0017a4   cfe7     MOVFF     0xfe7,0xfdb                                                                                     
0017a6   ffdb                                                                                                               
0017a8   c401     MOVFF     0x401,0xfdf        LSB(byte_to_read) = ep0Bo.Cnt;                                               C:\fw\picscopefw\x017\usb.c
0017aa   ffdf                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * Accumulate total number of bytes read                                     C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
0017ac   50de     MOVF      0xde,0x0,0x0       wCount._word = wCount._word + byte_to_read._word;                            C:\fw\picscopefw\x017\usb.c
0017ae   0100     MOVLB     0x0                                                                                             
0017b0   27f9     ADDWF     0xf9,0x1,0x1                                                                                    
0017b2   50dd     MOVF      0xdd,0x0,0x0                                                                                    
0017b4   23fa     ADDWFC    0xfa,0x1,0x1                                                                                    
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0017b6   0e18     MOVLW     0x18               pSrc.bRam = (byte*)&CtrlTrfData;                                             C:\fw\picscopefw\x017\usb.c
0017b8   6ff5     MOVWF     0xf5,0x1                                                                                        
0017ba   0e04     MOVLW     0x4                                                                                             
0017bc   6ff6     MOVWF     0xf6,0x1                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0017be   cfd9     MOVFF     0xfd9,0xfe9        while(byte_to_read._word)                                                    C:\fw\picscopefw\x017\usb.c
0017c0   ffe9                                                                                                               
0017c2   cfda     MOVFF     0xfda,0xfea                                                                                     
0017c4   ffea                                                                                                               
0017c6   50ee     MOVF      0xee,0x0,0x0                                                                                    
0017c8   10ed     IORWF     0xed,0x0,0x0                                                                                    
0017ca   e014     BZ        0x17f4                                                                                          
0017f2   d7e5     BRA       0x17be                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
0017cc   c0f5     MOVFF     0xf5,0xfe9             *pDst.bRam = *pSrc.bRam;                                                 C:\fw\picscopefw\x017\usb.c
0017ce   ffe9                                                                                                               
0017d0   c0f6     MOVFF     0xf6,0xfea                                                                                      
0017d2   ffea                                                                                                               
0017d4   50ef     MOVF      0xef,0x0,0x0                                                                                    
0017d6   c0f7     MOVFF     0xf7,0xfe9                                                                                      
0017d8   ffe9                                                                                                               
0017da   c0f8     MOVFF     0xf8,0xfea                                                                                      
0017dc   ffea                                                                                                               
0017de   6eef     MOVWF     0xef,0x0                                                                                        
0017e0   2bf7     INCF      0xf7,0x1,0x1           pDst.bRam++;                                                             C:\fw\picscopefw\x017\usb.c
0017e2   0e00     MOVLW     0x0                                                                                             
0017e4   23f8     ADDWFC    0xf8,0x1,0x1                                                                                    
0017e6   2bf5     INCF      0xf5,0x1,0x1           pSrc.bRam++;                                                             C:\fw\picscopefw\x017\usb.c
0017e8   23f6     ADDWFC    0xf6,0x1,0x1                                                                                    
0017ea   06df     DECF      0xdf,0x1,0x0           byte_to_read._word--;                                                    C:\fw\picscopefw\x017\usb.c
0017ec   0e01     MOVLW     0x1                                                                                             
0017ee   e201     BC        0x17f2                                                                                          
0017f0   06db     DECF      0xdb,0x1,0x0                                                                                    
                                               }//end while(byte_to_read._word)                                             C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0017f4   cfd9     MOVFF     0xfd9,0xfe1    }//end USBCtrlTrfRxService                                                       C:\fw\picscopefw\x017\usb.c
0017f6   ffe1                                                                                                               
0017f8   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0017fa   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
0017fc   ffd9                                                                                                               
0017fe   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBCtrlEPServiceComplete(void)                          C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine wrap up the ramaining tasks in servicing        C:\fw\picscopefw\x017\usb.c
                                            *                  a Setup Request. Its main task is to set the endpoint        C:\fw\picscopefw\x017\usb.c
                                            *                  controls appropriately for a given situation. See code       C:\fw\picscopefw\x017\usb.c
                                            *                  below.                                                       C:\fw\picscopefw\x017\usb.c
                                            *                  There are three main scenarios:                              C:\fw\picscopefw\x017\usb.c
                                            *                  a) There was no handler for the Request, in this case        C:\fw\picscopefw\x017\usb.c
                                            *                     a STALL should be sent out.                               C:\fw\picscopefw\x017\usb.c
                                            *                  b) The host has requested a read control transfer,           C:\fw\picscopefw\x017\usb.c
                                            *                     endpoints are required to be setup in a specific way.     C:\fw\picscopefw\x017\usb.c
                                            *                  c) The host has requested a write control transfer, or       C:\fw\picscopefw\x017\usb.c
                                            *                     a control data stage is not required, endpoints are       C:\fw\picscopefw\x017\usb.c
                                            *                     required to be setup in a specific way.                   C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *                  Packet processing is resumed by clearing PKTDIS bit.         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBCtrlEPServiceComplete(void)                                              C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
001800   0100     MOVLB     0x0                if(ctrl_trf_session_owner == MUID_NULL)                                      C:\fw\picscopefw\x017\usb.c
001802   51f4     MOVF      0xf4,0x0,0x1                                                                                    
001804   e10b     BNZ       0x181c                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
                                                   /*                                                                       C:\fw\picscopefw\x017\usb.c
                                                    * If no one knows how to service this request then stall.               C:\fw\picscopefw\x017\usb.c
                                                    * Must also prepare EP0 to receive the next SETUP transaction.          C:\fw\picscopefw\x017\usb.c
                                                    */                                                                      C:\fw\picscopefw\x017\usb.c
001806   0104     MOVLB     0x4                    ep0Bo.Cnt = EP0_BUFF_SIZE;                                               C:\fw\picscopefw\x017\usb.c
001808   0e08     MOVLW     0x8                                                                                             
00180a   6f01     MOVWF     0x1,0x1                                                                                         
00180c   0e10     MOVLW     0x10                   ep0Bo.ADR = (byte*)&SetupPkt;                                            C:\fw\picscopefw\x017\usb.c
00180e   6f02     MOVWF     0x2,0x1                                                                                         
001810   0e04     MOVLW     0x4                                                                                             
001812   6f03     MOVWF     0x3,0x1                                                                                         
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001814   0e84     MOVLW     0x84                   ep0Bo.Stat._byte = _USIE|_BSTALL;                                        C:\fw\picscopefw\x017\usb.c
001816   6f00     MOVWF     0x0,0x1                                                                                         
001818   6f04     MOVWF     0x4,0x1                ep0Bi.Stat._byte = _USIE|_BSTALL;                                        C:\fw\picscopefw\x017\usb.c
                                               }                                                                            C:\fw\picscopefw\x017\usb.c
00181a   d033     BRA       0x1882             else    // A module has claimed ownership of the control transfer session.   C:\fw\picscopefw\x017\usb.c
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
00181c   0104     MOVLB     0x4                    if(SetupPkt.DataDir == DEV_TO_HOST)                                      C:\fw\picscopefw\x017\usb.c
00181e   af10     BTFSS     0x10,0x7,0x1                                                                                    
001820   d021     BRA       0x1864                                                                                          
                                                   {                                                                        C:\fw\picscopefw\x017\usb.c
001822   0100     MOVLB     0x0                        if(SetupPkt.wLength < wCount._word)                                  C:\fw\picscopefw\x017\usb.c
001824   51f9     MOVF      0xf9,0x0,0x1                                                                                    
001826   0104     MOVLB     0x4                                                                                             
001828   5d16     SUBWF     0x16,0x0,0x1                                                                                    
00182a   0100     MOVLB     0x0                                                                                             
00182c   51fa     MOVF      0xfa,0x0,0x1                                                                                    
00182e   0104     MOVLB     0x4                                                                                             
001830   5917     SUBWFB    0x17,0x0,0x1                                                                                    
001832   e204     BC        0x183c                                                                                          
001834   c416     MOVFF     0x416,0xf9                     wCount._word = SetupPkt.wLength;                                 C:\fw\picscopefw\x017\usb.c
001836   f0f9                                                                                                               
001838   c417     MOVFF     0x417,0xfa                                                                                      
00183a   f0fa                                                                                                               
00183c   df41     RCALL     0x16c0                     USBCtrlTrfTxService();                                               C:\fw\picscopefw\x017\usb.c
00183e   0100     MOVLB     0x0                        ctrl_trf_state = CTRL_TRF_TX;                                        C:\fw\picscopefw\x017\usb.c
001840   0e01     MOVLW     0x1                                                                                             
001842   6ff3     MOVWF     0xf3,0x1                                                                                        
                                                       /*                                                                   C:\fw\picscopefw\x017\usb.c
                                                        * Control Read:                                                     C:\fw\picscopefw\x017\usb.c
                                                        * <SETUP[0]><IN[1]><IN[0]>...<OUT[1]> | <SETUP[0]>                  C:\fw\picscopefw\x017\usb.c
                                                        * 1. Prepare OUT EP to respond to early termination                 C:\fw\picscopefw\x017\usb.c
                                                        *                                                                   C:\fw\picscopefw\x017\usb.c
                                                        * NOTE:                                                             C:\fw\picscopefw\x017\usb.c
                                                        * If something went wrong during the control transfer,              C:\fw\picscopefw\x017\usb.c
                                                        * the last status stage may not be sent by the host.                C:\fw\picscopefw\x017\usb.c
                                                        * When this happens, two different things could happen              C:\fw\picscopefw\x017\usb.c
                                                        * depending on the host.                                            C:\fw\picscopefw\x017\usb.c
                                                        * a) The host could send out a RESET.                               C:\fw\picscopefw\x017\usb.c
                                                        * b) The host could send out a new SETUP transaction                C:\fw\picscopefw\x017\usb.c
                                                        *    without sending a RESET first.                                 C:\fw\picscopefw\x017\usb.c
                                                        * To properly handle case (b), the OUT EP must be setup             C:\fw\picscopefw\x017\usb.c
                                                        * to receive either a zero length OUT transaction, or a             C:\fw\picscopefw\x017\usb.c
                                                        * new SETUP transaction.                                            C:\fw\picscopefw\x017\usb.c
                                                        *                                                                   C:\fw\picscopefw\x017\usb.c
                                                        * Since the SETUP transaction requires the DTS bit to be            C:\fw\picscopefw\x017\usb.c
                                                        * DAT0 while the zero length OUT status requires the DTS            C:\fw\picscopefw\x017\usb.c
                                                        * bit to be DAT1, the DTS bit check by the hardware should          C:\fw\picscopefw\x017\usb.c
                                                        * be disabled. This way the SIE could accept either of              C:\fw\picscopefw\x017\usb.c
                                                        * the two transactions.                                             C:\fw\picscopefw\x017\usb.c
                                                        *                                                                   C:\fw\picscopefw\x017\usb.c
                                                        * Furthermore, the Cnt byte should be set to prepare for            C:\fw\picscopefw\x017\usb.c
                                                        * the SETUP data (8-byte or more), and the buffer address           C:\fw\picscopefw\x017\usb.c
                                                        * should be pointed to SetupPkt.                                    C:\fw\picscopefw\x017\usb.c
                                                        */                                                                  C:\fw\picscopefw\x017\usb.c
001844   0104     MOVLB     0x4                        ep0Bo.Cnt = EP0_BUFF_SIZE;                                           C:\fw\picscopefw\x017\usb.c
001846   0e08     MOVLW     0x8                                                                                             
001848   6f01     MOVWF     0x1,0x1                                                                                         
00184a   0e10     MOVLW     0x10                       ep0Bo.ADR = (byte*)&SetupPkt;                                        C:\fw\picscopefw\x017\usb.c
00184c   6f02     MOVWF     0x2,0x1                                                                                         
00184e   0e04     MOVLW     0x4                                                                                             
001850   6f03     MOVWF     0x3,0x1                                                                                         
001852   0e80     MOVLW     0x80                       ep0Bo.Stat._byte = _USIE;           // Note: DTSEN is 0!             C:\fw\picscopefw\x017\usb.c
001854   6f00     MOVWF     0x0,0x1                                                                                         
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                       /*                                                                   C:\fw\picscopefw\x017\usb.c
                                                        * 2. Prepare IN EP to transfer data, Cnt should have                C:\fw\picscopefw\x017\usb.c
                                                        *    been initialized by responsible request owner.                 C:\fw\picscopefw\x017\usb.c
                                                        */                                                                  C:\fw\picscopefw\x017\usb.c
001856   0e18     MOVLW     0x18                       ep0Bi.ADR = (byte*)&CtrlTrfData;                                     C:\fw\picscopefw\x017\usb.c
001858   6f06     MOVWF     0x6,0x1                                                                                         
00185a   0e04     MOVLW     0x4                                                                                             
00185c   6f07     MOVWF     0x7,0x1                                                                                         
00185e   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\picscopefw\x017\usb.c
001860   6f04     MOVWF     0x4,0x1                                                                                         
                                                   }                                                                        C:\fw\picscopefw\x017\usb.c
001862   d00f     BRA       0x1882                 else    // (SetupPkt.DataDir == HOST_TO_DEV)                             C:\fw\picscopefw\x017\usb.c
                                                   {                                                                        C:\fw\picscopefw\x017\usb.c
001864   0100     MOVLB     0x0                        ctrl_trf_state = CTRL_TRF_RX;                                        C:\fw\picscopefw\x017\usb.c
001866   0e02     MOVLW     0x2                                                                                             
001868   6ff3     MOVWF     0xf3,0x1                                                                                        
                                                       /*                                                                   C:\fw\picscopefw\x017\usb.c
                                                        * Control Write:                                                    C:\fw\picscopefw\x017\usb.c
                                                        * <SETUP[0]><OUT[1]><OUT[0]>...<IN[1]> | <SETUP[0]>                 C:\fw\picscopefw\x017\usb.c
                                                        *                                                                   C:\fw\picscopefw\x017\usb.c
                                                        * 1. Prepare IN EP to respond to early termination                  C:\fw\picscopefw\x017\usb.c
                                                        *                                                                   C:\fw\picscopefw\x017\usb.c
                                                        *    This is the same as a Zero Length Packet Response              C:\fw\picscopefw\x017\usb.c
                                                        *    for control transfer without a data stage                      C:\fw\picscopefw\x017\usb.c
                                                        */                                                                  C:\fw\picscopefw\x017\usb.c
00186a   0104     MOVLB     0x4                        ep0Bi.Cnt = 0;                                                       C:\fw\picscopefw\x017\usb.c
00186c   6b05     CLRF      0x5,0x1                                                                                         
00186e   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\picscopefw\x017\usb.c
001870   6f04     MOVWF     0x4,0x1                                                                                         
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                       /*                                                                   C:\fw\picscopefw\x017\usb.c
                                                        * 2. Prepare OUT EP to receive data.                                C:\fw\picscopefw\x017\usb.c
                                                        */                                                                  C:\fw\picscopefw\x017\usb.c
001872   0e08     MOVLW     0x8                        ep0Bo.Cnt = EP0_BUFF_SIZE;                                           C:\fw\picscopefw\x017\usb.c
001874   6f01     MOVWF     0x1,0x1                                                                                         
001876   0e18     MOVLW     0x18                       ep0Bo.ADR = (byte*)&CtrlTrfData;                                     C:\fw\picscopefw\x017\usb.c
001878   6f02     MOVWF     0x2,0x1                                                                                         
00187a   0e04     MOVLW     0x4                                                                                             
00187c   6f03     MOVWF     0x3,0x1                                                                                         
00187e   0ec8     MOVLW     0xc8                       ep0Bo.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\picscopefw\x017\usb.c
001880   6f00     MOVWF     0x0,0x1                                                                                         
                                                   }//end if(SetupPkt.DataDir == DEV_TO_HOST)                               C:\fw\picscopefw\x017\usb.c
                                               }//end if(ctrl_trf_session_owner == MUID_NULL)                               C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * PKTDIS bit is set when a Setup Transaction is received.                   C:\fw\picscopefw\x017\usb.c
                                                * Clear to resume packet processing.                                        C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
001882   986d     BCF       0x6d,0x4,0x0       UCONbits.PKTDIS = 0;                                                         C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001884   0012     RETURN    0x0            }//end USBCtrlEPServiceComplete                                                  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBPrepareForNextSetupTrf(void)                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        The routine forces EP0 OUT to be ready for a new Setup       C:\fw\picscopefw\x017\usb.c
                                            *                  transaction, and forces EP0 IN to be owned by CPU.           C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBPrepareForNextSetupTrf(void)                                             C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
001886   0100     MOVLB     0x0                ctrl_trf_state = WAIT_SETUP;            // See usbctrltrf.h                  C:\fw\picscopefw\x017\usb.c
001888   6bf3     CLRF      0xf3,0x1                                                                                        
00188a   0104     MOVLB     0x4                ep0Bo.Cnt = EP0_BUFF_SIZE;              // Defined in usbcfg.h               C:\fw\picscopefw\x017\usb.c
00188c   0e08     MOVLW     0x8                                                                                             
00188e   6f01     MOVWF     0x1,0x1                                                                                         
001890   0e10     MOVLW     0x10               ep0Bo.ADR = (byte*)&SetupPkt;                                                C:\fw\picscopefw\x017\usb.c
001892   6f02     MOVWF     0x2,0x1                                                                                         
001894   0e04     MOVLW     0x4                                                                                             
001896   6f03     MOVWF     0x3,0x1                                                                                         
001898   0e88     MOVLW     0x88               ep0Bo.Stat._byte = _USIE|_DAT0|_DTSEN;  // EP0 buff dsc init, see usbmmap.h  C:\fw\picscopefw\x017\usb.c
00189a   6f00     MOVWF     0x0,0x1                                                                                         
00189c   6b04     CLRF      0x4,0x1            ep0Bi.Stat._byte = _UCPU;               // EP0 IN buffer initialization      C:\fw\picscopefw\x017\usb.c
00189e   0012     RETURN    0x0            }//end USBPrepareForNextSetupTrf                                                 C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** EOF usbctrltrf.c *********************************************************/  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           //usbdrv.c                                                                       C:\fw\picscopefw\x017\usb.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\picscopefw\x017\usb.c
                                           #include <p18cxxx.h>                                                             C:\fw\picscopefw\x017\usb.c
                                           #include "typedefs.h"                                                            C:\fw\picscopefw\x017\usb.c
                                           #include "usb.h"                                                                 C:\fw\picscopefw\x017\usb.c
                                           //#include "io_cfg.h"             // Required for USBCheckBusStatus()            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\picscopefw\x017\usb.c
                                           #pragma udata usb5                                                               C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBModuleEnable(void);                                                      C:\fw\picscopefw\x017\usb.c
                                           void USBModuleDisable(void);                                                     C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           void USBSuspend(void);                                                           C:\fw\picscopefw\x017\usb.c
                                           void USBWakeFromSuspend(void);                                                   C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           void USBProtocolResetHandler(void);                                              C:\fw\picscopefw\x017\usb.c
                                           void USB_SOF_Handler(void);                                                      C:\fw\picscopefw\x017\usb.c
                                           void USBStallHandler(void);                                                      C:\fw\picscopefw\x017\usb.c
                                           void USBErrorHandler(void);                                                      C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\picscopefw\x017\usb.c
                                           #pragma code                                                                     C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBCheckBusStatus(void)                                 C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine enables/disables the USB module by monitoring   C:\fw\picscopefw\x017\usb.c
                                            *                  the USB power signal.                                        C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBCheckBusStatus(void)                                                     C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
                                               /**************************************************************************  C:\fw\picscopefw\x017\usb.c
                                                * Bus Attachment & Detachment Detection                                     C:\fw\picscopefw\x017\usb.c
                                                * usb_bus_sense is an i/o pin defined in io_cfg.h                           C:\fw\picscopefw\x017\usb.c
                                                *************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                               #define USB_BUS_ATTACHED    1                                                C:\fw\picscopefw\x017\usb.c
                                               #define USB_BUS_DETACHED    0                                                C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               if(usb_bus_sense == USB_BUS_ATTACHED)       // Is USB bus attached?          C:\fw\picscopefw\x017\usb.c
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
0018a0   a66d     BTFSS     0x6d,0x3,0x0           if(UCONbits.USBEN == 0)                 // Is the module off?            C:\fw\picscopefw\x017\usb.c
0018a2   d80f     RCALL     0x18c2                     USBModuleEnable();                  // Is off, enable it             C:\fw\picscopefw\x017\usb.c
                                               }                                                                            C:\fw\picscopefw\x017\usb.c
0018a4   d002     BRA       0x18aa             else                                                                         C:\fw\picscopefw\x017\usb.c
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
0018a6   b66d     BTFSC     0x6d,0x3,0x0           if(UCONbits.USBEN == 1)                 // Is the module on?             C:\fw\picscopefw\x017\usb.c
0018a8   d813     RCALL     0x18d0                     USBModuleDisable();                 // Is on, disable it             C:\fw\picscopefw\x017\usb.c
                                               }//end if(usb_bus_sense...)                                                  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * After enabling the USB module, it takes some time for the voltage         C:\fw\picscopefw\x017\usb.c
                                                * on the D+ or D- line to rise high enough to get out of the SE0 condition. C:\fw\picscopefw\x017\usb.c
                                                * The USB Reset interrupt should not be unmasked until the SE0 condition is C:\fw\picscopefw\x017\usb.c
                                                * cleared. This helps preventing the firmware from misinterpreting this     C:\fw\picscopefw\x017\usb.c
                                                * unique event as a USB bus reset from the USB host.                        C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
0018aa   0100     MOVLB     0x0                if(usb_device_state == ATTACHED_STATE)                                       C:\fw\picscopefw\x017\usb.c
0018ac   05ef     DECF      0xef,0x0,0x1                                                                                    
0018ae   e108     BNZ       0x18c0                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
0018b0   ba6d     BTFSC     0x6d,0x5,0x0           if(!UCONbits.SE0)                                                        C:\fw\picscopefw\x017\usb.c
0018b2   d006     BRA       0x18c0                                                                                          
                                                   {                                                                        C:\fw\picscopefw\x017\usb.c
0018b4   6a68     CLRF      0x68,0x0                   UIR = 0;                        // Clear all USB interrupts          C:\fw\picscopefw\x017\usb.c
0018b6   6a69     CLRF      0x69,0x0                   UIE = 0;                        // Mask all USB interrupts           C:\fw\picscopefw\x017\usb.c
0018b8   8069     BSF       0x69,0x0,0x0               UIEbits.URSTIE = 1;             // Unmask RESET interrupt            C:\fw\picscopefw\x017\usb.c
0018ba   8869     BSF       0x69,0x4,0x0               UIEbits.IDLEIE = 1;             // Unmask IDLE interrupt             C:\fw\picscopefw\x017\usb.c
0018bc   0e02     MOVLW     0x2                        usb_device_state = POWERED_STATE;                                    C:\fw\picscopefw\x017\usb.c
0018be   6fef     MOVWF     0xef,0x1                                                                                        
                                                   }//end if                           // else wait until SE0 is cleared    C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               }//end if(usb_device_state == ATTACHED_STATE)                                C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0018c0   0012     RETURN    0x0            }//end USBCheckBusStatus                                                         C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBModuleEnable(void)                                   C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine enables the USB module.                         C:\fw\picscopefw\x017\usb.c
                                            *                  An end designer should never have to call this routine       C:\fw\picscopefw\x017\usb.c
                                            *                  manually. This routine should only be called from            C:\fw\picscopefw\x017\usb.c
                                            *                  USBCheckBusStatus().                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            See USBCheckBusStatus() for more information.                C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBModuleEnable(void)                                                       C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
0018c2   6a6d     CLRF      0x6d,0x0           UCON = 0;                                                                    C:\fw\picscopefw\x017\usb.c
0018c4   6a69     CLRF      0x69,0x0           UIE = 0;                                // Mask all USB interrupts           C:\fw\picscopefw\x017\usb.c
0018c6   866d     BSF       0x6d,0x3,0x0       UCONbits.USBEN = 1;                     // Enable module & attach to bus     C:\fw\picscopefw\x017\usb.c
0018c8   0100     MOVLB     0x0                usb_device_state = ATTACHED_STATE;      // Defined in usbmmap.c & .h         C:\fw\picscopefw\x017\usb.c
0018ca   0e01     MOVLW     0x1                                                                                             
0018cc   6fef     MOVWF     0xef,0x1                                                                                        
0018ce   0012     RETURN    0x0            }//end USBModuleEnable                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBModuleDisable(void)                                  C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine disables the USB module.                        C:\fw\picscopefw\x017\usb.c
                                            *                  An end designer should never have to call this routine       C:\fw\picscopefw\x017\usb.c
                                            *                  manually. This routine should only be called from            C:\fw\picscopefw\x017\usb.c
                                            *                  USBCheckBusStatus().                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            See USBCheckBusStatus() for more information.                C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBModuleDisable(void)                                                      C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
0018d0   6a6d     CLRF      0x6d,0x0           UCON = 0;                               // Disable module & detach from bus  C:\fw\picscopefw\x017\usb.c
0018d2   6a69     CLRF      0x69,0x0           UIE = 0;                                // Mask all USB interrupts           C:\fw\picscopefw\x017\usb.c
0018d4   0100     MOVLB     0x0                usb_device_state = DETACHED_STATE;      // Defined in usbmmap.c & .h         C:\fw\picscopefw\x017\usb.c
0018d6   6bef     CLRF      0xef,0x1                                                                                        
0018d8   0012     RETURN    0x0            }//end USBModuleDisable                                                          C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBSoftDetach(void)                                     C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    The device will have to be re-enumerated to function again.  C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        USBSoftDetach electrically disconnects the device from       C:\fw\picscopefw\x017\usb.c
                                            *                  the bus. This is done by stop supplying Vusb voltage to      C:\fw\picscopefw\x017\usb.c
                                            *                  pull-up resistor. The pull-down resistors on the host        C:\fw\picscopefw\x017\usb.c
                                            *                  side will pull both differential signal lines low and        C:\fw\picscopefw\x017\usb.c
                                            *                  the host registers the event as a disconnect.                C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *                  Since the USB cable is not physically disconnected, the      C:\fw\picscopefw\x017\usb.c
                                            *                  power supply through the cable can still be sensed by        C:\fw\picscopefw\x017\usb.c
                                            *                  the device. The next time USBCheckBusStatus() function       C:\fw\picscopefw\x017\usb.c
                                            *                  is called, it will reconnect the device back to the bus.     C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBSoftDetach(void)                                                         C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
0018da   ef68     GOTO      0x18d0             USBModuleDisable();                                                          C:\fw\picscopefw\x017\usb.c
0018dc   f00c                                                                                                               
                                           }//end USBSoftDetach                                                             C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBDriverService(void)                                  C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This routine is the heart of this firmware. It manages       C:\fw\picscopefw\x017\usb.c
                                            *                  all USB interrupts.                                          C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            Device state transitions through the following stages:       C:\fw\picscopefw\x017\usb.c
                                            *                  DETACHED -> ATTACHED -> POWERED -> DEFAULT ->                C:\fw\picscopefw\x017\usb.c
                                            *                  ADDRESS_PENDING -> ADDRESSED -> CONFIGURED -> READY          C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBDriverService(void)                                                      C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * Pointless to continue servicing if USB cable is not even attached.        C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
0018de   0100     MOVLB     0x0                if(usb_device_state == DETACHED_STATE) return;                               C:\fw\picscopefw\x017\usb.c
0018e0   51ef     MOVF      0xef,0x0,0x1                                                                                    
0018e2   e101     BNZ       0x18e6                                                                                          
0018e4   d039     BRA       0x1958                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * Task A: Service USB Activity Interrupt                                    C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0018e6   5068     MOVF      0x68,0x0,0x0       if(UIRbits.ACTVIF && UIEbits.ACTVIE)    USBWakeFromSuspend();                C:\fw\picscopefw\x017\usb.c
0018e8   0b04     ANDLW     0x4                                                                                             
0018ea   e004     BZ        0x18f4                                                                                          
0018ec   5069     MOVF      0x69,0x0,0x0                                                                                    
0018ee   0b04     ANDLW     0x4                                                                                             
0018f0   e001     BZ        0x18f4                                                                                          
0018f2   d838     RCALL     0x1964                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * Pointless to continue servicing if the device is in suspend mode.         C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
0018f4   b26d     BTFSC     0x6d,0x1,0x0       if(UCONbits.SUSPND==1) return;                                               C:\fw\picscopefw\x017\usb.c
0018f6   d030     BRA       0x1958                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * Task B: Service USB Bus Reset Interrupt.                                  C:\fw\picscopefw\x017\usb.c
                                                * When bus reset is received during suspend, ACTVIF will be set first,      C:\fw\picscopefw\x017\usb.c
                                                * once the UCONbits.SUSPND is clear, then the URSTIF bit will be asserted.  C:\fw\picscopefw\x017\usb.c
                                                * This is why URSTIF is checked after ACTVIF.                               C:\fw\picscopefw\x017\usb.c
                                                *                                                                           C:\fw\picscopefw\x017\usb.c
                                                * The USB reset flag is masked when the USB state is in                     C:\fw\picscopefw\x017\usb.c
                                                * DETACHED_STATE or ATTACHED_STATE, and therefore cannot                    C:\fw\picscopefw\x017\usb.c
                                                * cause a USB reset event during these two states.                          C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
0018f8   5068     MOVF      0x68,0x0,0x0       if(UIRbits.URSTIF && UIEbits.URSTIE)    USBProtocolResetHandler();           C:\fw\picscopefw\x017\usb.c
0018fa   0b01     ANDLW     0x1                                                                                             
0018fc   e004     BZ        0x1906                                                                                          
0018fe   5069     MOVF      0x69,0x0,0x0                                                                                    
001900   0b01     ANDLW     0x1                                                                                             
001902   e001     BZ        0x1906                                                                                          
001904   d84f     RCALL     0x19a4                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * Task C: Service other USB interrupts                                      C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
001906   5068     MOVF      0x68,0x0,0x0       if(UIRbits.IDLEIF && UIEbits.IDLEIE)    USBSuspend();                        C:\fw\picscopefw\x017\usb.c
001908   0b10     ANDLW     0x10                                                                                            
00190a   e004     BZ        0x1914                                                                                          
00190c   5069     MOVF      0x69,0x0,0x0                                                                                    
00190e   0b10     ANDLW     0x10                                                                                            
001910   e001     BZ        0x1914                                                                                          
001912   d823     RCALL     0x195a                                                                                          
001914   5068     MOVF      0x68,0x0,0x0       if(UIRbits.SOFIF && UIEbits.SOFIE)      USB_SOF_Handler();                   C:\fw\picscopefw\x017\usb.c
001916   0b40     ANDLW     0x40                                                                                            
001918   e004     BZ        0x1922                                                                                          
00191a   5069     MOVF      0x69,0x0,0x0                                                                                    
00191c   0b40     ANDLW     0x40                                                                                            
00191e   e001     BZ        0x1922                                                                                          
001920   d837     RCALL     0x1990                                                                                          
001922   5068     MOVF      0x68,0x0,0x0       if(UIRbits.STALLIF && UIEbits.STALLIE)  USBStallHandler();                   C:\fw\picscopefw\x017\usb.c
001924   0b20     ANDLW     0x20                                                                                            
001926   e004     BZ        0x1930                                                                                          
001928   5069     MOVF      0x69,0x0,0x0                                                                                    
00192a   0b20     ANDLW     0x20                                                                                            
00192c   e001     BZ        0x1930                                                                                          
00192e   d832     RCALL     0x1994                                                                                          
001930   5068     MOVF      0x68,0x0,0x0       if(UIRbits.UERRIF && UIEbits.UERRIE)    USBErrorHandler();                   C:\fw\picscopefw\x017\usb.c
001932   0b02     ANDLW     0x2                                                                                             
001934   e004     BZ        0x193e                                                                                          
001936   5069     MOVF      0x69,0x0,0x0                                                                                    
001938   0b02     ANDLW     0x2                                                                                             
00193a   e001     BZ        0x193e                                                                                          
00193c   d831     RCALL     0x19a0                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * Pointless to continue servicing if the host has not sent a bus reset.     C:\fw\picscopefw\x017\usb.c
                                                * Once bus reset is received, the device transitions into the DEFAULT       C:\fw\picscopefw\x017\usb.c
                                                * state and is ready for communication.                                     C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
00193e   0e03     MOVLW     0x3                if(usb_device_state < DEFAULT_STATE) return;                                 C:\fw\picscopefw\x017\usb.c
001940   0100     MOVLB     0x0                                                                                             
001942   5def     SUBWF     0xef,0x0,0x1                                                                                    
001944   e201     BC        0x1948                                                                                          
001946   d008     BRA       0x1958                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * Task D: Servicing USB Transaction Complete Interrupt                      C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
001948   5068     MOVF      0x68,0x0,0x0       if(UIRbits.TRNIF && UIEbits.TRNIE)                                           C:\fw\picscopefw\x017\usb.c
00194a   0b08     ANDLW     0x8                                                                                             
00194c   e005     BZ        0x1958                                                                                          
00194e   5069     MOVF      0x69,0x0,0x0                                                                                    
001950   0b08     ANDLW     0x8                                                                                             
001952   e002     BZ        0x1958                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
                                                   /*                                                                       C:\fw\picscopefw\x017\usb.c
                                                    * USBCtrlEPService only services transactions over EP0.                 C:\fw\picscopefw\x017\usb.c
                                                    * It ignores all other EP transactions.                                 C:\fw\picscopefw\x017\usb.c
                                                    */                                                                      C:\fw\picscopefw\x017\usb.c
001954   de3c     RCALL     0x15ce                 USBCtrlEPService();                                                      C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                   /*                                                                       C:\fw\picscopefw\x017\usb.c
                                                    * Other EP can be serviced later by responsible device class firmware.  C:\fw\picscopefw\x017\usb.c
                                                    * Each device driver knows when an OUT or IN transaction is ready by    C:\fw\picscopefw\x017\usb.c
                                                    * checking the buffer ownership bit.                                    C:\fw\picscopefw\x017\usb.c
                                                    * An OUT EP should always be owned by SIE until the data is ready.      C:\fw\picscopefw\x017\usb.c
                                                    * An IN EP should always be owned by CPU until the data is ready.       C:\fw\picscopefw\x017\usb.c
                                                    *                                                                       C:\fw\picscopefw\x017\usb.c
                                                    * Because of this logic, it is not necessary to save the USTAT value    C:\fw\picscopefw\x017\usb.c
                                                    * of non-EP0 transactions.                                              C:\fw\picscopefw\x017\usb.c
                                                    */                                                                      C:\fw\picscopefw\x017\usb.c
001956   9668     BCF       0x68,0x3,0x0           UIRbits.TRNIF = 0;                                                       C:\fw\picscopefw\x017\usb.c
                                               }//end if(UIRbits.TRNIF && UIEbits.TRNIE)                                    C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001958   0012     RETURN    0x0            }//end USBDriverService                                                          C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBSuspend(void)                                        C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:                                                                     C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBSuspend(void)                                                            C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * NOTE: Do not clear UIRbits.ACTVIF here!                                   C:\fw\picscopefw\x017\usb.c
                                                * Reason:                                                                   C:\fw\picscopefw\x017\usb.c
                                                * ACTVIF is only generated once an IDLEIF has been generated.               C:\fw\picscopefw\x017\usb.c
                                                * This is a 1:1 ratio interrupt generation.                                 C:\fw\picscopefw\x017\usb.c
                                                * For every IDLEIF, there will be only one ACTVIF regardless of             C:\fw\picscopefw\x017\usb.c
                                                * the number of subsequent bus transitions.                                 C:\fw\picscopefw\x017\usb.c
                                                *                                                                           C:\fw\picscopefw\x017\usb.c
                                                * If the ACTIF is cleared here, a problem could occur when:                 C:\fw\picscopefw\x017\usb.c
                                                * [       IDLE       ][bus activity ->                                      C:\fw\picscopefw\x017\usb.c
                                                * <--- 3 ms ----->     ^                                                    C:\fw\picscopefw\x017\usb.c
                                                *                ^     ACTVIF=1                                             C:\fw\picscopefw\x017\usb.c
                                                *                IDLEIF=1                                                   C:\fw\picscopefw\x017\usb.c
                                                *  #           #           #           #   (#=Program polling flags)        C:\fw\picscopefw\x017\usb.c
                                                *                          ^                                                C:\fw\picscopefw\x017\usb.c
                                                *                          This polling loop will see both                  C:\fw\picscopefw\x017\usb.c
                                                *                          IDLEIF=1 and ACTVIF=1.                           C:\fw\picscopefw\x017\usb.c
                                                *                          However, the program services IDLEIF first       C:\fw\picscopefw\x017\usb.c
                                                *                          because ACTIVIE=0.                               C:\fw\picscopefw\x017\usb.c
                                                *                          If this routine clears the only ACTIVIF,         C:\fw\picscopefw\x017\usb.c
                                                *                          then it can never get out of the suspend         C:\fw\picscopefw\x017\usb.c
                                                *                          mode.                                            C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
00195a   8469     BSF       0x69,0x2,0x0       UIEbits.ACTVIE = 1;                     // Enable bus activity interrupt     C:\fw\picscopefw\x017\usb.c
00195c   9868     BCF       0x68,0x4,0x0       UIRbits.IDLEIF = 0;                                                          C:\fw\picscopefw\x017\usb.c
00195e   826d     BSF       0x6d,0x1,0x0       UCONbits.SUSPND = 1;                    // Put USB module in power conserve  C:\fw\picscopefw\x017\usb.c
                                                                                       // mode, SIE clock inactive          C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * At this point the PIC can go into sleep,idle, or                          C:\fw\picscopefw\x017\usb.c
                                                * switch to a slower clock, etc.                                            C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               /* Modifiable Section */                                                     C:\fw\picscopefw\x017\usb.c
001960   9aa1     BCF       0xa1,0x5,0x0       PIR2bits.USBIF = 0;                                                          C:\fw\picscopefw\x017\usb.c
                                           /*                                                                               C:\fw\picscopefw\x017\usb.c
                                           //2/15/05 JD This was causing problems with USBIE being enabled..                C:\fw\picscopefw\x017\usb.c
                                               INTCONbits.RBIF = 0;                                                         C:\fw\picscopefw\x017\usb.c
                                               PIE2bits.USBIE = 1;                     // Set USB wakeup source             C:\fw\picscopefw\x017\usb.c
                                               INTCONbits.RBIE = 1;                    // Set sw2,3 wakeup source           C:\fw\picscopefw\x017\usb.c
                                               Sleep();                                // Goto sleep                        C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                               if(INTCONbits.RBIF == 1)                // Check if external stimulus        C:\fw\picscopefw\x017\usb.c
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
                                                   USBRemoteWakeup();                  // If yes, attempt RWU               C:\fw\picscopefw\x017\usb.c
                                               }                                                                            C:\fw\picscopefw\x017\usb.c
                                               PIE2bits.USBIE = 0;                                                          C:\fw\picscopefw\x017\usb.c
                                               INTCONbits.RBIE = 0;                                                         C:\fw\picscopefw\x017\usb.c
                                           */                                                                               C:\fw\picscopefw\x017\usb.c
                                               /* End Modifiable Section */                                                 C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001962   0012     RETURN    0x0            }//end USBSuspend                                                                C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBWakeFromSuspend(void)                                C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:                                                                     C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBWakeFromSuspend(void)                                                    C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * If using clock switching, this is the place to restore the                C:\fw\picscopefw\x017\usb.c
                                                * original clock frequency.                                                 C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
001964   926d     BCF       0x6d,0x1,0x0       UCONbits.SUSPND = 0;                                                         C:\fw\picscopefw\x017\usb.c
001966   9469     BCF       0x69,0x2,0x0       UIEbits.ACTVIE = 0;                                                          C:\fw\picscopefw\x017\usb.c
001968   9468     BCF       0x68,0x2,0x0       UIRbits.ACTVIF = 0;                                                          C:\fw\picscopefw\x017\usb.c
00196a   0012     RETURN    0x0            }//end USBWakeFromSuspend                                                        C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBRemoteWakeup(void)                                   C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        This function should be called by user when the device       C:\fw\picscopefw\x017\usb.c
                                            *                  is waken up by an external stimulus other than ACTIVIF.      C:\fw\picscopefw\x017\usb.c
                                            *                  Please read the note below to understand the limitations.    C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            The modifiable section in this routine should be changed     C:\fw\picscopefw\x017\usb.c
                                            *                  to meet the application needs. Current implementation        C:\fw\picscopefw\x017\usb.c
                                            *                  temporary blocks other functions from executing for a        C:\fw\picscopefw\x017\usb.c
                                            *                  period of 1-13 ms depending on the core frequency.           C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *                  According to USB 2.0 specification section 7.1.7.7,          C:\fw\picscopefw\x017\usb.c
                                            *                  "The remote wakeup device must hold the resume signaling     C:\fw\picscopefw\x017\usb.c
                                            *                  for at lest 1 ms but for no more than 15 ms."                C:\fw\picscopefw\x017\usb.c
                                            *                  The idea here is to use a delay counter loop, using a        C:\fw\picscopefw\x017\usb.c
                                            *                  common value that would work over a wide range of core       C:\fw\picscopefw\x017\usb.c
                                            *                  frequencies.                                                 C:\fw\picscopefw\x017\usb.c
                                            *                  That value selected is 1800. See table below:                C:\fw\picscopefw\x017\usb.c
                                            *                  ==========================================================   C:\fw\picscopefw\x017\usb.c
                                            *                  Core Freq(MHz)      MIP         RESUME Signal Period (ms)    C:\fw\picscopefw\x017\usb.c
                                            *                  ==========================================================   C:\fw\picscopefw\x017\usb.c
                                            *                      48              12          1.05                         C:\fw\picscopefw\x017\usb.c
                                            *                       4              1           12.6                         C:\fw\picscopefw\x017\usb.c
                                            *                  ==========================================================   C:\fw\picscopefw\x017\usb.c
                                            *                  * These timing could be incorrect when using code            C:\fw\picscopefw\x017\usb.c
                                            *                    optimization or extended instruction mode,                 C:\fw\picscopefw\x017\usb.c
                                            *                    or when having other interrupts enabled.                   C:\fw\picscopefw\x017\usb.c
                                            *                    Make sure to verify using the MPLAB SIM's Stopwatch        C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBRemoteWakeup(void)                                                       C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
                                               static word delay_count;                                                     C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
00196c   0100     MOVLB     0x0                if(usb_stat.RemoteWakeup == 1)          // Check if RemoteWakeup function    C:\fw\picscopefw\x017\usb.c
00196e   a1f0     BTFSS     0xf0,0x0,0x1                                                                                    
001970   d00e     BRA       0x198e                                                                                          
                                               {                                       // has been enabled by the host.     C:\fw\picscopefw\x017\usb.c
001972   dff8     RCALL     0x1964                 USBWakeFromSuspend();               // Unsuspend USB modue               C:\fw\picscopefw\x017\usb.c
001974   846d     BSF       0x6d,0x2,0x0           UCONbits.RESUME = 1;                // Start RESUME signaling            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                   /* Modifiable Section */                                                 C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001976   0100     MOVLB     0x0                    delay_count = 1800U;                // Set RESUME line for 1-13 ms       C:\fw\picscopefw\x017\usb.c
001978   0e08     MOVLW     0x8                                                                                             
00197a   6ffb     MOVWF     0xfb,0x1                                                                                        
00197c   0e07     MOVLW     0x7                                                                                             
00197e   6ffc     MOVWF     0xfc,0x1                                                                                        
                                                   do                                                                       C:\fw\picscopefw\x017\usb.c
                                                   {                                                                        C:\fw\picscopefw\x017\usb.c
001980   07fb     DECF      0xfb,0x1,0x1               delay_count--;                                                       C:\fw\picscopefw\x017\usb.c
001982   0e00     MOVLW     0x0                                                                                             
001984   5bfc     SUBWFB    0xfc,0x1,0x1                                                                                    
001986   51fb     MOVF      0xfb,0x0,0x1           }while(delay_count);                                                     C:\fw\picscopefw\x017\usb.c
001988   11fc     IORWF     0xfc,0x0,0x1                                                                                    
00198a   e1fa     BNZ       0x1980                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                   /* End Modifiable Section */                                             C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
00198c   946d     BCF       0x6d,0x2,0x0           UCONbits.RESUME = 0;                                                     C:\fw\picscopefw\x017\usb.c
                                               }//endif                                                                     C:\fw\picscopefw\x017\usb.c
00198e   0012     RETURN    0x0            }//end USBRemoteWakeup                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USB_SOF_Handler(void)                                   C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        The USB host sends out a SOF packet to full-speed devices    C:\fw\picscopefw\x017\usb.c
                                            *                  every 1 ms. This interrupt may be useful for isochronous     C:\fw\picscopefw\x017\usb.c
                                            *                  pipes. End designers should implement callback routine       C:\fw\picscopefw\x017\usb.c
                                            *                  as necessary.                                                C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USB_SOF_Handler(void)                                                       C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
                                               /* Callback routine here */                                                  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
001990   9c68     BCF       0x68,0x6,0x0       UIRbits.SOFIF = 0;                                                           C:\fw\picscopefw\x017\usb.c
001992   0012     RETURN    0x0            }//end USB_SOF_Handler                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBStallHandler(void)                                   C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    A STALL packet is sent to the host by the SIE.               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        The STALLIF is set anytime the SIE sends out a STALL         C:\fw\picscopefw\x017\usb.c
                                            *                  packet regardless of which endpoint causes it.               C:\fw\picscopefw\x017\usb.c
                                            *                  A Setup transaction overrides the STALL function. A stalled  C:\fw\picscopefw\x017\usb.c
                                            *                  endpoint stops stalling once it receives a setup packet.     C:\fw\picscopefw\x017\usb.c
                                            *                  In this case, the SIE will accepts the Setup packet and      C:\fw\picscopefw\x017\usb.c
                                            *                  set the TRNIF flag to notify the firmware. STALL function    C:\fw\picscopefw\x017\usb.c
                                            *                  for that particular endpoint pipe will be automatically      C:\fw\picscopefw\x017\usb.c
                                            *                  disabled (direction specific).                               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            *                  There are a few reasons for an endpoint to be stalled.       C:\fw\picscopefw\x017\usb.c
                                            *                  1. When a non-supported USB request is received.             C:\fw\picscopefw\x017\usb.c
                                            *                     Example: GET_DESCRIPTOR(DEVICE_QUALIFIER)                 C:\fw\picscopefw\x017\usb.c
                                            *                  2. When an endpoint is currently halted.                     C:\fw\picscopefw\x017\usb.c
                                            *                  3. When the device class specifies that an endpoint must     C:\fw\picscopefw\x017\usb.c
                                            *                     stall in response to a specific event.                    C:\fw\picscopefw\x017\usb.c
                                            *                     Example: Mass Storage Device Class                        C:\fw\picscopefw\x017\usb.c
                                            *                              If the CBW is not valid, the device shall        C:\fw\picscopefw\x017\usb.c
                                            *                              STALL the Bulk-In pipe.                          C:\fw\picscopefw\x017\usb.c
                                            *                              See USB Mass Storage Class Bulk-only Transport   C:\fw\picscopefw\x017\usb.c
                                            *                              Specification for more details.                  C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            UEPn.EPSTALL can be scanned to see which endpoint causes     C:\fw\picscopefw\x017\usb.c
                                            *                  the stall event.                                             C:\fw\picscopefw\x017\usb.c
                                            *                  If                                                           C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBStallHandler(void)                                                       C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
                                               /*                                                                           C:\fw\picscopefw\x017\usb.c
                                                * Does not really have to do anything here,                                 C:\fw\picscopefw\x017\usb.c
                                                * even for the control endpoint.                                            C:\fw\picscopefw\x017\usb.c
                                                * All BDs of Endpoint 0 are owned by SIE right now,                         C:\fw\picscopefw\x017\usb.c
                                                * but once a Setup Transaction is received, the ownership                   C:\fw\picscopefw\x017\usb.c
                                                * for EP0_OUT will be returned to CPU.                                      C:\fw\picscopefw\x017\usb.c
                                                * When the Setup Transaction is serviced, the ownership                     C:\fw\picscopefw\x017\usb.c
                                                * for EP0_IN will then be forced back to CPU by firmware.                   C:\fw\picscopefw\x017\usb.c
                                                */                                                                          C:\fw\picscopefw\x017\usb.c
001994   a070     BTFSS     0x70,0x0,0x0       if(UEP0bits.EPSTALL == 1)                                                    C:\fw\picscopefw\x017\usb.c
001996   d002     BRA       0x199c                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
001998   df76     RCALL     0x1886                 USBPrepareForNextSetupTrf();        // Firmware work-around              C:\fw\picscopefw\x017\usb.c
00199a   9070     BCF       0x70,0x0,0x0           UEP0bits.EPSTALL = 0;                                                    C:\fw\picscopefw\x017\usb.c
                                               }                                                                            C:\fw\picscopefw\x017\usb.c
00199c   9a68     BCF       0x68,0x5,0x0       UIRbits.STALLIF = 0;                                                         C:\fw\picscopefw\x017\usb.c
00199e   0012     RETURN    0x0            }//end USBStallHandler                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBErrorHandler(void)                                   C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        The purpose of this interrupt is mainly for debugging        C:\fw\picscopefw\x017\usb.c
                                            *                  during development. Check UEIR to see which error causes     C:\fw\picscopefw\x017\usb.c
                                            *                  the interrupt.                                               C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBErrorHandler(void)                                                       C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
0019a0   9268     BCF       0x68,0x1,0x0       UIRbits.UERRIF = 0;                                                          C:\fw\picscopefw\x017\usb.c
0019a2   0012     RETURN    0x0            }//end USBErrorHandler                                                           C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\usb.c
                                            * Function:        void USBProtocolResetHandler(void)                           C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * PreCondition:    A USB bus reset is received from the host.                   C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Side Effects:    Currently, this routine flushes any pending USB              C:\fw\picscopefw\x017\usb.c
                                            *                  transactions. It empties out the USTAT FIFO. This action     C:\fw\picscopefw\x017\usb.c
                                            *                  might not be desirable in some applications.                 C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Overview:        Once a USB bus reset is received from the host, this         C:\fw\picscopefw\x017\usb.c
                                            *                  routine should be called. It resets the device address to    C:\fw\picscopefw\x017\usb.c
                                            *                  zero, disables all non-EP0 endpoints, initializes EP0 to     C:\fw\picscopefw\x017\usb.c
                                            *                  be ready for default communication, clears all USB           C:\fw\picscopefw\x017\usb.c
                                            *                  interrupt flags, unmasks applicable USB interrupts, and      C:\fw\picscopefw\x017\usb.c
                                            *                  reinitializes internal state-machine variables.              C:\fw\picscopefw\x017\usb.c
                                            *                                                                               C:\fw\picscopefw\x017\usb.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\usb.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\usb.c
                                           void USBProtocolResetHandler(void)                                               C:\fw\picscopefw\x017\usb.c
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
0019a4   6a6a     CLRF      0x6a,0x0           UEIR = 0;                       // Clear all USB error flags                 C:\fw\picscopefw\x017\usb.c
0019a6   6a68     CLRF      0x68,0x0           UIR = 0;                        // Clears all USB interrupts                 C:\fw\picscopefw\x017\usb.c
0019a8   0e9f     MOVLW     0x9f               UEIE = 0b10011111;              // Unmask all USB error interrupts           C:\fw\picscopefw\x017\usb.c
0019aa   6e6b     MOVWF     0x6b,0x0                                                                                        
0019ac   0e7b     MOVLW     0x7b               UIE = 0b01111011;               // Enable all interrupts except ACTVIE       C:\fw\picscopefw\x017\usb.c
0019ae   6e69     MOVWF     0x69,0x0                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0019b0   6a6e     CLRF      0x6e,0x0           UADDR = 0x00;                   // Reset to default address                  C:\fw\picscopefw\x017\usb.c
0019b2   0e0f     MOVLW     0xf                mDisableEP1to15();              // Reset all non-EP0 UEPn registers          C:\fw\picscopefw\x017\usb.c
0019b4   6ee6     MOVWF     0xe6,0x0                                                                                        
0019b6   0e71     MOVLW     0x71                                                                                            
0019b8   6ee6     MOVWF     0xe6,0x0                                                                                        
0019ba   0e0f     MOVLW     0xf                                                                                             
0019bc   6ee6     MOVWF     0xe6,0x0                                                                                        
0019be   d811     RCALL     0x19e2                                                                                          
0019c0   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0019c2   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0019c4   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0019c6   0e16     MOVLW     0x16               UEP0 = EP_CTRL|HSHK_EN;         // Init EP0 as a Ctrl EP, see usbdrv.h       C:\fw\picscopefw\x017\usb.c
0019c8   6e70     MOVWF     0x70,0x0                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0019ca   a668     BTFSS     0x68,0x3,0x0       while(UIRbits.TRNIF == 1)       // Flush any pending transactions            C:\fw\picscopefw\x017\usb.c
0019cc   d002     BRA       0x19d2                                                                                          
0019d0   d7fc     BRA       0x19ca                                                                                          
0019ce   9668     BCF       0x68,0x3,0x0           UIRbits.TRNIF = 0;                                                       C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0019d2   986d     BCF       0x6d,0x4,0x0       UCONbits.PKTDIS = 0;            // Make sure packet processing is enabled    C:\fw\picscopefw\x017\usb.c
0019d4   df58     RCALL     0x1886             USBPrepareForNextSetupTrf();    // Declared in usbctrltrf.c                  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
0019d6   0100     MOVLB     0x0                usb_stat.RemoteWakeup = 0;      // Default status flag to disable            C:\fw\picscopefw\x017\usb.c
0019d8   91f0     BCF       0xf0,0x0,0x1                                                                                    
0019da   6bf1     CLRF      0xf1,0x1           usb_active_cfg = 0;             // Clear active configuration                C:\fw\picscopefw\x017\usb.c
0019dc   0e03     MOVLW     0x3                usb_device_state = DEFAULT_STATE;                                            C:\fw\picscopefw\x017\usb.c
0019de   6fef     MOVWF     0xef,0x1                                                                                        
0019e0   0012     RETURN    0x0            }//end USBProtocolResetHandler                                                   C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /* Auxiliary Function */                                                         C:\fw\picscopefw\x017\usb.c
0019e2   cfd9     MOVFF     0xfd9,0xfe6    void ClearArray(byte* startAdr,byte count)                                       C:\fw\picscopefw\x017\usb.c
0019e4   ffe6                                                                                                               
0019e6   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
0019e8   ffd9                                                                                                               
                                           {                                                                                C:\fw\picscopefw\x017\usb.c
0019ea   0efd     MOVLW     0xfd               *startAdr;                                                                   C:\fw\picscopefw\x017\usb.c
0019ec   cfdb     MOVFF     0xfdb,0xfe9                                                                                     
0019ee   ffe9                                                                                                               
0019f0   0efe     MOVLW     0xfe                                                                                            
0019f2   cfdb     MOVFF     0xfdb,0xfea                                                                                     
0019f4   ffea                                                                                                               
0019f6   0efc     MOVLW     0xfc               while(count)                                                                 C:\fw\picscopefw\x017\usb.c
0019f8   50db     MOVF      0xdb,0x0,0x0                                                                                    
0019fa   e004     BZ        0x1a04                                                                                          
001a02   d7f9     BRA       0x19f6                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\usb.c
                                                   _asm                                                                     C:\fw\picscopefw\x017\usb.c
0019fc   6aee     CLRF      0xee,0x0               clrf POSTINC0,0                                                          C:\fw\picscopefw\x017\usb.c
                                                   _endasm                                                                  C:\fw\picscopefw\x017\usb.c
0019fe   0efc     MOVLW     0xfc                   count--;                                                                 C:\fw\picscopefw\x017\usb.c
001a00   06db     DECF      0xdb,0x1,0x0                                                                                    
                                               }//end while                                                                 C:\fw\picscopefw\x017\usb.c
001a04   52e5     MOVF      0xe5,0x1,0x0   }//end ClearArray                                                                C:\fw\picscopefw\x017\usb.c
001a06   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001a08   ffd9                                                                                                               
001a0a   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                           /** EOF usbdrv.c *************************************************************/  C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usb.c
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\picscopefw\x017\usbapplet.c
                                           //#include <p18cxxx.h>                                                           C:\fw\picscopefw\x017\usbapplet.c
                                           #include "c_system.h"                                                            C:\fw\picscopefw\x017\usbapplet.c
                                           #include "typedefs.h"                                                            C:\fw\picscopefw\x017\usbapplet.c
                                           #include "usb.h"                                                                 C:\fw\picscopefw\x017\usbapplet.c
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
                                           void PROCESS_COMM_REQUEST(void);                                                 C:\fw\picscopefw\x017\usbapplet.c
                                           //void RemCapCalculation(void);                                                  C:\fw\picscopefw\x017\usbapplet.c
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
                                           void HIDSetReportHandler(void) {                                                 C:\fw\picscopefw\x017\usbapplet.c
001d58   0102     MOVLB     0x2            	USBQuery = true;                                                                C:\fw\picscopefw\x017\usbapplet.c
001d5a   89c3     BSF       0xc3,0x4,0x1                                                                                    
001d5c   ec1c     CALL      0xa38,0x0      	PROCESS_COMM_REQUEST();                                                         C:\fw\picscopefw\x017\usbapplet.c
001d5e   f005                                                                                                               
001d60   0102     MOVLB     0x2            	USBQuery = false;	                                                              C:\fw\picscopefw\x017\usbapplet.c
001d62   99c3     BCF       0xc3,0x4,0x1                                                                                    
001d64   0012     RETURN    0x0            }                                                                                C:\fw\picscopefw\x017\usbapplet.c
                                           //-----------------------------------------------------------------------        C:\fw\picscopefw\x017\usbapplet.c
                                           void HIDGetReportHandler(void) {                                                 C:\fw\picscopefw\x017\usbapplet.c
                                           //load up CtrlTrfData with data.                                                 C:\fw\picscopefw\x017\usbapplet.c
001d66   0102     MOVLB     0x2            	USBQuery = true;                                                                C:\fw\picscopefw\x017\usbapplet.c
001d68   89c3     BSF       0xc3,0x4,0x1                                                                                    
001d6a   ec1c     CALL      0xa38,0x0      	PROCESS_COMM_REQUEST();                                                         C:\fw\picscopefw\x017\usbapplet.c
001d6c   f005                                                                                                               
001d6e   0100     MOVLB     0x0            	ctrl_trf_session_owner = MUID_HID;                                              C:\fw\picscopefw\x017\usbapplet.c
001d70   0e02     MOVLW     0x2                                                                                             
001d72   6ff4     MOVWF     0xf4,0x1                                                                                        
001d74   0100     MOVLB     0x0            	pSrc.bRam = (byte*)&CtrlTrfData;                                                C:\fw\picscopefw\x017\usbapplet.c
001d76   0e18     MOVLW     0x18                                                                                            
001d78   6ff5     MOVWF     0xf5,0x1                                                                                        
001d7a   0e04     MOVLW     0x4                                                                                             
001d7c   6ff6     MOVWF     0xf6,0x1                                                                                        
001d7e   0100     MOVLB     0x0            	usb_stat.ctrl_trf_mem = _RAM;       // Set memory type                          C:\fw\picscopefw\x017\usbapplet.c
001d80   93f0     BCF       0xf0,0x1,0x1                                                                                    
001d82   0102     MOVLB     0x2            	USBQuery = false;                                                               C:\fw\picscopefw\x017\usbapplet.c
001d84   99c3     BCF       0xc3,0x4,0x1                                                                                    
001d86   0012     RETURN    0x0            }                                                                                C:\fw\picscopefw\x017\usbapplet.c
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
                                           unsigned char EP1Buffer[64];                                                     C:\fw\picscopefw\x017\usbapplet.c
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
                                           extern TwoBytes DataBuffer[220];                                                 C:\fw\picscopefw\x017\usbapplet.c
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
                                           unsigned char InputDataPointer;                                                  C:\fw\picscopefw\x017\usbapplet.c
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
001d88   cfd9     MOVFF     0xfd9,0xfe6    void ServiceEP1(void) {                                                          C:\fw\picscopefw\x017\usbapplet.c
001d8a   ffe6                                                                                                               
001d8c   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001d8e   ffd9                                                                                                               
001d90   0e04     MOVLW     0x4                                                                                             
001d92   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           	BitField ByteToSend, NumBytes;                                                  C:\fw\picscopefw\x017\usbapplet.c
                                           	unsigned char tempvar1, tempvar0;                                               C:\fw\picscopefw\x017\usbapplet.c
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
                                           	                                                                                C:\fw\picscopefw\x017\usbapplet.c
001d94   0102     MOVLB     0x2            	ServiceEP1Data = false;                                                         C:\fw\picscopefw\x017\usbapplet.c
001d96   9bc3     BCF       0xc3,0x5,0x1                                                                                    
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
                                           	//report ID 52                                                                  C:\fw\picscopefw\x017\usbapplet.c
001d98   0100     MOVLB     0x0            	EP1Buffer[0] = 0xB0;				//0th byte is report id                                 C:\fw\picscopefw\x017\usbapplet.c
001d9a   0eb0     MOVLW     0xb0                                                                                            
001d9c   6fae     MOVWF     0xae,0x1                                                                                        
001d9e   c0ee     MOVFF     0xee,0xaf      	EP1Buffer[1] = InputDataPointer;                                                C:\fw\picscopefw\x017\usbapplet.c
001da0   f0af                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
001da2   0e02     MOVLW     0x2            	tempvar1 = 0;                                                                   C:\fw\picscopefw\x017\usbapplet.c
001da4   6adb     CLRF      0xdb,0x0                                                                                        
001da6   0e03     MOVLW     0x3            	for (tempvar0 = 0;tempvar0 < 30;tempvar0++) {                                   C:\fw\picscopefw\x017\usbapplet.c
001da8   6adb     CLRF      0xdb,0x0                                                                                        
001daa   0e1e     MOVLW     0x1e                                                                                            
001dac   6ef3     MOVWF     0xf3,0x0                                                                                        
001dae   0e03     MOVLW     0x3                                                                                             
001db0   cfdb     MOVFF     0xfdb,0xff4                                                                                     
001db2   fff4                                                                                                               
001db4   50f3     MOVF      0xf3,0x0,0x0                                                                                    
001db6   5cf4     SUBWF     0xf4,0x0,0x0                                                                                    
001db8   e234     BC        0x1e22                                                                                          
001e1c   0e03     MOVLW     0x3                                                                                             
001e1e   2adb     INCF      0xdb,0x1,0x0                                                                                    
001e20   d7c4     BRA       0x1daa                                                                                          
001dba   0e03     MOVLW     0x3            		EP1Buffer[tempvar1] = DataBuffer[tempvar0].b_form.low;                         C:\fw\picscopefw\x017\usbapplet.c
001dbc   6aea     CLRF      0xea,0x0                                                                                        
001dbe   34db     RLCF      0xdb,0x0,0x0                                                                                    
001dc0   0bfe     ANDLW     0xfe                                                                                            
001dc2   36ea     RLCF      0xea,0x1,0x0                                                                                    
001dc4   6ee9     MOVWF     0xe9,0x0                                                                                        
001dc6   0e03     MOVLW     0x3                                                                                             
001dc8   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001dca   0e01     MOVLW     0x1                                                                                             
001dcc   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001dce   50ef     MOVF      0xef,0x0,0x0                                                                                    
001dd0   6ee6     MOVWF     0xe6,0x0                                                                                        
001dd2   0e02     MOVLW     0x2                                                                                             
001dd4   50db     MOVF      0xdb,0x0,0x0                                                                                    
001dd6   6aea     CLRF      0xea,0x0                                                                                        
001dd8   0fae     ADDLW     0xae                                                                                            
001dda   6ee9     MOVWF     0xe9,0x0                                                                                        
001ddc   0e00     MOVLW     0x0                                                                                             
001dde   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001de0   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001de2   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001de4   6eef     MOVWF     0xef,0x0                                                                                        
001de6   0e02     MOVLW     0x2            		tempvar1++;                                                                    C:\fw\picscopefw\x017\usbapplet.c
001de8   2adb     INCF      0xdb,0x1,0x0                                                                                    
001dea   0e03     MOVLW     0x3            		EP1Buffer[tempvar1] = DataBuffer[tempvar0].b_form.high;                        C:\fw\picscopefw\x017\usbapplet.c
001dec   6aea     CLRF      0xea,0x0                                                                                        
001dee   34db     RLCF      0xdb,0x0,0x0                                                                                    
001df0   0bfe     ANDLW     0xfe                                                                                            
001df2   36ea     RLCF      0xea,0x1,0x0                                                                                    
001df4   6ee9     MOVWF     0xe9,0x0                                                                                        
001df6   0e03     MOVLW     0x3                                                                                             
001df8   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001dfa   0e01     MOVLW     0x1                                                                                             
001dfc   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001dfe   52ee     MOVF      0xee,0x1,0x0                                                                                    
001e00   50ef     MOVF      0xef,0x0,0x0                                                                                    
001e02   6ee6     MOVWF     0xe6,0x0                                                                                        
001e04   0e02     MOVLW     0x2                                                                                             
001e06   50db     MOVF      0xdb,0x0,0x0                                                                                    
001e08   6aea     CLRF      0xea,0x0                                                                                        
001e0a   0fae     ADDLW     0xae                                                                                            
001e0c   6ee9     MOVWF     0xe9,0x0                                                                                        
001e0e   0e00     MOVLW     0x0                                                                                             
001e10   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001e12   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001e14   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001e16   6eef     MOVWF     0xef,0x0                                                                                        
001e18   0e02     MOVLW     0x2            		tempvar1++;                                                                    C:\fw\picscopefw\x017\usbapplet.c
001e1a   2adb     INCF      0xdb,0x1,0x0                                                                                    
                                           	}                                                                               C:\fw\picscopefw\x017\usbapplet.c
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
001e22   52de     MOVF      0xde,0x1,0x0   	NumBytes.byte = 64;                                                             C:\fw\picscopefw\x017\usbapplet.c
001e24   0e40     MOVLW     0x40                                                                                            
001e26   6edd     MOVWF     0xdd,0x0                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
001e28   0104     MOVLB     0x4                if(!mHIDTxIsBusy()) {                                                        C:\fw\picscopefw\x017\usbapplet.c
001e2a   bf0c     BTFSC     0xc,0x7,0x1                                                                                     
001e2c   d00c     BRA       0x1e46                                                                                          
                                           //put data on the endpoint:                                                      C:\fw\picscopefw\x017\usbapplet.c
001e2e   0e01     MOVLW     0x1            		HIDTxReport((unsigned char *)&EP1Buffer[0],NumBytes.byte);                     C:\fw\picscopefw\x017\usbapplet.c
001e30   cfdb     MOVFF     0xfdb,0xfe6                                                                                     
001e32   ffe6                                                                                                               
001e34   0eae     MOVLW     0xae                                                                                            
001e36   6ee6     MOVWF     0xe6,0x0                                                                                        
001e38   0e00     MOVLW     0x0                                                                                             
001e3a   6ee6     MOVWF     0xe6,0x0                                                                                        
001e3c   eca8     CALL      0x1b50,0x0                                                                                      
001e3e   f00d                                                                                                               
001e40   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001e42   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001e44   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           	}                                                                               C:\fw\picscopefw\x017\usbapplet.c
001e46   cfd9     MOVFF     0xfd9,0xfe1    }                                                                                C:\fw\picscopefw\x017\usbapplet.c
001e48   ffe1                                                                                                               
001e4a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001e4c   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001e4e   ffd9                                                                                                               
001e50   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
                                                                                                                            C:\fw\picscopefw\x017\usbapplet.c
                                           /*********************************************************************           C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            *                Microchip USB C18 Firmware Version 1.0                         C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            *********************************************************************           C:\fw\picscopefw\x017\usbdescript.c
                                            * FileName:        usbdsc.c                                                     C:\fw\picscopefw\x017\usbdescript.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\picscopefw\x017\usbdescript.c
                                            * Processor:       PIC18                                                        C:\fw\picscopefw\x017\usbdescript.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\picscopefw\x017\usbdescript.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * Software License Agreement                                                    C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\picscopefw\x017\usbdescript.c
                                            * (the Company) for its PICmicro Microcontroller is intended and             C:\fw\picscopefw\x017\usbdescript.c
                                            * supplied to you, the Companys customer, for use solely and                   C:\fw\picscopefw\x017\usbdescript.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\picscopefw\x017\usbdescript.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\picscopefw\x017\usbdescript.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\picscopefw\x017\usbdescript.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\picscopefw\x017\usbdescript.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\picscopefw\x017\usbdescript.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\picscopefw\x017\usbdescript.c
                                            * license.                                                                      C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * THIS SOFTWARE IS PROVIDED IN AN AS IS CONDITION. NO WARRANTIES,             C:\fw\picscopefw\x017\usbdescript.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\picscopefw\x017\usbdescript.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\picscopefw\x017\usbdescript.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\picscopefw\x017\usbdescript.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\picscopefw\x017\usbdescript.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            ********************************************************************/           C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           /*********************************************************************           C:\fw\picscopefw\x017\usbdescript.c
                                            * -usbdsc.c-                                                                    C:\fw\picscopefw\x017\usbdescript.c
                                            * This file contains the USB descriptor information. It is used                 C:\fw\picscopefw\x017\usbdescript.c
                                            * in conjunction with the usbdsc.h file. When a descriptor is added             C:\fw\picscopefw\x017\usbdescript.c
                                            * or removed from the main configuration descriptor, i.e. CFG01,                C:\fw\picscopefw\x017\usbdescript.c
                                            * the user must also change the descriptor structure defined in                 C:\fw\picscopefw\x017\usbdescript.c
                                            * the usbdsc.h file. The structure is used to calculate the                     C:\fw\picscopefw\x017\usbdescript.c
                                            * descriptor size, i.e. sizeof(CFG01).                                          C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * A typical configuration descriptor consists of:                               C:\fw\picscopefw\x017\usbdescript.c
                                            * At least one configuration descriptor (USB_CFG_DSC)                           C:\fw\picscopefw\x017\usbdescript.c
                                            * One or more interface descriptors (USB_INTF_DSC)                              C:\fw\picscopefw\x017\usbdescript.c
                                            * One or more endpoint descriptors (USB_EP_DSC)                                 C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * Naming Convention:                                                            C:\fw\picscopefw\x017\usbdescript.c
                                            * To resolve ambiguity, the naming convention are as followed:                  C:\fw\picscopefw\x017\usbdescript.c
                                            * - USB_CFG_DSC type should be named cdxx, where xx is the                      C:\fw\picscopefw\x017\usbdescript.c
                                            *   configuration number. This number should match the actual                   C:\fw\picscopefw\x017\usbdescript.c
                                            *   index value of this configuration.                                          C:\fw\picscopefw\x017\usbdescript.c
                                            * - USB_INTF_DSC type should be named i<yy>a<zz>, where yy is the               C:\fw\picscopefw\x017\usbdescript.c
                                            *   interface number and zz is the alternate interface number.                  C:\fw\picscopefw\x017\usbdescript.c
                                            * - USB_EP_DSC type should be named ep<##><d>_i<yy>a<zz>, where                 C:\fw\picscopefw\x017\usbdescript.c
                                            *   ## is the endpoint number and d is the direction of transfer.               C:\fw\picscopefw\x017\usbdescript.c
                                            *   The interface name should also be listed as a suffix to identify            C:\fw\picscopefw\x017\usbdescript.c
                                            *   which interface does the endpoint belong to.                                C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * Example:                                                                      C:\fw\picscopefw\x017\usbdescript.c
                                            * If a device has one configuration, two interfaces; interface 0                C:\fw\picscopefw\x017\usbdescript.c
                                            * has two endpoints (in and out), and interface 1 has one endpoint(in).         C:\fw\picscopefw\x017\usbdescript.c
                                            * Then the CFG01 structure in the usbdsc.h should be:                           C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * #define CFG01 rom struct                            \                         C:\fw\picscopefw\x017\usbdescript.c
                                            * {   USB_CFG_DSC             cd01;                   \                         C:\fw\picscopefw\x017\usbdescript.c
                                            *     USB_INTF_DSC            i00a00;                 \                         C:\fw\picscopefw\x017\usbdescript.c
                                            *     USB_EP_DSC              ep01o_i00a00;           \                         C:\fw\picscopefw\x017\usbdescript.c
                                            *     USB_EP_DSC              ep01i_i00a00;           \                         C:\fw\picscopefw\x017\usbdescript.c
                                            *     USB_INTF_DSC            i01a00;                 \                         C:\fw\picscopefw\x017\usbdescript.c
                                            *     USB_EP_DSC              ep02i_i01a00;           \                         C:\fw\picscopefw\x017\usbdescript.c
                                            * } cfg01                                                                       C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * Note the hierarchy of the descriptors above, it follows the USB               C:\fw\picscopefw\x017\usbdescript.c
                                            * specification requirement. All endpoints belonging to an interface            C:\fw\picscopefw\x017\usbdescript.c
                                            * should be listed immediately after that interface.                            C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * -------------------------------------------------------------------           C:\fw\picscopefw\x017\usbdescript.c
                                            * Filling in the descriptor values in the usbdsc.c file:                        C:\fw\picscopefw\x017\usbdescript.c
                                            * -------------------------------------------------------------------           C:\fw\picscopefw\x017\usbdescript.c
                                            * Most items should be self-explanatory, however, a few will be                 C:\fw\picscopefw\x017\usbdescript.c
                                            * explained for clarification.                                                  C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * [Configuration Descriptor(USB_CFG_DSC)]                                       C:\fw\picscopefw\x017\usbdescript.c
                                            * The configuration attribute must always have the _DEFAULT                     C:\fw\picscopefw\x017\usbdescript.c
                                            * definition at the minimum. Additional options can be ORed                     C:\fw\picscopefw\x017\usbdescript.c
                                            * to the _DEFAULT attribute. Available options are _SELF and _RWU.              C:\fw\picscopefw\x017\usbdescript.c
                                            * These definitions are defined in the usbdefs_std_dsc.h file. The              C:\fw\picscopefw\x017\usbdescript.c
                                            * _SELF tells the USB host that this device is self-powered. The                C:\fw\picscopefw\x017\usbdescript.c
                                            * _RWU tells the USB host that this device supports Remote Wakeup.              C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * [Endpoint Descriptor(USB_EP_DSC)]                                             C:\fw\picscopefw\x017\usbdescript.c
                                            * Assume the following example:                                                 C:\fw\picscopefw\x017\usbdescript.c
                                            * sizeof(USB_EP_DSC),DSC_EP,_EP01_OUT,_BULK,64,0x00                             C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * The first two parameters are self-explanatory. They specify the               C:\fw\picscopefw\x017\usbdescript.c
                                            * length of this endpoint descriptor (7) and the descriptor type.               C:\fw\picscopefw\x017\usbdescript.c
                                            * The next parameter identifies the endpoint, the definitions are               C:\fw\picscopefw\x017\usbdescript.c
                                            * defined in usbdefs_std_dsc.h and has the following naming                     C:\fw\picscopefw\x017\usbdescript.c
                                            * convention:                                                                   C:\fw\picscopefw\x017\usbdescript.c
                                            * _EP<##>_<dir>                                                                 C:\fw\picscopefw\x017\usbdescript.c
                                            * where ## is the endpoint number and dir is the direction of                   C:\fw\picscopefw\x017\usbdescript.c
                                            * transfer. The dir has the value of either 'OUT' or 'IN'.                      C:\fw\picscopefw\x017\usbdescript.c
                                            * The next parameter identifies the type of the endpoint. Available             C:\fw\picscopefw\x017\usbdescript.c
                                            * options are _BULK, _INT, _ISO, and _CTRL. The _CTRL is not                    C:\fw\picscopefw\x017\usbdescript.c
                                            * typically used because the default control transfer endpoint is               C:\fw\picscopefw\x017\usbdescript.c
                                            * not defined in the USB descriptors. When _ISO option is used,                 C:\fw\picscopefw\x017\usbdescript.c
                                            * addition options can be ORed to _ISO. Example:                                C:\fw\picscopefw\x017\usbdescript.c
                                            * _ISO|_AD|_FE                                                                  C:\fw\picscopefw\x017\usbdescript.c
                                            * This describes the endpoint as an isochronous pipe with adaptive              C:\fw\picscopefw\x017\usbdescript.c
                                            * and feedback attributes. See usbdefs_std_dsc.h and the USB                    C:\fw\picscopefw\x017\usbdescript.c
                                            * specification for details. The next parameter defines the size of             C:\fw\picscopefw\x017\usbdescript.c
                                            * the endpoint. The last parameter in the polling interval.                     C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * -------------------------------------------------------------------           C:\fw\picscopefw\x017\usbdescript.c
                                            * Adding a USB String                                                           C:\fw\picscopefw\x017\usbdescript.c
                                            * -------------------------------------------------------------------           C:\fw\picscopefw\x017\usbdescript.c
                                            * A string descriptor array should have the following format:                   C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * rom struct{byte bLength;byte bDscType;word string[size];}sdxxx={              C:\fw\picscopefw\x017\usbdescript.c
                                            * sizeof(sdxxx),DSC_STR,<text>};                                                C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * The above structure provides a means for the C compiler to                    C:\fw\picscopefw\x017\usbdescript.c
                                            * calculate the length of string descriptor sdxxx, where xxx is the             C:\fw\picscopefw\x017\usbdescript.c
                                            * index number. The first two bytes of the descriptor are descriptor            C:\fw\picscopefw\x017\usbdescript.c
                                            * length and type. The rest <text> are string texts which must be               C:\fw\picscopefw\x017\usbdescript.c
                                            * in the unicode format. The unicode format is achieved by declaring            C:\fw\picscopefw\x017\usbdescript.c
                                            * each character as a word type. The whole text string is declared              C:\fw\picscopefw\x017\usbdescript.c
                                            * as a word array with the number of characters equals to <size>.               C:\fw\picscopefw\x017\usbdescript.c
                                            * <size> has to be manually counted and entered into the array                  C:\fw\picscopefw\x017\usbdescript.c
                                            * declaration. Let's study this through an example:                             C:\fw\picscopefw\x017\usbdescript.c
                                            * if the string is "USB" , then the string descriptor should be:                C:\fw\picscopefw\x017\usbdescript.c
                                            * (Using index 02)                                                              C:\fw\picscopefw\x017\usbdescript.c
                                            * rom struct{byte bLength;byte bDscType;word string[3];}sd002={                 C:\fw\picscopefw\x017\usbdescript.c
                                            * sizeof(sd002),DSC_STR,'U','S','B'};                                           C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * A USB project may have multiple strings and the firmware supports             C:\fw\picscopefw\x017\usbdescript.c
                                            * the management of multiple strings through a look-up table.                   C:\fw\picscopefw\x017\usbdescript.c
                                            * The look-up table is defined as:                                              C:\fw\picscopefw\x017\usbdescript.c
                                            * rom const unsigned char *rom USB_SD_Ptr[]={&sd000,&sd001,&sd002};             C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * The above declaration has 3 strings, sd000, sd001, and sd002.                 C:\fw\picscopefw\x017\usbdescript.c
                                            * Strings can be removed or added. sd000 is a specialized string                C:\fw\picscopefw\x017\usbdescript.c
                                            * descriptor. It defines the language code, usually this is                     C:\fw\picscopefw\x017\usbdescript.c
                                            * US English (0x0409). The index of the string must match the index             C:\fw\picscopefw\x017\usbdescript.c
                                            * position of the USB_SD_Ptr array, &sd000 must be in position                  C:\fw\picscopefw\x017\usbdescript.c
                                            * USB_SD_Ptr[0], &sd001 must be in position USB_SD_Ptr[1] and so on.            C:\fw\picscopefw\x017\usbdescript.c
                                            * The look-up table USB_SD_Ptr is used by the get string handler                C:\fw\picscopefw\x017\usbdescript.c
                                            * function in usb9.c.                                                           C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * -------------------------------------------------------------------           C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * The look-up table scheme also applies to the configuration                    C:\fw\picscopefw\x017\usbdescript.c
                                            * descriptor. A USB device may have multiple configuration                      C:\fw\picscopefw\x017\usbdescript.c
                                            * descriptors, i.e. CFG01, CFG02, etc. To add a configuration                   C:\fw\picscopefw\x017\usbdescript.c
                                            * descriptor, user must implement a structure similar to CFG01.                 C:\fw\picscopefw\x017\usbdescript.c
                                            * The next step is to add the configuration descriptor name, i.e.               C:\fw\picscopefw\x017\usbdescript.c
                                            * cfg01, cfg02,.., to the look-up table USB_CD_Ptr. USB_CD_Ptr[0]               C:\fw\picscopefw\x017\usbdescript.c
                                            * is a dummy place holder since configuration 0 is the un-configured            C:\fw\picscopefw\x017\usbdescript.c
                                            * state according to the definition in the USB specification.                   C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            ********************************************************************/           C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           /*********************************************************************           C:\fw\picscopefw\x017\usbdescript.c
                                            * Descriptor specific type definitions are defined in:                          C:\fw\picscopefw\x017\usbdescript.c
                                            * system\usb\usbdefs\usbdefs_std_dsc.h                                          C:\fw\picscopefw\x017\usbdescript.c
                                            *                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                            * Configuration information is defined in:                                      C:\fw\picscopefw\x017\usbdescript.c
                                            * autofiles\usbcfg.h                                                            C:\fw\picscopefw\x017\usbdescript.c
                                            ********************************************************************/           C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           #define POLLING_INTERVAL	40                                                      C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           /** I N C L U D E S *************************************************/           C:\fw\picscopefw\x017\usbdescript.c
                                           #include "typedefs.h"                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           #include "usb.h"                                                                 C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           /** C O N S T A N T S ************************************************/          C:\fw\picscopefw\x017\usbdescript.c
                                           #pragma romdata                                                                  C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           /* Device Descriptor */                                                          C:\fw\picscopefw\x017\usbdescript.c
                                           rom USB_DEV_DSC device_dsc=                                                      C:\fw\picscopefw\x017\usbdescript.c
                                           {                                                                                C:\fw\picscopefw\x017\usbdescript.c
                                               0x12,     	// bLength                                                        C:\fw\picscopefw\x017\usbdescript.c
                                               0x01,     	// bDescriptorType                                                C:\fw\picscopefw\x017\usbdescript.c
                                               0x0110,    	// bcdUSB (spec release #)                                       C:\fw\picscopefw\x017\usbdescript.c
                                               0x00,     	// bDeviceClass                                                   C:\fw\picscopefw\x017\usbdescript.c
                                               0x00,     	// bDeviceSubClass                                                C:\fw\picscopefw\x017\usbdescript.c
                                               0x00,     	// bDeviceProtocol                                                C:\fw\picscopefw\x017\usbdescript.c
                                               0x08,     	// bMaxPacketSize0                                                C:\fw\picscopefw\x017\usbdescript.c
                                               0x09AE,     // idVendor - 0x09AE is Tripplite's Vendor ID                    C:\fw\picscopefw\x017\usbdescript.c
                                               0x4429,		// idProduct                                                        C:\fw\picscopefw\x017\usbdescript.c
                                               0x0010,    	// bcdDevice : Project version = 0.10                            C:\fw\picscopefw\x017\usbdescript.c
                                               INDEX_MANUFACTURER,	// Index of string Descriptor describing manufacturer      C:\fw\picscopefw\x017\usbdescript.c
                                               INDEX_NAME,			// Index of string Descriptor describing product               C:\fw\picscopefw\x017\usbdescript.c
                                               INDEX_SERIALNUM,	// Index of string Descriptor describing the device's serial number C:\fw\picscopefw\x017\usbdescript.c
                                               0x01				// bNumConfigurations : renaud 1 configuration                       C:\fw\picscopefw\x017\usbdescript.c
                                           };                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           /* Configuration 1 Descriptor */                                                 C:\fw\picscopefw\x017\usbdescript.c
                                           CFG01={                                                                          C:\fw\picscopefw\x017\usbdescript.c
                                           	0x09,		// bLength: Configuration Descriptor size                                C:\fw\picscopefw\x017\usbdescript.c
                                           	0x02,		// bDescriptorType: Configuration                                        C:\fw\picscopefw\x017\usbdescript.c
                                           	P1_CONFDESC_LEN,	//(word) Length of configuration descriptor. **Renaud : To update C:\fw\picscopefw\x017\usbdescript.c
                                           	0x01,		// bNumInterfaces: 1 interface.                                          C:\fw\picscopefw\x017\usbdescript.c
                                           	0x01,		// bConfigurationValue: Configuration value = 1                          C:\fw\picscopefw\x017\usbdescript.c
                                           	0,			// iConfiguration: Index of string descriptor describing the configuration (None) C:\fw\picscopefw\x017\usbdescript.c
                                           //	0x80,		// bmAttributes: Bus powered and NO Remote wakeup                      C:\fw\picscopefw\x017\usbdescript.c
                                           	0xA0,		// bmAttributes: Bus powered and Remote wakeup ** Renaud : changed from 0xE0 C:\fw\picscopefw\x017\usbdescript.c
                                           //	0xC0,		// bmAttributes: Self powered and NO Remote wakeup                     C:\fw\picscopefw\x017\usbdescript.c
                                           //	0xE0,		// bmAttributes: Self powered and Remote wakeup                        C:\fw\picscopefw\x017\usbdescript.c
                                           	0x32,		// MaxPower 50 mA : ** Renaud : MaxPowerself-powered draws 0 mA from the bus.  C:\fw\picscopefw\x017\usbdescript.c
                                           //	0x00,		// 0 mA power consumption.                                             C:\fw\picscopefw\x017\usbdescript.c
                                           // Interface descriptor (Interface 0 = DemoKit)                                  C:\fw\picscopefw\x017\usbdescript.c
                                           	0x09,		// bLength: Interface Descriptor size                                    C:\fw\picscopefw\x017\usbdescript.c
                                           	0x04,		// bDescriptorType: Interface descriptor type  ** Renaud : to check      C:\fw\picscopefw\x017\usbdescript.c
                                           	0x00,		// bInterfaceNumber: Interface Number = 0                                C:\fw\picscopefw\x017\usbdescript.c
                                           	0x00,		// bAlternateSetting: No Alternate setting                               C:\fw\picscopefw\x017\usbdescript.c
                                           	0x01,		// bNumEndpoints: one endpoints used    ** Renaud : changed from 2 to 1  C:\fw\picscopefw\x017\usbdescript.c
                                           	0x03,		// bInterfaceClass: HID                                                  C:\fw\picscopefw\x017\usbdescript.c
                                           	0x00,		// bInterfaceSubClass: ** Renaud : changed from 1 (Boot Interface Subclass in tripplite descriptor)to 0 : no boot subclass C:\fw\picscopefw\x017\usbdescript.c
                                           	0x00,		// bInterfaceProtocol: ** Renaud : changed from 2 (protocol - mouse in tripplite descriptor) to 0 : no protocol  C:\fw\picscopefw\x017\usbdescript.c
                                           	0x00,		// iInterface: Index of string descriptor (No string value)              C:\fw\picscopefw\x017\usbdescript.c
                                           // HID descriptor (Demokit)                                                      C:\fw\picscopefw\x017\usbdescript.c
                                           	0x09,		// bLength: HID Descriptor size                                          C:\fw\picscopefw\x017\usbdescript.c
                                           	0x21,		// bDescriptorType: HID                                                  C:\fw\picscopefw\x017\usbdescript.c
                                           	0x0110,		// (word) bcdHID: HID Class Spec release number (1.10) ** Renaud : I let rev 1.10, but Tripplite has HID class release number (1.00) C:\fw\picscopefw\x017\usbdescript.c
                                           	0x00,		// bCountryCode: Hardware target country US ** Renaud changed from 0x21 (US) to 0x00 (none specified) C:\fw\picscopefw\x017\usbdescript.c
                                           	0x01,		// bNumDescriptors: Number of HID class descriptors to follow            C:\fw\picscopefw\x017\usbdescript.c
                                           	0x22,		// bDescriptorType: Report                                               C:\fw\picscopefw\x017\usbdescript.c
                                           	HID_RPT_UPS_SIZE,	// (word) Length of report descriptor interface 0 (2 bytes) ** Renaud : To update C:\fw\picscopefw\x017\usbdescript.c
                                           // Endpoint 1 descriptor (Demokit)                                               C:\fw\picscopefw\x017\usbdescript.c
                                           	0x07,		// bLength: Endpoint Descriptor size                                     C:\fw\picscopefw\x017\usbdescript.c
                                           	0x05,		// bDescriptorType: Endpoint descriptor type   ** Renaud : To check      C:\fw\picscopefw\x017\usbdescript.c
                                           	0x81,		// bEndpointAddress: Endpoint  1 IN                                      C:\fw\picscopefw\x017\usbdescript.c
                                           	0x03,		// bmAttributes: Interrupt endpoint                                      C:\fw\picscopefw\x017\usbdescript.c
                                           	0x0008,		// wMaxPacketSize(LSB):                                                C:\fw\picscopefw\x017\usbdescript.c
                                           	POLLING_INTERVAL,       // bInterval: Polling Interval (40 ms = 0x28)           C:\fw\picscopefw\x017\usbdescript.c
                                           };                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //2/8/05 JD language selection I think..                                         C:\fw\picscopefw\x017\usbdescript.c
                                           rom struct{byte bLength;byte bDscType;word string[1];}sd000={                    C:\fw\picscopefw\x017\usbdescript.c
                                           sizeof(sd000),DSC_STR,0x0409};                                                   C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //Manufacturer string                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           rom struct{byte bLength;byte bDscType;word string[11];}MfrString={               C:\fw\picscopefw\x017\usbdescript.c
                                           sizeof(MfrString),DSC_STR,                                                       C:\fw\picscopefw\x017\usbdescript.c
                                           'J','o','e'};                                                                    C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //Device Chemistry String                                                        C:\fw\picscopefw\x017\usbdescript.c
                                           rom struct{byte bLength;byte bDscType;word string[4];}DevChem={                  C:\fw\picscopefw\x017\usbdescript.c
                                           sizeof(DevChem),DSC_STR,                                                         C:\fw\picscopefw\x017\usbdescript.c
                                           'P','b','A','C'};                                                                C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //Product String                                                                 C:\fw\picscopefw\x017\usbdescript.c
                                           struct{byte bLength;byte bDscType;word string[21];}PrdString={                   C:\fw\picscopefw\x017\usbdescript.c
                                           sizeof(PrdString),DSC_STR,                                                       C:\fw\picscopefw\x017\usbdescript.c
                                           'J','o','e',0x2019,'s',' ','S','c','o','p','e',' '};                             C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //Serial Number                                                                  C:\fw\picscopefw\x017\usbdescript.c
                                           struct{byte bLength;byte bDscType;word string[16];}SerialNum={                   C:\fw\picscopefw\x017\usbdescript.c
                                           sizeof(SerialNum),DSC_STR,                                                       C:\fw\picscopefw\x017\usbdescript.c
                                           '6','9','1','2','0','6','0','A',' '};                                            C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           /*                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                           	0x06,  0x00, 0xff          // USAGE_PAGE (Vendor Defined Page 1)                C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           	0x09,  0x01               // USAGE (Vendor Usage 1)                             C:\fw\picscopefw\x017\usbdescript.c
                                           	0xa1,  0x01               // COLLECTION (Application)                           C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           	0x85,  RID_RECEIVE       // REPORT_ID (1)  - streaming UART rx data             C:\fw\picscopefw\x017\usbdescript.c
                                           	0x09,  0x01                // USAGE (Vendor Usage 1)                            C:\fw\picscopefw\x017\usbdescript.c
                                           	0x15,  0x00                // LOGICAL_MINIMUM (0)                               C:\fw\picscopefw\x017\usbdescript.c
                                           	0x26,  0xff, 0x00           // LOGICAL_MAXIMUM (255)                            C:\fw\picscopefw\x017\usbdescript.c
                                           	0x75,  0x08                // REPORT_SIZE (8) = bits                            C:\fw\picscopefw\x017\usbdescript.c
                                           	0x95,  EP1_REPORT_LENGTH // REPORT_COUNT (7) = 1 report id byte + 7 data bytes  C:\fw\picscopefw\x017\usbdescript.c
                                           	0x81,  0x06                // INPUT (Data,Var,Rel)                              C:\fw\picscopefw\x017\usbdescript.c
                                           	0x09,  0x01                // USAGE (Vendor Usage 1)                            C:\fw\picscopefw\x017\usbdescript.c
                                           	0xb1,  0x06                // FEATURE (Data,Var,Rel)                            C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           	0x85,  RID_COMMAND       // REPORT_ID (3) Command (setreport)                   C:\fw\picscopefw\x017\usbdescript.c
                                           	0x09,  0x01               // USAGE (Vendor Usage 1)                             C:\fw\picscopefw\x017\usbdescript.c
                                           	0x15,  0x00               // LOGICAL_MINIMUM (0)                                C:\fw\picscopefw\x017\usbdescript.c
                                           	0x26,  0x08, 0x00           // LOGICAL_MAXIMUM (255)                            C:\fw\picscopefw\x017\usbdescript.c
                                           	0x75,  0x08               // REPORT_SIZE (8) bits                               C:\fw\picscopefw\x017\usbdescript.c
                                           	0x95,  0x01               // REPORT_COUNT (1) byte                              C:\fw\picscopefw\x017\usbdescript.c
                                           	0x09,  0x01               // USAGE (Vendor Usage 1)                             C:\fw\picscopefw\x017\usbdescript.c
                                           	0xb1,  0x06               // FEATURE (Data,Var,Rel)                             C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           	0x85,  RID_TRANSMIT      // REPORT_ID (2) serial transmit these bytes (SetReport) C:\fw\picscopefw\x017\usbdescript.c
                                           	0x09,  0x03               // USAGE (Vendor Usage 1)                             C:\fw\picscopefw\x017\usbdescript.c
                                           	0x96,  0x07, 0x00          // REPORT_COUNT (7) 1 count byte, 6 data             C:\fw\picscopefw\x017\usbdescript.c
                                           	0xb1,  0x06               // FEATURE (Data,Var,Rel)                             C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           	0xc0                     // END_COLLECTION                                      C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           */                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //the reason for this structure is so that sizeof() returns a value.             C:\fw\picscopefw\x017\usbdescript.c
                                           rom struct{byte report[HID_RPT_UPS_SIZE];}hid_rpt_UPS={                          C:\fw\picscopefw\x017\usbdescript.c
                                           //Production test information                                                    C:\fw\picscopefw\x017\usbdescript.c
                                               0x06, 0xff, 0xff,              //     USAGE_PAGE (Vendor Defined Page 0xffff) C:\fw\picscopefw\x017\usbdescript.c
                                           	0x09,  0x01,               		// USAGE (Vendor Usage 1)                          C:\fw\picscopefw\x017\usbdescript.c
                                           	0xa1,  0x01,              	  // COLLECTION (Application)                        C:\fw\picscopefw\x017\usbdescript.c
                                               0x75, 0x08,                    //       REPORT_SIZE (8)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x95, 0x01,                    //       REPORT_COUNT (1)                     C:\fw\picscopefw\x017\usbdescript.c
                                               0x26, 0xff, 0x00,              //       LOGICAL_MAXIMUM (255)                C:\fw\picscopefw\x017\usbdescript.c
                                               0x15, 0x00,                    //       LOGICAL_MINIMUM (0)                  C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //NVR Operations                                                                 C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0x96,                    //       REPORT_ID (150)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xC0,                    //       USAGE (***NVR Read/Write Data)       C:\fw\picscopefw\x017\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                               0x75, 0x20,                    //       REPORT_SIZE (32)                     C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0xB4,                    //       REPORT_ID (180)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xD2,                    //       USAGE (***NVR Page Read/Write Data)  C:\fw\picscopefw\x017\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                               0x75, 0x10,                    //       REPORT_SIZE (16)                     C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0x97,                    //       REPORT_ID (151)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xC1,                    //       USAGE (***NVR Address 16bit)         C:\fw\picscopefw\x017\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\picscopefw\x017\usbdescript.c
                                               0x75, 0x08,                    //       REPORT_SIZE (8)                      C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //RAM Operations                                                                 C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0x98,                    //       REPORT_ID (152)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xC2,                    //       USAGE (***RAM Read/Write Data)       C:\fw\picscopefw\x017\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                               0x75, 0x10,                    //       REPORT_SIZE (16)                     C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0x99,                    //       REPORT_ID (153)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xC3,                    //       USAGE (***RAM Address 16bit)         C:\fw\picscopefw\x017\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //ROM Operations                                                                 C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0x9C,                    //       REPORT_ID (156)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xD4,                    //       USAGE (***ROM Read/Write Data)       C:\fw\picscopefw\x017\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                               0x75, 0x10,                    //       REPORT_SIZE (16)                     C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0x9D,                    //       REPORT_ID (157)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xD5,                    //       USAGE (***ROM Address 16bit)         C:\fw\picscopefw\x017\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //Production test protocol #                                                     C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0x9B,                    //       REPORT_ID (155)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xC5,                    //       USAGE (***Production Test Protocol #) C:\fw\picscopefw\x017\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                               0x75, 0x20,                    //       REPORT_SIZE (32)                     C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0xAF,                    //       REPORT_ID (175)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xE9,                    //       USAGE (***Voltage Data)              C:\fw\picscopefw\x017\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0xAF,                    //       REPORT_ID (175)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xE9,                    //       USAGE (***Voltage Data)              C:\fw\picscopefw\x017\usbdescript.c
                                           	0x81, 0xa2,					   //	 	INPUT (Data,Var,Abs, Vol, NPrf)                         C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                               0x76, 0x00, 0x02,              //       REPORT_SIZE (512)                    C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0xB0,                    //       REPORT_ID (176)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xEA,                    //       USAGE (***Voltage Data Bulk)         C:\fw\picscopefw\x017\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //Firmware Partnumber                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           	0x75, 0x20,						//	   REPORT_SIZE (32)                                         C:\fw\picscopefw\x017\usbdescript.c
                                           	0x85, 0xC2,						//	   REPORT_ID (194)                                          C:\fw\picscopefw\x017\usbdescript.c
                                           	0x09, 0xD6,						//	   USAGE (***Firmware Partnumber 32bit)                     C:\fw\picscopefw\x017\usbdescript.c
                                           	0xb1, 0x02,						//	   FEATURE (Data,Var,Abs)                                   C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           //Production test password = 866E1942                                            C:\fw\picscopefw\x017\usbdescript.c
                                               0x85, 0x9A,                    //       REPORT_ID (154)                      C:\fw\picscopefw\x017\usbdescript.c
                                               0x09, 0xC4,                    //       USAGE (***Production test Password - 32bit) C:\fw\picscopefw\x017\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\picscopefw\x017\usbdescript.c
                                               0xc0                          //     END_COLLECTION                          C:\fw\picscopefw\x017\usbdescript.c
                                           };                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                           //** Renaud : end_ReportDescriptor                                               C:\fw\picscopefw\x017\usbdescript.c
                                           	                                                                                C:\fw\picscopefw\x017\usbdescript.c
                                           rom const unsigned char *rom USB_CD_Ptr[]={&cfg01,&cfg01};                       C:\fw\picscopefw\x017\usbdescript.c
                                           rom const unsigned char *rom USB_SD_Ptr[]={&sd000,&MfrString,&PrdString,&SerialNum,&DevChem}; C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           rom pFunc ClassReqHandler[1]=                                                    C:\fw\picscopefw\x017\usbdescript.c
                                           {                                                                                C:\fw\picscopefw\x017\usbdescript.c
                                               &USBCheckHIDRequest                                                          C:\fw\picscopefw\x017\usbdescript.c
                                           };                                                                               C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           #pragma code                                                                     C:\fw\picscopefw\x017\usbdescript.c
                                                                                                                            C:\fw\picscopefw\x017\usbdescript.c
                                           /** EOF usbdsc.c ****************************************************/           C:\fw\picscopefw\x017\usbdescript.c
                                           //############################################################################### C:\fw\picscopefw\x017\rs232.c
                                           //#										       						       		#                                             C:\fw\picscopefw\x017\rs232.c
                                           //#			Author: Joe Dunne											 		#                                           C:\fw\picscopefw\x017\rs232.c
                                           //#			RS232 Communication ROUTINE											#                                    C:\fw\picscopefw\x017\rs232.c
                                           //#			File Name: RXCOMM.ASM												#                                         C:\fw\picscopefw\x017\rs232.c
                                           //#																				#                                                         C:\fw\picscopefw\x017\rs232.c
                                           //#			Updated 2/02/05 by JD												#                                         C:\fw\picscopefw\x017\rs232.c
                                           //#									      	       	       	       	       		#                            C:\fw\picscopefw\x017\rs232.c
                                           //############################################################################### C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           #include	"c_system.h"                                                            C:\fw\picscopefw\x017\rs232.c
                                           #include "typedefs.h"                                                            C:\fw\picscopefw\x017\rs232.c
                                           #include "usb.h"                                                                 C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           #define	FW_REV						0x10                                                         C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           #define	UPS_TYPE					(2|FW_REV)                                                  C:\fw\picscopefw\x017\rs232.c
                                           #define	INVALID_REQUEST				0xff                                                  C:\fw\picscopefw\x017\rs232.c
                                           #define	PRODUCTION_TEST_PROTOCOL	0x0003                                          C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           extern struct{byte bLength;byte bDscType;word string[];}SerialNum;               C:\fw\picscopefw\x017\rs232.c
                                           extern rom struct{byte bLength;byte bDscType;word string[24];}MfrString;         C:\fw\picscopefw\x017\rs232.c
                                           extern rom struct{byte bLength;byte bDscType;word string[10];}DevChem;           C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           void	RemCapCalculation(void);                                                    C:\fw\picscopefw\x017\rs232.c
                                           void	EE_READ(void);                                                              C:\fw\picscopefw\x017\rs232.c
                                           void	D_DIV(void);                                                                C:\fw\picscopefw\x017\rs232.c
                                           void	SQRT_16BIT(void);		//result is stored in RES0.                              C:\fw\picscopefw\x017\rs232.c
                                           void	HIDGetReportHandler(void);                                                  C:\fw\picscopefw\x017\rs232.c
                                           unsigned char	READ_SYSTEM_NVR(void);                                             C:\fw\picscopefw\x017\rs232.c
                                           void	EE_PAGE_WRITE(void);                                                        C:\fw\picscopefw\x017\rs232.c
                                           void	BOOT_LOAD_MODE(void);                                                       C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           //--------------------------------------------------------------                 C:\fw\picscopefw\x017\rs232.c
                                           //						Handle received query                                                    C:\fw\picscopefw\x017\rs232.c
                                           //--------------------------------------------------------------                 C:\fw\picscopefw\x017\rs232.c
000a38   cfd9     MOVFF     0xfd9,0xfe6    void	PROCESS_COMM_REQUEST(void) {                                                C:\fw\picscopefw\x017\rs232.c
000a3a   ffe6                                                                                                               
000a3c   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
000a3e   ffd9                                                                                                               
000a40   0e11     MOVLW     0x11                                                                                            
000a42   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           	unsigned char *RcvPtr;                                                          C:\fw\picscopefw\x017\rs232.c
                                           	unsigned char tempvar1, tempvar0;                                               C:\fw\picscopefw\x017\rs232.c
                                           	far unsigned char *Data;                                                        C:\fw\picscopefw\x017\rs232.c
                                           	BitField ByteToSend;                                                            C:\fw\picscopefw\x017\rs232.c
                                           	TwoBytes tempreg, tempnum0, value;                                              C:\fw\picscopefw\x017\rs232.c
                                           	FourBytes longreg;                                                              C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
000a44   0102     MOVLB     0x2            	ResponseType = 0xFF;		//no response                                             C:\fw\picscopefw\x017\rs232.c
000a46   69c2     SETF      0xc2,0x1                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
000a48   0102     MOVLB     0x2            	if (!USBQuery) {                                                                C:\fw\picscopefw\x017\rs232.c
000a4a   b9c3     BTFSC     0xc3,0x4,0x1                                                                                    
000a4c   d011     BRA       0xa70                                                                                           
                                           		//RS232 query                                                                  C:\fw\picscopefw\x017\rs232.c
000a4e   91c3     BCF       0xc3,0x0,0x1   		ProcessCommRequest = false;                                                    C:\fw\picscopefw\x017\rs232.c
                                           		//Prevent any communication in progress from being messed up.                  C:\fw\picscopefw\x017\rs232.c
000a50   0102     MOVLB     0x2            		if (TxBufPtr != 0) return;                                                     C:\fw\picscopefw\x017\rs232.c
000a52   51bb     MOVF      0xbb,0x0,0x1                                                                                    
000a54   e002     BZ        0xa5a                                                                                           
000a56   ef14     GOTO      0x1228                                                                                          
000a58   f009                                                                                                               
000a5a   0102     MOVLB     0x2            		SendingOutString = false;                                                      C:\fw\picscopefw\x017\rs232.c
000a5c   95c3     BCF       0xc3,0x2,0x1                                                                                    
000a5e   97c3     BCF       0xc3,0x3,0x1   		StringInEEPROM = false;                                                        C:\fw\picscopefw\x017\rs232.c
000a60   0102     MOVLB     0x2            		TxBufPtr = 4;			//the header will be written later.                            C:\fw\picscopefw\x017\rs232.c
000a62   0e04     MOVLW     0x4                                                                                             
000a64   6fbb     MOVWF     0xbb,0x1                                                                                        
000a66   0ed7     MOVLW     0xd7           		RcvPtr = (unsigned char *)&RxBuffer[4];                                        C:\fw\picscopefw\x017\rs232.c
000a68   6ede     MOVWF     0xde,0x0                                                                                        
000a6a   0e02     MOVLW     0x2                                                                                             
000a6c   6edd     MOVWF     0xdd,0x0                                                                                        
                                           	}                                                                               C:\fw\picscopefw\x017\rs232.c
000a6e   d007     BRA       0xa7e          	else {                                                                          C:\fw\picscopefw\x017\rs232.c
                                           		//USB query                                                                    C:\fw\picscopefw\x017\rs232.c
000a70   0102     MOVLB     0x2            		USBDataPointer = 1;		//the 0th byte is the reportid                            C:\fw\picscopefw\x017\rs232.c
000a72   0e01     MOVLW     0x1                                                                                             
000a74   6fc4     MOVWF     0xc4,0x1                                                                                        
000a76   0ecc     MOVLW     0xcc           		RcvPtr = (unsigned char *)&USBEP0DataInBuffer[1];                              C:\fw\picscopefw\x017\rs232.c
000a78   6ede     MOVWF     0xde,0x0                                                                                        
000a7a   0e02     MOVLW     0x2                                                                                             
000a7c   6edd     MOVWF     0xdd,0x0                                                                                        
                                           	}                                                                               C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           //Polling command:                                                               C:\fw\picscopefw\x017\rs232.c
000a7e   0102     MOVLB     0x2            	if (!USBQuery && RxBuffer[1] == 0x03 || \                                       C:\fw\picscopefw\x017\rs232.c
000a80   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000a82   0b10     ANDLW     0x10                                                                                            
000a84   e104     BNZ       0xa8e                                                                                           
000a86   0e03     MOVLW     0x3                                                                                             
000a88   0102     MOVLB     0x2                                                                                             
000a8a   5dd4     SUBWF     0xd4,0x0,0x1                                                                                    
000a8c   e009     BZ        0xaa0                                                                                           
000a8e   0102     MOVLB     0x2                                                                                             
000a90   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000a92   0b10     ANDLW     0x10                                                                                            
000a94   e101     BNZ       0xa98                                                                                           
000a96   d205     BRA       0xea2                                                                                           
000a98   0104     MOVLB     0x4                                                                                             
000a9a   0511     DECF      0x11,0x0,0x1                                                                                    
000a9c   e001     BZ        0xaa0                                                                                           
000a9e   d201     BRA       0xea2                                                                                           
                                           		USBQuery && SetupPkt.bRequest == GET_REPORT) {                                 C:\fw\picscopefw\x017\rs232.c
000aa0   0102     MOVLB     0x2            		switch ((USBQuery?SetupPkt._byte[2]:RxBuffer[3])) {                            C:\fw\picscopefw\x017\rs232.c
000aa2   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000aa4   0b10     ANDLW     0x10                                                                                            
000aa6   e003     BZ        0xaae                                                                                           
000aa8   0104     MOVLB     0x4                                                                                             
000aaa   5112     MOVF      0x12,0x0,0x1                                                                                    
000aac   d002     BRA       0xab2                                                                                           
000aae   0102     MOVLB     0x2                                                                                             
000ab0   51d6     MOVF      0xd6,0x0,0x1                                                                                    
000ab2   0ab4     XORLW     0xb4                                                                                            
000ab4   e101     BNZ       0xab8                                                                                           
000ab6   d1dc     BRA       0xe70                                                                                           
000ab8   0a04     XORLW     0x4                                                                                             
000aba   e101     BNZ       0xabe                                                                                           
000abc   d196     BRA       0xdea                                                                                           
000abe   0a1f     XORLW     0x1f                                                                                            
000ac0   e101     BNZ       0xac4                                                                                           
000ac2   d15b     BRA       0xd7a                                                                                           
000ac4   0a34     XORLW     0x34                                                                                            
000ac6   e101     BNZ       0xaca                                                                                           
000ac8   d14d     BRA       0xd64                                                                                           
000aca   0a06     XORLW     0x6                                                                                             
000acc   e101     BNZ       0xad0                                                                                           
000ace   d134     BRA       0xd38                                                                                           
000ad0   0a01     XORLW     0x1                                                                                             
000ad2   e101     BNZ       0xad6                                                                                           
000ad4   d11d     BRA       0xd10                                                                                           
000ad6   0a05     XORLW     0x5                                                                                             
000ad8   e101     BNZ       0xadc                                                                                           
000ada   d104     BRA       0xce4                                                                                           
000adc   0a01     XORLW     0x1                                                                                             
000ade   e101     BNZ       0xae2                                                                                           
000ae0   d0e6     BRA       0xcae                                                                                           
000ae2   0a0f     XORLW     0xf                                                                                             
000ae4   e101     BNZ       0xae8                                                                                           
000ae6   d0cd     BRA       0xc82                                                                                           
000ae8   0a01     XORLW     0x1                                                                                             
000aea   e101     BNZ       0xaee                                                                                           
000aec   d0bf     BRA       0xc6c                                                                                           
000aee   0abc     XORLW     0xbc                                                                                            
000af0   e101     BNZ       0xaf4                                                                                           
000af2   d08e     BRA       0xc10                                                                                           
000af4   0a48     XORLW     0x48                                                                                            
000af6   e05d     BZ        0xbb2                                                                                           
000af8   0a49     XORLW     0x49                                                                                            
000afa   e05b     BZ        0xbb2                                                                                           
000afc   0a02     XORLW     0x2                                                                                             
000afe   e02a     BZ        0xb54                                                                                           
000b00   0a24     XORLW     0x24                                                                                            
000b02   e005     BZ        0xb0e                                                                                           
000b04   0a03     XORLW     0x3                                                                                             
000b06   e003     BZ        0xb0e                                                                                           
000b08   0a26     XORLW     0x26                                                                                            
000b0a   e001     BZ        0xb0e                                                                                           
000b0c   d1c9     BRA       0xea0                                                                                           
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           		case 13:                                                                       C:\fw\picscopefw\x017\rs232.c
                                           		case 14:                                                                       C:\fw\picscopefw\x017\rs232.c
                                           		case 40:                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			//iProduct                                                                    C:\fw\picscopefw\x017\rs232.c
000b0e   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000b10   0e05     MOVLW     0x5                                                                                             
000b12   6fc2     MOVWF     0xc2,0x1                                                                                        
000b14   0102     MOVLB     0x2            			TxBuffer[2] = 22;			//number of bytes in response                             C:\fw\picscopefw\x017\rs232.c
000b16   0e16     MOVLW     0x16                                                                                            
000b18   6fde     MOVWF     0xde,0x1                                                                                        
000b1a   0102     MOVLB     0x2            			if (USBQuery) {                                                               C:\fw\picscopefw\x017\rs232.c
000b1c   a9c3     BTFSS     0xc3,0x4,0x1                                                                                    
000b1e   d005     BRA       0xb2a                                                                                           
000b20   0e02     MOVLW     0x2            				TXENQ(INDEX_NAME);                                                           C:\fw\picscopefw\x017\rs232.c
000b22   6ee6     MOVWF     0xe6,0x0                                                                                        
000b24   db87     RCALL     0x1234                                                                                          
000b26   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000b28   d1bc     BRA       0xea2          				break;                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000b2a   0e04     MOVLW     0x4            			TxBufPtr = TxBuffer[2]+4;					//override txbuffer pointer.                    C:\fw\picscopefw\x017\rs232.c
000b2c   0102     MOVLB     0x2                                                                                             
000b2e   25de     ADDWF     0xde,0x0,0x1                                                                                    
000b30   0102     MOVLB     0x2                                                                                             
000b32   6fbb     MOVWF     0xbb,0x1                                                                                        
000b34   0e04     MOVLW     0x4            			StringChksum = RxBuffer[3]+(TxBufPtr-4)+HEADER_CHAR+DATA_RETURNED;            C:\fw\picscopefw\x017\rs232.c
000b36   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
000b38   0102     MOVLB     0x2                                                                                             
000b3a   25d6     ADDWF     0xd6,0x0,0x1                                                                                    
000b3c   0f7e     ADDLW     0x7e                                                                                            
000b3e   0f05     ADDLW     0x5                                                                                             
000b40   0102     MOVLB     0x2                                                                                             
000b42   6fc1     MOVWF     0xc1,0x1                                                                                        
000b44   0102     MOVLB     0x2            			SendingOutString = true;                                                      C:\fw\picscopefw\x017\rs232.c
000b46   85c3     BSF       0xc3,0x2,0x1                                                                                    
000b48   87c3     BSF       0xc3,0x3,0x1   			StringInEEPROM = true;                                                        C:\fw\picscopefw\x017\rs232.c
000b4a   9fc3     BCF       0xc3,0x7,0x1   			StringInRAM = false;                                                          C:\fw\picscopefw\x017\rs232.c
000b4c   0102     MOVLB     0x2            			StringPtr = EE_USB_ID_STRING+2;	//Send out product string.                    C:\fw\picscopefw\x017\rs232.c
000b4e   0e46     MOVLW     0x46                                                                                            
000b50   6fbf     MOVWF     0xbf,0x1                                                                                        
000b52   d1a7     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 41:                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			//iSerialNumber                                                               C:\fw\picscopefw\x017\rs232.c
000b54   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000b56   0e05     MOVLW     0x5                                                                                             
000b58   6fc2     MOVWF     0xc2,0x1                                                                                        
000b5a   0102     MOVLB     0x2            			TxBuffer[2] = 17;			//number of bytes in response                             C:\fw\picscopefw\x017\rs232.c
000b5c   0e11     MOVLW     0x11                                                                                            
000b5e   6fde     MOVWF     0xde,0x1                                                                                        
000b60   0102     MOVLB     0x2            			if (USBQuery) {                                                               C:\fw\picscopefw\x017\rs232.c
000b62   a9c3     BTFSS     0xc3,0x4,0x1                                                                                    
000b64   d005     BRA       0xb70                                                                                           
000b66   0e03     MOVLW     0x3            				TXENQ(INDEX_SERIALNUM);                                                      C:\fw\picscopefw\x017\rs232.c
000b68   6ee6     MOVWF     0xe6,0x0                                                                                        
000b6a   db64     RCALL     0x1234                                                                                          
000b6c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000b6e   d199     BRA       0xea2          				break;                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000b70   0e04     MOVLW     0x4            			TxBufPtr = TxBuffer[2]+4;					//override txbuffer pointer.                    C:\fw\picscopefw\x017\rs232.c
000b72   0102     MOVLB     0x2                                                                                             
000b74   25de     ADDWF     0xde,0x0,0x1                                                                                    
000b76   0102     MOVLB     0x2                                                                                             
000b78   6fbb     MOVWF     0xbb,0x1                                                                                        
000b7a   0e04     MOVLW     0x4            			StringChksum = RxBuffer[3]+(TxBufPtr-4)+HEADER_CHAR+DATA_RETURNED;            C:\fw\picscopefw\x017\rs232.c
000b7c   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
000b7e   0102     MOVLB     0x2                                                                                             
000b80   25d6     ADDWF     0xd6,0x0,0x1                                                                                    
000b82   0f7e     ADDLW     0x7e                                                                                            
000b84   0f05     ADDLW     0x5                                                                                             
000b86   0102     MOVLB     0x2                                                                                             
000b88   6fc1     MOVWF     0xc1,0x1                                                                                        
000b8a   0102     MOVLB     0x2            			SendingOutString = true;                                                      C:\fw\picscopefw\x017\rs232.c
000b8c   85c3     BSF       0xc3,0x2,0x1                                                                                    
000b8e   97c3     BCF       0xc3,0x3,0x1   			StringInEEPROM = false;                                                       C:\fw\picscopefw\x017\rs232.c
000b90   8fc3     BSF       0xc3,0x7,0x1   			StringInRAM = true;                                                           C:\fw\picscopefw\x017\rs232.c
000b92   50d9     MOVF      0xd9,0x0,0x0   			tempreg.s_form = (unsigned short)(&SerialNum)+2;                              C:\fw\picscopefw\x017\rs232.c
000b94   0f07     ADDLW     0x7                                                                                             
000b96   6ee9     MOVWF     0xe9,0x0                                                                                        
000b98   cfda     MOVFF     0xfda,0xfea                                                                                     
000b9a   ffea                                                                                                               
000b9c   0e8e     MOVLW     0x8e                                                                                            
000b9e   6eee     MOVWF     0xee,0x0                                                                                        
000ba0   0e00     MOVLW     0x0                                                                                             
000ba2   6eed     MOVWF     0xed,0x0                                                                                        
000ba4   0e08     MOVLW     0x8            			StringPtr_H = tempreg.b_form.high;                                            C:\fw\picscopefw\x017\rs232.c
000ba6   cfdb     MOVFF     0xfdb,0x2c0                                                                                     
000ba8   f2c0                                                                                                               
000baa   0e07     MOVLW     0x7            			StringPtr = tempreg.b_form.low;	//Send out serial string.                     C:\fw\picscopefw\x017\rs232.c
000bac   cfdb     MOVFF     0xfdb,0x2bf                                                                                     
000bae   f2bf                                                                                                               
000bb0   d178     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 98:	//iOEMInformation                                                     C:\fw\picscopefw\x017\rs232.c
                                           		case 43:	//iManufacturer                                                       C:\fw\picscopefw\x017\rs232.c
000bb2   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000bb4   0e05     MOVLW     0x5                                                                                             
000bb6   6fc2     MOVWF     0xc2,0x1                                                                                        
000bb8   0102     MOVLB     0x2            			TxBuffer[2] = 12;			//number of bytes in response                             C:\fw\picscopefw\x017\rs232.c
000bba   0e0c     MOVLW     0xc                                                                                             
000bbc   6fde     MOVWF     0xde,0x1                                                                                        
000bbe   0102     MOVLB     0x2            			if (USBQuery) {                                                               C:\fw\picscopefw\x017\rs232.c
000bc0   a9c3     BTFSS     0xc3,0x4,0x1                                                                                    
000bc2   d005     BRA       0xbce                                                                                           
000bc4   0e01     MOVLW     0x1            				TXENQ(INDEX_MANUFACTURER);                                                   C:\fw\picscopefw\x017\rs232.c
000bc6   6ee6     MOVWF     0xe6,0x0                                                                                        
000bc8   db35     RCALL     0x1234                                                                                          
000bca   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000bcc   d16a     BRA       0xea2          				break;                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000bce   0e04     MOVLW     0x4            			TxBufPtr = TxBuffer[2]+4;					//override txbuffer pointer.                    C:\fw\picscopefw\x017\rs232.c
000bd0   0102     MOVLB     0x2                                                                                             
000bd2   25de     ADDWF     0xde,0x0,0x1                                                                                    
000bd4   0102     MOVLB     0x2                                                                                             
000bd6   6fbb     MOVWF     0xbb,0x1                                                                                        
000bd8   0e04     MOVLW     0x4            			StringChksum = RxBuffer[3]+(TxBufPtr-4)+HEADER_CHAR+DATA_RETURNED;            C:\fw\picscopefw\x017\rs232.c
000bda   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
000bdc   0102     MOVLB     0x2                                                                                             
000bde   25d6     ADDWF     0xd6,0x0,0x1                                                                                    
000be0   0f7e     ADDLW     0x7e                                                                                            
000be2   0f05     ADDLW     0x5                                                                                             
000be4   0102     MOVLB     0x2                                                                                             
000be6   6fc1     MOVWF     0xc1,0x1                                                                                        
000be8   0102     MOVLB     0x2            			SendingOutString = true;                                                      C:\fw\picscopefw\x017\rs232.c
000bea   85c3     BSF       0xc3,0x2,0x1                                                                                    
000bec   97c3     BCF       0xc3,0x3,0x1   			StringInEEPROM = false;                                                       C:\fw\picscopefw\x017\rs232.c
000bee   9fc3     BCF       0xc3,0x7,0x1   			StringInRAM = false;                                                          C:\fw\picscopefw\x017\rs232.c
000bf0   50d9     MOVF      0xd9,0x0,0x0   			tempreg.s_form = (unsigned short)&MfrString;                                  C:\fw\picscopefw\x017\rs232.c
000bf2   0f07     ADDLW     0x7                                                                                             
000bf4   6ee9     MOVWF     0xe9,0x0                                                                                        
000bf6   cfda     MOVFF     0xfda,0xfea                                                                                     
000bf8   ffea                                                                                                               
000bfa   0e8a     MOVLW     0x8a                                                                                            
000bfc   6eee     MOVWF     0xee,0x0                                                                                        
000bfe   0e1e     MOVLW     0x1e                                                                                            
000c00   6eed     MOVWF     0xed,0x0                                                                                        
000c02   0e08     MOVLW     0x8            			StringPtr_H = tempreg.b_form.high;                                            C:\fw\picscopefw\x017\rs232.c
000c04   cfdb     MOVFF     0xfdb,0x2c0                                                                                     
000c06   f2c0                                                                                                               
000c08   0e07     MOVLW     0x7            			StringPtr = tempreg.b_form.low;	//Send out serial string.                     C:\fw\picscopefw\x017\rs232.c
000c0a   cfdb     MOVFF     0xfdb,0x2bf                                                                                     
000c0c   f2bf                                                                                                               
000c0e   d149     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           		case 42:                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			//iDeviceChemistry                                                            C:\fw\picscopefw\x017\rs232.c
000c10   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000c12   0e05     MOVLW     0x5                                                                                             
000c14   6fc2     MOVWF     0xc2,0x1                                                                                        
000c16   0102     MOVLB     0x2            			TxBuffer[2] = 5;			//number of bytes in response                              C:\fw\picscopefw\x017\rs232.c
000c18   6fde     MOVWF     0xde,0x1                                                                                        
000c1a   0102     MOVLB     0x2            			if (USBQuery) {                                                               C:\fw\picscopefw\x017\rs232.c
000c1c   a9c3     BTFSS     0xc3,0x4,0x1                                                                                    
000c1e   d005     BRA       0xc2a                                                                                           
000c20   0e04     MOVLW     0x4            				TXENQ(INDEX_DEVCHEM);                                                        C:\fw\picscopefw\x017\rs232.c
000c22   6ee6     MOVWF     0xe6,0x0                                                                                        
000c24   db07     RCALL     0x1234                                                                                          
000c26   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000c28   d13c     BRA       0xea2          				break;                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			}			                                                                          C:\fw\picscopefw\x017\rs232.c
000c2a   0e04     MOVLW     0x4            			TxBufPtr = TxBuffer[2]+4;					//override txbuffer pointer.                    C:\fw\picscopefw\x017\rs232.c
000c2c   0102     MOVLB     0x2                                                                                             
000c2e   25de     ADDWF     0xde,0x0,0x1                                                                                    
000c30   0102     MOVLB     0x2                                                                                             
000c32   6fbb     MOVWF     0xbb,0x1                                                                                        
000c34   0e04     MOVLW     0x4            			StringChksum = RxBuffer[3]+(TxBufPtr-4)+HEADER_CHAR+DATA_RETURNED;            C:\fw\picscopefw\x017\rs232.c
000c36   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
000c38   0102     MOVLB     0x2                                                                                             
000c3a   25d6     ADDWF     0xd6,0x0,0x1                                                                                    
000c3c   0f7e     ADDLW     0x7e                                                                                            
000c3e   0f05     ADDLW     0x5                                                                                             
000c40   0102     MOVLB     0x2                                                                                             
000c42   6fc1     MOVWF     0xc1,0x1                                                                                        
000c44   0102     MOVLB     0x2            			SendingOutString = true;                                                      C:\fw\picscopefw\x017\rs232.c
000c46   85c3     BSF       0xc3,0x2,0x1                                                                                    
000c48   97c3     BCF       0xc3,0x3,0x1   			StringInEEPROM = false;                                                       C:\fw\picscopefw\x017\rs232.c
000c4a   9fc3     BCF       0xc3,0x7,0x1   			StringInRAM = false;                                                          C:\fw\picscopefw\x017\rs232.c
000c4c   50d9     MOVF      0xd9,0x0,0x0   			tempreg.s_form = (unsigned short)(&DevChem)+2;                                C:\fw\picscopefw\x017\rs232.c
000c4e   0f07     ADDLW     0x7                                                                                             
000c50   6ee9     MOVWF     0xe9,0x0                                                                                        
000c52   cfda     MOVFF     0xfda,0xfea                                                                                     
000c54   ffea                                                                                                               
000c56   0ea4     MOVLW     0xa4                                                                                            
000c58   6eee     MOVWF     0xee,0x0                                                                                        
000c5a   0e1e     MOVLW     0x1e                                                                                            
000c5c   6eed     MOVWF     0xed,0x0                                                                                        
000c5e   0e08     MOVLW     0x8            			StringPtr_H = tempreg.b_form.high;	//(backwards for some crazy reason)        C:\fw\picscopefw\x017\rs232.c
000c60   cfdb     MOVFF     0xfdb,0x2c0                                                                                     
000c62   f2c0                                                                                                               
000c64   0e07     MOVLW     0x7            			StringPtr = tempreg.b_form.low;	//Send out serial string.                     C:\fw\picscopefw\x017\rs232.c
000c66   cfdb     MOVFF     0xfdb,0x2bf                                                                                     
000c68   f2bf                                                                                                               
000c6a   d11b     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           //production test commands:			                                                   C:\fw\picscopefw\x017\rs232.c
                                           		case 150:		//NVR Read                                                          C:\fw\picscopefw\x017\rs232.c
000c6c   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000c6e   0e05     MOVLW     0x5                                                                                             
000c70   6fc2     MOVWF     0xc2,0x1                                                                                        
000c72   a8a0     BTFSS     0xa0,0x4,0x0   			if (1 && !PIE2bits.EEIE) {                                                    C:\fw\picscopefw\x017\rs232.c
                                           //				EEAddress = NVRCommAddr.b_form.low;                                        C:\fw\picscopefw\x017\rs232.c
                                           //				DISABLE_ALL_INTERRUPTS();                                                  C:\fw\picscopefw\x017\rs232.c
                                           //				Temp6 = READ_SYSTEM_NVR();		//returns data through wreg                    C:\fw\picscopefw\x017\rs232.c
                                           //				ENABLE_ALL_INTERRUPTS();                                                   C:\fw\picscopefw\x017\rs232.c
                                           //				TXENQ(Temp6);                                                              C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000c74   d005     BRA       0xc80          			else {                                                                        C:\fw\picscopefw\x017\rs232.c
000c76   0e01     MOVLW     0x1            				ResponseType = COMMAND_REJECTED;                                             C:\fw\picscopefw\x017\rs232.c
000c78   6fc2     MOVWF     0xc2,0x1                                                                                        
000c7a   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\picscopefw\x017\rs232.c
000c7c   dadb     RCALL     0x1234                                                                                          
000c7e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000c80   d110     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           			                                                                              C:\fw\picscopefw\x017\rs232.c
                                           		case 151:		//NVR Address                                                       C:\fw\picscopefw\x017\rs232.c
000c82   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000c84   0e05     MOVLW     0x5                                                                                             
000c86   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\picscopefw\x017\rs232.c
000c88   c2c5     MOVFF     0x2c5,0xfe6    				TXENQ(NVRCommAddr.b_form.low);		//low byte                                   C:\fw\picscopefw\x017\rs232.c
000c8a   ffe6                                                                                                               
000c8c   dad3     RCALL     0x1234                                                                                          
000c8e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000c90   c2c6     MOVFF     0x2c6,0xfe6    				TXENQ(NVRCommAddr.b_form.high);		//high byte                                 C:\fw\picscopefw\x017\rs232.c
000c92   ffe6                                                                                                               
000c94   dacf     RCALL     0x1234                                                                                          
000c96   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000c98   d009     BRA       0xcac          			else {                                                                        C:\fw\picscopefw\x017\rs232.c
000c9a   0102     MOVLB     0x2            				ResponseType = COMMAND_REJECTED;                                             C:\fw\picscopefw\x017\rs232.c
000c9c   0e01     MOVLW     0x1                                                                                             
000c9e   6fc2     MOVWF     0xc2,0x1                                                                                        
000ca0   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);		//low byte                                          C:\fw\picscopefw\x017\rs232.c
000ca2   dac8     RCALL     0x1234                                                                                          
000ca4   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000ca6   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);		//high byte                                         C:\fw\picscopefw\x017\rs232.c
000ca8   dac5     RCALL     0x1234                                                                                          
000caa   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000cac   d0fa     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 152:		//RAM Read                                                          C:\fw\picscopefw\x017\rs232.c
000cae   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000cb0   0e05     MOVLW     0x5                                                                                             
000cb2   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\picscopefw\x017\rs232.c
000cb4   0e04     MOVLW     0x4            				Data = (far unsigned char *)RAMCommAddr.s_form;                              C:\fw\picscopefw\x017\rs232.c
000cb6   c2c7     MOVFF     0x2c7,0xfdb                                                                                     
000cb8   ffdb                                                                                                               
000cba   0e05     MOVLW     0x5                                                                                             
000cbc   c2c8     MOVFF     0x2c8,0xfdb                                                                                     
000cbe   ffdb                                                                                                               
000cc0   0e04     MOVLW     0x4            				TXENQ(*Data);                                                                C:\fw\picscopefw\x017\rs232.c
000cc2   cfdb     MOVFF     0xfdb,0xfe9                                                                                     
000cc4   ffe9                                                                                                               
000cc6   0e05     MOVLW     0x5                                                                                             
000cc8   cfdb     MOVFF     0xfdb,0xfea                                                                                     
000cca   ffea                                                                                                               
000ccc   50ef     MOVF      0xef,0x0,0x0                                                                                    
000cce   6ee6     MOVWF     0xe6,0x0                                                                                        
000cd0   dab1     RCALL     0x1234                                                                                          
000cd2   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000cd4   d006     BRA       0xce2          			else {                                                                        C:\fw\picscopefw\x017\rs232.c
000cd6   0102     MOVLB     0x2            				ResponseType = COMMAND_REJECTED;                                             C:\fw\picscopefw\x017\rs232.c
000cd8   0e01     MOVLW     0x1                                                                                             
000cda   6fc2     MOVWF     0xc2,0x1                                                                                        
000cdc   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\picscopefw\x017\rs232.c
000cde   daaa     RCALL     0x1234                                                                                          
000ce0   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000ce2   d0df     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           	                                                                                C:\fw\picscopefw\x017\rs232.c
                                           		case 153:		//RAM Address                                                       C:\fw\picscopefw\x017\rs232.c
000ce4   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000ce6   0e05     MOVLW     0x5                                                                                             
000ce8   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\picscopefw\x017\rs232.c
000cea   c2c7     MOVFF     0x2c7,0xfe6    				TXENQ(RAMCommAddr.b_form.low);		//low byte                                   C:\fw\picscopefw\x017\rs232.c
000cec   ffe6                                                                                                               
000cee   daa2     RCALL     0x1234                                                                                          
000cf0   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000cf2   c2c8     MOVFF     0x2c8,0xfe6    				TXENQ(RAMCommAddr.b_form.high);		//high byte                                 C:\fw\picscopefw\x017\rs232.c
000cf4   ffe6                                                                                                               
000cf6   da9e     RCALL     0x1234                                                                                          
000cf8   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000cfa   d009     BRA       0xd0e          			else {                                                                        C:\fw\picscopefw\x017\rs232.c
000cfc   0102     MOVLB     0x2            				ResponseType = COMMAND_REJECTED;                                             C:\fw\picscopefw\x017\rs232.c
000cfe   0e01     MOVLW     0x1                                                                                             
000d00   6fc2     MOVWF     0xc2,0x1                                                                                        
000d02   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\picscopefw\x017\rs232.c
000d04   da97     RCALL     0x1234                                                                                          
000d06   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000d08   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\picscopefw\x017\rs232.c
000d0a   da94     RCALL     0x1234                                                                                          
000d0c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000d0e   d0c9     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           	                                                                                C:\fw\picscopefw\x017\rs232.c
                                           		case 156:		//ROM Read                                                          C:\fw\picscopefw\x017\rs232.c
000d10   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000d12   0e05     MOVLW     0x5                                                                                             
000d14   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\picscopefw\x017\rs232.c
000d16   c2c9     MOVFF     0x2c9,0xff6    				TXENQ(*(near unsigned char rom *)ROMCommAddr.s_form);                        C:\fw\picscopefw\x017\rs232.c
000d18   fff6                                                                                                               
000d1a   c2ca     MOVFF     0x2ca,0xff7                                                                                     
000d1c   fff7                                                                                                               
000d1e   0008     TBLRD                                                                                                     
000d20   50f5     MOVF      0xf5,0x0,0x0                                                                                    
000d22   6ee6     MOVWF     0xe6,0x0                                                                                        
000d24   da87     RCALL     0x1234                                                                                          
000d26   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000d28   d006     BRA       0xd36          			else {                                                                        C:\fw\picscopefw\x017\rs232.c
000d2a   0102     MOVLB     0x2            				ResponseType = COMMAND_REJECTED;                                             C:\fw\picscopefw\x017\rs232.c
000d2c   0e01     MOVLW     0x1                                                                                             
000d2e   6fc2     MOVWF     0xc2,0x1                                                                                        
000d30   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\picscopefw\x017\rs232.c
000d32   da80     RCALL     0x1234                                                                                          
000d34   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000d36   d0b5     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           	                                                                                C:\fw\picscopefw\x017\rs232.c
                                           		case 157:		//ROM Address                                                       C:\fw\picscopefw\x017\rs232.c
000d38   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000d3a   0e05     MOVLW     0x5                                                                                             
000d3c   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\picscopefw\x017\rs232.c
000d3e   c2c9     MOVFF     0x2c9,0xfe6    				TXENQ(ROMCommAddr.b_form.low);		//low byte                                   C:\fw\picscopefw\x017\rs232.c
000d40   ffe6                                                                                                               
000d42   da78     RCALL     0x1234                                                                                          
000d44   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000d46   c2ca     MOVFF     0x2ca,0xfe6    				TXENQ(ROMCommAddr.b_form.high);		//high byte                                 C:\fw\picscopefw\x017\rs232.c
000d48   ffe6                                                                                                               
000d4a   da74     RCALL     0x1234                                                                                          
000d4c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000d4e   d009     BRA       0xd62          			else {                                                                        C:\fw\picscopefw\x017\rs232.c
000d50   0102     MOVLB     0x2            				ResponseType = COMMAND_REJECTED;                                             C:\fw\picscopefw\x017\rs232.c
000d52   0e01     MOVLW     0x1                                                                                             
000d54   6fc2     MOVWF     0xc2,0x1                                                                                        
000d56   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\picscopefw\x017\rs232.c
000d58   da6d     RCALL     0x1234                                                                                          
000d5a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000d5c   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\picscopefw\x017\rs232.c
000d5e   da6a     RCALL     0x1234                                                                                          
000d60   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000d62   d09f     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           		case 155:		//production test protocol                                          C:\fw\picscopefw\x017\rs232.c
000d64   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000d66   0e05     MOVLW     0x5                                                                                             
000d68   6fc2     MOVWF     0xc2,0x1                                                                                        
000d6a   0e03     MOVLW     0x3            			TXENQ(PRODUCTION_TEST_PROTOCOL&255);                                          C:\fw\picscopefw\x017\rs232.c
000d6c   6ee6     MOVWF     0xe6,0x0                                                                                        
000d6e   da62     RCALL     0x1234                                                                                          
000d70   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			//TXENQ(PRODUCTION_TEST_PROTOCOL/256);                                        C:\fw\picscopefw\x017\rs232.c
000d72   6ae6     CLRF      0xe6,0x0       			TXENQ(PRODUCTION_TEST_PROTOCOL>>8);                                           C:\fw\picscopefw\x017\rs232.c
000d74   da5f     RCALL     0x1234                                                                                          
000d76   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000d78   d094     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           	                                                                                C:\fw\picscopefw\x017\rs232.c
                                           		case 175:		//voltage data                                                      C:\fw\picscopefw\x017\rs232.c
000d7a   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000d7c   0e05     MOVLW     0x5                                                                                             
000d7e   6fc2     MOVWF     0xc2,0x1                                                                                        
000d80   c0ee     MOVFF     0xee,0xfe6     			TXENQ(InputDataPointer);                                                      C:\fw\picscopefw\x017\rs232.c
000d82   ffe6                                                                                                               
000d84   da57     RCALL     0x1234                                                                                          
000d86   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000d88   0100     MOVLB     0x0            			TXENQ(DataBuffer[InputDataPointer].b_form.low);                               C:\fw\picscopefw\x017\rs232.c
000d8a   51ee     MOVF      0xee,0x0,0x1                                                                                    
000d8c   6ee9     MOVWF     0xe9,0x0                                                                                        
000d8e   6aea     CLRF      0xea,0x0                                                                                        
000d90   90d8     BCF       0xd8,0x0,0x0                                                                                    
000d92   36e9     RLCF      0xe9,0x1,0x0                                                                                    
000d94   36ea     RLCF      0xea,0x1,0x0                                                                                    
000d96   0e03     MOVLW     0x3                                                                                             
000d98   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000d9a   0e01     MOVLW     0x1                                                                                             
000d9c   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000d9e   50ef     MOVF      0xef,0x0,0x0                                                                                    
000da0   6ee6     MOVWF     0xe6,0x0                                                                                        
000da2   da48     RCALL     0x1234                                                                                          
000da4   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000da6   0100     MOVLB     0x0            			TXENQ(DataBuffer[InputDataPointer].b_form.high);                              C:\fw\picscopefw\x017\rs232.c
000da8   51ee     MOVF      0xee,0x0,0x1                                                                                    
000daa   6ee9     MOVWF     0xe9,0x0                                                                                        
000dac   6aea     CLRF      0xea,0x0                                                                                        
000dae   90d8     BCF       0xd8,0x0,0x0                                                                                    
000db0   36e9     RLCF      0xe9,0x1,0x0                                                                                    
000db2   36ea     RLCF      0xea,0x1,0x0                                                                                    
000db4   0e03     MOVLW     0x3                                                                                             
000db6   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000db8   0e01     MOVLW     0x1                                                                                             
000dba   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000dbc   52ee     MOVF      0xee,0x1,0x0                                                                                    
000dbe   50ef     MOVF      0xef,0x0,0x0                                                                                    
000dc0   6ee6     MOVWF     0xe6,0x0                                                                                        
000dc2   da38     RCALL     0x1234                                                                                          
000dc4   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000dc6   6ae6     CLRF      0xe6,0x0       			TXENQ(0);                                                                     C:\fw\picscopefw\x017\rs232.c
000dc8   da35     RCALL     0x1234                                                                                          
000dca   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
000dcc   0100     MOVLB     0x0            			InputDataPointer++;                                                           C:\fw\picscopefw\x017\rs232.c
000dce   2bee     INCF      0xee,0x1,0x1                                                                                    
000dd0   51ee     MOVF      0xee,0x0,0x1   			if (InputDataPointer >= 200) InputDataPointer = 255;                          C:\fw\picscopefw\x017\rs232.c
000dd2   6e02     MOVWF     0x2,0x0                                                                                         
000dd4   6a03     CLRF      0x3,0x0                                                                                         
000dd6   90d8     BCF       0xd8,0x0,0x0                                                                                    
000dd8   5003     MOVF      0x3,0x0,0x0                                                                                     
000dda   e604     BN        0xde4                                                                                           
000ddc   0ec8     MOVLW     0xc8                                                                                            
000dde   5c02     SUBWF     0x2,0x0,0x0                                                                                     
000de0   0e00     MOVLW     0x0                                                                                             
000de2   5803     SUBWFB    0x3,0x0,0x0                                                                                     
000de4   e301     BNC       0xde8                                                                                           
000de6   69ee     SETF      0xee,0x1                                                                                        
000de8   d05c     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           		case 176:		//voltage data bulk                                                 C:\fw\picscopefw\x017\rs232.c
000dea   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000dec   0e05     MOVLW     0x5                                                                                             
000dee   6fc2     MOVWF     0xc2,0x1                                                                                        
000df0   c0ee     MOVFF     0xee,0xfe6     			TXENQ(InputDataPointer);                                                      C:\fw\picscopefw\x017\rs232.c
000df2   ffe6                                                                                                               
000df4   da1f     RCALL     0x1234                                                                                          
000df6   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000df8   0e03     MOVLW     0x3            			for (tempvar0 = 0;tempvar0 < 30;tempvar0++) {                                 C:\fw\picscopefw\x017\rs232.c
000dfa   6adb     CLRF      0xdb,0x0                                                                                        
000dfc   0e1e     MOVLW     0x1e                                                                                            
000dfe   6ef3     MOVWF     0xf3,0x0                                                                                        
000e00   0e03     MOVLW     0x3                                                                                             
000e02   cfdb     MOVFF     0xfdb,0xff4                                                                                     
000e04   fff4                                                                                                               
000e06   50f3     MOVF      0xf3,0x0,0x0                                                                                    
000e08   5cf4     SUBWF     0xf4,0x0,0x0                                                                                    
000e0a   e224     BC        0xe54                                                                                           
000e4e   0e03     MOVLW     0x3                                                                                             
000e50   2adb     INCF      0xdb,0x1,0x0                                                                                    
000e52   d7d4     BRA       0xdfc                                                                                           
000e0c   0100     MOVLB     0x0            				TXENQ(DataBuffer[InputDataPointer].b_form.low);                              C:\fw\picscopefw\x017\rs232.c
000e0e   51ee     MOVF      0xee,0x0,0x1                                                                                    
000e10   6ee9     MOVWF     0xe9,0x0                                                                                        
000e12   6aea     CLRF      0xea,0x0                                                                                        
000e14   90d8     BCF       0xd8,0x0,0x0                                                                                    
000e16   36e9     RLCF      0xe9,0x1,0x0                                                                                    
000e18   36ea     RLCF      0xea,0x1,0x0                                                                                    
000e1a   0e03     MOVLW     0x3                                                                                             
000e1c   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000e1e   0e01     MOVLW     0x1                                                                                             
000e20   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000e22   50ef     MOVF      0xef,0x0,0x0                                                                                    
000e24   6ee6     MOVWF     0xe6,0x0                                                                                        
000e26   da06     RCALL     0x1234                                                                                          
000e28   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e2a   0100     MOVLB     0x0            				TXENQ(DataBuffer[InputDataPointer].b_form.high);                             C:\fw\picscopefw\x017\rs232.c
000e2c   51ee     MOVF      0xee,0x0,0x1                                                                                    
000e2e   6ee9     MOVWF     0xe9,0x0                                                                                        
000e30   6aea     CLRF      0xea,0x0                                                                                        
000e32   90d8     BCF       0xd8,0x0,0x0                                                                                    
000e34   36e9     RLCF      0xe9,0x1,0x0                                                                                    
000e36   36ea     RLCF      0xea,0x1,0x0                                                                                    
000e38   0e03     MOVLW     0x3                                                                                             
000e3a   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000e3c   0e01     MOVLW     0x1                                                                                             
000e3e   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000e40   52ee     MOVF      0xee,0x1,0x0                                                                                    
000e42   50ef     MOVF      0xef,0x0,0x0                                                                                    
000e44   6ee6     MOVWF     0xe6,0x0                                                                                        
000e46   d9f6     RCALL     0x1234                                                                                          
000e48   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e4a   0100     MOVLB     0x0            				InputDataPointer++;                                                          C:\fw\picscopefw\x017\rs232.c
000e4c   2bee     INCF      0xee,0x1,0x1                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000e54   0100     MOVLB     0x0            			if (InputDataPointer >= 200) InputDataPointer = 255;                          C:\fw\picscopefw\x017\rs232.c
000e56   51ee     MOVF      0xee,0x0,0x1                                                                                    
000e58   6e02     MOVWF     0x2,0x0                                                                                         
000e5a   6a03     CLRF      0x3,0x0                                                                                         
000e5c   90d8     BCF       0xd8,0x0,0x0                                                                                    
000e5e   5003     MOVF      0x3,0x0,0x0                                                                                     
000e60   e604     BN        0xe6a                                                                                           
000e62   0ec8     MOVLW     0xc8                                                                                            
000e64   5c02     SUBWF     0x2,0x0,0x0                                                                                     
000e66   0e00     MOVLW     0x0                                                                                             
000e68   5803     SUBWFB    0x3,0x0,0x0                                                                                     
000e6a   e301     BNC       0xe6e                                                                                           
000e6c   69ee     SETF      0xee,0x1                                                                                        
000e6e   d019     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           		case 180:		//NVR Page Read                                                     C:\fw\picscopefw\x017\rs232.c
000e70   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\picscopefw\x017\rs232.c
000e72   0e05     MOVLW     0x5                                                                                             
000e74   6fc2     MOVWF     0xc2,0x1                                                                                        
000e76   b8a0     BTFSC     0xa0,0x4,0x0   			if (1 && !PIE2bits.EEIE) {                                                    C:\fw\picscopefw\x017\rs232.c
000e78   d004     BRA       0xe82                                                                                           
000e7a   9ef2     BCF       0xf2,0x7,0x0   				DISABLE_ALL_INTERRUPTS();                                                    C:\fw\picscopefw\x017\rs232.c
000e7c   9cf2     BCF       0xf2,0x6,0x0                                                                                    
                                           //				EEAddress = NVRCommAddr.b_form.low;                                        C:\fw\picscopefw\x017\rs232.c
                                           //				Temp6 = READ_SYSTEM_NVR();                                                 C:\fw\picscopefw\x017\rs232.c
                                           //				TXENQ(Temp6);                                                              C:\fw\picscopefw\x017\rs232.c
                                           //				EEAddress++;                                                               C:\fw\picscopefw\x017\rs232.c
                                           //				Temp6 = READ_SYSTEM_NVR();                                                 C:\fw\picscopefw\x017\rs232.c
                                           //				TXENQ(Temp6);                                                              C:\fw\picscopefw\x017\rs232.c
                                           //				EEAddress++;                                                               C:\fw\picscopefw\x017\rs232.c
                                           //				Temp6 = READ_SYSTEM_NVR();                                                 C:\fw\picscopefw\x017\rs232.c
                                           //				TXENQ(Temp6);                                                              C:\fw\picscopefw\x017\rs232.c
                                           //				EEAddress++;                                                               C:\fw\picscopefw\x017\rs232.c
                                           //				Temp6 = READ_SYSTEM_NVR();                                                 C:\fw\picscopefw\x017\rs232.c
                                           //				TXENQ(Temp6);                                                              C:\fw\picscopefw\x017\rs232.c
                                           //				ENABLE_ALL_INTERRUPTS();                                                   C:\fw\picscopefw\x017\rs232.c
000e7e   d011     BRA       0xea2          				break;                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000e80   d00f     BRA       0xea0          			else {                                                                        C:\fw\picscopefw\x017\rs232.c
000e82   0e01     MOVLW     0x1            				ResponseType = COMMAND_REJECTED;                                             C:\fw\picscopefw\x017\rs232.c
000e84   6fc2     MOVWF     0xc2,0x1                                                                                        
000e86   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\picscopefw\x017\rs232.c
000e88   d9d5     RCALL     0x1234                                                                                          
000e8a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e8c   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\picscopefw\x017\rs232.c
000e8e   d9d2     RCALL     0x1234                                                                                          
000e90   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e92   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\picscopefw\x017\rs232.c
000e94   d9cf     RCALL     0x1234                                                                                          
000e96   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e98   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\picscopefw\x017\rs232.c
000e9a   d9cc     RCALL     0x1234                                                                                          
000e9c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e9e   d001     BRA       0xea2          				break;                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			}				                                                                         C:\fw\picscopefw\x017\rs232.c
                                           		default:                                                                       C:\fw\picscopefw\x017\rs232.c
000ea0   d000     BRA       0xea2          			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		}                                                                              C:\fw\picscopefw\x017\rs232.c
                                           	}                                                                               C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           //Set command:                                                                   C:\fw\picscopefw\x017\rs232.c
000ea2   0102     MOVLB     0x2            	if (!USBQuery && RxBuffer[1] == 0x04 || \                                       C:\fw\picscopefw\x017\rs232.c
000ea4   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000ea6   0b10     ANDLW     0x10                                                                                            
000ea8   e104     BNZ       0xeb2                                                                                           
000eaa   0e04     MOVLW     0x4                                                                                             
000eac   0102     MOVLB     0x2                                                                                             
000eae   5dd4     SUBWF     0xd4,0x0,0x1                                                                                    
000eb0   e00a     BZ        0xec6                                                                                           
000eb2   0102     MOVLB     0x2                                                                                             
000eb4   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000eb6   0b10     ANDLW     0x10                                                                                            
000eb8   e101     BNZ       0xebc                                                                                           
000eba   d15f     BRA       0x117a                                                                                          
000ebc   0e09     MOVLW     0x9                                                                                             
000ebe   0104     MOVLB     0x4                                                                                             
000ec0   5d11     SUBWF     0x11,0x0,0x1                                                                                    
000ec2   e001     BZ        0xec6                                                                                           
000ec4   d15a     BRA       0x117a                                                                                          
                                           		USBQuery && SetupPkt.bRequest == SET_REPORT) {                                 C:\fw\picscopefw\x017\rs232.c
000ec6   0102     MOVLB     0x2            		switch ((USBQuery?SetupPkt._byte[2]:RxBuffer[3])) {                            C:\fw\picscopefw\x017\rs232.c
000ec8   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000eca   0b10     ANDLW     0x10                                                                                            
000ecc   e003     BZ        0xed4                                                                                           
000ece   0104     MOVLB     0x4                                                                                             
000ed0   5112     MOVF      0x12,0x0,0x1                                                                                    
000ed2   d002     BRA       0xed8                                                                                           
000ed4   0102     MOVLB     0x2                                                                                             
000ed6   51d6     MOVF      0xd6,0x0,0x1                                                                                    
000ed8   0ab4     XORLW     0xb4                                                                                            
000eda   e101     BNZ       0xede                                                                                           
000edc   d11e     BRA       0x111a                                                                                          
000ede   0a29     XORLW     0x29                                                                                            
000ee0   e101     BNZ       0xee4                                                                                           
000ee2   d0ef     BRA       0x10c2                                                                                          
000ee4   0a01     XORLW     0x1                                                                                             
000ee6   e101     BNZ       0xeea                                                                                           
000ee8   d0e0     BRA       0x10aa                                                                                          
000eea   0a06     XORLW     0x6                                                                                             
000eec   e101     BNZ       0xef0                                                                                           
000eee   d083     BRA       0xff6                                                                                           
000ef0   0a03     XORLW     0x3                                                                                             
000ef2   e059     BZ        0xfa6                                                                                           
000ef4   0a01     XORLW     0x1                                                                                             
000ef6   e041     BZ        0xf7a                                                                                           
000ef8   0a0f     XORLW     0xf                                                                                             
000efa   e013     BZ        0xf22                                                                                           
000efc   0a01     XORLW     0x1                                                                                             
000efe   e001     BZ        0xf02                                                                                           
                                           /*                                                                               C:\fw\picscopefw\x017\rs232.c
                                           		case 17:                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			//AudibleAlarmControl                                                         C:\fw\picscopefw\x017\rs232.c
                                           			if (RcvPtr[0] == 3) {                                                         C:\fw\picscopefw\x017\rs232.c
                                           				MuteBeeper = true;                                                           C:\fw\picscopefw\x017\rs232.c
                                           				ResponseType = COMMAND_ACCEPTED;                                             C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			else ResponseType = COMMAND_REJECTED;                                         C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 16:		//Test                                                               C:\fw\picscopefw\x017\rs232.c
                                           			if (MASTER_RELAY_LAT_BIT && LineValid) {	//check if Master receptacles off or Line invalid? C:\fw\picscopefw\x017\rs232.c
                                           				if (RcvPtr[0] == 1) {                                                        C:\fw\picscopefw\x017\rs232.c
                                           					RequestSelfTest = true;                                                     C:\fw\picscopefw\x017\rs232.c
                                           					ResponseType = COMMAND_ACCEPTED;                                            C:\fw\picscopefw\x017\rs232.c
                                           				}                                                                            C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			else ResponseType = COMMAND_REJECTED;                                         C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 21:		//DelayBeforeShutdown                                                C:\fw\picscopefw\x017\rs232.c
                                           			if (ContactClosureShutdownLatch || SelfTestMode) {                            C:\fw\picscopefw\x017\rs232.c
                                           				ResponseType = COMMAND_REJECTED;                                             C:\fw\picscopefw\x017\rs232.c
                                           				TXENQ(RcvPtr[0]);			//data                                                   C:\fw\picscopefw\x017\rs232.c
                                           				TXENQ(RcvPtr[1]);			//data                                                   C:\fw\picscopefw\x017\rs232.c
                                           				break;                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			else ResponseType = COMMAND_ACCEPTED;                                         C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           			PreDelayHighByte = RcvPtr[1];		//Store high byte value                        C:\fw\picscopefw\x017\rs232.c
                                           			PreDelayLowByte = RcvPtr[0];		//Store low byte value                          C:\fw\picscopefw\x017\rs232.c
                                           			PreDelayCntr_H = PreDelayHighByte;		//Load high byte counter                  C:\fw\picscopefw\x017\rs232.c
                                           			PreDelayCntr_L = PreDelayLowByte;		//Load low byte counter                    C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           			if (RcvPtr[0] == 0xff && RcvPtr[1] == 0xff) {                                 C:\fw\picscopefw\x017\rs232.c
                                           				//Abort the inverter shutdown command                                        C:\fw\picscopefw\x017\rs232.c
                                           				CountOutPreDelay = false;                                                    C:\fw\picscopefw\x017\rs232.c
                                           				RequestUnitShutDown = false;                                                 C:\fw\picscopefw\x017\rs232.c
                                           				break;                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			if (RcvPtr[0] == 0 && RcvPtr[1] == 0) {                                       C:\fw\picscopefw\x017\rs232.c
                                           				PreDelayLowByte = DEFAULT_PREDELAY;		//load default predelay                 C:\fw\picscopefw\x017\rs232.c
                                           				PreDelayCntr_L = PreDelayLowByte;		//Load low byte counter                   C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			RequestUnitShutDown = true;                                                   C:\fw\picscopefw\x017\rs232.c
                                           			CountOutPreDelay = true;                                                      C:\fw\picscopefw\x017\rs232.c
                                           			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 23:		//DelayBeforeReboot                                                  C:\fw\picscopefw\x017\rs232.c
                                           			if (InverterON || Standby) {                                                  C:\fw\picscopefw\x017\rs232.c
                                           				ResponseType = COMMAND_REJECTED;                                             C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			else {                                                                        C:\fw\picscopefw\x017\rs232.c
                                           				ResponseType = COMMAND_ACCEPTED;                                             C:\fw\picscopefw\x017\rs232.c
                                           				RebootCounter = RcvPtr[0];                                                   C:\fw\picscopefw\x017\rs232.c
                                           				RebootCounter_H = RcvPtr[1];                                                 C:\fw\picscopefw\x017\rs232.c
                                           				RequestReboot = true;		//Request all active power outlets be turned off for 10 seconds C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 22:	//DelayBeforeStartup (vendor defined) (minutes)                       C:\fw\picscopefw\x017\rs232.c
                                           		case 97:	//DelayBeforeStartup (seconds)                                        C:\fw\picscopefw\x017\rs232.c
                                           			if (ContactClosureShutdownLatch || SelfTestMode || !BatteryOK) {              C:\fw\picscopefw\x017\rs232.c
                                           				ResponseType = COMMAND_REJECTED;                                             C:\fw\picscopefw\x017\rs232.c
                                           				TXENQ(RcvPtr[0]);			//data                                                   C:\fw\picscopefw\x017\rs232.c
                                           				TXENQ(RcvPtr[1]);			//data                                                   C:\fw\picscopefw\x017\rs232.c
                                           				break;                                                                       C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			else ResponseType = COMMAND_ACCEPTED;                                         C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           			if (RcvPtr[3] == 22) {				//data is in minutes, so convert to seconds.        C:\fw\picscopefw\x017\rs232.c
                                           				tempreg.b_form.low = RcvPtr[0];                                              C:\fw\picscopefw\x017\rs232.c
                                           				tempreg.b_form.high = RcvPtr[1];                                             C:\fw\picscopefw\x017\rs232.c
                                           				longreg.l_form = tempreg.s_form*60;		//overflow not possible                 C:\fw\picscopefw\x017\rs232.c
                                           				DelayedWUCntr_H = longreg.b_form.byte2;                                      C:\fw\picscopefw\x017\rs232.c
                                           				DelayedWUCntr_M = longreg.b_form.byte1;                                      C:\fw\picscopefw\x017\rs232.c
                                           				DelayedWUCntr_L = longreg.b_form.byte0;                                      C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			else {									//data is in seconds, so just copy it over.                    C:\fw\picscopefw\x017\rs232.c
                                           				DelayedWUCntr_H = 0;                                                         C:\fw\picscopefw\x017\rs232.c
                                           				DelayedWUCntr_M = RcvPtr[1];                                                 C:\fw\picscopefw\x017\rs232.c
                                           				DelayedWUCntr_L = RcvPtr[0];                                                 C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			                                                                              C:\fw\picscopefw\x017\rs232.c
                                           			if (RcvPtr[0] == 0xff && RcvPtr[1] == 0xff) {	//cancel command                C:\fw\picscopefw\x017\rs232.c
                                           				CountOutPreDelay = false;                                                    C:\fw\picscopefw\x017\rs232.c
                                           				RequestUnitShutDown = false;	//Abort the inverter shutdown command           C:\fw\picscopefw\x017\rs232.c
                                           				DelayedWakeup = false;                                                       C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           			if (DelayedWUCntr_L == 0 && DelayedWUCntr_M == 0 && DelayedWUCntr_H == 0) {   C:\fw\picscopefw\x017\rs232.c
                                           				DelayedWUCntr_L = 2;			//load default wakeup predelay                        C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           			if (PreDelayCntr_H == 0 && PreDelayCntr_L == 0 || !MASTER_RELAY_LAT_BIT || !RequestUnitShutDown) { C:\fw\picscopefw\x017\rs232.c
                                           				PreDelayCntr_H = 0;                                                          C:\fw\picscopefw\x017\rs232.c
                                           				PreDelayCntr_L = DEFAULT_PREDELAY;	//load default predelay                   C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			                                                                              C:\fw\picscopefw\x017\rs232.c
                                           			if (!DelayedWakeup) {			//if we are not already in delayed wakeup..           C:\fw\picscopefw\x017\rs232.c
                                           				RequestDelayedWakeUp = true;                                                 C:\fw\picscopefw\x017\rs232.c
                                           				CountOutPreDelay = true;                                                     C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 82:	//Watchdog                                                            C:\fw\picscopefw\x017\rs232.c
                                           			if (RcvPtr[0] != 0) {                                                         C:\fw\picscopefw\x017\rs232.c
                                           				ResponseType = COMMAND_ACCEPTED;                                             C:\fw\picscopefw\x017\rs232.c
                                           				ComWatchValue = RcvPtr[0];		//load watchdog counter.                         C:\fw\picscopefw\x017\rs232.c
                                           				ComWatchCntr = ComWatchValue;                                                C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			else ResponseType = COMMAND_REJECTED;                                         C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 105:	//SwitchOutletControlMap                                             C:\fw\picscopefw\x017\rs232.c
                                           			if (!CountOutPreDelay && !SelfTestMode) {                                     C:\fw\picscopefw\x017\rs232.c
                                           				ResponseType = COMMAND_ACCEPTED;                                             C:\fw\picscopefw\x017\rs232.c
                                           				ReceptacleStatus = ~RcvPtr[0];		//load desired outlet state.                 C:\fw\picscopefw\x017\rs232.c
                                           				RequestOutletChange = true;                                                  C:\fw\picscopefw\x017\rs232.c
                                           				CountOutPreDelay = true;                                                     C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			else ResponseType = COMMAND_REJECTED;                                         C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			break;	                                                                       C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           		case 193:	//EnterBootload mode                                                 C:\fw\picscopefw\x017\rs232.c
                                           			if (Standby) {                                                                C:\fw\picscopefw\x017\rs232.c
                                           				if (RcvPtr[0] == 0xF6 && \                                                   C:\fw\picscopefw\x017\rs232.c
                                           					RcvPtr[1] == 0x8C && \                                                      C:\fw\picscopefw\x017\rs232.c
                                           					RcvPtr[2] == 0x2A && \                                                      C:\fw\picscopefw\x017\rs232.c
                                           					RcvPtr[3] == 0x6B) {                                                        C:\fw\picscopefw\x017\rs232.c
                                           						                                                                           C:\fw\picscopefw\x017\rs232.c
                                           //exit UPS functionality and enter bootload mode.                                C:\fw\picscopefw\x017\rs232.c
                                           					DISABLE_ALL_INTERRUPTS();                                                   C:\fw\picscopefw\x017\rs232.c
                                           					_asm	goto	BOOT_LOAD_MODE	_endasm                                            C:\fw\picscopefw\x017\rs232.c
                                           						                                                                           C:\fw\picscopefw\x017\rs232.c
                                           				}                                                                            C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			ResponseType = COMMAND_REJECTED;                                              C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[2]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			TXENQ(RcvPtr[3]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
                                           			break;	                                                                       C:\fw\picscopefw\x017\rs232.c
                                           */			                                                                            C:\fw\picscopefw\x017\rs232.c
                                           //Production test commands                                                       C:\fw\picscopefw\x017\rs232.c
                                           		case 150:		//NVR Write                                                         C:\fw\picscopefw\x017\rs232.c
000f02   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\picscopefw\x017\rs232.c
000f04   0e02     MOVLW     0x2                                                                                             
000f06   6fc2     MOVWF     0xc2,0x1                                                                                        
000f08   a8a0     BTFSS     0xa0,0x4,0x0   			if (1 && !PIE2bits.EEIE) {                                                    C:\fw\picscopefw\x017\rs232.c
                                           //				DISABLE_ALL_INTERRUPTS();                                                  C:\fw\picscopefw\x017\rs232.c
                                           //				EECounterB = 1;						//Number of bytes to write.                           C:\fw\picscopefw\x017\rs232.c
                                           //				EEAddress = NVRCommAddr.b_form.low;	//EEPROM register starting address byte. C:\fw\picscopefw\x017\rs232.c
                                           //				EEData = RcvPtr[0];					//First byte of data to write.                     C:\fw\picscopefw\x017\rs232.c
                                           //diag disable ee_page_write                                                     C:\fw\picscopefw\x017\rs232.c
                                           //				EE_PAGE_WRITE();                                                           C:\fw\picscopefw\x017\rs232.c
                                           //				ENABLE_ALL_INTERRUPTS();                                                   C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000f0a   d002     BRA       0xf10          			else ResponseType = COMMAND_REJECTED;                                         C:\fw\picscopefw\x017\rs232.c
000f0c   0e01     MOVLW     0x1                                                                                             
000f0e   6fc2     MOVWF     0xc2,0x1                                                                                        
000f10   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
000f12   ffe9                                                                                                               
000f14   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f16   ffea                                                                                                               
000f18   50ef     MOVF      0xef,0x0,0x0                                                                                    
000f1a   6ee6     MOVWF     0xe6,0x0                                                                                        
000f1c   d98b     RCALL     0x1234                                                                                          
000f1e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000f20   d12c     BRA       0x117a         			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           			                                                                              C:\fw\picscopefw\x017\rs232.c
                                           		case 151:		//NVR Address                                                       C:\fw\picscopefw\x017\rs232.c
000f22   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\picscopefw\x017\rs232.c
000f24   0e02     MOVLW     0x2                                                                                             
000f26   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\picscopefw\x017\rs232.c
000f28   cfde     MOVFF     0xfde,0xfe9    				NVRCommAddr.b_form.low = RcvPtr[0];		//low byte                              C:\fw\picscopefw\x017\rs232.c
000f2a   ffe9                                                                                                               
000f2c   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f2e   ffea                                                                                                               
000f30   cfef     MOVFF     0xfef,0x2c5                                                                                     
000f32   f2c5                                                                                                               
000f34   cfde     MOVFF     0xfde,0xfe9    				NVRCommAddr.b_form.high = RcvPtr[1];	//high byte                             C:\fw\picscopefw\x017\rs232.c
000f36   ffe9                                                                                                               
000f38   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f3a   ffea                                                                                                               
000f3c   0e01     MOVLW     0x1                                                                                             
000f3e   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000f40   0e00     MOVLW     0x0                                                                                             
000f42   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000f44   cfef     MOVFF     0xfef,0x2c6                                                                                     
000f46   f2c6                                                                                                               
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
000f48   d003     BRA       0xf50          			else ResponseType = COMMAND_REJECTED;                                         C:\fw\picscopefw\x017\rs232.c
000f4a   0102     MOVLB     0x2                                                                                             
000f4c   0e01     MOVLW     0x1                                                                                             
000f4e   6fc2     MOVWF     0xc2,0x1                                                                                        
000f50   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
000f52   ffe9                                                                                                               
000f54   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f56   ffea                                                                                                               
000f58   50ef     MOVF      0xef,0x0,0x0                                                                                    
000f5a   6ee6     MOVWF     0xe6,0x0                                                                                        
000f5c   d96b     RCALL     0x1234                                                                                          
000f5e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000f60   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
000f62   ffe9                                                                                                               
000f64   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f66   ffea                                                                                                               
000f68   0e01     MOVLW     0x1                                                                                             
000f6a   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000f6c   0e00     MOVLW     0x0                                                                                             
000f6e   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000f70   50ef     MOVF      0xef,0x0,0x0                                                                                    
000f72   6ee6     MOVWF     0xe6,0x0                                                                                        
000f74   d95f     RCALL     0x1234                                                                                          
000f76   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000f78   d100     BRA       0x117a         			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 152:		//RAM Write                                                         C:\fw\picscopefw\x017\rs232.c
000f7a   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\picscopefw\x017\rs232.c
000f7c   0e02     MOVLW     0x2                                                                                             
000f7e   6fc2     MOVWF     0xc2,0x1                                                                                        
000f80   cfde     MOVFF     0xfde,0xfe9    			*(far unsigned char *)RAMCommAddr.s_form = RcvPtr[0];                         C:\fw\picscopefw\x017\rs232.c
000f82   ffe9                                                                                                               
000f84   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f86   ffea                                                                                                               
000f88   50ef     MOVF      0xef,0x0,0x0                                                                                    
000f8a   c2c7     MOVFF     0x2c7,0xfe9                                                                                     
000f8c   ffe9                                                                                                               
000f8e   c2c8     MOVFF     0x2c8,0xfea                                                                                     
000f90   ffea                                                                                                               
000f92   6eef     MOVWF     0xef,0x0                                                                                        
000f94   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
000f96   ffe9                                                                                                               
000f98   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f9a   ffea                                                                                                               
000f9c   50ef     MOVF      0xef,0x0,0x0                                                                                    
000f9e   6ee6     MOVWF     0xe6,0x0                                                                                        
000fa0   d949     RCALL     0x1234                                                                                          
000fa2   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000fa4   d0ea     BRA       0x117a         			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           	                                                                                C:\fw\picscopefw\x017\rs232.c
                                           		case 153:		//RAM Address                                                       C:\fw\picscopefw\x017\rs232.c
000fa6   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\picscopefw\x017\rs232.c
000fa8   0e02     MOVLW     0x2                                                                                             
000faa   6fc2     MOVWF     0xc2,0x1                                                                                        
000fac   cfde     MOVFF     0xfde,0xfe9    			RAMCommAddr.b_form.low = RcvPtr[0];		//low byte                               C:\fw\picscopefw\x017\rs232.c
000fae   ffe9                                                                                                               
000fb0   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000fb2   ffea                                                                                                               
000fb4   cfef     MOVFF     0xfef,0x2c7                                                                                     
000fb6   f2c7                                                                                                               
000fb8   cfde     MOVFF     0xfde,0xfe9    			RAMCommAddr.b_form.high = RcvPtr[1];	//high byte                              C:\fw\picscopefw\x017\rs232.c
000fba   ffe9                                                                                                               
000fbc   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000fbe   ffea                                                                                                               
000fc0   0e01     MOVLW     0x1                                                                                             
000fc2   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000fc4   0e00     MOVLW     0x0                                                                                             
000fc6   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000fc8   cfef     MOVFF     0xfef,0x2c8                                                                                     
000fca   f2c8                                                                                                               
000fcc   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
000fce   ffe9                                                                                                               
000fd0   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000fd2   ffea                                                                                                               
000fd4   50ef     MOVF      0xef,0x0,0x0                                                                                    
000fd6   6ee6     MOVWF     0xe6,0x0                                                                                        
000fd8   d92d     RCALL     0x1234                                                                                          
000fda   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000fdc   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
000fde   ffe9                                                                                                               
000fe0   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000fe2   ffea                                                                                                               
000fe4   0e01     MOVLW     0x1                                                                                             
000fe6   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000fe8   0e00     MOVLW     0x0                                                                                             
000fea   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000fec   50ef     MOVF      0xef,0x0,0x0                                                                                    
000fee   6ee6     MOVWF     0xe6,0x0                                                                                        
000ff0   d921     RCALL     0x1234                                                                                          
000ff2   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000ff4   d0c2     BRA       0x117a         			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 154:		//Password write (starting with low byte)                           C:\fw\picscopefw\x017\rs232.c
000ff6   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\picscopefw\x017\rs232.c
000ff8   0e02     MOVLW     0x2                                                                                             
000ffa   6fc2     MOVWF     0xc2,0x1                                                                                        
000ffc   cfde     MOVFF     0xfde,0xfe9    			if (RcvPtr[0] == 0x42 && \                                                    C:\fw\picscopefw\x017\rs232.c
000ffe   ffe9                                                                                                               
001000   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001002   ffea                                                                                                               
001004   50ef     MOVF      0xef,0x0,0x0                                                                                    
001006   0842     SUBLW     0x42                                                                                            
001008   e123     BNZ       0x1050                                                                                          
00100a   cfde     MOVFF     0xfde,0xfe9                                                                                     
00100c   ffe9                                                                                                               
00100e   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001010   ffea                                                                                                               
001012   0e01     MOVLW     0x1                                                                                             
001014   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001016   0e00     MOVLW     0x0                                                                                             
001018   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
00101a   50ef     MOVF      0xef,0x0,0x0                                                                                    
00101c   0819     SUBLW     0x19                                                                                            
00101e   e118     BNZ       0x1050                                                                                          
001020   cfde     MOVFF     0xfde,0xfe9                                                                                     
001022   ffe9                                                                                                               
001024   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001026   ffea                                                                                                               
001028   0e02     MOVLW     0x2                                                                                             
00102a   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
00102c   0e00     MOVLW     0x0                                                                                             
00102e   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001030   50ef     MOVF      0xef,0x0,0x0                                                                                    
001032   086e     SUBLW     0x6e                                                                                            
001034   e10d     BNZ       0x1050                                                                                          
001036   cfde     MOVFF     0xfde,0xfe9                                                                                     
001038   ffe9                                                                                                               
00103a   cfdd     MOVFF     0xfdd,0xfea                                                                                     
00103c   ffea                                                                                                               
00103e   0e03     MOVLW     0x3                                                                                             
001040   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001042   0e00     MOVLW     0x0                                                                                             
001044   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001046   50ef     MOVF      0xef,0x0,0x0                                                                                    
001048   0886     SUBLW     0x86                                                                                            
00104a   e102     BNZ       0x1050                                                                                          
                                           				RcvPtr[1] == 0x19 && \                                                       C:\fw\picscopefw\x017\rs232.c
                                           				RcvPtr[2] == 0x6E && \                                                       C:\fw\picscopefw\x017\rs232.c
                                           				RcvPtr[3] == 0x86) {                                                         C:\fw\picscopefw\x017\rs232.c
00104c   0102     MOVLB     0x2            				ProdTestCmdsAllowed = true;                                                  C:\fw\picscopefw\x017\rs232.c
00104e   8dc3     BSF       0xc3,0x6,0x1                                                                                    
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           			//don't report command rejected because it'll make it easy to break the password. C:\fw\picscopefw\x017\rs232.c
001050   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
001052   ffe9                                                                                                               
001054   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001056   ffea                                                                                                               
001058   50ef     MOVF      0xef,0x0,0x0                                                                                    
00105a   6ee6     MOVWF     0xe6,0x0                                                                                        
00105c   d8eb     RCALL     0x1234                                                                                          
00105e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001060   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
001062   ffe9                                                                                                               
001064   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001066   ffea                                                                                                               
001068   0e01     MOVLW     0x1                                                                                             
00106a   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
00106c   0e00     MOVLW     0x0                                                                                             
00106e   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001070   50ef     MOVF      0xef,0x0,0x0                                                                                    
001072   6ee6     MOVWF     0xe6,0x0                                                                                        
001074   d8df     RCALL     0x1234                                                                                          
001076   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001078   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[2]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
00107a   ffe9                                                                                                               
00107c   cfdd     MOVFF     0xfdd,0xfea                                                                                     
00107e   ffea                                                                                                               
001080   0e02     MOVLW     0x2                                                                                             
001082   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001084   0e00     MOVLW     0x0                                                                                             
001086   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001088   50ef     MOVF      0xef,0x0,0x0                                                                                    
00108a   6ee6     MOVWF     0xe6,0x0                                                                                        
00108c   d8d3     RCALL     0x1234                                                                                          
00108e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001090   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[3]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
001092   ffe9                                                                                                               
001094   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001096   ffea                                                                                                               
001098   0e03     MOVLW     0x3                                                                                             
00109a   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
00109c   0e00     MOVLW     0x0                                                                                             
00109e   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
0010a0   50ef     MOVF      0xef,0x0,0x0                                                                                    
0010a2   6ee6     MOVWF     0xe6,0x0                                                                                        
0010a4   d8c7     RCALL     0x1234                                                                                          
0010a6   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0010a8   d068     BRA       0x117a         			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		case 156:		//ROM Write (not supported)                                         C:\fw\picscopefw\x017\rs232.c
                                           //Writing a single byte is not supported by the chip.                            C:\fw\picscopefw\x017\rs232.c
0010aa   0102     MOVLB     0x2            			ResponseType = COMMAND_REJECTED;                                              C:\fw\picscopefw\x017\rs232.c
0010ac   0e01     MOVLW     0x1                                                                                             
0010ae   6fc2     MOVWF     0xc2,0x1                                                                                        
0010b0   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
0010b2   ffe9                                                                                                               
0010b4   cfdd     MOVFF     0xfdd,0xfea                                                                                     
0010b6   ffea                                                                                                               
0010b8   50ef     MOVF      0xef,0x0,0x0                                                                                    
0010ba   6ee6     MOVWF     0xe6,0x0                                                                                        
0010bc   d8bb     RCALL     0x1234                                                                                          
0010be   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0010c0   d05c     BRA       0x117a         			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           	                                                                                C:\fw\picscopefw\x017\rs232.c
                                           		case 157:		//ROM Address                                                       C:\fw\picscopefw\x017\rs232.c
0010c2   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\picscopefw\x017\rs232.c
0010c4   0e02     MOVLW     0x2                                                                                             
0010c6   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\picscopefw\x017\rs232.c
0010c8   cfde     MOVFF     0xfde,0xfe9    				ROMCommAddr.b_form.low = RcvPtr[0];		//low byte                              C:\fw\picscopefw\x017\rs232.c
0010ca   ffe9                                                                                                               
0010cc   cfdd     MOVFF     0xfdd,0xfea                                                                                     
0010ce   ffea                                                                                                               
0010d0   cfef     MOVFF     0xfef,0x2c9                                                                                     
0010d2   f2c9                                                                                                               
0010d4   cfde     MOVFF     0xfde,0xfe9    				ROMCommAddr.b_form.high = RcvPtr[1];	//high byte                             C:\fw\picscopefw\x017\rs232.c
0010d6   ffe9                                                                                                               
0010d8   cfdd     MOVFF     0xfdd,0xfea                                                                                     
0010da   ffea                                                                                                               
0010dc   0e01     MOVLW     0x1                                                                                             
0010de   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
0010e0   0e00     MOVLW     0x0                                                                                             
0010e2   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
0010e4   cfef     MOVFF     0xfef,0x2ca                                                                                     
0010e6   f2ca                                                                                                               
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
0010e8   d003     BRA       0x10f0         			else ResponseType = COMMAND_REJECTED;                                         C:\fw\picscopefw\x017\rs232.c
0010ea   0102     MOVLB     0x2                                                                                             
0010ec   0e01     MOVLW     0x1                                                                                             
0010ee   6fc2     MOVWF     0xc2,0x1                                                                                        
0010f0   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
0010f2   ffe9                                                                                                               
0010f4   cfdd     MOVFF     0xfdd,0xfea                                                                                     
0010f6   ffea                                                                                                               
0010f8   50ef     MOVF      0xef,0x0,0x0                                                                                    
0010fa   6ee6     MOVWF     0xe6,0x0                                                                                        
0010fc   d89b     RCALL     0x1234                                                                                          
0010fe   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001100   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\picscopefw\x017\rs232.c
001102   ffe9                                                                                                               
001104   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001106   ffea                                                                                                               
001108   0e01     MOVLW     0x1                                                                                             
00110a   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
00110c   0e00     MOVLW     0x0                                                                                             
00110e   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001110   50ef     MOVF      0xef,0x0,0x0                                                                                    
001112   6ee6     MOVWF     0xe6,0x0                                                                                        
001114   d88f     RCALL     0x1234                                                                                          
001116   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001118   d030     BRA       0x117a         			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           		case 180:		//NVR Page Write                                                    C:\fw\picscopefw\x017\rs232.c
00111a   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\picscopefw\x017\rs232.c
00111c   0e02     MOVLW     0x2                                                                                             
00111e   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           //			if (1 && !PIE2bits.EEIE && !RETRY_EEPROM_WRITE) {                           C:\fw\picscopefw\x017\rs232.c
                                           //				DISABLE_ALL_INTERRUPTS();                                                  C:\fw\picscopefw\x017\rs232.c
                                           //				EECounterB = 4;						//Number of bytes to write.                           C:\fw\picscopefw\x017\rs232.c
                                           //				EEAddress = NVRCommAddr.b_form.low;	//EEPROM register starting address byte. C:\fw\picscopefw\x017\rs232.c
                                           //				EEData = RcvPtr[0];					//First byte of data to write.                     C:\fw\picscopefw\x017\rs232.c
                                           //				EEData1 = RcvPtr[1];				//Second byte of data to write.                    C:\fw\picscopefw\x017\rs232.c
                                           //				EEData2 = RcvPtr[2];				//Third byte of data to write.                     C:\fw\picscopefw\x017\rs232.c
                                           //				EEData3 = RcvPtr[3];				//Fourth byte of data to write.                    C:\fw\picscopefw\x017\rs232.c
                                           //diag.. disable ee_page_write                                                   C:\fw\picscopefw\x017\rs232.c
                                           //				EE_PAGE_WRITE();                                                           C:\fw\picscopefw\x017\rs232.c
                                           //				ENABLE_ALL_INTERRUPTS();                                                   C:\fw\picscopefw\x017\rs232.c
                                           //			}                                                                           C:\fw\picscopefw\x017\rs232.c
                                           //			else ResponseType = COMMAND_REJECTED;                                       C:\fw\picscopefw\x017\rs232.c
001120   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);                                                             C:\fw\picscopefw\x017\rs232.c
001122   ffe9                                                                                                               
001124   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001126   ffea                                                                                                               
001128   50ef     MOVF      0xef,0x0,0x0                                                                                    
00112a   6ee6     MOVWF     0xe6,0x0                                                                                        
00112c   d883     RCALL     0x1234                                                                                          
00112e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001130   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[1]);                                                             C:\fw\picscopefw\x017\rs232.c
001132   ffe9                                                                                                               
001134   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001136   ffea                                                                                                               
001138   0e01     MOVLW     0x1                                                                                             
00113a   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
00113c   0e00     MOVLW     0x0                                                                                             
00113e   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001140   50ef     MOVF      0xef,0x0,0x0                                                                                    
001142   6ee6     MOVWF     0xe6,0x0                                                                                        
001144   d877     RCALL     0x1234                                                                                          
001146   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001148   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[2]);                                                             C:\fw\picscopefw\x017\rs232.c
00114a   ffe9                                                                                                               
00114c   cfdd     MOVFF     0xfdd,0xfea                                                                                     
00114e   ffea                                                                                                               
001150   0e02     MOVLW     0x2                                                                                             
001152   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001154   0e00     MOVLW     0x0                                                                                             
001156   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001158   50ef     MOVF      0xef,0x0,0x0                                                                                    
00115a   6ee6     MOVWF     0xe6,0x0                                                                                        
00115c   d86b     RCALL     0x1234                                                                                          
00115e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001160   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[3]);                                                             C:\fw\picscopefw\x017\rs232.c
001162   ffe9                                                                                                               
001164   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001166   ffea                                                                                                               
001168   0e03     MOVLW     0x3                                                                                             
00116a   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
00116c   0e00     MOVLW     0x0                                                                                             
00116e   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001170   50ef     MOVF      0xef,0x0,0x0                                                                                    
001172   6ee6     MOVWF     0xe6,0x0                                                                                        
001174   d85f     RCALL     0x1234                                                                                          
001176   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001178   d000     BRA       0x117a         			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		default:                                                                       C:\fw\picscopefw\x017\rs232.c
000f00   d13c     BRA       0x117a         			break;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           		}                                                                              C:\fw\picscopefw\x017\rs232.c
                                           	}                                                                               C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
00117a   0102     MOVLB     0x2            	if (USBQuery) {                                                                 C:\fw\picscopefw\x017\rs232.c
00117c   a9c3     BTFSS     0xc3,0x4,0x1                                                                                    
00117e   d013     BRA       0x11a6                                                                                          
001180   0eff     MOVLW     0xff           		if (ResponseType == 0xff) return;                                              C:\fw\picscopefw\x017\rs232.c
001182   0102     MOVLB     0x2                                                                                             
001184   5dc2     SUBWF     0xc2,0x0,0x1                                                                                    
001186   e101     BNZ       0x118a                                                                                          
001188   d04f     BRA       0x1228                                                                                          
                                           //no response or ack?                                                            C:\fw\picscopefw\x017\rs232.c
00118a   0e09     MOVLW     0x9            		if (SetupPkt.bRequest == SET_REPORT) return;		//no response to set_report      C:\fw\picscopefw\x017\rs232.c
00118c   0104     MOVLB     0x4                                                                                             
00118e   5d11     SUBWF     0x11,0x0,0x1                                                                                    
001190   e101     BNZ       0x1194                                                                                          
001192   d04a     BRA       0x1228                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           		//USB query setup data:                                                        C:\fw\picscopefw\x017\rs232.c
001194   c412     MOVFF     0x412,0x418    		CtrlTrfData._byte[0] = SetupPkt._byte[2];                                      C:\fw\picscopefw\x017\rs232.c
001196   f418                                                                                                               
001198   0102     MOVLB     0x2            		wCount._word = USBDataPointer;		//Calculate number of bytes to send            C:\fw\picscopefw\x017\rs232.c
00119a   51c4     MOVF      0xc4,0x0,0x1                                                                                    
00119c   0100     MOVLB     0x0                                                                                             
00119e   6ff9     MOVWF     0xf9,0x1                                                                                        
0011a0   6bfa     CLRF      0xfa,0x1                                                                                        
0011a2   d042     BRA       0x1228         		return;                                                                        C:\fw\picscopefw\x017\rs232.c
                                           	}                                                                               C:\fw\picscopefw\x017\rs232.c
0011a4   d040     BRA       0x1226         	else {                                                                          C:\fw\picscopefw\x017\rs232.c
                                           		//RS232 query setup data:                                                      C:\fw\picscopefw\x017\rs232.c
0011a6   0102     MOVLB     0x2            		TxBuffer[0] = HEADER_CHAR;                                                     C:\fw\picscopefw\x017\rs232.c
0011a8   0e7e     MOVLW     0x7e                                                                                            
0011aa   6fdc     MOVWF     0xdc,0x1                                                                                        
0011ac   c2c2     MOVFF     0x2c2,0x2dd    		TxBuffer[1] = ResponseType;                                                    C:\fw\picscopefw\x017\rs232.c
0011ae   f2dd                                                                                                               
0011b0   c2d6     MOVFF     0x2d6,0x2df    		TxBuffer[3] = RxBuffer[3];				//report ID.                                     C:\fw\picscopefw\x017\rs232.c
0011b2   f2df                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
0011b4   0102     MOVLB     0x2            		if (!SendingOutString) TxBuffer[2] = TxBufPtr-3;			//calculate the length of data returned C:\fw\picscopefw\x017\rs232.c
0011b6   b5c3     BTFSC     0xc3,0x2,0x1                                                                                    
0011b8   d005     BRA       0x11c4                                                                                          
0011ba   0e03     MOVLW     0x3                                                                                             
0011bc   0102     MOVLB     0x2                                                                                             
0011be   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
0011c0   0102     MOVLB     0x2                                                                                             
0011c2   6fde     MOVWF     0xde,0x1                                                                                        
                                           		//else TxBuffer[2] already written                                             C:\fw\picscopefw\x017\rs232.c
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           		//if we've enqueued a byte, this indicates that the command was accepted.      C:\fw\picscopefw\x017\rs232.c
                                           		//In that case, we should compute the checksum and send the data out.          C:\fw\picscopefw\x017\rs232.c
0011c4   0102     MOVLB     0x2            			if (!SendingOutString) {                                                      C:\fw\picscopefw\x017\rs232.c
0011c6   b5c3     BTFSC     0xc3,0x2,0x1                                                                                    
0011c8   d028     BRA       0x121a                                                                                          
0011ca   0102     MOVLB     0x2            				if (TxBufPtr > 2) {		                                                        C:\fw\picscopefw\x017\rs232.c
0011cc   51bb     MOVF      0xbb,0x0,0x1                                                                                    
0011ce   0802     SUBLW     0x2                                                                                             
0011d0   e224     BC        0x121a                                                                                          
                                           				//We've enqueued all other bytes, so write the checksum:                     C:\fw\picscopefw\x017\rs232.c
0011d2   0e03     MOVLW     0x3            					tempvar0 = 0;                                                               C:\fw\picscopefw\x017\rs232.c
0011d4   6adb     CLRF      0xdb,0x0                                                                                        
0011d6   0e02     MOVLW     0x2            					for (tempvar1 = 0;tempvar1 < TxBufPtr;tempvar1++) {                         C:\fw\picscopefw\x017\rs232.c
0011d8   6adb     CLRF      0xdb,0x0                                                                                        
0011da   51bb     MOVF      0xbb,0x0,0x1                                                                                    
0011dc   6ef3     MOVWF     0xf3,0x0                                                                                        
0011de   0e02     MOVLW     0x2                                                                                             
0011e0   cfdb     MOVFF     0xfdb,0xff4                                                                                     
0011e2   fff4                                                                                                               
0011e4   50f3     MOVF      0xf3,0x0,0x0                                                                                    
0011e6   5cf4     SUBWF     0xf4,0x0,0x0                                                                                    
0011e8   e212     BC        0x120e                                                                                          
001208   0e02     MOVLW     0x2                                                                                             
00120a   2adb     INCF      0xdb,0x1,0x0                                                                                    
00120c   d7e6     BRA       0x11da                                                                                          
0011ea   0e02     MOVLW     0x2            						tempvar0 += TxBuffer[tempvar1];                                            C:\fw\picscopefw\x017\rs232.c
0011ec   50db     MOVF      0xdb,0x0,0x0                                                                                    
0011ee   6aea     CLRF      0xea,0x0                                                                                        
0011f0   0fdc     ADDLW     0xdc                                                                                            
0011f2   6ee9     MOVWF     0xe9,0x0                                                                                        
0011f4   0e02     MOVLW     0x2                                                                                             
0011f6   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
0011f8   0e03     MOVLW     0x3                                                                                             
0011fa   cfdb     MOVFF     0xfdb,0xfe7                                                                                     
0011fc   ffe7                                                                                                               
0011fe   50ef     MOVF      0xef,0x0,0x0                                                                                    
001200   26e7     ADDWF     0xe7,0x1,0x0                                                                                    
001202   0e03     MOVLW     0x3                                                                                             
001204   cfe7     MOVFF     0xfe7,0xfdb                                                                                     
001206   ffdb                                                                                                               
                                           					}                                                                           C:\fw\picscopefw\x017\rs232.c
00120e   0e03     MOVLW     0x3            					TXENQ(tempvar0);			//enqueue checksum as final byte to send out.            C:\fw\picscopefw\x017\rs232.c
001210   cfdb     MOVFF     0xfdb,0xfe6                                                                                     
001212   ffe6                                                                                                               
001214   d80f     RCALL     0x1234                                                                                          
001216   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001218   d007     BRA       0x1228         					return;		//and exit                                                         C:\fw\picscopefw\x017\rs232.c
                                           				}                                                                            C:\fw\picscopefw\x017\rs232.c
                                           			}                                                                             C:\fw\picscopefw\x017\rs232.c
                                           		//If the type of command received is neither a poll nor set command,           C:\fw\picscopefw\x017\rs232.c
                                           		//or we dont recognize the reportID, cancel the command because it             C:\fw\picscopefw\x017\rs232.c
                                           		//is not recognized.                                                           C:\fw\picscopefw\x017\rs232.c
00121a   0102     MOVLB     0x2            		TildeFlg = false;					//reset colon-received flag.                             C:\fw\picscopefw\x017\rs232.c
00121c   93c3     BCF       0xc3,0x1,0x1                                                                                    
00121e   0102     MOVLB     0x2            		RxBufPtr = 0;						//Reset buffer.                                             C:\fw\picscopefw\x017\rs232.c
001220   6bbe     CLRF      0xbe,0x1                                                                                        
001222   0102     MOVLB     0x2            		CmdLength = 0;                                                                 C:\fw\picscopefw\x017\rs232.c
001224   6bbd     CLRF      0xbd,0x1                                                                                        
                                           	}                                                                               C:\fw\picscopefw\x017\rs232.c
001226   d000     BRA       0x1228         	return;                                                                         C:\fw\picscopefw\x017\rs232.c
001228   cfd9     MOVFF     0xfd9,0xfe1    }                                                                                C:\fw\picscopefw\x017\rs232.c
00122a   ffe1                                                                                                               
00122c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00122e   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001230   ffd9                                                                                                               
001232   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\picscopefw\x017\rs232.c
                                           //-----------------------------------------------------------------------        C:\fw\picscopefw\x017\rs232.c
                                           //This routine will store a character into the TxBuffer.                         C:\fw\picscopefw\x017\rs232.c
001234   cfd9     MOVFF     0xfd9,0xfe6    void	TXENQ(unsigned char Input) {                                                C:\fw\picscopefw\x017\rs232.c
001236   ffe6                                                                                                               
001238   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
00123a   ffd9                                                                                                               
00123c   0102     MOVLB     0x2            	if (!USBQuery) {                                                                C:\fw\picscopefw\x017\rs232.c
00123e   b9c3     BTFSC     0xc3,0x4,0x1                                                                                    
001240   d010     BRA       0x1262                                                                                          
                                           		//RS232 Query                                                                  C:\fw\picscopefw\x017\rs232.c
001242   0e40     MOVLW     0x40           		if (TxBufPtr >= MAX_TX_LENGTH) return;		//Exit if buffer full.                 C:\fw\picscopefw\x017\rs232.c
001244   0102     MOVLB     0x2                                                                                             
001246   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
001248   e301     BNC       0x124c                                                                                          
00124a   d01a     BRA       0x1280                                                                                          
00124c   51bb     MOVF      0xbb,0x0,0x1   		TxBuffer[TxBufPtr] = Input;	//Store value in buffer.                           C:\fw\picscopefw\x017\rs232.c
00124e   6aea     CLRF      0xea,0x0                                                                                        
001250   0fdc     ADDLW     0xdc                                                                                            
001252   6ee9     MOVWF     0xe9,0x0                                                                                        
001254   0e02     MOVLW     0x2                                                                                             
001256   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001258   0efe     MOVLW     0xfe                                                                                            
00125a   cfdb     MOVFF     0xfdb,0xfef                                                                                     
00125c   ffef                                                                                                               
00125e   2bbb     INCF      0xbb,0x1,0x1   		TxBufPtr++;					//Update input ptr.                                            C:\fw\picscopefw\x017\rs232.c
                                           	}                                                                               C:\fw\picscopefw\x017\rs232.c
001260   d00f     BRA       0x1280         	else {                                                                          C:\fw\picscopefw\x017\rs232.c
                                           		//USB Query                                                                    C:\fw\picscopefw\x017\rs232.c
001262   0e40     MOVLW     0x40           		if (USBDataPointer >= 64) return;		//Exit if buffer full.                      C:\fw\picscopefw\x017\rs232.c
001264   0102     MOVLB     0x2                                                                                             
001266   5dc4     SUBWF     0xc4,0x0,0x1                                                                                    
001268   e301     BNC       0x126c                                                                                          
00126a   d00a     BRA       0x1280                                                                                          
00126c   51c4     MOVF      0xc4,0x0,0x1   		CtrlTrfData._byte[USBDataPointer] = Input;                                     C:\fw\picscopefw\x017\rs232.c
00126e   6aea     CLRF      0xea,0x0                                                                                        
001270   0f18     ADDLW     0x18                                                                                            
001272   6ee9     MOVWF     0xe9,0x0                                                                                        
001274   0e04     MOVLW     0x4                                                                                             
001276   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001278   0efe     MOVLW     0xfe                                                                                            
00127a   cfdb     MOVFF     0xfdb,0xfef                                                                                     
00127c   ffef                                                                                                               
00127e   2bc4     INCF      0xc4,0x1,0x1   		USBDataPointer++;                                                              C:\fw\picscopefw\x017\rs232.c
                                           	}                                                                               C:\fw\picscopefw\x017\rs232.c
001280   52e5     MOVF      0xe5,0x1,0x0   }                                                                                C:\fw\picscopefw\x017\rs232.c
001282   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001284   ffd9                                                                                                               
001286   0012     RETURN    0x0                                                                                             
                                           //-----------------------------------------------------------------------        C:\fw\picscopefw\x017\rs232.c
                                           //Reset TX Buffer.                                                               C:\fw\picscopefw\x017\rs232.c
                                           void	RTXB(void) {                                                                C:\fw\picscopefw\x017\rs232.c
001288   0102     MOVLB     0x2            	TxBufPtr = 0;		//Point to buffer start.                                         C:\fw\picscopefw\x017\rs232.c
00128a   6bbb     CLRF      0xbb,0x1                                                                                        
00128c   0102     MOVLB     0x2            	TxBufOutPtr = 0;		//Point to buffer start.                                      C:\fw\picscopefw\x017\rs232.c
00128e   6bbc     CLRF      0xbc,0x1                                                                                        
001290   0012     RETURN    0x0            }                                                                                C:\fw\picscopefw\x017\rs232.c
                                           /*********************************************************************           C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            *             Microchip USB C18 Firmware -  HID Version 1.0                     C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            *********************************************************************           C:\fw\picscopefw\x017\hid.c
                                            * FileName:        hid.c                                                        C:\fw\picscopefw\x017\hid.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\picscopefw\x017\hid.c
                                            * Processor:       PIC18                                                        C:\fw\picscopefw\x017\hid.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\picscopefw\x017\hid.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Software License Agreement                                                    C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\picscopefw\x017\hid.c
                                            * (the Company) for its PICmicro Microcontroller is intended and             C:\fw\picscopefw\x017\hid.c
                                            * supplied to you, the Companys customer, for use solely and                   C:\fw\picscopefw\x017\hid.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\picscopefw\x017\hid.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\picscopefw\x017\hid.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\picscopefw\x017\hid.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\picscopefw\x017\hid.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\picscopefw\x017\hid.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\picscopefw\x017\hid.c
                                            * license.                                                                      C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * THIS SOFTWARE IS PROVIDED IN AN AS IS CONDITION. NO WARRANTIES,             C:\fw\picscopefw\x017\hid.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\picscopefw\x017\hid.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\picscopefw\x017\hid.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\picscopefw\x017\hid.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\picscopefw\x017\hid.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Author               Date        Comment                                      C:\fw\picscopefw\x017\hid.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           C:\fw\picscopefw\x017\hid.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    C:\fw\picscopefw\x017\hid.c
                                            ********************************************************************/           C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\picscopefw\x017\hid.c
                                           #include <p18cxxx.h>                                                             C:\fw\picscopefw\x017\hid.c
                                           #include "c_system.h"                                                            C:\fw\picscopefw\x017\hid.c
                                           #include "typedefs.h"                                                            C:\fw\picscopefw\x017\hid.c
                                           #include "usb.h"                                                                 C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           #ifdef USB_USE_HID                                                               C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\picscopefw\x017\hid.c
                                           void HIDGetReportHandler(void);                                                  C:\fw\picscopefw\x017\hid.c
                                           void HIDSetReportHandler(void);                                                  C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\picscopefw\x017\hid.c
                                           #pragma udata usb5                                                               C:\fw\picscopefw\x017\hid.c
                                           byte idle_rate;                                                                  C:\fw\picscopefw\x017\hid.c
                                           byte active_protocol;               // [0] Boot Protocol [1] Report Protocol     C:\fw\picscopefw\x017\hid.c
                                           byte hid_rpt_rx_len;                                                             C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\picscopefw\x017\hid.c
                                           #pragma code                                                                     C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           /** C L A S S  S P E C I F I C  R E Q ****************************************/  C:\fw\picscopefw\x017\hid.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\hid.c
                                            * Function:        void USBCheckHIDRequest(void)                                C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Overview:        This routine checks the setup data packet to see if it       C:\fw\picscopefw\x017\hid.c
                                            *                  knows how to handle it                                       C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\hid.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\hid.c
                                           void USBCheckHIDRequest(void)                                                    C:\fw\picscopefw\x017\hid.c
                                           {                                                                                C:\fw\picscopefw\x017\hid.c
001a0c   0104     MOVLB     0x4                if(SetupPkt.Recipient != RCPT_INTF) return;                                  C:\fw\picscopefw\x017\hid.c
001a0e   5110     MOVF      0x10,0x0,0x1                                                                                    
001a10   0b1f     ANDLW     0x1f                                                                                            
001a12   0801     SUBLW     0x1                                                                                             
001a14   e001     BZ        0x1a18                                                                                          
001a16   d086     BRA       0x1b24                                                                                          
001a18   5114     MOVF      0x14,0x0,0x1       if(SetupPkt.bIntfID != HID_INTF_ID) return;                                  C:\fw\picscopefw\x017\hid.c
001a1a   e001     BZ        0x1a1e                                                                                          
001a1c   d083     BRA       0x1b24                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                               /*                                                                           C:\fw\picscopefw\x017\hid.c
                                                * There are two standard requests that hid.c may support.                   C:\fw\picscopefw\x017\hid.c
                                                * 1. GET_DSC(DSC_HID,DSC_RPT,DSC_PHY);                                      C:\fw\picscopefw\x017\hid.c
                                                * 2. SET_DSC(DSC_HID,DSC_RPT,DSC_PHY);                                      C:\fw\picscopefw\x017\hid.c
                                                */                                                                          C:\fw\picscopefw\x017\hid.c
001a1e   0e06     MOVLW     0x6                if(SetupPkt.bRequest == GET_DSC)                                             C:\fw\picscopefw\x017\hid.c
001a20   5d11     SUBWF     0x11,0x0,0x1                                                                                    
001a22   e12e     BNZ       0x1a80                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\hid.c
001a24   5113     MOVF      0x13,0x0,0x1           switch(SetupPkt.bDscType)                                                C:\fw\picscopefw\x017\hid.c
001a26   0a23     XORLW     0x23                                                                                            
001a28   e028     BZ        0x1a7a                                                                                          
001a2a   0a01     XORLW     0x1                                                                                             
001a2c   e013     BZ        0x1a54                                                                                          
001a2e   0a03     XORLW     0x3                                                                                             
001a30   e001     BZ        0x1a34                                                                                          
001a32   d024     BRA       0x1a7c                                                                                          
                                                   {                                                                        C:\fw\picscopefw\x017\hid.c
                                                       case DSC_HID:                                                        C:\fw\picscopefw\x017\hid.c
001a34   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_HID;                               C:\fw\picscopefw\x017\hid.c
001a36   0e02     MOVLW     0x2                                                                                             
001a38   6ff4     MOVWF     0xf4,0x1                                                                                        
001a3a   0100     MOVLB     0x0                            mUSBGetHIDDscAdr(pSrc.bRom);        // See usbcfg.h              C:\fw\picscopefw\x017\hid.c
001a3c   05f1     DECF      0xf1,0x0,0x1                                                                                    
001a3e   e105     BNZ       0x1a4a                                                                                          
001a40   0100     MOVLB     0x0                                                                                             
001a42   0e76     MOVLW     0x76                                                                                            
001a44   6ff5     MOVWF     0xf5,0x1                                                                                        
001a46   0e1e     MOVLW     0x1e                                                                                            
001a48   6ff6     MOVWF     0xf6,0x1                                                                                        
001a4a   0e09     MOVLW     0x9                            wCount._word = sizeof(USB_HID_DSC);                              C:\fw\picscopefw\x017\hid.c
001a4c   0100     MOVLB     0x0                                                                                             
001a4e   6ff9     MOVWF     0xf9,0x1                                                                                        
001a50   6bfa     CLRF      0xfa,0x1                                                                                        
001a52   d014     BRA       0x1a7c                         break;                                                           C:\fw\picscopefw\x017\hid.c
                                                       case DSC_RPT:                                                        C:\fw\picscopefw\x017\hid.c
001a54   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_HID;                               C:\fw\picscopefw\x017\hid.c
001a56   0e02     MOVLW     0x2                                                                                             
001a58   6ff4     MOVWF     0xf4,0x1                                                                                        
001a5a   0100     MOVLB     0x0                            mUSBGetHIDRptDscAdr(pSrc.bRom);     // See usbcfg.h              C:\fw\picscopefw\x017\hid.c
001a5c   05f1     DECF      0xf1,0x0,0x1                                                                                    
001a5e   e105     BNZ       0x1a6a                                                                                          
001a60   0100     MOVLB     0x0                                                                                             
001a62   0eac     MOVLW     0xac                                                                                            
001a64   6ff5     MOVWF     0xf5,0x1                                                                                        
001a66   0e1e     MOVLW     0x1e                                                                                            
001a68   6ff6     MOVWF     0xf6,0x1                                                                                        
001a6a   0100     MOVLB     0x0                            mUSBGetHIDRptDscSize(wCount._word); // See usbcfg.h              C:\fw\picscopefw\x017\hid.c
001a6c   05f1     DECF      0xf1,0x0,0x1                                                                                    
001a6e   e104     BNZ       0x1a78                                                                                          
001a70   0e70     MOVLW     0x70                                                                                            
001a72   0100     MOVLB     0x0                                                                                             
001a74   6ff9     MOVWF     0xf9,0x1                                                                                        
001a76   6bfa     CLRF      0xfa,0x1                                                                                        
001a78   d001     BRA       0x1a7c                         break;                                                           C:\fw\picscopefw\x017\hid.c
                                                       case DSC_PHY:                                                        C:\fw\picscopefw\x017\hid.c
                                                           // ctrl_trf_session_owner = MUID_HID;                            C:\fw\picscopefw\x017\hid.c
001a7a   d000     BRA       0x1a7c                         break;                                                           C:\fw\picscopefw\x017\hid.c
                                                   }//end switch(SetupPkt.bDscType)                                         C:\fw\picscopefw\x017\hid.c
001a7c   0100     MOVLB     0x0                    usb_stat.ctrl_trf_mem = _ROM;                                            C:\fw\picscopefw\x017\hid.c
001a7e   83f0     BSF       0xf0,0x1,0x1                                                                                    
                                               }//end if(SetupPkt.bRequest == GET_DSC)                                      C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
001a80   0104     MOVLB     0x4                if(SetupPkt.RequestType != CLASS) return;                                    C:\fw\picscopefw\x017\hid.c
001a82   5110     MOVF      0x10,0x0,0x1                                                                                    
001a84   0b60     ANDLW     0x60                                                                                            
001a86   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001a88   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001a8a   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001a8c   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001a8e   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001a90   0801     SUBLW     0x1                                                                                             
001a92   e001     BZ        0x1a96                                                                                          
001a94   d047     BRA       0x1b24                                                                                          
001a96   5111     MOVF      0x11,0x0,0x1       switch(SetupPkt.bRequest)                                                    C:\fw\picscopefw\x017\hid.c
001a98   0a0b     XORLW     0xb                                                                                             
001a9a   e03e     BZ        0x1b18                                                                                          
001a9c   0a08     XORLW     0x8                                                                                             
001a9e   e02e     BZ        0x1afc                                                                                          
001aa0   0a09     XORLW     0x9                                                                                             
001aa2   e026     BZ        0x1af0                                                                                          
001aa4   0a08     XORLW     0x8                                                                                             
001aa6   e016     BZ        0x1ad4                                                                                          
001aa8   0a0b     XORLW     0xb                                                                                             
001aaa   e006     BZ        0x1ab8                                                                                          
001aac   0a08     XORLW     0x8                                                                                             
001aae   e001     BZ        0x1ab2                                                                                          
001ab0   d039     BRA       0x1b24                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\hid.c
                                                   case GET_REPORT:                                                         C:\fw\picscopefw\x017\hid.c
001ab2   ecb3     CALL      0x1d66,0x0                 HIDGetReportHandler();                                               C:\fw\picscopefw\x017\hid.c
001ab4   f00e                                                                                                               
001ab6   d036     BRA       0x1b24                     break;                                                               C:\fw\picscopefw\x017\hid.c
                                                   case SET_REPORT:                                                         C:\fw\picscopefw\x017\hid.c
                                           //            HIDSetReportHandler();      //2/8/05 JD this was not at the right location. C:\fw\picscopefw\x017\hid.c
001ab8   0100     MOVLB     0x0            			pDst.bRam = (byte*)&USBEP0DataInBuffer;	//Set destination for report data.    C:\fw\picscopefw\x017\hid.c
001aba   0ecb     MOVLW     0xcb                                                                                            
001abc   6ff7     MOVWF     0xf7,0x1                                                                                        
001abe   0e02     MOVLW     0x2                                                                                             
001ac0   6ff8     MOVWF     0xf8,0x1                                                                                        
001ac2   0100     MOVLB     0x0            			usb_stat.ctrl_trf_mem = _RAM;		//Set memory type                              C:\fw\picscopefw\x017\hid.c
001ac4   93f0     BCF       0xf0,0x1,0x1                                                                                    
001ac6   0100     MOVLB     0x0            			wCount._word = 0;					//reset counter                                         C:\fw\picscopefw\x017\hid.c
001ac8   6bf9     CLRF      0xf9,0x1                                                                                        
001aca   6bfa     CLRF      0xfa,0x1                                                                                        
001acc   0100     MOVLB     0x0            			ctrl_trf_session_owner = MUID_HID;  //set owner to HID, service this when we have some data..	 C:\fw\picscopefw\x017\hid.c
001ace   0e02     MOVLW     0x2                                                                                             
001ad0   6ff4     MOVWF     0xf4,0x1                                                                                        
001ad2   d028     BRA       0x1b24                     break;                                                               C:\fw\picscopefw\x017\hid.c
                                                   case GET_IDLE:                                                           C:\fw\picscopefw\x017\hid.c
001ad4   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_HID;                                   C:\fw\picscopefw\x017\hid.c
001ad6   0e02     MOVLW     0x2                                                                                             
001ad8   6ff4     MOVWF     0xf4,0x1                                                                                        
001ada   0100     MOVLB     0x0                        pSrc.bRam = (byte*)&idle_rate;      // Set source                    C:\fw\picscopefw\x017\hid.c
001adc   0efd     MOVLW     0xfd                                                                                            
001ade   6ff5     MOVWF     0xf5,0x1                                                                                        
001ae0   0e00     MOVLW     0x0                                                                                             
001ae2   6ff6     MOVWF     0xf6,0x1                                                                                        
001ae4   0100     MOVLB     0x0                        usb_stat.ctrl_trf_mem = _RAM;       // Set memory type               C:\fw\picscopefw\x017\hid.c
001ae6   93f0     BCF       0xf0,0x1,0x1                                                                                    
001ae8   0100     MOVLB     0x0                        LSB(wCount) = 1;                    // Set data count                C:\fw\picscopefw\x017\hid.c
001aea   0e01     MOVLW     0x1                                                                                             
001aec   6ff9     MOVWF     0xf9,0x1                                                                                        
001aee   d01a     BRA       0x1b24                     break;                                                               C:\fw\picscopefw\x017\hid.c
                                                   case SET_IDLE:                                                           C:\fw\picscopefw\x017\hid.c
001af0   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_HID;                                   C:\fw\picscopefw\x017\hid.c
001af2   0e02     MOVLW     0x2                                                                                             
001af4   6ff4     MOVWF     0xf4,0x1                                                                                        
001af6   c413     MOVFF     0x413,0xfd                 idle_rate = MSB(SetupPkt.W_Value);                                   C:\fw\picscopefw\x017\hid.c
001af8   f0fd                                                                                                               
001afa   d014     BRA       0x1b24                     break;                                                               C:\fw\picscopefw\x017\hid.c
                                                   case GET_PROTOCOL:                                                       C:\fw\picscopefw\x017\hid.c
001afc   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_HID;                                   C:\fw\picscopefw\x017\hid.c
001afe   0e02     MOVLW     0x2                                                                                             
001b00   6ff4     MOVWF     0xf4,0x1                                                                                        
001b02   0100     MOVLB     0x0                        pSrc.bRam = (byte*)&active_protocol;// Set source                    C:\fw\picscopefw\x017\hid.c
001b04   0efe     MOVLW     0xfe                                                                                            
001b06   6ff5     MOVWF     0xf5,0x1                                                                                        
001b08   0e00     MOVLW     0x0                                                                                             
001b0a   6ff6     MOVWF     0xf6,0x1                                                                                        
001b0c   0100     MOVLB     0x0                        usb_stat.ctrl_trf_mem = _RAM;       // Set memory type               C:\fw\picscopefw\x017\hid.c
001b0e   93f0     BCF       0xf0,0x1,0x1                                                                                    
001b10   0100     MOVLB     0x0                        LSB(wCount) = 1;                    // Set data count                C:\fw\picscopefw\x017\hid.c
001b12   0e01     MOVLW     0x1                                                                                             
001b14   6ff9     MOVWF     0xf9,0x1                                                                                        
001b16   d006     BRA       0x1b24                     break;                                                               C:\fw\picscopefw\x017\hid.c
                                                   case SET_PROTOCOL:                                                       C:\fw\picscopefw\x017\hid.c
001b18   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_HID;                                   C:\fw\picscopefw\x017\hid.c
001b1a   0e02     MOVLW     0x2                                                                                             
001b1c   6ff4     MOVWF     0xf4,0x1                                                                                        
001b1e   c412     MOVFF     0x412,0xfe                 active_protocol = LSB(SetupPkt.W_Value);                             C:\fw\picscopefw\x017\hid.c
001b20   f0fe                                                                                                               
001b22   d000     BRA       0x1b24                     break;                                                               C:\fw\picscopefw\x017\hid.c
                                               }//end switch(SetupPkt.bRequest)                                             C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
001b24   0012     RETURN    0x0            }//end USBCheckHIDRequest                                                        C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           /** U S E R  A P I ***********************************************************/  C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\hid.c
                                            * Function:        void HIDInitEP(void)                                         C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * PreCondition:    None                                                         C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Input:           None                                                         C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Overview:        HIDInitEP initializes HID endpoints, buffer descriptors,     C:\fw\picscopefw\x017\hid.c
                                            *                  internal state-machine, and variables.                       C:\fw\picscopefw\x017\hid.c
                                            *                  It should be called after the USB host has sent out a        C:\fw\picscopefw\x017\hid.c
                                            *                  SET_CONFIGURATION request.                                   C:\fw\picscopefw\x017\hid.c
                                            *                  See USBStdSetCfgHandler() in usb9.c for examples.            C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\hid.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\hid.c
                                           void HIDInitEP(void)                                                             C:\fw\picscopefw\x017\hid.c
                                           {                                                                                C:\fw\picscopefw\x017\hid.c
001b26   0100     MOVLB     0x0                hid_rpt_rx_len =0;                                                           C:\fw\picscopefw\x017\hid.c
001b28   6bff     CLRF      0xff,0x1                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\hid.c
001b2a   0e1e     MOVLW     0x1e               HID_UEP = EP_OUT_IN|HSHK_EN;                // Enable 2 data pipes           C:\fw\picscopefw\x017\hid.c
001b2c   6e71     MOVWF     0x71,0x0                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\hid.c
001b2e   0104     MOVLB     0x4                HID_BD_OUT.Cnt = sizeof(hid_report_out);    // Set buffer size               C:\fw\picscopefw\x017\hid.c
001b30   0e08     MOVLW     0x8                                                                                             
001b32   6f09     MOVWF     0x9,0x1                                                                                         
001b34   0e58     MOVLW     0x58               HID_BD_OUT.ADR = (byte*)&hid_report_out;    // Set buffer address            C:\fw\picscopefw\x017\hid.c
001b36   6f0a     MOVWF     0xa,0x1                                                                                         
001b38   0e04     MOVLW     0x4                                                                                             
001b3a   6f0b     MOVWF     0xb,0x1                                                                                         
001b3c   0e88     MOVLW     0x88               HID_BD_OUT.Stat._byte = _USIE|_DAT0|_DTSEN; // Set status                    C:\fw\picscopefw\x017\hid.c
001b3e   6f08     MOVWF     0x8,0x1                                                                                         
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                               /*                                                                           C:\fw\picscopefw\x017\hid.c
                                                * Do not have to init Cnt of IN pipes here.                                 C:\fw\picscopefw\x017\hid.c
                                                * Reason:  Number of bytes to send to the host                              C:\fw\picscopefw\x017\hid.c
                                                *          varies from one transaction to                                   C:\fw\picscopefw\x017\hid.c
                                                *          another. Cnt should equal the exact                              C:\fw\picscopefw\x017\hid.c
                                                *          number of bytes to transmit for                                  C:\fw\picscopefw\x017\hid.c
                                                *          a given IN transaction.                                          C:\fw\picscopefw\x017\hid.c
                                                *          This number of bytes will only                                   C:\fw\picscopefw\x017\hid.c
                                                *          be known right before the data is                                C:\fw\picscopefw\x017\hid.c
                                                *          sent.                                                            C:\fw\picscopefw\x017\hid.c
                                                */                                                                          C:\fw\picscopefw\x017\hid.c
001b40   0104     MOVLB     0x4                HID_BD_IN.ADR = (byte*)&hid_report_in;      // Set buffer address            C:\fw\picscopefw\x017\hid.c
001b42   0e60     MOVLW     0x60                                                                                            
001b44   6f0e     MOVWF     0xe,0x1                                                                                         
001b46   0e04     MOVLW     0x4                                                                                             
001b48   6f0f     MOVWF     0xf,0x1                                                                                         
001b4a   0e40     MOVLW     0x40               HID_BD_IN.Stat._byte = _UCPU|_DAT1;         // Set status                    C:\fw\picscopefw\x017\hid.c
001b4c   6f0c     MOVWF     0xc,0x1                                                                                         
                                                                                                                            C:\fw\picscopefw\x017\hid.c
001b4e   0012     RETURN    0x0            }//end HIDInitEP                                                                 C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\hid.c
                                            * Function:        void HIDTxReport(char *buffer, byte len)                     C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * PreCondition:    mHIDTxIsBusy() must return false.                            C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            *                  Value of 'len' must be equal to or smaller than              C:\fw\picscopefw\x017\hid.c
                                            *                  HID_INT_IN_EP_SIZE                                           C:\fw\picscopefw\x017\hid.c
                                            *                  For an interrupt endpoint, the largest buffer size is        C:\fw\picscopefw\x017\hid.c
                                            *                  64 bytes.                                                    C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Input:           buffer  : Pointer to the starting location of data bytes     C:\fw\picscopefw\x017\hid.c
                                            *                  len     : Number of bytes to be transferred                  C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Output:          None                                                         C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Side Effects:    None                                                         C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Overview:        Use this macro to transfer data located in data memory.      C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            *                  Remember: mHIDTxIsBusy() must return false before user       C:\fw\picscopefw\x017\hid.c
                                            *                  can call this function.                                      C:\fw\picscopefw\x017\hid.c
                                            *                  Unexpected behavior will occur if this function is called    C:\fw\picscopefw\x017\hid.c
                                            *                  when mHIDTxIsBusy() == 0                                     C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            *                  Typical Usage:                                               C:\fw\picscopefw\x017\hid.c
                                            *                  if(!mHIDTxIsBusy())                                          C:\fw\picscopefw\x017\hid.c
                                            *                      HIDTxReport(buffer, 3);                                  C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Note:            None                                                         C:\fw\picscopefw\x017\hid.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\hid.c
001b50   cfd9     MOVFF     0xfd9,0xfe6    void HIDTxReport(char *buffer, byte len)                                         C:\fw\picscopefw\x017\hid.c
001b52   ffe6                                                                                                               
001b54   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001b56   ffd9                                                                                                               
001b58   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           {                                                                                C:\fw\picscopefw\x017\hid.c
                                           	byte i;                                                                         C:\fw\picscopefw\x017\hid.c
                                           	                                                                                C:\fw\picscopefw\x017\hid.c
                                               /*                                                                           C:\fw\picscopefw\x017\hid.c
                                                * Value of len should be equal to or smaller than HID_INT_IN_EP_SIZE.       C:\fw\picscopefw\x017\hid.c
                                                * This check forces the value of len to meet the precondition.              C:\fw\picscopefw\x017\hid.c
                                                */                                                                          C:\fw\picscopefw\x017\hid.c
001b5a   0efc     MOVLW     0xfc           	if(len > HID_INT_IN_EP_SIZE)                                                    C:\fw\picscopefw\x017\hid.c
001b5c   50db     MOVF      0xdb,0x0,0x0                                                                                    
001b5e   0840     SUBLW     0x40                                                                                            
001b60   e205     BC        0x1b6c                                                                                          
001b62   0e40     MOVLW     0x40           	    len = HID_INT_IN_EP_SIZE;                                                   C:\fw\picscopefw\x017\hid.c
001b64   6ef3     MOVWF     0xf3,0x0                                                                                        
001b66   0efc     MOVLW     0xfc                                                                                            
001b68   cff3     MOVFF     0xff3,0xfdb                                                                                     
001b6a   ffdb                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                              /*                                                                            C:\fw\picscopefw\x017\hid.c
                                               * Copy data from user's buffer to dual-ram buffer                            C:\fw\picscopefw\x017\hid.c
                                               */                                                                           C:\fw\picscopefw\x017\hid.c
001b6c   6adf     CLRF      0xdf,0x0           for (i = 0; i < len; i++)                                                    C:\fw\picscopefw\x017\hid.c
001b6e   0efc     MOVLW     0xfc                                                                                            
001b70   50db     MOVF      0xdb,0x0,0x0                                                                                    
001b72   5cdf     SUBWF     0xdf,0x0,0x0                                                                                    
001b74   e219     BC        0x1ba8                                                                                          
001ba4   2adf     INCF      0xdf,0x1,0x0                                                                                    
001ba6   d7e3     BRA       0x1b6e                                                                                          
001b76   50df     MOVF      0xdf,0x0,0x0       	hid_report_in[i] = buffer[i];                                               C:\fw\picscopefw\x017\hid.c
001b78   6ee7     MOVWF     0xe7,0x0                                                                                        
001b7a   0efd     MOVLW     0xfd                                                                                            
001b7c   cfdb     MOVFF     0xfdb,0xfe9                                                                                     
001b7e   ffe9                                                                                                               
001b80   0efe     MOVLW     0xfe                                                                                            
001b82   cfdb     MOVFF     0xfdb,0xfea                                                                                     
001b84   ffea                                                                                                               
001b86   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001b88   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001b8a   0e00     MOVLW     0x0                                                                                             
001b8c   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001b8e   50ef     MOVF      0xef,0x0,0x0                                                                                    
001b90   6ee6     MOVWF     0xe6,0x0                                                                                        
001b92   50df     MOVF      0xdf,0x0,0x0                                                                                    
001b94   6aea     CLRF      0xea,0x0                                                                                        
001b96   0f60     ADDLW     0x60                                                                                            
001b98   6ee9     MOVWF     0xe9,0x0                                                                                        
001b9a   0e04     MOVLW     0x4                                                                                             
001b9c   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001b9e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001ba0   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001ba2   6eef     MOVWF     0xef,0x0                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\hid.c
001ba8   0efc     MOVLW     0xfc               HID_BD_IN.Cnt = len;                                                         C:\fw\picscopefw\x017\hid.c
001baa   cfdb     MOVFF     0xfdb,0x40d                                                                                     
001bac   f40d                                                                                                               
001bae   0e40     MOVLW     0x40               mUSBBufferReady(HID_BD_IN);                                                  C:\fw\picscopefw\x017\hid.c
001bb0   0104     MOVLB     0x4                                                                                             
001bb2   170c     ANDWF     0xc,0x1,0x1                                                                                     
001bb4   7d0c     BTG       0xc,0x6,0x1                                                                                     
001bb6   0e88     MOVLW     0x88                                                                                            
001bb8   130c     IORWF     0xc,0x1,0x1                                                                                     
                                                                                                                            C:\fw\picscopefw\x017\hid.c
001bba   52e5     MOVF      0xe5,0x1,0x0   }//end HIDTxReport                                                               C:\fw\picscopefw\x017\hid.c
001bbc   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001bbe   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001bc0   ffd9                                                                                                               
001bc2   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           /******************************************************************************  C:\fw\picscopefw\x017\hid.c
                                            * Function:        byte HIDRxReport(char *buffer, byte len)                     C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * PreCondition:    Value of input argument 'len' should be smaller than the     C:\fw\picscopefw\x017\hid.c
                                            *                  maximum endpoint size responsible for receiving report       C:\fw\picscopefw\x017\hid.c
                                            *                  data from USB host for HID class.                            C:\fw\picscopefw\x017\hid.c
                                            *                  Input argument 'buffer' should point to a buffer area that   C:\fw\picscopefw\x017\hid.c
                                            *                  is bigger or equal to the size specified by 'len'.           C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Input:           buffer  : Pointer to where received bytes are to be stored   C:\fw\picscopefw\x017\hid.c
                                            *                  len     : The number of bytes expected.                      C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Output:          The number of bytes copied to buffer.                        C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Side Effects:    Publicly accessible variable hid_rpt_rx_len is updated       C:\fw\picscopefw\x017\hid.c
                                            *                  with the number of bytes copied to buffer.                   C:\fw\picscopefw\x017\hid.c
                                            *                  Once HIDRxReport is called, subsequent retrieval of          C:\fw\picscopefw\x017\hid.c
                                            *                  hid_rpt_rx_len can be done by calling macro                  C:\fw\picscopefw\x017\hid.c
                                            *                  mHIDGetRptRxLength().                                        C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Overview:        HIDRxReport copies a string of bytes received through        C:\fw\picscopefw\x017\hid.c
                                            *                  USB HID OUT endpoint to a user's specified location.         C:\fw\picscopefw\x017\hid.c
                                            *                  It is a non-blocking function. It does not wait              C:\fw\picscopefw\x017\hid.c
                                            *                  for data if there is no data available. Instead it returns   C:\fw\picscopefw\x017\hid.c
                                            *                  '0' to notify the caller that there is no data available.    C:\fw\picscopefw\x017\hid.c
                                            *                                                                               C:\fw\picscopefw\x017\hid.c
                                            * Note:            If the actual number of bytes received is larger than the    C:\fw\picscopefw\x017\hid.c
                                            *                  number of bytes expected (len), only the expected number     C:\fw\picscopefw\x017\hid.c
                                            *                  of bytes specified will be copied to buffer.                 C:\fw\picscopefw\x017\hid.c
                                            *                  If the actual number of bytes received is smaller than the   C:\fw\picscopefw\x017\hid.c
                                            *                  number of bytes expected (len), only the actual number       C:\fw\picscopefw\x017\hid.c
                                            *                  of bytes received will be copied to buffer.                  C:\fw\picscopefw\x017\hid.c
                                            *****************************************************************************/  C:\fw\picscopefw\x017\hid.c
001bc4   cfd9     MOVFF     0xfd9,0xfe6    byte HIDRxReport(char *buffer, byte len)                                         C:\fw\picscopefw\x017\hid.c
001bc6   ffe6                                                                                                               
001bc8   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001bca   ffd9                                                                                                               
                                           {                                                                                C:\fw\picscopefw\x017\hid.c
001bcc   0100     MOVLB     0x0                hid_rpt_rx_len = 0;                                                          C:\fw\picscopefw\x017\hid.c
001bce   6bff     CLRF      0xff,0x1                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\hid.c
001bd0   0104     MOVLB     0x4                if(!mHIDRxIsBusy())                                                          C:\fw\picscopefw\x017\hid.c
001bd2   bf08     BTFSC     0x8,0x7,0x1                                                                                     
001bd4   d031     BRA       0x1c38                                                                                          
                                               {                                                                            C:\fw\picscopefw\x017\hid.c
                                                   /*                                                                       C:\fw\picscopefw\x017\hid.c
                                                    * Adjust the expected number of bytes to equal                          C:\fw\picscopefw\x017\hid.c
                                                    * the actual number of bytes received.                                  C:\fw\picscopefw\x017\hid.c
                                                    */                                                                      C:\fw\picscopefw\x017\hid.c
001bd6   0efc     MOVLW     0xfc                   if(len > HID_BD_OUT.Cnt)                                                 C:\fw\picscopefw\x017\hid.c
001bd8   cfdb     MOVFF     0xfdb,0x2                                                                                       
001bda   f002                                                                                                               
001bdc   5109     MOVF      0x9,0x0,0x1                                                                                     
001bde   80d8     BSF       0xd8,0x0,0x0                                                                                    
001be0   5402     SUBFWB    0x2,0x0,0x0                                                                                     
001be2   e203     BC        0x1bea                                                                                          
001be4   0efc     MOVLW     0xfc                       len = HID_BD_OUT.Cnt;                                                C:\fw\picscopefw\x017\hid.c
001be6   c409     MOVFF     0x409,0xfdb                                                                                     
001be8   ffdb                                                                                                               
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                                   /*                                                                       C:\fw\picscopefw\x017\hid.c
                                                    * Copy data from dual-ram buffer to user's buffer                       C:\fw\picscopefw\x017\hid.c
                                                    */                                                                      C:\fw\picscopefw\x017\hid.c
001bea   0100     MOVLB     0x0                    for(hid_rpt_rx_len = 0; hid_rpt_rx_len < len; hid_rpt_rx_len++)          C:\fw\picscopefw\x017\hid.c
001bec   6bff     CLRF      0xff,0x1                                                                                        
001bee   0efc     MOVLW     0xfc                                                                                            
001bf0   50db     MOVF      0xdb,0x0,0x0                                                                                    
001bf2   5dff     SUBWF     0xff,0x0,0x1                                                                                    
001bf4   e219     BC        0x1c28                                                                                          
001c24   2bff     INCF      0xff,0x1,0x1                                                                                    
001c26   d7e3     BRA       0x1bee                                                                                          
001bf6   51ff     MOVF      0xff,0x0,0x1               buffer[hid_rpt_rx_len] = hid_report_out[hid_rpt_rx_len];             C:\fw\picscopefw\x017\hid.c
001bf8   6aea     CLRF      0xea,0x0                                                                                        
001bfa   0f58     ADDLW     0x58                                                                                            
001bfc   6ee9     MOVWF     0xe9,0x0                                                                                        
001bfe   0e04     MOVLW     0x4                                                                                             
001c00   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001c02   50ef     MOVF      0xef,0x0,0x0                                                                                    
001c04   6ee6     MOVWF     0xe6,0x0                                                                                        
001c06   51ff     MOVF      0xff,0x0,0x1                                                                                    
001c08   6ee7     MOVWF     0xe7,0x0                                                                                        
001c0a   0efd     MOVLW     0xfd                                                                                            
001c0c   cfdb     MOVFF     0xfdb,0xfe9                                                                                     
001c0e   ffe9                                                                                                               
001c10   0efe     MOVLW     0xfe                                                                                            
001c12   cfdb     MOVFF     0xfdb,0xfea                                                                                     
001c14   ffea                                                                                                               
001c16   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001c18   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001c1a   0e00     MOVLW     0x0                                                                                             
001c1c   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001c1e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001c20   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001c22   6eef     MOVWF     0xef,0x0                                                                                        
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                                   /*                                                                       C:\fw\picscopefw\x017\hid.c
                                                    * Prepare dual-ram buffer for next OUT transaction                      C:\fw\picscopefw\x017\hid.c
                                                    */                                                                      C:\fw\picscopefw\x017\hid.c
001c28   0104     MOVLB     0x4                    HID_BD_OUT.Cnt = sizeof(hid_report_out);                                 C:\fw\picscopefw\x017\hid.c
001c2a   0e08     MOVLW     0x8                                                                                             
001c2c   6f09     MOVWF     0x9,0x1                                                                                         
001c2e   0e40     MOVLW     0x40                   mUSBBufferReady(HID_BD_OUT);                                             C:\fw\picscopefw\x017\hid.c
001c30   1708     ANDWF     0x8,0x1,0x1                                                                                     
001c32   7d08     BTG       0x8,0x6,0x1                                                                                     
001c34   0e88     MOVLW     0x88                                                                                            
001c36   1308     IORWF     0x8,0x1,0x1                                                                                     
                                               }//end if                                                                    C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
001c38   0100     MOVLB     0x0                return hid_rpt_rx_len;                                                       C:\fw\picscopefw\x017\hid.c
001c3a   51ff     MOVF      0xff,0x0,0x1                                                                                    
001c3c   d000     BRA       0x1c3e                                                                                          
                                                                                                                            C:\fw\picscopefw\x017\hid.c
001c3e   52e5     MOVF      0xe5,0x1,0x0   }//end HIDRxReport                                                               C:\fw\picscopefw\x017\hid.c
001c40   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001c42   ffd9                                                                                                               
001c44   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           #endif //def USB_USE_HID                                                         C:\fw\picscopefw\x017\hid.c
                                                                                                                            C:\fw\picscopefw\x017\hid.c
                                           /** EOF hid.c ***************************************************************/   C:\fw\picscopefw\x017\hid.c
                                           #include	"c_system.h"                                                            C:\fw\picscopefw\x017\ram_def.c
                                                                                                                            C:\fw\picscopefw\x017\ram_def.c
                                           //global ram                                                                     C:\fw\picscopefw\x017\ram_def.c
                                                                                                                            C:\fw\picscopefw\x017\ram_def.c
                                           #pragma udata RamData                                                            C:\fw\picscopefw\x017\ram_def.c
                                                                                                                            C:\fw\picscopefw\x017\ram_def.c
                                                                                                                            C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char Sample;                                                            C:\fw\picscopefw\x017\ram_def.c
                                           TwoBytes SampleData;                                                             C:\fw\picscopefw\x017\ram_def.c
                                           TwoBytes DataBuffer[220];                                                        C:\fw\picscopefw\x017\ram_def.c
                                                                                                                            C:\fw\picscopefw\x017\ram_def.c
                                                                                                                            C:\fw\picscopefw\x017\ram_def.c
                                           //----------------------------USB stuff----------------------------------        C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char TxBufPtr;                                                          C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char TxBufOutPtr;                                                       C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char CmdLength;                                                         C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char RxBufPtr;                                                          C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char StringPtr;                                                         C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char StringPtr_H;                                                       C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char StringChksum;                                                      C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char ResponseType;                                                      C:\fw\picscopefw\x017\ram_def.c
                                           BitField	CommFlags1;                                                             C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char USBDataPointer;                                                    C:\fw\picscopefw\x017\ram_def.c
                                           TwoBytes NVRCommAddr;                                                            C:\fw\picscopefw\x017\ram_def.c
                                           TwoBytes RAMCommAddr;                                                            C:\fw\picscopefw\x017\ram_def.c
                                           TwoBytes ROMCommAddr;                                                            C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char USBEP0DataInBuffer[8];                                             C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char	RxBuffer[9];                                                       C:\fw\picscopefw\x017\ram_def.c
                                           unsigned char	TxBuffer[64];                                                      C:\fw\picscopefw\x017\ram_def.c
                                                   LIST P=18F4550                                                           C:\MCC18\SRC\TRADIT~1\PROC\p18f4550.asm
                                                   LIST                                                                     C:\MCC18\SRC\TRADIT~1\PROC\p18f4550.asm
                                                   END                                                                      C:\MCC18\SRC\TRADIT~1\PROC\p18f4550.asm
                                           ;	RCS Header $Id: cmath18.asm,v 1.4 2004/10/01 19:13:22 GrosbaJ Exp $            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;       CMATH18 DATA DEFINITION FILE                                             C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;******************************************************************************* C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;   VARIABLE ALLOCATION - Core math library routines                             C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;******************************************************************************* C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           MATH_DATA      UDATA_ACS                                                         C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           SIGN		RES 1       ; save location for sign in MSB                                C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           FPFLAGSbits                                                                      C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           FPFLAGS		RES 1       ; floating point library exception flags                    C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                   GLOBAL  SIGN, FPFLAGS, FPFLAGSbits                                       C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           	                                                                                C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                   END                                                                      C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
