MP2COD 4.03, COFF to COD File Converter
Copyright (c) 2006 Microchip Technology Inc.
Listing File Generated: Fri Apr 06 15:07:29 2007


Address  Value    Disassembly              Source                                                                           File
-------  -------  -----------------------  -------------------------------------------------------------------------------  -----
                                           //############################################################################## C:\fw\midicontroller\x001x\main.c
                                           //	Test code                                                                     C:\fw\midicontroller\x001x\main.c
                                           //############################################################################## C:\fw\midicontroller\x001x\main.c
                                           //------------------------------------------------------------------------------ C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           #include "c_compiler.h"                                                          C:\fw\midicontroller\x001x\main.c
                                           #include "p18f4455.h"                                                            C:\fw\midicontroller\x001x\main.c
                                           #include "c_cnstdef.h"                                                           C:\fw\midicontroller\x001x\main.c
                                           #include "c_ramdef.h"                                                            C:\fw\midicontroller\x001x\main.c
                                           #include "c_portdef.h"                                                           C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           #include "usb.h"                                                                 C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           /*                                                                               C:\fw\midicontroller\x001x\main.c
                                           //300000                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG USBDIV=2, CPUDIV=OSC3_PLL4, PLLDIV=1                              C:\fw\midicontroller\x001x\main.c
                                           //300001                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG FOSC=HSPLL_HS, FCMEM=OFF, IESO=OFF                                C:\fw\midicontroller\x001x\main.c
                                           //300002                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG VREGEN=ON, PWRT=ON, BOR=ON, BORV=2		//2 = 2.7V..                  C:\fw\midicontroller\x001x\main.c
                                           //300003                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG WDT=OFF, WDTPS=128                                                C:\fw\midicontroller\x001x\main.c
                                           //300005                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG CCP2MX=ON, PBADEN=OFF, LPT1OSC=OFF, MCLRE=ON                      C:\fw\midicontroller\x001x\main.c
                                           //300006                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG STVREN=ON, LVP=OFF, ICPRT=OFF, XINST=OFF, DEBUG=OFF               C:\fw\midicontroller\x001x\main.c
                                           //300008                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG CP0=OFF, CP1=OFF, CP2=OFF                                         C:\fw\midicontroller\x001x\main.c
                                           //300009                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG CPB=OFF, CPD=OFF                                                  C:\fw\midicontroller\x001x\main.c
                                           //30000A                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG WRT0=OFF, WRT1=OFF, WRT2=OFF                                      C:\fw\midicontroller\x001x\main.c
                                           //30000B                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG WRTC=OFF, WRTB=OFF, WRTD=OFF                                      C:\fw\midicontroller\x001x\main.c
                                           //30000C                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG EBTR0=OFF, EBTR1=OFF, EBTR2=OFF                                   C:\fw\midicontroller\x001x\main.c
                                           //30000D                                                                         C:\fw\midicontroller\x001x\main.c
                                           #pragma CONFIG EBTRB=OFF                                                         C:\fw\midicontroller\x001x\main.c
                                           */                                                                               C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           unsigned char	ADC_CONVERSION(unsigned char Channel);                             C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           extern unsigned char InputDataPointer;                                           C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           void	ServiceUSB(void);                                                           C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           #define	RX_TRIS_BIT		TRISCbits.TRISC7		// Receive direction bit                  C:\fw\midicontroller\x001x\main.c
                                           #define	TX_TRIS_BIT		TRISCbits.TRISC6		// Transmit direction bit                 C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
001d2e   cfd9     MOVFF     0xfd9,0xfe6    void main() {                                                                    C:\fw\midicontroller\x001x\main.c
001d30   ffe6                                                                                                               
001d32   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001d34   ffd9                                                                                                               
001d36   0e02     MOVLW     0x2                                                                                             
001d38   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           	unsigned char i, test;                                                          C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
001d3a   6a96     CLRF      0x96,0x0       	TRISE = 0x00;		//assert all pins on portd as outputs                            C:\fw\midicontroller\x001x\main.c
001d3c   6a95     CLRF      0x95,0x0       	TRISD = 0x00;		//assert all pins on portd as outputs                            C:\fw\midicontroller\x001x\main.c
001d3e   0ebf     MOVLW     0xbf           	TRISC = 0xBF;                                                                   C:\fw\midicontroller\x001x\main.c
001d40   6e94     MOVWF     0x94,0x0                                                                                        
                                           //	TRISCbits.TRISC6 = false;                                                     C:\fw\midicontroller\x001x\main.c
                                           //	RCSTA = 0x90;                                                                 C:\fw\midicontroller\x001x\main.c
                                           //	TXSTA = 0xA2;		//0x46;                                                        C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           //	SPBRG = 204;                                                                  C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           //	TRISD = 0x00;		//assert all pins on portd as outputs                          C:\fw\midicontroller\x001x\main.c
                                           //Initialize the USART control registers                                         C:\fw\midicontroller\x001x\main.c
001d42   0ea6     MOVLW     0xa6           	TXSTA = 0xA6;			//master,8bit,async,high speed                                  C:\fw\midicontroller\x001x\main.c
001d44   6eac     MOVWF     0xac,0x0                                                                                        
001d46   0e90     MOVLW     0x90           	RCSTA = 0x90;			//enabled,8bit, continuous                                      C:\fw\midicontroller\x001x\main.c
001d48   6eab     MOVWF     0xab,0x0                                                                                        
                                           //	BAUDCONbits.BRG16 = true;                                                     C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           //These constants setup the application's MCU Analog-to-Digital Converter module. C:\fw\midicontroller\x001x\main.c
001d4a   0e40     MOVLW     0x40           	ADCON0	= 0b01000000;		//AN0, off                                                C:\fw\midicontroller\x001x\main.c
001d4c   6ec2     MOVWF     0xc2,0x0                                                                                        
001d4e   0e09     MOVLW     0x9            	ADCON1	= 0b00001001;		//6 analog + 2 digital channels                           C:\fw\midicontroller\x001x\main.c
001d50   6ec1     MOVWF     0xc1,0x0                                                                                        
001d52   0e86     MOVLW     0x86           	ADCON2	= 0b10000110;		//Right justified, 0 TAD(manual), FOSC/32                 C:\fw\midicontroller\x001x\main.c
001d54   6ec0     MOVWF     0xc0,0x0                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
001d56   0e10     MOVLW     0x10           	SPBRG = 16;			//115200 baud                                                     C:\fw\midicontroller\x001x\main.c
001d58   6eaf     MOVWF     0xaf,0x0                                                                                        
001d5a   0e01     MOVLW     0x1            	SPBRGH = 0x01;                                                                  C:\fw\midicontroller\x001x\main.c
001d5c   6eb0     MOVWF     0xb0,0x0                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\main.c
001d5e   0e14     MOVLW     0x14           	mInitializeUSBDriver();                                                         C:\fw\midicontroller\x001x\main.c
001d60   6e6f     MOVWF     0x6f,0x0                                                                                        
001d62   0100     MOVLB     0x0                                                                                             
001d64   6ba1     CLRF      0xa1,0x1                                                                                        
001d66   0100     MOVLB     0x0                                                                                             
001d68   6ba2     CLRF      0xa2,0x1                                                                                        
001d6a   0100     MOVLB     0x0                                                                                             
001d6c   6ba3     CLRF      0xa3,0x1                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\main.c
001df4   d7bc     BRA       0x1d6e         	for(;;) {                                                                       C:\fw\midicontroller\x001x\main.c
001d6e   0e01     MOVLW     0x1            		Sample = ADC_CONVERSION((unsigned char)0x01);		//read channel AN0              C:\fw\midicontroller\x001x\main.c
001d70   6ee6     MOVWF     0xe6,0x0                                                                                        
001d72   d84b     RCALL     0x1e0a                                                                                          
001d74   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001d76   0101     MOVLB     0x1                                                                                             
001d78   6f00     MOVWF     0x0,0x1                                                                                         
001d7a   c100     MOVFF     0x100,0xf8c    		LATD = Sample;                                                                 C:\fw\midicontroller\x001x\main.c
001d7c   ff8c                                                                                                               
                                                                                                                            C:\fw\midicontroller\x001x\main.c
001d7e   0e55     MOVLW     0x55           		LATE = 0x55;                                                                   C:\fw\midicontroller\x001x\main.c
001d80   6e8d     MOVWF     0x8d,0x0                                                                                        
001d82   52de     MOVF      0xde,0x1,0x0   		test = 0xAA;                                                                   C:\fw\midicontroller\x001x\main.c
001d84   0eaa     MOVLW     0xaa                                                                                            
001d86   6edd     MOVWF     0xdd,0x0                                                                                        
001df2   d7ca     BRA       0x1d88         		for (;;) {                                                                     C:\fw\midicontroller\x001x\main.c
001d88   6adf     CLRF      0xdf,0x0       			for(i=0;i<220;i++) {                                                          C:\fw\midicontroller\x001x\main.c
001d8a   50df     MOVF      0xdf,0x0,0x0                                                                                    
001d8c   6e02     MOVWF     0x2,0x0                                                                                         
001d8e   6a03     CLRF      0x3,0x0                                                                                         
001d90   90d8     BCF       0xd8,0x0,0x0                                                                                    
001d92   5003     MOVF      0x3,0x0,0x0                                                                                     
001d94   e604     BN        0x1d9e                                                                                          
001d96   0edc     MOVLW     0xdc                                                                                            
001d98   5c02     SUBWF     0x2,0x0,0x0                                                                                     
001d9a   0e00     MOVLW     0x0                                                                                             
001d9c   5803     SUBWFB    0x3,0x0,0x0                                                                                     
001d9e   e219     BC        0x1dd2                                                                                          
001dce   2adf     INCF      0xdf,0x1,0x0                                                                                    
001dd0   d7dc     BRA       0x1d8a                                                                                          
                                           				//ServiceUSB();                                                              C:\fw\midicontroller\x001x\main.c
001da0   0e01     MOVLW     0x1            				ADC_CONVERSION((unsigned char)0x01);		//read channel AN0                     C:\fw\midicontroller\x001x\main.c
001da2   6ee6     MOVWF     0xe6,0x0                                                                                        
001da4   d832     RCALL     0x1e0a                                                                                          
001da6   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           	                                                                                C:\fw\midicontroller\x001x\main.c
                                           //	adcHI = (char)((adcValue >> 5)& 0x1f);	// 0|0|0|d9|d8|d7|d6|d5                C:\fw\midicontroller\x001x\main.c
                                           //	adcLO = (char)((adcValue & 0x1f)|0x80);	// 1|0|0|d4|d3|d2|d1|d0               C:\fw\midicontroller\x001x\main.c
                                           				//result in ADRESH:ADRESL                                                    C:\fw\midicontroller\x001x\main.c
001da8   cfc3     MOVFF     0xfc3,0x101    				SampleData.s_form = ADRES;                                                   C:\fw\midicontroller\x001x\main.c
001daa   f101                                                                                                               
001dac   cfc4     MOVFF     0xfc4,0x102                                                                                     
001dae   f102                                                                                                               
                                           //				SampleData.b_form.low = (ADRESL&0x1F)|0x80;                                C:\fw\midicontroller\x001x\main.c
                                           	                                                                                C:\fw\midicontroller\x001x\main.c
001db0   6aea     CLRF      0xea,0x0       				DataBuffer[i].s_form = SampleData.s_form;			//store sample in buffer.        C:\fw\midicontroller\x001x\main.c
001db2   34df     RLCF      0xdf,0x0,0x0                                                                                    
001db4   0bfe     ANDLW     0xfe                                                                                            
001db6   36ea     RLCF      0xea,0x1,0x0                                                                                    
001db8   6ee9     MOVWF     0xe9,0x0                                                                                        
001dba   0e03     MOVLW     0x3                                                                                             
001dbc   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001dbe   0e01     MOVLW     0x1                                                                                             
001dc0   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001dc2   c101     MOVFF     0x101,0xfee                                                                                     
001dc4   ffee                                                                                                               
001dc6   c102     MOVFF     0x102,0xfed                                                                                     
001dc8   ffed                                                                                                               
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           				//flicker test leds to indicate sampling rate..                              C:\fw\midicontroller\x001x\main.c
001dca   1c8d     COMF      0x8d,0x0,0x0   				LATE = ~LATE;                                                                C:\fw\midicontroller\x001x\main.c
001dcc   6e8d     MOVWF     0x8d,0x0                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           			}                                                                             C:\fw\midicontroller\x001x\main.c
001dd2   0100     MOVLB     0x0            			InputDataPointer = 0;                                                         C:\fw\midicontroller\x001x\main.c
001dd4   6ba0     CLRF      0xa0,0x1                                                                                        
                                           			do {                                                                          C:\fw\midicontroller\x001x\main.c
001dd6   d831     RCALL     0x1e3a         				ServiceUSB();                                                                C:\fw\midicontroller\x001x\main.c
001dd8   0e01     MOVLW     0x1            				ADC_CONVERSION((unsigned char)0x01);		//This is just to provide a short delay between sets of TX data. C:\fw\midicontroller\x001x\main.c
001dda   6ee6     MOVWF     0xe6,0x0                                                                                        
001ddc   d816     RCALL     0x1e0a                                                                                          
001dde   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001de0   0100     MOVLB     0x0            			} while (InputDataPointer != 255);                                            C:\fw\midicontroller\x001x\main.c
001de2   51a0     MOVF      0xa0,0x0,0x1                                                                                    
001de4   6e02     MOVWF     0x2,0x0                                                                                         
001de6   6a03     CLRF      0x3,0x0                                                                                         
001de8   0eff     MOVLW     0xff                                                                                            
001dea   1802     XORWF     0x2,0x0,0x0                                                                                     
001dec   e101     BNZ       0x1df0                                                                                          
001dee   5003     MOVF      0x3,0x0,0x0                                                                                     
001df0   e1f2     BNZ       0x1dd6                                                                                          
                                           		}                                                                              C:\fw\midicontroller\x001x\main.c
                                           	}                                                                               C:\fw\midicontroller\x001x\main.c
001df6   0e02     MOVLW     0x2            }                                                                                C:\fw\midicontroller\x001x\main.c
001df8   5ce1     SUBWF     0xe1,0x0,0x0                                                                                    
001dfa   e202     BC        0x1e00                                                                                          
001dfc   6ae1     CLRF      0xe1,0x0                                                                                        
001dfe   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001e00   6ee1     MOVWF     0xe1,0x0                                                                                        
001e02   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001e04   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001e06   ffd9                                                                                                               
001e08   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\midicontroller\x001x\main.c
001e0a   cfd9     MOVFF     0xfd9,0xfe6    unsigned char	ADC_CONVERSION(unsigned char Channel) {                            C:\fw\midicontroller\x001x\main.c
001e0c   ffe6                                                                                                               
001e0e   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001e10   ffd9                                                                                                               
001e12   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           	unsigned char tempcntr;                                                         C:\fw\midicontroller\x001x\main.c
001e14   0efe     MOVLW     0xfe           	ADCON0 = Channel;                                                               C:\fw\midicontroller\x001x\main.c
001e16   50db     MOVF      0xdb,0x0,0x0                                                                                    
001e18   6ec2     MOVWF     0xc2,0x0                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           //Wait for the converter's holding capacitor to charge up.                       C:\fw\midicontroller\x001x\main.c
                                           ADC_CHARGING_DELAY_LOOP:                                                         C:\fw\midicontroller\x001x\main.c
001e1a   0e0a     MOVLW     0xa            	for(tempcntr = 10;tempcntr!=0;tempcntr--);                                      C:\fw\midicontroller\x001x\main.c
001e1c   6edf     MOVWF     0xdf,0x0                                                                                        
001e1e   50df     MOVF      0xdf,0x0,0x0                                                                                    
001e20   e002     BZ        0x1e26                                                                                          
001e22   06df     DECF      0xdf,0x1,0x0                                                                                    
001e24   d7fc     BRA       0x1e1e                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           //Start the conversion                                                           C:\fw\midicontroller\x001x\main.c
001e26   82c2     BSF       0xc2,0x1,0x0   	ADCON0bits.GO = true;                                                           C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           //Wait for the conversion to complete, then exit                                 C:\fw\midicontroller\x001x\main.c
                                           ADC_CONVERSION_DELAY:                                                            C:\fw\midicontroller\x001x\main.c
001e28   b2c2     BTFSC     0xc2,0x1,0x0   	for(;ADCON0bits.GO;);                                                           C:\fw\midicontroller\x001x\main.c
001e2a   d7fe     BRA       0x1e28                                                                                          
                                           	                                                                                C:\fw\midicontroller\x001x\main.c
001e2c   50c4     MOVF      0xc4,0x0,0x0   	return ADRESH;                                                                  C:\fw\midicontroller\x001x\main.c
001e2e   d000     BRA       0x1e30                                                                                          
001e30   52e5     MOVF      0xe5,0x1,0x0   }                                                                                C:\fw\midicontroller\x001x\main.c
001e32   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001e34   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001e36   ffd9                                                                                                               
001e38   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                                                                                                            C:\fw\midicontroller\x001x\main.c
                                           void	ServiceUSB(void) {                                                          C:\fw\midicontroller\x001x\main.c
001e3a   ec35     CALL      0x186a,0x0     	USBCheckBusStatus();                    // Must use polling method              C:\fw\midicontroller\x001x\main.c
001e3c   f00c                                                                                                               
001e3e   be6f     BTFSC     0x6f,0x7,0x0       if(UCFGbits.UTEYE!=1) {                                                      C:\fw\midicontroller\x001x\main.c
001e40   d002     BRA       0x1e46                                                                                          
001e42   ec54     CALL      0x18a8,0x0             USBDriverService();                 // Interrupt or polling method       C:\fw\midicontroller\x001x\main.c
001e44   f00c                                                                                                               
                                           	}                                                                               C:\fw\midicontroller\x001x\main.c
001e46   0012     RETURN    0x0            }                                                                                C:\fw\midicontroller\x001x\main.c
                                           /* $Id: c018.c,v 1.2.14.1 2006/01/24 14:50:12 rhinec Exp $ */                    C:\fw\midicontroller\x001x\startup.c
                                                                                                                            C:\fw\midicontroller\x001x\startup.c
                                           /* Copyright (c)1999 Microchip Technology */                                     C:\fw\midicontroller\x001x\startup.c
                                                                                                                            C:\fw\midicontroller\x001x\startup.c
                                           /* MPLAB-C18 startup code */                                                     C:\fw\midicontroller\x001x\startup.c
                                                                                                                            C:\fw\midicontroller\x001x\startup.c
                                           /* external reference to the user's main routine */                              C:\fw\midicontroller\x001x\startup.c
                                           extern void main (void);                                                         C:\fw\midicontroller\x001x\startup.c
                                           /* prototype for the startup function */                                         C:\fw\midicontroller\x001x\startup.c
                                           void _entry (void);                                                              C:\fw\midicontroller\x001x\startup.c
                                           void _startup (void);                                                            C:\fw\midicontroller\x001x\startup.c
                                           extern near char __FPFLAGS;                                                      C:\fw\midicontroller\x001x\startup.c
                                           #define RND 6                                                                    C:\fw\midicontroller\x001x\startup.c
                                                                                                                            C:\fw\midicontroller\x001x\startup.c
                                           #pragma code _entry_scn=0x000A00                                                 C:\fw\midicontroller\x001x\startup.c
                                           void                                                                             C:\fw\midicontroller\x001x\startup.c
                                           _entry (void)                                                                    C:\fw\midicontroller\x001x\startup.c
                                           {                                                                                C:\fw\midicontroller\x001x\startup.c
000a00   efa5     GOTO      0x1f4a         _asm goto _startup _endasm                                                       C:\fw\midicontroller\x001x\startup.c
000a02   f00f                                                                                                               
                                                                                                                            C:\fw\midicontroller\x001x\startup.c
000a04   0012     RETURN    0x0            }                                                                                C:\fw\midicontroller\x001x\startup.c
                                                                                                                            C:\fw\midicontroller\x001x\startup.c
                                           #pragma code _startup_scn                                                        C:\fw\midicontroller\x001x\startup.c
                                           void                                                                             C:\fw\midicontroller\x001x\startup.c
                                           _startup (void)                                                                  C:\fw\midicontroller\x001x\startup.c
                                           {                                                                                C:\fw\midicontroller\x001x\startup.c
                                             _asm                                                                           C:\fw\midicontroller\x001x\startup.c
                                               // Initialize the stack pointer                                              C:\fw\midicontroller\x001x\startup.c
001f4a   ee17     LFSR      0x1,0x700          lfsr 1, _stack                                                               C:\fw\midicontroller\x001x\startup.c
001f4c   f000                                                                                                               
001f4e   ee27     LFSR      0x2,0x700          lfsr 2, _stack                                                               C:\fw\midicontroller\x001x\startup.c
001f50   f000                                                                                                               
                                                                                                                            C:\fw\midicontroller\x001x\startup.c
001f52   6af8     CLRF      0xf8,0x0           clrf TBLPTRU, 0 // 1st silicon doesn't do this on POR                        C:\fw\midicontroller\x001x\startup.c
                                                                                                                            C:\fw\midicontroller\x001x\startup.c
001f54   9c01     BCF       0x1,0x6,0x0        bcf __FPFLAGS,RND,0 // Initalize rounding flag for floating point libs       C:\fw\midicontroller\x001x\startup.c
                                           _endasm loop:                                                                    C:\fw\midicontroller\x001x\startup.c
                                                                                                                            C:\fw\midicontroller\x001x\startup.c
                                             // Call the user's main routine                                                C:\fw\midicontroller\x001x\startup.c
001f56   ec97     CALL      0x1d2e,0x0       main ();                                                                       C:\fw\midicontroller\x001x\startup.c
001f58   f00e                                                                                                               
                                                                                                                            C:\fw\midicontroller\x001x\startup.c
001f5a   d7fd     BRA       0x1f56           goto loop;                                                                     C:\fw\midicontroller\x001x\startup.c
001f5c   0012     RETURN    0x0            }                               /* end _startup() */                             C:\fw\midicontroller\x001x\startup.c
                                           /*********************************************************************           C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *                Microchip USB C18 Firmware Version 1.0                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *********************************************************************           C:\fw\midicontroller\x001x\usb.c
                                            * FileName:        usb9.c                                                       C:\fw\midicontroller\x001x\usb.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\midicontroller\x001x\usb.c
                                            * Processor:       PIC18                                                        C:\fw\midicontroller\x001x\usb.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\midicontroller\x001x\usb.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Software License Agreement                                                    C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\midicontroller\x001x\usb.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             C:\fw\midicontroller\x001x\usb.c
                                            * supplied to you, the Company’s customer, for use solely and                   C:\fw\midicontroller\x001x\usb.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\midicontroller\x001x\usb.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\midicontroller\x001x\usb.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\midicontroller\x001x\usb.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\midicontroller\x001x\usb.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\midicontroller\x001x\usb.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\midicontroller\x001x\usb.c
                                            * license.                                                                      C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             C:\fw\midicontroller\x001x\usb.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\midicontroller\x001x\usb.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\midicontroller\x001x\usb.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\midicontroller\x001x\usb.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\midicontroller\x001x\usb.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Author               Date        Comment                                      C:\fw\midicontroller\x001x\usb.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           C:\fw\midicontroller\x001x\usb.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    C:\fw\midicontroller\x001x\usb.c
                                            ********************************************************************/           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #include "p18f4455.h"                                                            C:\fw\midicontroller\x001x\usb.c
                                           #include "typedefs.h"                                                            C:\fw\midicontroller\x001x\usb.c
                                           #include "usb.h"                                                                 C:\fw\midicontroller\x001x\usb.c
                                           //#include "io_cfg.h"                     // Required for self_power status      C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #pragma udata usb5                                                               C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBStdGetDscHandler(void);                                                  C:\fw\midicontroller\x001x\usb.c
                                           void USBStdSetCfgHandler(void);                                                  C:\fw\midicontroller\x001x\usb.c
                                           void USBStdGetStatusHandler(void);                                               C:\fw\midicontroller\x001x\usb.c
                                           void USBStdFeatureReqHandler(void);                                              C:\fw\midicontroller\x001x\usb.c
                                           void HIDSetReportHandler(void);                                                  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #pragma code                                                                     C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBCheckStdRequest(void)                                C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine checks the setup data packet to see if it       C:\fw\midicontroller\x001x\usb.c
                                            *                  knows how to handle it                                       C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBCheckStdRequest(void)                                                    C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
00128e   0104     MOVLB     0x4                if(SetupPkt.RequestType != STANDARD) return;                                 C:\fw\midicontroller\x001x\usb.c
001290   5110     MOVF      0x10,0x0,0x1                                                                                    
001292   0b60     ANDLW     0x60                                                                                            
001294   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001296   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001298   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00129a   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00129c   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00129e   0900     IORLW     0x0                                                                                             
0012a0   e001     BZ        0x12a4                                                                                          
0012a2   d04f     BRA       0x1342                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
0012a4   5111     MOVF      0x11,0x0,0x1       switch(SetupPkt.bRequest)                                                    C:\fw\midicontroller\x001x\usb.c
0012a6   0a07     XORLW     0x7                                                                                             
0012a8   e04b     BZ        0x1340                                                                                          
0012aa   0a0b     XORLW     0xb                                                                                             
0012ac   e049     BZ        0x1340                                                                                          
0012ae   0a07     XORLW     0x7                                                                                             
0012b0   e03a     BZ        0x1326                                                                                          
0012b2   0a01     XORLW     0x1                                                                                             
0012b4   e028     BZ        0x1306                                                                                          
0012b6   0a0b     XORLW     0xb                                                                                             
0012b8   e024     BZ        0x1302                                                                                          
0012ba   0a02     XORLW     0x2                                                                                             
0012bc   e022     BZ        0x1302                                                                                          
0012be   0a03     XORLW     0x3                                                                                             
0012c0   e01e     BZ        0x12fe                                                                                          
0012c2   0a08     XORLW     0x8                                                                                             
0012c4   e011     BZ        0x12e8                                                                                          
0012c6   0a01     XORLW     0x1                                                                                             
0012c8   e00d     BZ        0x12e4                                                                                          
0012ca   0a0f     XORLW     0xf                                                                                             
0012cc   e009     BZ        0x12e0                                                                                          
0012ce   0a03     XORLW     0x3                                                                                             
0012d0   e001     BZ        0x12d4                                                                                          
0012d2   d036     BRA       0x1340                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   case SET_ADR:                                                            C:\fw\midicontroller\x001x\usb.c
0012d4   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\midicontroller\x001x\usb.c
0012d6   0e01     MOVLW     0x1                                                                                             
0012d8   6fa6     MOVWF     0xa6,0x1                                                                                        
0012da   0e04     MOVLW     0x4                        usb_device_state = ADR_PENDING_STATE;       // Update state only     C:\fw\midicontroller\x001x\usb.c
0012dc   6fa1     MOVWF     0xa1,0x1                                                                                        
                                                       /* See USBCtrlTrfInHandler() in usbctrltrf.c for the next step */    C:\fw\midicontroller\x001x\usb.c
0012de   d031     BRA       0x1342                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                                   case GET_DSC:                                                            C:\fw\midicontroller\x001x\usb.c
0012e0   d831     RCALL     0x1344                     USBStdGetDscHandler();                                               C:\fw\midicontroller\x001x\usb.c
0012e2   d02f     BRA       0x1342                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                                   case SET_CFG:                                                            C:\fw\midicontroller\x001x\usb.c
0012e4   d890     RCALL     0x1406                     USBStdSetCfgHandler();                                               C:\fw\midicontroller\x001x\usb.c
0012e6   d02d     BRA       0x1342                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                                   case GET_CFG:                                                            C:\fw\midicontroller\x001x\usb.c
0012e8   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\midicontroller\x001x\usb.c
0012ea   0e01     MOVLW     0x1                                                                                             
0012ec   6fa6     MOVWF     0xa6,0x1                                                                                        
0012ee   0ea3     MOVLW     0xa3                       pSrc.bRam = (byte*)&usb_active_cfg;         // Set Source            C:\fw\midicontroller\x001x\usb.c
0012f0   6fa7     MOVWF     0xa7,0x1                                                                                        
0012f2   0e00     MOVLW     0x0                                                                                             
0012f4   6fa8     MOVWF     0xa8,0x1                                                                                        
0012f6   93a2     BCF       0xa2,0x1,0x1               usb_stat.ctrl_trf_mem = _RAM;               // Set memory type       C:\fw\midicontroller\x001x\usb.c
0012f8   0e01     MOVLW     0x1                        LSB(wCount) = 1;                            // Set data count        C:\fw\midicontroller\x001x\usb.c
0012fa   6fab     MOVWF     0xab,0x1                                                                                        
0012fc   d022     BRA       0x1342                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                                   case GET_STATUS:                                                         C:\fw\midicontroller\x001x\usb.c
0012fe   d8a9     RCALL     0x1452                     USBStdGetStatusHandler();                                            C:\fw\midicontroller\x001x\usb.c
001300   d020     BRA       0x1342                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                                   case CLR_FEATURE:                                                        C:\fw\midicontroller\x001x\usb.c
                                                   case SET_FEATURE:                                                        C:\fw\midicontroller\x001x\usb.c
001302   d8f1     RCALL     0x14e6                     USBStdFeatureReqHandler();                                           C:\fw\midicontroller\x001x\usb.c
001304   d01e     BRA       0x1342                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                                   case GET_INTF:                                                           C:\fw\midicontroller\x001x\usb.c
001306   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\midicontroller\x001x\usb.c
001308   0e01     MOVLW     0x1                                                                                             
00130a   6fa6     MOVWF     0xa6,0x1                                                                                        
00130c   0104     MOVLB     0x4                        pSrc.bRam = (byte*)&usb_alt_intf+SetupPkt.bIntfID;  // Set source    C:\fw\midicontroller\x001x\usb.c
00130e   5114     MOVF      0x14,0x0,0x1                                                                                    
001310   0100     MOVLB     0x0                                                                                             
001312   6fa7     MOVWF     0xa7,0x1                                                                                        
001314   6ba8     CLRF      0xa8,0x1                                                                                        
001316   0ea4     MOVLW     0xa4                                                                                            
001318   27a7     ADDWF     0xa7,0x1,0x1                                                                                    
00131a   0e00     MOVLW     0x0                                                                                             
00131c   23a8     ADDWFC    0xa8,0x1,0x1                                                                                    
00131e   93a2     BCF       0xa2,0x1,0x1               usb_stat.ctrl_trf_mem = _RAM;               // Set memory type       C:\fw\midicontroller\x001x\usb.c
001320   0e01     MOVLW     0x1                        LSB(wCount) = 1;                            // Set data count        C:\fw\midicontroller\x001x\usb.c
001322   6fab     MOVWF     0xab,0x1                                                                                        
001324   d00e     BRA       0x1342                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                                   case SET_INTF:                                                           C:\fw\midicontroller\x001x\usb.c
001326   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\midicontroller\x001x\usb.c
001328   0e01     MOVLW     0x1                                                                                             
00132a   6fa6     MOVWF     0xa6,0x1                                                                                        
00132c   0104     MOVLB     0x4                        usb_alt_intf[SetupPkt.bIntfID] = SetupPkt.bAltID;                    C:\fw\midicontroller\x001x\usb.c
00132e   5114     MOVF      0x14,0x0,0x1                                                                                    
001330   6aea     CLRF      0xea,0x0                                                                                        
001332   0fa4     ADDLW     0xa4                                                                                            
001334   6ee9     MOVWF     0xe9,0x0                                                                                        
001336   0e00     MOVLW     0x0                                                                                             
001338   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
00133a   c412     MOVFF     0x412,0xfef                                                                                     
00133c   ffef                                                                                                               
00133e   d001     BRA       0x1342                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                                   case SET_DSC:                                                            C:\fw\midicontroller\x001x\usb.c
                                                   case SYNCH_FRAME:                                                        C:\fw\midicontroller\x001x\usb.c
                                                   default:                                                                 C:\fw\midicontroller\x001x\usb.c
001340   d000     BRA       0x1342                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                               }//end switch                                                                C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001342   0012     RETURN    0x0            }//end USBCheckStdRequest                                                        C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBStdGetDscHandler(void)                               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine handles the standard GET_DESCRIPTOR request.    C:\fw\midicontroller\x001x\usb.c
                                            *                  It utilizes tables dynamically looks up descriptor size.     C:\fw\midicontroller\x001x\usb.c
                                            *                  This routine should never have to be modified if the tables  C:\fw\midicontroller\x001x\usb.c
                                            *                  in usbdsc.c are declared correctly.                          C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBStdGetDscHandler(void)                                                   C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
001344   0e80     MOVLW     0x80               if(SetupPkt.bmRequestType == 0x80)                                           C:\fw\midicontroller\x001x\usb.c
001346   0104     MOVLB     0x4                                                                                             
001348   5d10     SUBWF     0x10,0x0,0x1                                                                                    
00134a   e15c     BNZ       0x1404                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
00134c   5113     MOVF      0x13,0x0,0x1           switch(SetupPkt.bDscType)                                                C:\fw\midicontroller\x001x\usb.c
00134e   0a03     XORLW     0x3                                                                                             
001350   e032     BZ        0x13b6                                                                                          
001352   0a01     XORLW     0x1                                                                                             
001354   e00e     BZ        0x1372                                                                                          
001356   0a03     XORLW     0x3                                                                                             
001358   e001     BZ        0x135c                                                                                          
00135a   d04b     BRA       0x13f2                                                                                          
                                                   {                                                                        C:\fw\midicontroller\x001x\usb.c
                                                       case DSC_DEV:                                                        C:\fw\midicontroller\x001x\usb.c
00135c   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_USB9;                              C:\fw\midicontroller\x001x\usb.c
00135e   0e01     MOVLW     0x1                                                                                             
001360   6fa6     MOVWF     0xa6,0x1                                                                                        
001362   0e10     MOVLW     0x10                           pSrc.bRom = (rom byte*)&device_dsc;                              C:\fw\midicontroller\x001x\usb.c
001364   6fa7     MOVWF     0xa7,0x1                                                                                        
001366   0e1c     MOVLW     0x1c                                                                                            
001368   6fa8     MOVWF     0xa8,0x1                                                                                        
00136a   0e12     MOVLW     0x12                           wCount._word = sizeof(device_dsc);          // Set data count    C:\fw\midicontroller\x001x\usb.c
00136c   6fab     MOVWF     0xab,0x1                                                                                        
00136e   6bac     CLRF      0xac,0x1                                                                                        
001370   d040     BRA       0x13f2                         break;                                                           C:\fw\midicontroller\x001x\usb.c
                                                       case DSC_CFG:                                                        C:\fw\midicontroller\x001x\usb.c
001372   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_USB9;                              C:\fw\midicontroller\x001x\usb.c
001374   0e01     MOVLW     0x1                                                                                             
001376   6fa6     MOVWF     0xa6,0x1                                                                                        
001378   0104     MOVLB     0x4                            pSrc.bRom = *(USB_CD_Ptr+SetupPkt.bDscIndex);                    C:\fw\midicontroller\x001x\usb.c
00137a   5112     MOVF      0x12,0x0,0x1                                                                                    
00137c   6ef6     MOVWF     0xf6,0x0                                                                                        
00137e   6af7     CLRF      0xf7,0x0                                                                                        
001380   90d8     BCF       0xd8,0x0,0x0                                                                                    
001382   36f6     RLCF      0xf6,0x1,0x0                                                                                    
001384   36f7     RLCF      0xf7,0x1,0x0                                                                                    
001386   0e1d     MOVLW     0x1d                                                                                            
001388   26f6     ADDWF     0xf6,0x1,0x0                                                                                    
00138a   0e1d     MOVLW     0x1d                                                                                            
00138c   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
00138e   0009     TBLRDPOSTINC                                                                                              
001390   cff5     MOVFF     0xff5,0xa7                                                                                      
001392   f0a7                                                                                                               
001394   000a     TBLRDPOSTDEC                                                                                              
001396   cff5     MOVFF     0xff5,0xa8                                                                                      
001398   f0a8                                                                                                               
00139a   0e02     MOVLW     0x2                            wCount._word = *(pSrc.wRom+1);              // Set data count    C:\fw\midicontroller\x001x\usb.c
00139c   0100     MOVLB     0x0                                                                                             
00139e   6af7     CLRF      0xf7,0x0                                                                                        
0013a0   25a7     ADDWF     0xa7,0x0,0x1                                                                                    
0013a2   6ef6     MOVWF     0xf6,0x0                                                                                        
0013a4   51a8     MOVF      0xa8,0x0,0x1                                                                                    
0013a6   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
0013a8   0009     TBLRDPOSTINC                                                                                              
0013aa   cff5     MOVFF     0xff5,0xab                                                                                      
0013ac   f0ab                                                                                                               
0013ae   000a     TBLRDPOSTDEC                                                                                              
0013b0   cff5     MOVFF     0xff5,0xac                                                                                      
0013b2   f0ac                                                                                                               
0013b4   d01e     BRA       0x13f2                         break;                                                           C:\fw\midicontroller\x001x\usb.c
                                                       case DSC_STR:                                                        C:\fw\midicontroller\x001x\usb.c
0013b6   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_USB9;                              C:\fw\midicontroller\x001x\usb.c
0013b8   0e01     MOVLW     0x1                                                                                             
0013ba   6fa6     MOVWF     0xa6,0x1                                                                                        
0013bc   0104     MOVLB     0x4            				pSrc.bRom = *(USB_SD_Ptr+SetupPkt.bDscIndex);                                C:\fw\midicontroller\x001x\usb.c
0013be   5112     MOVF      0x12,0x0,0x1                                                                                    
0013c0   6ef6     MOVWF     0xf6,0x0                                                                                        
0013c2   6af7     CLRF      0xf7,0x0                                                                                        
0013c4   90d8     BCF       0xd8,0x0,0x0                                                                                    
0013c6   36f6     RLCF      0xf6,0x1,0x0                                                                                    
0013c8   36f7     RLCF      0xf7,0x1,0x0                                                                                    
0013ca   0e21     MOVLW     0x21                                                                                            
0013cc   26f6     ADDWF     0xf6,0x1,0x0                                                                                    
0013ce   0e1d     MOVLW     0x1d                                                                                            
0013d0   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
0013d2   0009     TBLRDPOSTINC                                                                                              
0013d4   cff5     MOVFF     0xff5,0xa7                                                                                      
0013d6   f0a7                                                                                                               
0013d8   000a     TBLRDPOSTDEC                                                                                              
0013da   cff5     MOVFF     0xff5,0xa8                                                                                      
0013dc   f0a8                                                                                                               
0013de   c0a7     MOVFF     0xa7,0xff6     				wCount._word = *pSrc.bRom;                  // Set data count                C:\fw\midicontroller\x001x\usb.c
0013e0   fff6                                                                                                               
0013e2   c0a8     MOVFF     0xa8,0xff7                                                                                      
0013e4   fff7                                                                                                               
0013e6   0008     TBLRD                                                                                                     
0013e8   50f5     MOVF      0xf5,0x0,0x0                                                                                    
0013ea   0100     MOVLB     0x0                                                                                             
0013ec   6fab     MOVWF     0xab,0x1                                                                                        
0013ee   6bac     CLRF      0xac,0x1                                                                                        
0013f0   d000     BRA       0x13f2                         break;                                                           C:\fw\midicontroller\x001x\usb.c
                                                   }//end switch                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
0013f2   0e02     MOVLW     0x2            		if (SetupPkt.bDscIndex != INDEX_NAME && SetupPkt.bDscIndex != INDEX_SERIALNUM) { //handle as NVR (or ram) read C:\fw\midicontroller\x001x\usb.c
0013f4   0104     MOVLB     0x4                                                                                             
0013f6   5d12     SUBWF     0x12,0x0,0x1                                                                                    
0013f8   e005     BZ        0x1404                                                                                          
0013fa   0e03     MOVLW     0x3                                                                                             
0013fc   5d12     SUBWF     0x12,0x0,0x1                                                                                    
0013fe   e002     BZ        0x1404                                                                                          
001400   0100     MOVLB     0x0                    	usb_stat.ctrl_trf_mem = _ROM;                       // Set memory type  C:\fw\midicontroller\x001x\usb.c
001402   83a2     BSF       0xa2,0x1,0x1                                                                                    
                                                   }                                                                        C:\fw\midicontroller\x001x\usb.c
                                               }//end if                                                                    C:\fw\midicontroller\x001x\usb.c
001404   0012     RETURN    0x0            }//end USBStdGetDscHandler                                                       C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBStdSetCfgHandler(void)                               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine first disables all endpoints by clearing        C:\fw\midicontroller\x001x\usb.c
                                            *                  UEP registers. It then configures (initializes) endpoints    C:\fw\midicontroller\x001x\usb.c
                                            *                  specified in the modifiable section.                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBStdSetCfgHandler(void)                                                   C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
001406   0100     MOVLB     0x0                ctrl_trf_session_owner = MUID_USB9;                                          C:\fw\midicontroller\x001x\usb.c
001408   0e01     MOVLW     0x1                                                                                             
00140a   6fa6     MOVWF     0xa6,0x1                                                                                        
00140c   0e0f     MOVLW     0xf                mDisableEP1to15();                          // See usbdrv.h                  C:\fw\midicontroller\x001x\usb.c
00140e   6ee6     MOVWF     0xe6,0x0                                                                                        
001410   0e71     MOVLW     0x71                                                                                            
001412   6ee6     MOVWF     0xe6,0x0                                                                                        
001414   0e0f     MOVLW     0xf                                                                                             
001416   6ee6     MOVWF     0xe6,0x0                                                                                        
001418   dac9     RCALL     0x19ac                                                                                          
00141a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00141c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00141e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001420   0e01     MOVLW     0x1                ClearArray((byte*)&usb_alt_intf,MAX_NUM_INT);                                C:\fw\midicontroller\x001x\usb.c
001422   6ee6     MOVWF     0xe6,0x0                                                                                        
001424   0ea4     MOVLW     0xa4                                                                                            
001426   6ee6     MOVWF     0xe6,0x0                                                                                        
001428   0e00     MOVLW     0x0                                                                                             
00142a   6ee6     MOVWF     0xe6,0x0                                                                                        
00142c   dabf     RCALL     0x19ac                                                                                          
00142e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001430   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001432   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001434   c412     MOVFF     0x412,0xa3         usb_active_cfg = SetupPkt.bCfgValue;                                         C:\fw\midicontroller\x001x\usb.c
001436   f0a3                                                                                                               
001438   0104     MOVLB     0x4                if(SetupPkt.bCfgValue == 0)                                                  C:\fw\midicontroller\x001x\usb.c
00143a   5112     MOVF      0x12,0x0,0x1                                                                                    
00143c   e104     BNZ       0x1446                                                                                          
00143e   0100     MOVLB     0x0                    usb_device_state = ADDRESS_STATE;                                        C:\fw\midicontroller\x001x\usb.c
001440   0e05     MOVLW     0x5                                                                                             
001442   6fa1     MOVWF     0xa1,0x1                                                                                        
001444   d005     BRA       0x1450             else                                                                         C:\fw\midicontroller\x001x\usb.c
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
001446   0100     MOVLB     0x0                    usb_device_state = CONFIGURED_STATE;                                     C:\fw\midicontroller\x001x\usb.c
001448   0e06     MOVLW     0x6                                                                                             
00144a   6fa1     MOVWF     0xa1,0x1                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   /* Modifiable Section */                                                 C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   #if defined(USB_USE_HID)                // See autofiles\usbcfg.h        C:\fw\midicontroller\x001x\usb.c
00144c   ec78     CALL      0x1af0,0x0             HIDInitEP();                                                             C:\fw\midicontroller\x001x\usb.c
00144e   f00d                                                                                                               
                                                   #endif                                                                   C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   /* End modifiable section */                                             C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               }//end if(SetupPkt.bcfgValue == 0)                                           C:\fw\midicontroller\x001x\usb.c
001450   0012     RETURN    0x0            }//end USBStdSetCfgHandler                                                       C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBStdGetStatusHandler(void)                            C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine handles the standard GET_STATUS request         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBStdGetStatusHandler(void)                                                C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
001452   0104     MOVLB     0x4                CtrlTrfData._byte0 = 0;                         // Initialize content        C:\fw\midicontroller\x001x\usb.c
001454   6b18     CLRF      0x18,0x1                                                                                        
001456   6b19     CLRF      0x19,0x1           CtrlTrfData._byte1 = 0;                                                      C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001458   5110     MOVF      0x10,0x0,0x1       switch(SetupPkt.Recipient)                                                   C:\fw\midicontroller\x001x\usb.c
00145a   0b1f     ANDLW     0x1f                                                                                            
00145c   0a02     XORLW     0x2                                                                                             
00145e   e014     BZ        0x1488                                                                                          
001460   0a03     XORLW     0x3                                                                                             
001462   e00e     BZ        0x1480                                                                                          
001464   0a01     XORLW     0x1                                                                                             
001466   e001     BZ        0x146a                                                                                          
001468   d033     BRA       0x14d0                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   case RCPT_DEV:                                                           C:\fw\midicontroller\x001x\usb.c
00146a   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\midicontroller\x001x\usb.c
00146c   0e01     MOVLW     0x1                                                                                             
00146e   6fa6     MOVWF     0xa6,0x1                                                                                        
                                                       /*                                                                   C:\fw\midicontroller\x001x\usb.c
                                                        * _byte0: bit0: Self-Powered Status [0] Bus-Powered [1] Self-Powered C:\fw\midicontroller\x001x\usb.c
                                                        *         bit1: RemoteWakeup        [0] Disabled    [1] Enabled     C:\fw\midicontroller\x001x\usb.c
                                                        */                                                                  C:\fw\midicontroller\x001x\usb.c
                                                       if(self_power == 1)                     // self_power defined in io_cfg.h C:\fw\midicontroller\x001x\usb.c
001470   0104     MOVLB     0x4                            CtrlTrfData._byte0|=0b000000001;    // Set bit0                  C:\fw\midicontroller\x001x\usb.c
001472   8118     BSF       0x18,0x0,0x1                                                                                    
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001474   0100     MOVLB     0x0                        if(usb_stat.RemoteWakeup == 1)          // usb_stat defined in usbmmap.c C:\fw\midicontroller\x001x\usb.c
001476   a1a2     BTFSS     0xa2,0x0,0x1                                                                                    
001478   d002     BRA       0x147e                                                                                          
00147a   0104     MOVLB     0x4                            CtrlTrfData._byte0|=0b00000010;     // Set bit1                  C:\fw\midicontroller\x001x\usb.c
00147c   8318     BSF       0x18,0x1,0x1                                                                                    
00147e   d028     BRA       0x14d0                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                                   case RCPT_INTF:                                                          C:\fw\midicontroller\x001x\usb.c
001480   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;     // No data to update         C:\fw\midicontroller\x001x\usb.c
001482   0e01     MOVLW     0x1                                                                                             
001484   6fa6     MOVWF     0xa6,0x1                                                                                        
001486   d024     BRA       0x14d0                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                                   case RCPT_EP:                                                            C:\fw\midicontroller\x001x\usb.c
001488   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  C:\fw\midicontroller\x001x\usb.c
00148a   0e01     MOVLW     0x1                                                                                             
00148c   6fa6     MOVWF     0xa6,0x1                                                                                        
                                                       /*                                                                   C:\fw\midicontroller\x001x\usb.c
                                                        * _byte0: bit0: Halt Status [0] Not Halted [1] Halted               C:\fw\midicontroller\x001x\usb.c
                                                        */                                                                  C:\fw\midicontroller\x001x\usb.c
00148e   0104     MOVLB     0x4                        pDst.bRam = (byte*)&ep0Bo+(SetupPkt.EPNum*8)+(SetupPkt.EPDir*4);     C:\fw\midicontroller\x001x\usb.c
001490   5114     MOVF      0x14,0x0,0x1                                                                                    
001492   0b0f     ANDLW     0xf                                                                                             
001494   0d08     MULLW     0x8                                                                                             
001496   50f3     MOVF      0xf3,0x0,0x0                                                                                    
001498   6a03     CLRF      0x3,0x0                                                                                         
00149a   0f00     ADDLW     0x0                                                                                             
00149c   6e02     MOVWF     0x2,0x0                                                                                         
00149e   0e04     MOVLW     0x4                                                                                             
0014a0   2203     ADDWFC    0x3,0x1,0x0                                                                                     
0014a2   5114     MOVF      0x14,0x0,0x1                                                                                    
0014a4   0b80     ANDLW     0x80                                                                                            
0014a6   e001     BZ        0x14aa                                                                                          
0014a8   0e01     MOVLW     0x1                                                                                             
0014aa   0d04     MULLW     0x4                                                                                             
0014ac   50f3     MOVF      0xf3,0x0,0x0                                                                                    
0014ae   0100     MOVLB     0x0                                                                                             
0014b0   2402     ADDWF     0x2,0x0,0x0                                                                                     
0014b2   6fa9     MOVWF     0xa9,0x1                                                                                        
0014b4   0e00     MOVLW     0x0                                                                                             
0014b6   2003     ADDWFC    0x3,0x0,0x0                                                                                     
0014b8   6faa     MOVWF     0xaa,0x1                                                                                        
0014ba   c0a9     MOVFF     0xa9,0xfe9                 if(*pDst.bRam & _BSTALL)    // Use _BSTALL as a bit mask             C:\fw\midicontroller\x001x\usb.c
0014bc   ffe9                                                                                                               
0014be   c0aa     MOVFF     0xaa,0xfea                                                                                      
0014c0   ffea                                                                                                               
0014c2   50ef     MOVF      0xef,0x0,0x0                                                                                    
0014c4   0b04     ANDLW     0x4                                                                                             
0014c6   e003     BZ        0x14ce                                                                                          
0014c8   0104     MOVLB     0x4                            CtrlTrfData._byte0=0x01;// Set bit0                              C:\fw\midicontroller\x001x\usb.c
0014ca   0e01     MOVLW     0x1                                                                                             
0014cc   6f18     MOVWF     0x18,0x1                                                                                        
0014ce   d000     BRA       0x14d0                     break;                                                               C:\fw\midicontroller\x001x\usb.c
                                               }//end switch                                                                C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
0014d0   0100     MOVLB     0x0                if(ctrl_trf_session_owner == MUID_USB9)                                      C:\fw\midicontroller\x001x\usb.c
0014d2   05a6     DECF      0xa6,0x0,0x1                                                                                    
0014d4   e107     BNZ       0x14e4                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
0014d6   0e18     MOVLW     0x18                   pSrc.bRam = (byte*)&CtrlTrfData;            // Set Source                C:\fw\midicontroller\x001x\usb.c
0014d8   6fa7     MOVWF     0xa7,0x1                                                                                        
0014da   0e04     MOVLW     0x4                                                                                             
0014dc   6fa8     MOVWF     0xa8,0x1                                                                                        
0014de   93a2     BCF       0xa2,0x1,0x1           usb_stat.ctrl_trf_mem = _RAM;               // Set memory type           C:\fw\midicontroller\x001x\usb.c
0014e0   0e02     MOVLW     0x2                    LSB(wCount) = 2;                            // Set data count            C:\fw\midicontroller\x001x\usb.c
0014e2   6fab     MOVWF     0xab,0x1                                                                                        
                                               }//end if(...)                                                               C:\fw\midicontroller\x001x\usb.c
0014e4   0012     RETURN    0x0            }//end USBStdGetStatusHandler                                                    C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBStdFeatureReqHandler(void)                           C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine handles the standard SET & CLEAR FEATURES       C:\fw\midicontroller\x001x\usb.c
                                            *                  requests                                                     C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBStdFeatureReqHandler(void)                                               C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
0014e6   0104     MOVLB     0x4                if((SetupPkt.bFeature == DEVICE_REMOTE_WAKEUP)&&                             C:\fw\midicontroller\x001x\usb.c
0014e8   0512     DECF      0x12,0x0,0x1                                                                                    
0014ea   e110     BNZ       0x150c                (SetupPkt.Recipient == RCPT_DEV))                                         C:\fw\midicontroller\x001x\usb.c
0014ec   5110     MOVF      0x10,0x0,0x1                                                                                    
0014ee   0b1f     ANDLW     0x1f                                                                                            
0014f0   0900     IORLW     0x0                                                                                             
0014f2   e10c     BNZ       0x150c                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
0014f4   0100     MOVLB     0x0                    ctrl_trf_session_owner = MUID_USB9;                                      C:\fw\midicontroller\x001x\usb.c
0014f6   0e01     MOVLW     0x1                                                                                             
0014f8   6fa6     MOVWF     0xa6,0x1                                                                                        
0014fa   0e03     MOVLW     0x3                    if(SetupPkt.bRequest == SET_FEATURE)                                     C:\fw\midicontroller\x001x\usb.c
0014fc   0104     MOVLB     0x4                                                                                             
0014fe   5d11     SUBWF     0x11,0x0,0x1                                                                                    
001500   e103     BNZ       0x1508                                                                                          
001502   0100     MOVLB     0x0                        usb_stat.RemoteWakeup = 1;                                           C:\fw\midicontroller\x001x\usb.c
001504   81a2     BSF       0xa2,0x0,0x1                                                                                    
001506   d002     BRA       0x150c                 else                                                                     C:\fw\midicontroller\x001x\usb.c
001508   0100     MOVLB     0x0                        usb_stat.RemoteWakeup = 0;                                           C:\fw\midicontroller\x001x\usb.c
00150a   91a2     BCF       0xa2,0x0,0x1                                                                                    
                                               }//end if                                                                    C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
00150c   0104     MOVLB     0x4                if((SetupPkt.bFeature == ENDPOINT_HALT)&&                                    C:\fw\midicontroller\x001x\usb.c
00150e   5112     MOVF      0x12,0x0,0x1                                                                                    
001510   e13a     BNZ       0x1586                (SetupPkt.Recipient == RCPT_EP)&&                                         C:\fw\midicontroller\x001x\usb.c
001512   5110     MOVF      0x10,0x0,0x1                                                                                    
001514   0b1f     ANDLW     0x1f                                                                                            
001516   0802     SUBLW     0x2                                                                                             
001518   e136     BNZ       0x1586                                                                                          
00151a   5114     MOVF      0x14,0x0,0x1          (SetupPkt.EPNum != 0))                                                    C:\fw\midicontroller\x001x\usb.c
00151c   0b0f     ANDLW     0xf                                                                                             
00151e   0900     IORLW     0x0                                                                                             
001520   e032     BZ        0x1586                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
001522   0100     MOVLB     0x0                    ctrl_trf_session_owner = MUID_USB9;                                      C:\fw\midicontroller\x001x\usb.c
001524   0e01     MOVLW     0x1                                                                                             
001526   6fa6     MOVWF     0xa6,0x1                                                                                        
                                                   /* Must do address calculation here */                                   C:\fw\midicontroller\x001x\usb.c
001528   0104     MOVLB     0x4                    pDst.bRam = (byte*)&ep0Bo+(SetupPkt.EPNum*8)+(SetupPkt.EPDir*4);         C:\fw\midicontroller\x001x\usb.c
00152a   5114     MOVF      0x14,0x0,0x1                                                                                    
00152c   0b0f     ANDLW     0xf                                                                                             
00152e   0d08     MULLW     0x8                                                                                             
001530   50f3     MOVF      0xf3,0x0,0x0                                                                                    
001532   6a03     CLRF      0x3,0x0                                                                                         
001534   0f00     ADDLW     0x0                                                                                             
001536   6e02     MOVWF     0x2,0x0                                                                                         
001538   0e04     MOVLW     0x4                                                                                             
00153a   2203     ADDWFC    0x3,0x1,0x0                                                                                     
00153c   5114     MOVF      0x14,0x0,0x1                                                                                    
00153e   0b80     ANDLW     0x80                                                                                            
001540   e001     BZ        0x1544                                                                                          
001542   0e01     MOVLW     0x1                                                                                             
001544   0d04     MULLW     0x4                                                                                             
001546   50f3     MOVF      0xf3,0x0,0x0                                                                                    
001548   0100     MOVLB     0x0                                                                                             
00154a   2402     ADDWF     0x2,0x0,0x0                                                                                     
00154c   6fa9     MOVWF     0xa9,0x1                                                                                        
00154e   0e00     MOVLW     0x0                                                                                             
001550   2003     ADDWFC    0x3,0x0,0x0                                                                                     
001552   6faa     MOVWF     0xaa,0x1                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001554   0e03     MOVLW     0x3                    if(SetupPkt.bRequest == SET_FEATURE)                                     C:\fw\midicontroller\x001x\usb.c
001556   0104     MOVLB     0x4                                                                                             
001558   5d11     SUBWF     0x11,0x0,0x1                                                                                    
00155a   e107     BNZ       0x156a                                                                                          
00155c   0e84     MOVLW     0x84                       *pDst.bRam = _USIE|_BSTALL;                                          C:\fw\midicontroller\x001x\usb.c
00155e   c0a9     MOVFF     0xa9,0xfe9                                                                                      
001560   ffe9                                                                                                               
001562   c0aa     MOVFF     0xaa,0xfea                                                                                      
001564   ffea                                                                                                               
001566   6eef     MOVWF     0xef,0x0                                                                                        
001568   d00e     BRA       0x1586                 else                                                                     C:\fw\midicontroller\x001x\usb.c
                                                   {                                                                        C:\fw\midicontroller\x001x\usb.c
00156a   af14     BTFSS     0x14,0x7,0x1               if(SetupPkt.EPDir == 1) // IN                                        C:\fw\midicontroller\x001x\usb.c
00156c   d006     BRA       0x157a                                                                                          
00156e   c0a9     MOVFF     0xa9,0xfe9                     *pDst.bRam = _UCPU;                                              C:\fw\midicontroller\x001x\usb.c
001570   ffe9                                                                                                               
001572   c0aa     MOVFF     0xaa,0xfea                                                                                      
001574   ffea                                                                                                               
001576   6aef     CLRF      0xef,0x0                                                                                        
001578   d006     BRA       0x1586                     else                                                                 C:\fw\midicontroller\x001x\usb.c
00157a   0e88     MOVLW     0x88                           *pDst.bRam = _USIE|_DAT0|_DTSEN;                                 C:\fw\midicontroller\x001x\usb.c
00157c   c0a9     MOVFF     0xa9,0xfe9                                                                                      
00157e   ffe9                                                                                                               
001580   c0aa     MOVFF     0xaa,0xfea                                                                                      
001582   ffea                                                                                                               
001584   6eef     MOVWF     0xef,0x0                                                                                        
                                                   }//end if                                                                C:\fw\midicontroller\x001x\usb.c
                                               }//end if                                                                    C:\fw\midicontroller\x001x\usb.c
001586   0012     RETURN    0x0            }//end USBStdFeatureReqHandler                                                   C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** EOF usb9.c ***************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           //usbmmap.c                                                                      C:\fw\midicontroller\x001x\usb.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #include "typedefs.h"                                                            C:\fw\midicontroller\x001x\usb.c
                                           #include "usb.h"                                                                 C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** U S B  G L O B A L  V A R I A B L E S ************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #pragma udata usb5                                                               C:\fw\midicontroller\x001x\usb.c
                                           byte usb_device_state;          // Device States: DETACHED, ATTACHED, ...        C:\fw\midicontroller\x001x\usb.c
                                           USB_DEVICE_STATUS usb_stat;     // Global USB flags                              C:\fw\midicontroller\x001x\usb.c
                                           byte usb_active_cfg;            // Value of current configuration                C:\fw\midicontroller\x001x\usb.c
                                           byte usb_alt_intf[MAX_NUM_INT]; // Array to keep track of the current alternate  C:\fw\midicontroller\x001x\usb.c
                                                                           // setting for each interface ID                 C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** U S B  F I X E D  L O C A T I O N  V A R I A B L E S *********************/  C:\fw\midicontroller\x001x\usb.c
                                           //#pragma udata usbram4=0x400     //See Linker Script,usb4:0x400-0x4FF(256-byte) C:\fw\midicontroller\x001x\usb.c
                                           #pragma udata overlay usbram4=0x400     //See Linker Script,usb4:0x400-0x4FF(256-byte) C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Section A: Buffer Descriptor Table                                            C:\fw\midicontroller\x001x\usb.c
                                            * - 0x400 - 0x4FF(max)                                                          C:\fw\midicontroller\x001x\usb.c
                                            * - MAX_EP_NUMBER is defined in autofiles\usbcfg.h                              C:\fw\midicontroller\x001x\usb.c
                                            * - BDT data type is defined in system\usb\usbmmap.h                            C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(0 <= MAX_EP_NUMBER)                                                          C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep0Bo;         //Endpoint #0 BD Out                             C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep0Bi;         //Endpoint #0 BD In                              C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(1 <= MAX_EP_NUMBER)                                                          C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep1Bo;         //Endpoint #1 BD Out                             C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep1Bi;         //Endpoint #1 BD In                              C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(2 <= MAX_EP_NUMBER)                                                          C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep2Bo;         //Endpoint #2 BD Out                             C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep2Bi;         //Endpoint #2 BD In                              C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(3 <= MAX_EP_NUMBER)                                                          C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep3Bo;         //Endpoint #3 BD Out                             C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep3Bi;         //Endpoint #3 BD In                              C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(4 <= MAX_EP_NUMBER)                                                          C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep4Bo;         //Endpoint #4 BD Out                             C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep4Bi;         //Endpoint #4 BD In                              C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(5 <= MAX_EP_NUMBER)                                                          C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep5Bo;         //Endpoint #5 BD Out                             C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep5Bi;         //Endpoint #5 BD In                              C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(6 <= MAX_EP_NUMBER)                                                          C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep6Bo;         //Endpoint #6 BD Out                             C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep6Bi;         //Endpoint #6 BD In                              C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(7 <= MAX_EP_NUMBER)                                                          C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep7Bo;         //Endpoint #7 BD Out                             C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep7Bi;         //Endpoint #7 BD In                              C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(8 <= MAX_EP_NUMBER)                                                          C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep8Bo;         //Endpoint #8 BD Out                             C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep8Bi;         //Endpoint #8 BD In                              C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(9 <= MAX_EP_NUMBER)                                                          C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep9Bo;         //Endpoint #9 BD Out                             C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep9Bi;         //Endpoint #9 BD In                              C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(10 <= MAX_EP_NUMBER)                                                         C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep10Bo;        //Endpoint #10 BD Out                            C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep10Bi;        //Endpoint #10 BD In                             C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(11 <= MAX_EP_NUMBER)                                                         C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep11Bo;        //Endpoint #11 BD Out                            C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep11Bi;        //Endpoint #11 BD In                             C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(12 <= MAX_EP_NUMBER)                                                         C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep12Bo;        //Endpoint #12 BD Out                            C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep12Bi;        //Endpoint #12 BD In                             C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(13 <= MAX_EP_NUMBER)                                                         C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep13Bo;        //Endpoint #13 BD Out                            C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep13Bi;        //Endpoint #13 BD In                             C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(14 <= MAX_EP_NUMBER)                                                         C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep14Bo;        //Endpoint #14 BD Out                            C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep14Bi;        //Endpoint #14 BD In                             C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #if(15 <= MAX_EP_NUMBER)                                                         C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep15Bo;        //Endpoint #15 BD Out                            C:\fw\midicontroller\x001x\usb.c
                                           volatile far BDT ep15Bi;        //Endpoint #15 BD In                             C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Section B: EP0 Buffer Space                                                   C:\fw\midicontroller\x001x\usb.c
                                            ******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * - Two buffer areas are defined:                                               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *   A. CTRL_TRF_SETUP                                                           C:\fw\midicontroller\x001x\usb.c
                                            *      - Size = EP0_BUFF_SIZE as defined in autofiles\usbcfg.h                  C:\fw\midicontroller\x001x\usb.c
                                            *      - Detailed data structure allows direct adddressing of bits and bytes.   C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *   B. CTRL_TRF_DATA                                                            C:\fw\midicontroller\x001x\usb.c
                                            *      - Size = EP0_BUFF_SIZE as defined in autofiles\usbcfg.h                  C:\fw\midicontroller\x001x\usb.c
                                            *      - Data structure allows direct adddressing of the first 8 bytes.         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * - Both data types are defined in system\usb\usbdefs\usbdefs_ep0_buff.h        C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           volatile far CTRL_TRF_SETUP SetupPkt;                                            C:\fw\midicontroller\x001x\usb.c
                                           volatile far CTRL_TRF_DATA CtrlTrfData;                                          C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Section C: HID Buffer                                                         C:\fw\midicontroller\x001x\usb.c
                                            ******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #if defined(USB_USE_HID)                                                         C:\fw\midicontroller\x001x\usb.c
                                           volatile far unsigned char hid_report_out[HID_INT_OUT_EP_SIZE];                  C:\fw\midicontroller\x001x\usb.c
                                           volatile far unsigned char hid_report_in[HID_INT_IN_EP_SIZE];                    C:\fw\midicontroller\x001x\usb.c
                                           #endif                                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           #pragma udata usb5                                                               C:\fw\midicontroller\x001x\usb.c
                                           /** EOF usbmmap.c ************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           //usbctrltrf.c                                                                   C:\fw\midicontroller\x001x\usb.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #include "p18f4455.h"                                                            C:\fw\midicontroller\x001x\usb.c
                                           #include "typedefs.h"                                                            C:\fw\midicontroller\x001x\usb.c
                                           #include "usb.h"                                                                 C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #pragma udata usb5                                                               C:\fw\midicontroller\x001x\usb.c
                                           byte ctrl_trf_state;                // Control Transfer State                    C:\fw\midicontroller\x001x\usb.c
                                           byte ctrl_trf_session_owner;        // Current transfer session owner            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           POINTER pSrc;                       // Data source pointer                       C:\fw\midicontroller\x001x\usb.c
                                           POINTER pDst;                       // Data destination pointer                  C:\fw\midicontroller\x001x\usb.c
                                           WORD wCount;                        // Data counter                              C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBCtrlTrfSetupHandler(void);                                               C:\fw\midicontroller\x001x\usb.c
                                           void USBCtrlTrfOutHandler(void);                                                 C:\fw\midicontroller\x001x\usb.c
                                           void USBCtrlTrfInHandler(void);                                                  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #pragma code                                                                     C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBCtrlEPService(void)                                  C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    USTAT is loaded with a valid endpoint address.               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        USBCtrlEPService checks for three transaction types that     C:\fw\midicontroller\x001x\usb.c
                                            *                  it knows how to service and services them:                   C:\fw\midicontroller\x001x\usb.c
                                            *                  1. EP0 SETUP                                                 C:\fw\midicontroller\x001x\usb.c
                                            *                  2. EP0 OUT                                                   C:\fw\midicontroller\x001x\usb.c
                                            *                  3. EP0 IN                                                    C:\fw\midicontroller\x001x\usb.c
                                            *                  It ignores all other types (i.e. EP1, EP2, etc.)             C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBCtrlEPService(void)                                                      C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
001588   506c     MOVF      0x6c,0x0,0x0       if(USTAT == EP00_OUT)                                                        C:\fw\midicontroller\x001x\usb.c
00158a   e10b     BNZ       0x15a2                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
00158c   0104     MOVLB     0x4                    if(ep0Bo.Stat.PID == SETUP_TOKEN)           // EP0 SETUP                 C:\fw\midicontroller\x001x\usb.c
00158e   5100     MOVF      0x0,0x0,0x1                                                                                     
001590   0b3c     ANDLW     0x3c                                                                                            
001592   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001594   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001596   080d     SUBLW     0xd                                                                                             
001598   e102     BNZ       0x159e                                                                                          
00159a   d808     RCALL     0x15ac                     USBCtrlTrfSetupHandler();                                            C:\fw\midicontroller\x001x\usb.c
00159c   d001     BRA       0x15a0                 else                                        // EP0 OUT                   C:\fw\midicontroller\x001x\usb.c
00159e   d83b     RCALL     0x1616                     USBCtrlTrfOutHandler();                                              C:\fw\midicontroller\x001x\usb.c
                                               }                                                                            C:\fw\midicontroller\x001x\usb.c
0015a0   d004     BRA       0x15aa             else if(USTAT == EP00_IN)                       // EP0 IN                    C:\fw\midicontroller\x001x\usb.c
0015a2   0e04     MOVLW     0x4                                                                                             
0015a4   5c6c     SUBWF     0x6c,0x0,0x0                                                                                    
0015a6   e101     BNZ       0x15aa                                                                                          
0015a8   d846     RCALL     0x1636                 USBCtrlTrfInHandler();                                                   C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
0015aa   0012     RETURN    0x0            }//end USBCtrlEPService                                                          C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBCtrlTrfSetupHandler(void)                            C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    SetupPkt buffer is loaded with valid USB Setup Data          C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine is a task dispatcher and has 3 stages.          C:\fw\midicontroller\x001x\usb.c
                                            *                  1. It initializes the control transfer state machine.        C:\fw\midicontroller\x001x\usb.c
                                            *                  2. It calls on each of the module that may know how to       C:\fw\midicontroller\x001x\usb.c
                                            *                     service the Setup Request from the host.                  C:\fw\midicontroller\x001x\usb.c
                                            *                     Module Example: USB9, HID, CDC, MSD, ...                  C:\fw\midicontroller\x001x\usb.c
                                            *                     As new classes are added, ClassReqHandler table in        C:\fw\midicontroller\x001x\usb.c
                                            *                     usbdsc.c should be updated to call all available          C:\fw\midicontroller\x001x\usb.c
                                            *                     class handlers.                                           C:\fw\midicontroller\x001x\usb.c
                                            *                  3. Once each of the modules has had a chance to check if     C:\fw\midicontroller\x001x\usb.c
                                            *                     it is responsible for servicing the request, stage 3      C:\fw\midicontroller\x001x\usb.c
                                            *                     then checks direction of the transfer to determine how    C:\fw\midicontroller\x001x\usb.c
                                            *                     to prepare EP0 for the control transfer.                  C:\fw\midicontroller\x001x\usb.c
                                            *                     Refer to USBCtrlEPServiceComplete() for more details.     C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            Microchip USB Firmware has three different states for        C:\fw\midicontroller\x001x\usb.c
                                            *                  the control transfer state machine:                          C:\fw\midicontroller\x001x\usb.c
                                            *                  1. WAIT_SETUP                                                C:\fw\midicontroller\x001x\usb.c
                                            *                  2. CTRL_TRF_TX                                               C:\fw\midicontroller\x001x\usb.c
                                            *                  3. CTRL_TRF_RX                                               C:\fw\midicontroller\x001x\usb.c
                                            *                  Refer to firmware manual to find out how one state           C:\fw\midicontroller\x001x\usb.c
                                            *                  is transitioned to another.                                  C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *                  A Control Transfer is composed of many USB transactions.     C:\fw\midicontroller\x001x\usb.c
                                            *                  When transferring data over multiple transactions,           C:\fw\midicontroller\x001x\usb.c
                                            *                  it is important to keep track of data source, data           C:\fw\midicontroller\x001x\usb.c
                                            *                  destination, and data count. These three parameters are      C:\fw\midicontroller\x001x\usb.c
                                            *                  stored in pSrc,pDst, and wCount. A flag is used to           C:\fw\midicontroller\x001x\usb.c
                                            *                  note if the data source is from ROM or RAM.                  C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
0015ac   cfd9     MOVFF     0xfd9,0xfe6    void USBCtrlTrfSetupHandler(void)                                                C:\fw\midicontroller\x001x\usb.c
0015ae   ffe6                                                                                                               
0015b0   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
0015b2   ffd9                                                                                                               
0015b4   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
                                               byte i;                                                                      C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /* Stage 1 */                                                                C:\fw\midicontroller\x001x\usb.c
0015b6   0100     MOVLB     0x0                ctrl_trf_state = WAIT_SETUP;                                                 C:\fw\midicontroller\x001x\usb.c
0015b8   6ba5     CLRF      0xa5,0x1                                                                                        
0015ba   6ba6     CLRF      0xa6,0x1           ctrl_trf_session_owner = MUID_NULL;     // Set owner to NULL                 C:\fw\midicontroller\x001x\usb.c
0015bc   6bab     CLRF      0xab,0x1           wCount._word = 0;                                                            C:\fw\midicontroller\x001x\usb.c
0015be   6bac     CLRF      0xac,0x1                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /* Stage 2 */                                                                C:\fw\midicontroller\x001x\usb.c
0015c0   de66     RCALL     0x128e             USBCheckStdRequest();                   // See system\usb9\usb9.c            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /* Modifiable Section */                                                     C:\fw\midicontroller\x001x\usb.c
0015c2   6adf     CLRF      0xdf,0x0           for(i=0;i < (sizeof(ClassReqHandler)/sizeof(pFunc));i++)                     C:\fw\midicontroller\x001x\usb.c
0015c4   50df     MOVF      0xdf,0x0,0x0                                                                                    
0015c6   6e02     MOVWF     0x2,0x0                                                                                         
0015c8   6a03     CLRF      0x3,0x0                                                                                         
0015ca   0e01     MOVLW     0x1                                                                                             
0015cc   5c02     SUBWF     0x2,0x0,0x0                                                                                     
0015ce   0e00     MOVLW     0x0                                                                                             
0015d0   5803     SUBWFB    0x3,0x0,0x0                                                                                     
0015d2   e21b     BC        0x160a                                                                                          
001606   2adf     INCF      0xdf,0x1,0x0                                                                                    
001608   d7dd     BRA       0x15c4                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
0015d4   0100     MOVLB     0x0                    if(ctrl_trf_session_owner != MUID_NULL)break;                            C:\fw\midicontroller\x001x\usb.c
0015d6   51a6     MOVF      0xa6,0x0,0x1                                                                                    
0015d8   e001     BZ        0x15dc                                                                                          
0015da   d017     BRA       0x160a                                                                                          
0015dc   6af7     CLRF      0xf7,0x0               ClassReqHandler[i]();               // See autofiles\usbdsc.c            C:\fw\midicontroller\x001x\usb.c
0015de   34df     RLCF      0xdf,0x0,0x0                                                                                    
0015e0   0bfe     ANDLW     0xfe                                                                                            
0015e2   36f7     RLCF      0xf7,0x1,0x0                                                                                    
0015e4   6ef6     MOVWF     0xf6,0x0                                                                                        
0015e6   0e2b     MOVLW     0x2b                                                                                            
0015e8   26f6     ADDWF     0xf6,0x1,0x0                                                                                    
0015ea   0e1d     MOVLW     0x1d                                                                                            
0015ec   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
0015ee   0009     TBLRDPOSTINC                                                                                              
0015f0   cff5     MOVFF     0xff5,0x2                                                                                       
0015f2   f002                                                                                                               
0015f4   0008     TBLRD                                                                                                     
0015f6   cff5     MOVFF     0xff5,0x3                                                                                       
0015f8   f003                                                                                                               
0015fa   d004     BRA       0x1604                                                                                          
0015fc   c003     MOVFF     0x3,0xffa                                                                                       
0015fe   fffa                                                                                                               
001600   5002     MOVF      0x2,0x0,0x0                                                                                     
001602   6ef9     MOVWF     0xf9,0x0                                                                                        
001604   dffb     RCALL     0x15fc                                                                                          
                                               }//end while                                                                 C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /* End Modifiable Section */                                                 C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /* Stage 3 */                                                                C:\fw\midicontroller\x001x\usb.c
00160a   d8df     RCALL     0x17ca             USBCtrlEPServiceComplete();                                                  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
00160c   52e5     MOVF      0xe5,0x1,0x0   }//end USBCtrlTrfSetupHandler                                                    C:\fw\midicontroller\x001x\usb.c
00160e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001610   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001612   ffd9                                                                                                               
001614   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBCtrlTrfOutHandler(void)                              C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine handles an OUT transaction according to         C:\fw\midicontroller\x001x\usb.c
                                            *                  which control transfer state is currently active.            C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            Note that if the the control transfer was from               C:\fw\midicontroller\x001x\usb.c
                                            *                  host to device, the session owner should be notified         C:\fw\midicontroller\x001x\usb.c
                                            *                  at the end of each OUT transaction to service the            C:\fw\midicontroller\x001x\usb.c
                                            *                  received data.                                               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBCtrlTrfOutHandler(void)                                                  C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
001616   0e02     MOVLW     0x2                if(ctrl_trf_state == CTRL_TRF_RX)                                            C:\fw\midicontroller\x001x\usb.c
001618   0100     MOVLB     0x0                                                                                             
00161a   5da5     SUBWF     0xa5,0x0,0x1                                                                                    
00161c   e10a     BNZ       0x1632                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
00161e   d898     RCALL     0x1750                 USBCtrlTrfRxService();                                                   C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   /*                                                                       C:\fw\midicontroller\x001x\usb.c
                                                    * Don't have to worry about overwriting _KEEP bit                       C:\fw\midicontroller\x001x\usb.c
                                                    * because if _KEEP was set, TRNIF would not have been                   C:\fw\midicontroller\x001x\usb.c
                                                    * generated in the first place.                                         C:\fw\midicontroller\x001x\usb.c
                                                    */                                                                      C:\fw\midicontroller\x001x\usb.c
001620   0104     MOVLB     0x4                    if(ep0Bo.Stat.DTS == 0)                                                  C:\fw\midicontroller\x001x\usb.c
001622   bd00     BTFSC     0x0,0x6,0x1                                                                                     
001624   d003     BRA       0x162c                                                                                          
001626   0ec8     MOVLW     0xc8                       ep0Bo.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\midicontroller\x001x\usb.c
001628   6f00     MOVWF     0x0,0x1                                                                                         
00162a   d002     BRA       0x1630                 else                                                                     C:\fw\midicontroller\x001x\usb.c
00162c   0e88     MOVLW     0x88                       ep0Bo.Stat._byte = _USIE|_DAT0|_DTSEN;                               C:\fw\midicontroller\x001x\usb.c
00162e   6f00     MOVWF     0x0,0x1                                                                                         
                                               }                                                                            C:\fw\midicontroller\x001x\usb.c
001630   d001     BRA       0x1634             else    // CTRL_TRF_TX                                                       C:\fw\midicontroller\x001x\usb.c
001632   d90e     RCALL     0x1850                 USBPrepareForNextSetupTrf();                                             C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001634   0012     RETURN    0x0            }//end USBCtrlTrfOutHandler                                                      C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBCtrlTrfInHandler(void)                               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine handles an IN transaction according to          C:\fw\midicontroller\x001x\usb.c
                                            *                  which control transfer state is currently active.            C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            A Set Address Request must not change the acutal address     C:\fw\midicontroller\x001x\usb.c
                                            *                  of the device until the completion of the control            C:\fw\midicontroller\x001x\usb.c
                                            *                  transfer. The end of the control transfer for Set Address    C:\fw\midicontroller\x001x\usb.c
                                            *                  Request is an IN transaction. Therefore it is necessary      C:\fw\midicontroller\x001x\usb.c
                                            *                  to service this unique situation when the condition is       C:\fw\midicontroller\x001x\usb.c
                                            *                  right. Macro mUSBCheckAdrPendingState is defined in          C:\fw\midicontroller\x001x\usb.c
                                            *                  usb9.h and its function is to specifically service this      C:\fw\midicontroller\x001x\usb.c
                                            *                  event.                                                       C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBCtrlTrfInHandler(void)                                                   C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
001636   0e04     MOVLW     0x4                mUSBCheckAdrPendingState();         // Must check if in ADR_PENDING_STATE    C:\fw\midicontroller\x001x\usb.c
001638   0100     MOVLB     0x0                                                                                             
00163a   5da1     SUBWF     0xa1,0x0,0x1                                                                                    
00163c   e10a     BNZ       0x1652                                                                                          
00163e   c412     MOVFF     0x412,0xf6e                                                                                     
001640   ff6e                                                                                                               
001642   506e     MOVF      0x6e,0x0,0x0                                                                                    
001644   0800     SUBLW     0x0                                                                                             
001646   e203     BC        0x164e                                                                                          
001648   0e05     MOVLW     0x5                                                                                             
00164a   6fa1     MOVWF     0xa1,0x1                                                                                        
00164c   d002     BRA       0x1652                                                                                          
00164e   0e03     MOVLW     0x3                                                                                             
001650   6fa1     MOVWF     0xa1,0x1                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001652   05a5     DECF      0xa5,0x0,0x1       if(ctrl_trf_state == CTRL_TRF_TX)                                            C:\fw\midicontroller\x001x\usb.c
001654   e10a     BNZ       0x166a                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
001656   d811     RCALL     0x167a                 USBCtrlTrfTxService();                                                   C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001658   0104     MOVLB     0x4                    if(ep0Bi.Stat.DTS == 0)                                                  C:\fw\midicontroller\x001x\usb.c
00165a   bd04     BTFSC     0x4,0x6,0x1                                                                                     
00165c   d003     BRA       0x1664                                                                                          
00165e   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\midicontroller\x001x\usb.c
001660   6f04     MOVWF     0x4,0x1                                                                                         
001662   d002     BRA       0x1668                 else                                                                     C:\fw\midicontroller\x001x\usb.c
001664   0e88     MOVLW     0x88                       ep0Bi.Stat._byte = _USIE|_DAT0|_DTSEN;                               C:\fw\midicontroller\x001x\usb.c
001666   6f04     MOVWF     0x4,0x1                                                                                         
                                               }                                                                            C:\fw\midicontroller\x001x\usb.c
001668   d007     BRA       0x1678             else { // CTRL_TRF_RX                                                        C:\fw\midicontroller\x001x\usb.c
                                           //Rawin's code change to handle setreport data:                                  C:\fw\midicontroller\x001x\usb.c
00166a   0e09     MOVLW     0x9            		if (SetupPkt.bRequest == SET_REPORT) {                                         C:\fw\midicontroller\x001x\usb.c
00166c   0104     MOVLB     0x4                                                                                             
00166e   5d11     SUBWF     0x11,0x0,0x1                                                                                    
001670   e102     BNZ       0x1676                                                                                          
001672   ec24     CALL      0x1e48,0x0     			HIDSetReportHandler();                                                        C:\fw\midicontroller\x001x\usb.c
001674   f00f                                                                                                               
                                           		}                                                                              C:\fw\midicontroller\x001x\usb.c
001676   d8ec     RCALL     0x1850         		USBPrepareForNextSetupTrf();                                                   C:\fw\midicontroller\x001x\usb.c
                                           	}                                                                               C:\fw\midicontroller\x001x\usb.c
001678   0012     RETURN    0x0            }//end USBCtrlTrfInHandler                                                       C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBCtrlTrfTxService(void)                               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    pSrc, wCount, and usb_stat.ctrl_trf_mem are setup properly.  C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine should be called from only two places.          C:\fw\midicontroller\x001x\usb.c
                                            *                  One from USBCtrlEPServiceComplete() and one from             C:\fw\midicontroller\x001x\usb.c
                                            *                  USBCtrlTrfInHandler(). It takes care of managing a           C:\fw\midicontroller\x001x\usb.c
                                            *                  transfer over multiple USB transactions.                     C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            This routine works with isochronous endpoint larger than     C:\fw\midicontroller\x001x\usb.c
                                            *                  256 bytes and is shown here as an example of how to deal     C:\fw\midicontroller\x001x\usb.c
                                            *                  with BC9 and BC8. In reality, a control endpoint can never   C:\fw\midicontroller\x001x\usb.c
                                            *                  be larger than 64 bytes.                                     C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
00167a   cfd9     MOVFF     0xfd9,0xfe6    void USBCtrlTrfTxService(void)                                                   C:\fw\midicontroller\x001x\usb.c
00167c   ffe6                                                                                                               
00167e   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001680   ffd9                                                                                                               
001682   0e02     MOVLW     0x2                                                                                             
001684   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
                                               WORD byte_to_send;                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * First, have to figure out how many byte of data to send.                  C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
001686   0100     MOVLB     0x0                if(wCount._word < EP0_BUFF_SIZE)                                             C:\fw\midicontroller\x001x\usb.c
001688   0e08     MOVLW     0x8                                                                                             
00168a   5dab     SUBWF     0xab,0x0,0x1                                                                                    
00168c   0e00     MOVLW     0x0                                                                                             
00168e   59ac     SUBWFB    0xac,0x0,0x1                                                                                    
001690   e205     BC        0x169c                                                                                          
001692   c0ab     MOVFF     0xab,0xfde             byte_to_send._word = wCount._word;                                       C:\fw\midicontroller\x001x\usb.c
001694   ffde                                                                                                               
001696   c0ac     MOVFF     0xac,0xfdd                                                                                      
001698   ffdd                                                                                                               
00169a   d003     BRA       0x16a2             else                                                                         C:\fw\midicontroller\x001x\usb.c
00169c   0e08     MOVLW     0x8                    byte_to_send._word = EP0_BUFF_SIZE;                                      C:\fw\midicontroller\x001x\usb.c
00169e   6ede     MOVWF     0xde,0x0                                                                                        
0016a0   6add     CLRF      0xdd,0x0                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * Next, load the number of bytes to send to BC9..0 in buffer descriptor     C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
0016a2   0104     MOVLB     0x4                ep0Bi.Stat.BC9 = 0;                                                          C:\fw\midicontroller\x001x\usb.c
0016a4   9304     BCF       0x4,0x1,0x1                                                                                     
0016a6   9104     BCF       0x4,0x0,0x1        ep0Bi.Stat.BC8 = 0;                                                          C:\fw\midicontroller\x001x\usb.c
0016a8   0e01     MOVLW     0x1                ep0Bi.Stat._byte |= MSB(byte_to_send);                                       C:\fw\midicontroller\x001x\usb.c
0016aa   50db     MOVF      0xdb,0x0,0x0                                                                                    
0016ac   1304     IORWF     0x4,0x1,0x1                                                                                     
0016ae   cfdf     MOVFF     0xfdf,0x405        ep0Bi.Cnt = LSB(byte_to_send);                                               C:\fw\midicontroller\x001x\usb.c
0016b0   f405                                                                                                               
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * Subtract the number of bytes just about to be sent from the total.        C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
0016b2   0e00     MOVLW     0x0                wCount._word = wCount._word - byte_to_send._word;                            C:\fw\midicontroller\x001x\usb.c
0016b4   50db     MOVF      0xdb,0x0,0x0                                                                                    
0016b6   0100     MOVLB     0x0                                                                                             
0016b8   5fab     SUBWF     0xab,0x1,0x1                                                                                    
0016ba   0e01     MOVLW     0x1                                                                                             
0016bc   50db     MOVF      0xdb,0x0,0x0                                                                                    
0016be   5bac     SUBWFB    0xac,0x1,0x1                                                                                    
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
0016c0   0e18     MOVLW     0x18               pDst.bRam = (byte*)&CtrlTrfData;        // Set destination pointer           C:\fw\midicontroller\x001x\usb.c
0016c2   6fa9     MOVWF     0xa9,0x1                                                                                        
0016c4   0e04     MOVLW     0x4                                                                                             
0016c6   6faa     MOVWF     0xaa,0x1                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
0016c8   a3a2     BTFSS     0xa2,0x1,0x1       if(usb_stat.ctrl_trf_mem == _ROM)       // Determine type of memory source   C:\fw\midicontroller\x001x\usb.c
0016ca   d01d     BRA       0x1706                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
0016cc   cfd9     MOVFF     0xfd9,0xfe9            while(byte_to_send._word)                                                C:\fw\midicontroller\x001x\usb.c
0016ce   ffe9                                                                                                               
0016d0   cfda     MOVFF     0xfda,0xfea                                                                                     
0016d2   ffea                                                                                                               
0016d4   50ee     MOVF      0xee,0x0,0x0                                                                                    
0016d6   10ed     IORWF     0xed,0x0,0x0                                                                                    
0016d8   e015     BZ        0x1704                                                                                          
001702   d7e4     BRA       0x16cc                                                                                          
                                                   {                                                                        C:\fw\midicontroller\x001x\usb.c
0016da   c0a7     MOVFF     0xa7,0xff6                 *pDst.bRam = *pSrc.bRom;                                             C:\fw\midicontroller\x001x\usb.c
0016dc   fff6                                                                                                               
0016de   c0a8     MOVFF     0xa8,0xff7                                                                                      
0016e0   fff7                                                                                                               
0016e2   0008     TBLRD                                                                                                     
0016e4   50f5     MOVF      0xf5,0x0,0x0                                                                                    
0016e6   c0a9     MOVFF     0xa9,0xfe9                                                                                      
0016e8   ffe9                                                                                                               
0016ea   c0aa     MOVFF     0xaa,0xfea                                                                                      
0016ec   ffea                                                                                                               
0016ee   6eef     MOVWF     0xef,0x0                                                                                        
0016f0   2ba9     INCF      0xa9,0x1,0x1               pDst.bRam++;                                                         C:\fw\midicontroller\x001x\usb.c
0016f2   0e00     MOVLW     0x0                                                                                             
0016f4   23aa     ADDWFC    0xaa,0x1,0x1                                                                                    
0016f6   2ba7     INCF      0xa7,0x1,0x1               pSrc.bRom++;                                                         C:\fw\midicontroller\x001x\usb.c
0016f8   23a8     ADDWFC    0xa8,0x1,0x1                                                                                    
0016fa   06df     DECF      0xdf,0x1,0x0               byte_to_send._word--;                                                C:\fw\midicontroller\x001x\usb.c
0016fc   0e01     MOVLW     0x1                                                                                             
0016fe   e201     BC        0x1702                                                                                          
001700   06db     DECF      0xdb,0x1,0x0                                                                                    
                                                   }//end while(byte_to_send._word)                                         C:\fw\midicontroller\x001x\usb.c
                                               }                                                                            C:\fw\midicontroller\x001x\usb.c
001704   d01b     BRA       0x173c             else // RAM                                                                  C:\fw\midicontroller\x001x\usb.c
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
001706   cfd9     MOVFF     0xfd9,0xfe9            while(byte_to_send._word)                                                C:\fw\midicontroller\x001x\usb.c
001708   ffe9                                                                                                               
00170a   cfda     MOVFF     0xfda,0xfea                                                                                     
00170c   ffea                                                                                                               
00170e   50ee     MOVF      0xee,0x0,0x0                                                                                    
001710   10ed     IORWF     0xed,0x0,0x0                                                                                    
001712   e014     BZ        0x173c                                                                                          
00173a   d7e5     BRA       0x1706                                                                                          
                                                   {                                                                        C:\fw\midicontroller\x001x\usb.c
001714   c0a7     MOVFF     0xa7,0xfe9                 *pDst.bRam = *pSrc.bRam;                                             C:\fw\midicontroller\x001x\usb.c
001716   ffe9                                                                                                               
001718   c0a8     MOVFF     0xa8,0xfea                                                                                      
00171a   ffea                                                                                                               
00171c   50ef     MOVF      0xef,0x0,0x0                                                                                    
00171e   c0a9     MOVFF     0xa9,0xfe9                                                                                      
001720   ffe9                                                                                                               
001722   c0aa     MOVFF     0xaa,0xfea                                                                                      
001724   ffea                                                                                                               
001726   6eef     MOVWF     0xef,0x0                                                                                        
001728   2ba9     INCF      0xa9,0x1,0x1               pDst.bRam++;                                                         C:\fw\midicontroller\x001x\usb.c
00172a   0e00     MOVLW     0x0                                                                                             
00172c   23aa     ADDWFC    0xaa,0x1,0x1                                                                                    
00172e   2ba7     INCF      0xa7,0x1,0x1               pSrc.bRam++;                                                         C:\fw\midicontroller\x001x\usb.c
001730   23a8     ADDWFC    0xa8,0x1,0x1                                                                                    
001732   06df     DECF      0xdf,0x1,0x0               byte_to_send._word--;                                                C:\fw\midicontroller\x001x\usb.c
001734   0e01     MOVLW     0x1                                                                                             
001736   e201     BC        0x173a                                                                                          
001738   06db     DECF      0xdb,0x1,0x0                                                                                    
                                                   }//end while(byte_to_send._word)                                         C:\fw\midicontroller\x001x\usb.c
                                               }//end if(usb_stat.ctrl_trf_mem == _ROM)                                     C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
00173c   0e02     MOVLW     0x2            }//end USBCtrlTrfTxService                                                       C:\fw\midicontroller\x001x\usb.c
00173e   5ce1     SUBWF     0xe1,0x0,0x0                                                                                    
001740   e202     BC        0x1746                                                                                          
001742   6ae1     CLRF      0xe1,0x0                                                                                        
001744   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001746   6ee1     MOVWF     0xe1,0x0                                                                                        
001748   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00174a   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
00174c   ffd9                                                                                                               
00174e   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBCtrlTrfRxService(void)                               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    pDst and wCount are setup properly.                          C:\fw\midicontroller\x001x\usb.c
                                            *                  pSrc is always &CtrlTrfData                                  C:\fw\midicontroller\x001x\usb.c
                                            *                  usb_stat.ctrl_trf_mem is always _RAM.                        C:\fw\midicontroller\x001x\usb.c
                                            *                  wCount should be set to 0 at the start of each control       C:\fw\midicontroller\x001x\usb.c
                                            *                  transfer.                                                    C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        *** This routine is only partially complete. Check for       C:\fw\midicontroller\x001x\usb.c
                                            *                  new version of the firmware.                                 C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
001750   cfd9     MOVFF     0xfd9,0xfe6    void USBCtrlTrfRxService(void)                                                   C:\fw\midicontroller\x001x\usb.c
001752   ffe6                                                                                                               
001754   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001756   ffd9                                                                                                               
001758   0e02     MOVLW     0x2                                                                                             
00175a   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
                                               WORD byte_to_read;                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
00175c   0e03     MOVLW     0x3                MSB(byte_to_read) = 0x03 & ep0Bo.Stat._byte;    // Filter out last 2 bits    C:\fw\midicontroller\x001x\usb.c
00175e   0104     MOVLB     0x4                                                                                             
001760   1500     ANDWF     0x0,0x0,0x1                                                                                     
001762   6ee7     MOVWF     0xe7,0x0                                                                                        
001764   0e01     MOVLW     0x1                                                                                             
001766   cfe7     MOVFF     0xfe7,0xfdb                                                                                     
001768   ffdb                                                                                                               
00176a   c401     MOVFF     0x401,0xfdf        LSB(byte_to_read) = ep0Bo.Cnt;                                               C:\fw\midicontroller\x001x\usb.c
00176c   ffdf                                                                                                               
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * Accumulate total number of bytes read                                     C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
00176e   50de     MOVF      0xde,0x0,0x0       wCount._word = wCount._word + byte_to_read._word;                            C:\fw\midicontroller\x001x\usb.c
001770   0100     MOVLB     0x0                                                                                             
001772   27ab     ADDWF     0xab,0x1,0x1                                                                                    
001774   50dd     MOVF      0xdd,0x0,0x0                                                                                    
001776   23ac     ADDWFC    0xac,0x1,0x1                                                                                    
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001778   0e18     MOVLW     0x18               pSrc.bRam = (byte*)&CtrlTrfData;                                             C:\fw\midicontroller\x001x\usb.c
00177a   6fa7     MOVWF     0xa7,0x1                                                                                        
00177c   0e04     MOVLW     0x4                                                                                             
00177e   6fa8     MOVWF     0xa8,0x1                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001780   cfd9     MOVFF     0xfd9,0xfe9        while(byte_to_read._word)                                                    C:\fw\midicontroller\x001x\usb.c
001782   ffe9                                                                                                               
001784   cfda     MOVFF     0xfda,0xfea                                                                                     
001786   ffea                                                                                                               
001788   50ee     MOVF      0xee,0x0,0x0                                                                                    
00178a   10ed     IORWF     0xed,0x0,0x0                                                                                    
00178c   e014     BZ        0x17b6                                                                                          
0017b4   d7e5     BRA       0x1780                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
00178e   c0a7     MOVFF     0xa7,0xfe9             *pDst.bRam = *pSrc.bRam;                                                 C:\fw\midicontroller\x001x\usb.c
001790   ffe9                                                                                                               
001792   c0a8     MOVFF     0xa8,0xfea                                                                                      
001794   ffea                                                                                                               
001796   50ef     MOVF      0xef,0x0,0x0                                                                                    
001798   c0a9     MOVFF     0xa9,0xfe9                                                                                      
00179a   ffe9                                                                                                               
00179c   c0aa     MOVFF     0xaa,0xfea                                                                                      
00179e   ffea                                                                                                               
0017a0   6eef     MOVWF     0xef,0x0                                                                                        
0017a2   2ba9     INCF      0xa9,0x1,0x1           pDst.bRam++;                                                             C:\fw\midicontroller\x001x\usb.c
0017a4   0e00     MOVLW     0x0                                                                                             
0017a6   23aa     ADDWFC    0xaa,0x1,0x1                                                                                    
0017a8   2ba7     INCF      0xa7,0x1,0x1           pSrc.bRam++;                                                             C:\fw\midicontroller\x001x\usb.c
0017aa   23a8     ADDWFC    0xa8,0x1,0x1                                                                                    
0017ac   06df     DECF      0xdf,0x1,0x0           byte_to_read._word--;                                                    C:\fw\midicontroller\x001x\usb.c
0017ae   0e01     MOVLW     0x1                                                                                             
0017b0   e201     BC        0x17b4                                                                                          
0017b2   06db     DECF      0xdb,0x1,0x0                                                                                    
                                               }//end while(byte_to_read._word)                                             C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
0017b6   0e02     MOVLW     0x2            }//end USBCtrlTrfRxService                                                       C:\fw\midicontroller\x001x\usb.c
0017b8   5ce1     SUBWF     0xe1,0x0,0x0                                                                                    
0017ba   e202     BC        0x17c0                                                                                          
0017bc   6ae1     CLRF      0xe1,0x0                                                                                        
0017be   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0017c0   6ee1     MOVWF     0xe1,0x0                                                                                        
0017c2   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0017c4   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
0017c6   ffd9                                                                                                               
0017c8   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBCtrlEPServiceComplete(void)                          C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine wrap up the ramaining tasks in servicing        C:\fw\midicontroller\x001x\usb.c
                                            *                  a Setup Request. Its main task is to set the endpoint        C:\fw\midicontroller\x001x\usb.c
                                            *                  controls appropriately for a given situation. See code       C:\fw\midicontroller\x001x\usb.c
                                            *                  below.                                                       C:\fw\midicontroller\x001x\usb.c
                                            *                  There are three main scenarios:                              C:\fw\midicontroller\x001x\usb.c
                                            *                  a) There was no handler for the Request, in this case        C:\fw\midicontroller\x001x\usb.c
                                            *                     a STALL should be sent out.                               C:\fw\midicontroller\x001x\usb.c
                                            *                  b) The host has requested a read control transfer,           C:\fw\midicontroller\x001x\usb.c
                                            *                     endpoints are required to be setup in a specific way.     C:\fw\midicontroller\x001x\usb.c
                                            *                  c) The host has requested a write control transfer, or       C:\fw\midicontroller\x001x\usb.c
                                            *                     a control data stage is not required, endpoints are       C:\fw\midicontroller\x001x\usb.c
                                            *                     required to be setup in a specific way.                   C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *                  Packet processing is resumed by clearing PKTDIS bit.         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBCtrlEPServiceComplete(void)                                              C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
0017ca   0100     MOVLB     0x0                if(ctrl_trf_session_owner == MUID_NULL)                                      C:\fw\midicontroller\x001x\usb.c
0017cc   51a6     MOVF      0xa6,0x0,0x1                                                                                    
0017ce   e10b     BNZ       0x17e6                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   /*                                                                       C:\fw\midicontroller\x001x\usb.c
                                                    * If no one knows how to service this request then stall.               C:\fw\midicontroller\x001x\usb.c
                                                    * Must also prepare EP0 to receive the next SETUP transaction.          C:\fw\midicontroller\x001x\usb.c
                                                    */                                                                      C:\fw\midicontroller\x001x\usb.c
0017d0   0104     MOVLB     0x4                    ep0Bo.Cnt = EP0_BUFF_SIZE;                                               C:\fw\midicontroller\x001x\usb.c
0017d2   0e08     MOVLW     0x8                                                                                             
0017d4   6f01     MOVWF     0x1,0x1                                                                                         
0017d6   0e10     MOVLW     0x10                   ep0Bo.ADR = (byte*)&SetupPkt;                                            C:\fw\midicontroller\x001x\usb.c
0017d8   6f02     MOVWF     0x2,0x1                                                                                         
0017da   0e04     MOVLW     0x4                                                                                             
0017dc   6f03     MOVWF     0x3,0x1                                                                                         
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
0017de   0e84     MOVLW     0x84                   ep0Bo.Stat._byte = _USIE|_BSTALL;                                        C:\fw\midicontroller\x001x\usb.c
0017e0   6f00     MOVWF     0x0,0x1                                                                                         
0017e2   6f04     MOVWF     0x4,0x1                ep0Bi.Stat._byte = _USIE|_BSTALL;                                        C:\fw\midicontroller\x001x\usb.c
                                               }                                                                            C:\fw\midicontroller\x001x\usb.c
0017e4   d033     BRA       0x184c             else    // A module has claimed ownership of the control transfer session.   C:\fw\midicontroller\x001x\usb.c
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
0017e6   0104     MOVLB     0x4                    if(SetupPkt.DataDir == DEV_TO_HOST)                                      C:\fw\midicontroller\x001x\usb.c
0017e8   af10     BTFSS     0x10,0x7,0x1                                                                                    
0017ea   d021     BRA       0x182e                                                                                          
                                                   {                                                                        C:\fw\midicontroller\x001x\usb.c
0017ec   0100     MOVLB     0x0                        if(SetupPkt.wLength < wCount._word)                                  C:\fw\midicontroller\x001x\usb.c
0017ee   51ab     MOVF      0xab,0x0,0x1                                                                                    
0017f0   0104     MOVLB     0x4                                                                                             
0017f2   5d16     SUBWF     0x16,0x0,0x1                                                                                    
0017f4   0100     MOVLB     0x0                                                                                             
0017f6   51ac     MOVF      0xac,0x0,0x1                                                                                    
0017f8   0104     MOVLB     0x4                                                                                             
0017fa   5917     SUBWFB    0x17,0x0,0x1                                                                                    
0017fc   e204     BC        0x1806                                                                                          
0017fe   c416     MOVFF     0x416,0xab                     wCount._word = SetupPkt.wLength;                                 C:\fw\midicontroller\x001x\usb.c
001800   f0ab                                                                                                               
001802   c417     MOVFF     0x417,0xac                                                                                      
001804   f0ac                                                                                                               
001806   df39     RCALL     0x167a                     USBCtrlTrfTxService();                                               C:\fw\midicontroller\x001x\usb.c
001808   0100     MOVLB     0x0                        ctrl_trf_state = CTRL_TRF_TX;                                        C:\fw\midicontroller\x001x\usb.c
00180a   0e01     MOVLW     0x1                                                                                             
00180c   6fa5     MOVWF     0xa5,0x1                                                                                        
                                                       /*                                                                   C:\fw\midicontroller\x001x\usb.c
                                                        * Control Read:                                                     C:\fw\midicontroller\x001x\usb.c
                                                        * <SETUP[0]><IN[1]><IN[0]>...<OUT[1]> | <SETUP[0]>                  C:\fw\midicontroller\x001x\usb.c
                                                        * 1. Prepare OUT EP to respond to early termination                 C:\fw\midicontroller\x001x\usb.c
                                                        *                                                                   C:\fw\midicontroller\x001x\usb.c
                                                        * NOTE:                                                             C:\fw\midicontroller\x001x\usb.c
                                                        * If something went wrong during the control transfer,              C:\fw\midicontroller\x001x\usb.c
                                                        * the last status stage may not be sent by the host.                C:\fw\midicontroller\x001x\usb.c
                                                        * When this happens, two different things could happen              C:\fw\midicontroller\x001x\usb.c
                                                        * depending on the host.                                            C:\fw\midicontroller\x001x\usb.c
                                                        * a) The host could send out a RESET.                               C:\fw\midicontroller\x001x\usb.c
                                                        * b) The host could send out a new SETUP transaction                C:\fw\midicontroller\x001x\usb.c
                                                        *    without sending a RESET first.                                 C:\fw\midicontroller\x001x\usb.c
                                                        * To properly handle case (b), the OUT EP must be setup             C:\fw\midicontroller\x001x\usb.c
                                                        * to receive either a zero length OUT transaction, or a             C:\fw\midicontroller\x001x\usb.c
                                                        * new SETUP transaction.                                            C:\fw\midicontroller\x001x\usb.c
                                                        *                                                                   C:\fw\midicontroller\x001x\usb.c
                                                        * Since the SETUP transaction requires the DTS bit to be            C:\fw\midicontroller\x001x\usb.c
                                                        * DAT0 while the zero length OUT status requires the DTS            C:\fw\midicontroller\x001x\usb.c
                                                        * bit to be DAT1, the DTS bit check by the hardware should          C:\fw\midicontroller\x001x\usb.c
                                                        * be disabled. This way the SIE could accept either of              C:\fw\midicontroller\x001x\usb.c
                                                        * the two transactions.                                             C:\fw\midicontroller\x001x\usb.c
                                                        *                                                                   C:\fw\midicontroller\x001x\usb.c
                                                        * Furthermore, the Cnt byte should be set to prepare for            C:\fw\midicontroller\x001x\usb.c
                                                        * the SETUP data (8-byte or more), and the buffer address           C:\fw\midicontroller\x001x\usb.c
                                                        * should be pointed to SetupPkt.                                    C:\fw\midicontroller\x001x\usb.c
                                                        */                                                                  C:\fw\midicontroller\x001x\usb.c
00180e   0104     MOVLB     0x4                        ep0Bo.Cnt = EP0_BUFF_SIZE;                                           C:\fw\midicontroller\x001x\usb.c
001810   0e08     MOVLW     0x8                                                                                             
001812   6f01     MOVWF     0x1,0x1                                                                                         
001814   0e10     MOVLW     0x10                       ep0Bo.ADR = (byte*)&SetupPkt;                                        C:\fw\midicontroller\x001x\usb.c
001816   6f02     MOVWF     0x2,0x1                                                                                         
001818   0e04     MOVLW     0x4                                                                                             
00181a   6f03     MOVWF     0x3,0x1                                                                                         
00181c   0e80     MOVLW     0x80                       ep0Bo.Stat._byte = _USIE;           // Note: DTSEN is 0!             C:\fw\midicontroller\x001x\usb.c
00181e   6f00     MOVWF     0x0,0x1                                                                                         
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                       /*                                                                   C:\fw\midicontroller\x001x\usb.c
                                                        * 2. Prepare IN EP to transfer data, Cnt should have                C:\fw\midicontroller\x001x\usb.c
                                                        *    been initialized by responsible request owner.                 C:\fw\midicontroller\x001x\usb.c
                                                        */                                                                  C:\fw\midicontroller\x001x\usb.c
001820   0e18     MOVLW     0x18                       ep0Bi.ADR = (byte*)&CtrlTrfData;                                     C:\fw\midicontroller\x001x\usb.c
001822   6f06     MOVWF     0x6,0x1                                                                                         
001824   0e04     MOVLW     0x4                                                                                             
001826   6f07     MOVWF     0x7,0x1                                                                                         
001828   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\midicontroller\x001x\usb.c
00182a   6f04     MOVWF     0x4,0x1                                                                                         
                                                   }                                                                        C:\fw\midicontroller\x001x\usb.c
00182c   d00f     BRA       0x184c                 else    // (SetupPkt.DataDir == HOST_TO_DEV)                             C:\fw\midicontroller\x001x\usb.c
                                                   {                                                                        C:\fw\midicontroller\x001x\usb.c
00182e   0100     MOVLB     0x0                        ctrl_trf_state = CTRL_TRF_RX;                                        C:\fw\midicontroller\x001x\usb.c
001830   0e02     MOVLW     0x2                                                                                             
001832   6fa5     MOVWF     0xa5,0x1                                                                                        
                                                       /*                                                                   C:\fw\midicontroller\x001x\usb.c
                                                        * Control Write:                                                    C:\fw\midicontroller\x001x\usb.c
                                                        * <SETUP[0]><OUT[1]><OUT[0]>...<IN[1]> | <SETUP[0]>                 C:\fw\midicontroller\x001x\usb.c
                                                        *                                                                   C:\fw\midicontroller\x001x\usb.c
                                                        * 1. Prepare IN EP to respond to early termination                  C:\fw\midicontroller\x001x\usb.c
                                                        *                                                                   C:\fw\midicontroller\x001x\usb.c
                                                        *    This is the same as a Zero Length Packet Response              C:\fw\midicontroller\x001x\usb.c
                                                        *    for control transfer without a data stage                      C:\fw\midicontroller\x001x\usb.c
                                                        */                                                                  C:\fw\midicontroller\x001x\usb.c
001834   0104     MOVLB     0x4                        ep0Bi.Cnt = 0;                                                       C:\fw\midicontroller\x001x\usb.c
001836   6b05     CLRF      0x5,0x1                                                                                         
001838   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\midicontroller\x001x\usb.c
00183a   6f04     MOVWF     0x4,0x1                                                                                         
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                       /*                                                                   C:\fw\midicontroller\x001x\usb.c
                                                        * 2. Prepare OUT EP to receive data.                                C:\fw\midicontroller\x001x\usb.c
                                                        */                                                                  C:\fw\midicontroller\x001x\usb.c
00183c   0e08     MOVLW     0x8                        ep0Bo.Cnt = EP0_BUFF_SIZE;                                           C:\fw\midicontroller\x001x\usb.c
00183e   6f01     MOVWF     0x1,0x1                                                                                         
001840   0e18     MOVLW     0x18                       ep0Bo.ADR = (byte*)&CtrlTrfData;                                     C:\fw\midicontroller\x001x\usb.c
001842   6f02     MOVWF     0x2,0x1                                                                                         
001844   0e04     MOVLW     0x4                                                                                             
001846   6f03     MOVWF     0x3,0x1                                                                                         
001848   0ec8     MOVLW     0xc8                       ep0Bo.Stat._byte = _USIE|_DAT1|_DTSEN;                               C:\fw\midicontroller\x001x\usb.c
00184a   6f00     MOVWF     0x0,0x1                                                                                         
                                                   }//end if(SetupPkt.DataDir == DEV_TO_HOST)                               C:\fw\midicontroller\x001x\usb.c
                                               }//end if(ctrl_trf_session_owner == MUID_NULL)                               C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * PKTDIS bit is set when a Setup Transaction is received.                   C:\fw\midicontroller\x001x\usb.c
                                                * Clear to resume packet processing.                                        C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
00184c   986d     BCF       0x6d,0x4,0x0       UCONbits.PKTDIS = 0;                                                         C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
00184e   0012     RETURN    0x0            }//end USBCtrlEPServiceComplete                                                  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBPrepareForNextSetupTrf(void)                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        The routine forces EP0 OUT to be ready for a new Setup       C:\fw\midicontroller\x001x\usb.c
                                            *                  transaction, and forces EP0 IN to be owned by CPU.           C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBPrepareForNextSetupTrf(void)                                             C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
001850   0100     MOVLB     0x0                ctrl_trf_state = WAIT_SETUP;            // See usbctrltrf.h                  C:\fw\midicontroller\x001x\usb.c
001852   6ba5     CLRF      0xa5,0x1                                                                                        
001854   0104     MOVLB     0x4                ep0Bo.Cnt = EP0_BUFF_SIZE;              // Defined in usbcfg.h               C:\fw\midicontroller\x001x\usb.c
001856   0e08     MOVLW     0x8                                                                                             
001858   6f01     MOVWF     0x1,0x1                                                                                         
00185a   0e10     MOVLW     0x10               ep0Bo.ADR = (byte*)&SetupPkt;                                                C:\fw\midicontroller\x001x\usb.c
00185c   6f02     MOVWF     0x2,0x1                                                                                         
00185e   0e04     MOVLW     0x4                                                                                             
001860   6f03     MOVWF     0x3,0x1                                                                                         
001862   0e88     MOVLW     0x88               ep0Bo.Stat._byte = _USIE|_DAT0|_DTSEN;  // EP0 buff dsc init, see usbmmap.h  C:\fw\midicontroller\x001x\usb.c
001864   6f00     MOVWF     0x0,0x1                                                                                         
001866   6b04     CLRF      0x4,0x1            ep0Bi.Stat._byte = _UCPU;               // EP0 IN buffer initialization      C:\fw\midicontroller\x001x\usb.c
001868   0012     RETURN    0x0            }//end USBPrepareForNextSetupTrf                                                 C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** EOF usbctrltrf.c *********************************************************/  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           //usbdrv.c                                                                       C:\fw\midicontroller\x001x\usb.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #include "p18f4455.h"                                                            C:\fw\midicontroller\x001x\usb.c
                                           #include "typedefs.h"                                                            C:\fw\midicontroller\x001x\usb.c
                                           #include "usb.h"                                                                 C:\fw\midicontroller\x001x\usb.c
                                           //#include "io_cfg.h"             // Required for USBCheckBusStatus()            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #pragma udata usb5                                                               C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBModuleEnable(void);                                                      C:\fw\midicontroller\x001x\usb.c
                                           void USBModuleDisable(void);                                                     C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           void USBSuspend(void);                                                           C:\fw\midicontroller\x001x\usb.c
                                           void USBWakeFromSuspend(void);                                                   C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           void USBProtocolResetHandler(void);                                              C:\fw\midicontroller\x001x\usb.c
                                           void USB_SOF_Handler(void);                                                      C:\fw\midicontroller\x001x\usb.c
                                           void USBStallHandler(void);                                                      C:\fw\midicontroller\x001x\usb.c
                                           void USBErrorHandler(void);                                                      C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           #pragma code                                                                     C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBCheckBusStatus(void)                                 C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine enables/disables the USB module by monitoring   C:\fw\midicontroller\x001x\usb.c
                                            *                  the USB power signal.                                        C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBCheckBusStatus(void)                                                     C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
                                               /**************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                                * Bus Attachment & Detachment Detection                                     C:\fw\midicontroller\x001x\usb.c
                                                * usb_bus_sense is an i/o pin defined in io_cfg.h                           C:\fw\midicontroller\x001x\usb.c
                                                *************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                               #define USB_BUS_ATTACHED    1                                                C:\fw\midicontroller\x001x\usb.c
                                               #define USB_BUS_DETACHED    0                                                C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               if(usb_bus_sense == USB_BUS_ATTACHED)       // Is USB bus attached?          C:\fw\midicontroller\x001x\usb.c
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
00186a   a66d     BTFSS     0x6d,0x3,0x0           if(UCONbits.USBEN == 0)                 // Is the module off?            C:\fw\midicontroller\x001x\usb.c
00186c   d80f     RCALL     0x188c                     USBModuleEnable();                  // Is off, enable it             C:\fw\midicontroller\x001x\usb.c
                                               }                                                                            C:\fw\midicontroller\x001x\usb.c
00186e   d002     BRA       0x1874             else                                                                         C:\fw\midicontroller\x001x\usb.c
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
001870   b66d     BTFSC     0x6d,0x3,0x0           if(UCONbits.USBEN == 1)                 // Is the module on?             C:\fw\midicontroller\x001x\usb.c
001872   d813     RCALL     0x189a                     USBModuleDisable();                 // Is on, disable it             C:\fw\midicontroller\x001x\usb.c
                                               }//end if(usb_bus_sense...)                                                  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * After enabling the USB module, it takes some time for the voltage         C:\fw\midicontroller\x001x\usb.c
                                                * on the D+ or D- line to rise high enough to get out of the SE0 condition. C:\fw\midicontroller\x001x\usb.c
                                                * The USB Reset interrupt should not be unmasked until the SE0 condition is C:\fw\midicontroller\x001x\usb.c
                                                * cleared. This helps preventing the firmware from misinterpreting this     C:\fw\midicontroller\x001x\usb.c
                                                * unique event as a USB bus reset from the USB host.                        C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
001874   0100     MOVLB     0x0                if(usb_device_state == ATTACHED_STATE)                                       C:\fw\midicontroller\x001x\usb.c
001876   05a1     DECF      0xa1,0x0,0x1                                                                                    
001878   e108     BNZ       0x188a                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
00187a   ba6d     BTFSC     0x6d,0x5,0x0           if(!UCONbits.SE0)                                                        C:\fw\midicontroller\x001x\usb.c
00187c   d006     BRA       0x188a                                                                                          
                                                   {                                                                        C:\fw\midicontroller\x001x\usb.c
00187e   6a68     CLRF      0x68,0x0                   UIR = 0;                        // Clear all USB interrupts          C:\fw\midicontroller\x001x\usb.c
001880   6a69     CLRF      0x69,0x0                   UIE = 0;                        // Mask all USB interrupts           C:\fw\midicontroller\x001x\usb.c
001882   8069     BSF       0x69,0x0,0x0               UIEbits.URSTIE = 1;             // Unmask RESET interrupt            C:\fw\midicontroller\x001x\usb.c
001884   8869     BSF       0x69,0x4,0x0               UIEbits.IDLEIE = 1;             // Unmask IDLE interrupt             C:\fw\midicontroller\x001x\usb.c
001886   0e02     MOVLW     0x2                        usb_device_state = POWERED_STATE;                                    C:\fw\midicontroller\x001x\usb.c
001888   6fa1     MOVWF     0xa1,0x1                                                                                        
                                                   }//end if                           // else wait until SE0 is cleared    C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               }//end if(usb_device_state == ATTACHED_STATE)                                C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
00188a   0012     RETURN    0x0            }//end USBCheckBusStatus                                                         C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBModuleEnable(void)                                   C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine enables the USB module.                         C:\fw\midicontroller\x001x\usb.c
                                            *                  An end designer should never have to call this routine       C:\fw\midicontroller\x001x\usb.c
                                            *                  manually. This routine should only be called from            C:\fw\midicontroller\x001x\usb.c
                                            *                  USBCheckBusStatus().                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            See USBCheckBusStatus() for more information.                C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBModuleEnable(void)                                                       C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
00188c   6a6d     CLRF      0x6d,0x0           UCON = 0;                                                                    C:\fw\midicontroller\x001x\usb.c
00188e   6a69     CLRF      0x69,0x0           UIE = 0;                                // Mask all USB interrupts           C:\fw\midicontroller\x001x\usb.c
001890   866d     BSF       0x6d,0x3,0x0       UCONbits.USBEN = 1;                     // Enable module & attach to bus     C:\fw\midicontroller\x001x\usb.c
001892   0100     MOVLB     0x0                usb_device_state = ATTACHED_STATE;      // Defined in usbmmap.c & .h         C:\fw\midicontroller\x001x\usb.c
001894   0e01     MOVLW     0x1                                                                                             
001896   6fa1     MOVWF     0xa1,0x1                                                                                        
001898   0012     RETURN    0x0            }//end USBModuleEnable                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBModuleDisable(void)                                  C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine disables the USB module.                        C:\fw\midicontroller\x001x\usb.c
                                            *                  An end designer should never have to call this routine       C:\fw\midicontroller\x001x\usb.c
                                            *                  manually. This routine should only be called from            C:\fw\midicontroller\x001x\usb.c
                                            *                  USBCheckBusStatus().                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            See USBCheckBusStatus() for more information.                C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBModuleDisable(void)                                                      C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
00189a   6a6d     CLRF      0x6d,0x0           UCON = 0;                               // Disable module & detach from bus  C:\fw\midicontroller\x001x\usb.c
00189c   6a69     CLRF      0x69,0x0           UIE = 0;                                // Mask all USB interrupts           C:\fw\midicontroller\x001x\usb.c
00189e   0100     MOVLB     0x0                usb_device_state = DETACHED_STATE;      // Defined in usbmmap.c & .h         C:\fw\midicontroller\x001x\usb.c
0018a0   6ba1     CLRF      0xa1,0x1                                                                                        
0018a2   0012     RETURN    0x0            }//end USBModuleDisable                                                          C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBSoftDetach(void)                                     C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    The device will have to be re-enumerated to function again.  C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        USBSoftDetach electrically disconnects the device from       C:\fw\midicontroller\x001x\usb.c
                                            *                  the bus. This is done by stop supplying Vusb voltage to      C:\fw\midicontroller\x001x\usb.c
                                            *                  pull-up resistor. The pull-down resistors on the host        C:\fw\midicontroller\x001x\usb.c
                                            *                  side will pull both differential signal lines low and        C:\fw\midicontroller\x001x\usb.c
                                            *                  the host registers the event as a disconnect.                C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *                  Since the USB cable is not physically disconnected, the      C:\fw\midicontroller\x001x\usb.c
                                            *                  power supply through the cable can still be sensed by        C:\fw\midicontroller\x001x\usb.c
                                            *                  the device. The next time USBCheckBusStatus() function       C:\fw\midicontroller\x001x\usb.c
                                            *                  is called, it will reconnect the device back to the bus.     C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBSoftDetach(void)                                                         C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
0018a4   ef4d     GOTO      0x189a             USBModuleDisable();                                                          C:\fw\midicontroller\x001x\usb.c
0018a6   f00c                                                                                                               
                                           }//end USBSoftDetach                                                             C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBDriverService(void)                                  C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This routine is the heart of this firmware. It manages       C:\fw\midicontroller\x001x\usb.c
                                            *                  all USB interrupts.                                          C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            Device state transitions through the following stages:       C:\fw\midicontroller\x001x\usb.c
                                            *                  DETACHED -> ATTACHED -> POWERED -> DEFAULT ->                C:\fw\midicontroller\x001x\usb.c
                                            *                  ADDRESS_PENDING -> ADDRESSED -> CONFIGURED -> READY          C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBDriverService(void)                                                      C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * Pointless to continue servicing if USB cable is not even attached.        C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
0018a8   0100     MOVLB     0x0                if(usb_device_state == DETACHED_STATE) return;                               C:\fw\midicontroller\x001x\usb.c
0018aa   51a1     MOVF      0xa1,0x0,0x1                                                                                    
0018ac   e101     BNZ       0x18b0                                                                                          
0018ae   d039     BRA       0x1922                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * Task A: Service USB Activity Interrupt                                    C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
0018b0   5068     MOVF      0x68,0x0,0x0       if(UIRbits.ACTVIF && UIEbits.ACTVIE)    USBWakeFromSuspend();                C:\fw\midicontroller\x001x\usb.c
0018b2   0b04     ANDLW     0x4                                                                                             
0018b4   e004     BZ        0x18be                                                                                          
0018b6   5069     MOVF      0x69,0x0,0x0                                                                                    
0018b8   0b04     ANDLW     0x4                                                                                             
0018ba   e001     BZ        0x18be                                                                                          
0018bc   d838     RCALL     0x192e                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * Pointless to continue servicing if the device is in suspend mode.         C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
0018be   b26d     BTFSC     0x6d,0x1,0x0       if(UCONbits.SUSPND==1) return;                                               C:\fw\midicontroller\x001x\usb.c
0018c0   d030     BRA       0x1922                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * Task B: Service USB Bus Reset Interrupt.                                  C:\fw\midicontroller\x001x\usb.c
                                                * When bus reset is received during suspend, ACTVIF will be set first,      C:\fw\midicontroller\x001x\usb.c
                                                * once the UCONbits.SUSPND is clear, then the URSTIF bit will be asserted.  C:\fw\midicontroller\x001x\usb.c
                                                * This is why URSTIF is checked after ACTVIF.                               C:\fw\midicontroller\x001x\usb.c
                                                *                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * The USB reset flag is masked when the USB state is in                     C:\fw\midicontroller\x001x\usb.c
                                                * DETACHED_STATE or ATTACHED_STATE, and therefore cannot                    C:\fw\midicontroller\x001x\usb.c
                                                * cause a USB reset event during these two states.                          C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
0018c2   5068     MOVF      0x68,0x0,0x0       if(UIRbits.URSTIF && UIEbits.URSTIE)    USBProtocolResetHandler();           C:\fw\midicontroller\x001x\usb.c
0018c4   0b01     ANDLW     0x1                                                                                             
0018c6   e004     BZ        0x18d0                                                                                          
0018c8   5069     MOVF      0x69,0x0,0x0                                                                                    
0018ca   0b01     ANDLW     0x1                                                                                             
0018cc   e001     BZ        0x18d0                                                                                          
0018ce   d84f     RCALL     0x196e                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * Task C: Service other USB interrupts                                      C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
0018d0   5068     MOVF      0x68,0x0,0x0       if(UIRbits.IDLEIF && UIEbits.IDLEIE)    USBSuspend();                        C:\fw\midicontroller\x001x\usb.c
0018d2   0b10     ANDLW     0x10                                                                                            
0018d4   e004     BZ        0x18de                                                                                          
0018d6   5069     MOVF      0x69,0x0,0x0                                                                                    
0018d8   0b10     ANDLW     0x10                                                                                            
0018da   e001     BZ        0x18de                                                                                          
0018dc   d823     RCALL     0x1924                                                                                          
0018de   5068     MOVF      0x68,0x0,0x0       if(UIRbits.SOFIF && UIEbits.SOFIE)      USB_SOF_Handler();                   C:\fw\midicontroller\x001x\usb.c
0018e0   0b40     ANDLW     0x40                                                                                            
0018e2   e004     BZ        0x18ec                                                                                          
0018e4   5069     MOVF      0x69,0x0,0x0                                                                                    
0018e6   0b40     ANDLW     0x40                                                                                            
0018e8   e001     BZ        0x18ec                                                                                          
0018ea   d837     RCALL     0x195a                                                                                          
0018ec   5068     MOVF      0x68,0x0,0x0       if(UIRbits.STALLIF && UIEbits.STALLIE)  USBStallHandler();                   C:\fw\midicontroller\x001x\usb.c
0018ee   0b20     ANDLW     0x20                                                                                            
0018f0   e004     BZ        0x18fa                                                                                          
0018f2   5069     MOVF      0x69,0x0,0x0                                                                                    
0018f4   0b20     ANDLW     0x20                                                                                            
0018f6   e001     BZ        0x18fa                                                                                          
0018f8   d832     RCALL     0x195e                                                                                          
0018fa   5068     MOVF      0x68,0x0,0x0       if(UIRbits.UERRIF && UIEbits.UERRIE)    USBErrorHandler();                   C:\fw\midicontroller\x001x\usb.c
0018fc   0b02     ANDLW     0x2                                                                                             
0018fe   e004     BZ        0x1908                                                                                          
001900   5069     MOVF      0x69,0x0,0x0                                                                                    
001902   0b02     ANDLW     0x2                                                                                             
001904   e001     BZ        0x1908                                                                                          
001906   d831     RCALL     0x196a                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * Pointless to continue servicing if the host has not sent a bus reset.     C:\fw\midicontroller\x001x\usb.c
                                                * Once bus reset is received, the device transitions into the DEFAULT       C:\fw\midicontroller\x001x\usb.c
                                                * state and is ready for communication.                                     C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
001908   0e03     MOVLW     0x3                if(usb_device_state < DEFAULT_STATE) return;                                 C:\fw\midicontroller\x001x\usb.c
00190a   0100     MOVLB     0x0                                                                                             
00190c   5da1     SUBWF     0xa1,0x0,0x1                                                                                    
00190e   e201     BC        0x1912                                                                                          
001910   d008     BRA       0x1922                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * Task D: Servicing USB Transaction Complete Interrupt                      C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
001912   5068     MOVF      0x68,0x0,0x0       if(UIRbits.TRNIF && UIEbits.TRNIE)                                           C:\fw\midicontroller\x001x\usb.c
001914   0b08     ANDLW     0x8                                                                                             
001916   e005     BZ        0x1922                                                                                          
001918   5069     MOVF      0x69,0x0,0x0                                                                                    
00191a   0b08     ANDLW     0x8                                                                                             
00191c   e002     BZ        0x1922                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   /*                                                                       C:\fw\midicontroller\x001x\usb.c
                                                    * USBCtrlEPService only services transactions over EP0.                 C:\fw\midicontroller\x001x\usb.c
                                                    * It ignores all other EP transactions.                                 C:\fw\midicontroller\x001x\usb.c
                                                    */                                                                      C:\fw\midicontroller\x001x\usb.c
00191e   de34     RCALL     0x1588                 USBCtrlEPService();                                                      C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   /*                                                                       C:\fw\midicontroller\x001x\usb.c
                                                    * Other EP can be serviced later by responsible device class firmware.  C:\fw\midicontroller\x001x\usb.c
                                                    * Each device driver knows when an OUT or IN transaction is ready by    C:\fw\midicontroller\x001x\usb.c
                                                    * checking the buffer ownership bit.                                    C:\fw\midicontroller\x001x\usb.c
                                                    * An OUT EP should always be owned by SIE until the data is ready.      C:\fw\midicontroller\x001x\usb.c
                                                    * An IN EP should always be owned by CPU until the data is ready.       C:\fw\midicontroller\x001x\usb.c
                                                    *                                                                       C:\fw\midicontroller\x001x\usb.c
                                                    * Because of this logic, it is not necessary to save the USTAT value    C:\fw\midicontroller\x001x\usb.c
                                                    * of non-EP0 transactions.                                              C:\fw\midicontroller\x001x\usb.c
                                                    */                                                                      C:\fw\midicontroller\x001x\usb.c
001920   9668     BCF       0x68,0x3,0x0           UIRbits.TRNIF = 0;                                                       C:\fw\midicontroller\x001x\usb.c
                                               }//end if(UIRbits.TRNIF && UIEbits.TRNIE)                                    C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001922   0012     RETURN    0x0            }//end USBDriverService                                                          C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBSuspend(void)                                        C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:                                                                     C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBSuspend(void)                                                            C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * NOTE: Do not clear UIRbits.ACTVIF here!                                   C:\fw\midicontroller\x001x\usb.c
                                                * Reason:                                                                   C:\fw\midicontroller\x001x\usb.c
                                                * ACTVIF is only generated once an IDLEIF has been generated.               C:\fw\midicontroller\x001x\usb.c
                                                * This is a 1:1 ratio interrupt generation.                                 C:\fw\midicontroller\x001x\usb.c
                                                * For every IDLEIF, there will be only one ACTVIF regardless of             C:\fw\midicontroller\x001x\usb.c
                                                * the number of subsequent bus transitions.                                 C:\fw\midicontroller\x001x\usb.c
                                                *                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * If the ACTIF is cleared here, a problem could occur when:                 C:\fw\midicontroller\x001x\usb.c
                                                * [       IDLE       ][bus activity ->                                      C:\fw\midicontroller\x001x\usb.c
                                                * <--- 3 ms ----->     ^                                                    C:\fw\midicontroller\x001x\usb.c
                                                *                ^     ACTVIF=1                                             C:\fw\midicontroller\x001x\usb.c
                                                *                IDLEIF=1                                                   C:\fw\midicontroller\x001x\usb.c
                                                *  #           #           #           #   (#=Program polling flags)        C:\fw\midicontroller\x001x\usb.c
                                                *                          ^                                                C:\fw\midicontroller\x001x\usb.c
                                                *                          This polling loop will see both                  C:\fw\midicontroller\x001x\usb.c
                                                *                          IDLEIF=1 and ACTVIF=1.                           C:\fw\midicontroller\x001x\usb.c
                                                *                          However, the program services IDLEIF first       C:\fw\midicontroller\x001x\usb.c
                                                *                          because ACTIVIE=0.                               C:\fw\midicontroller\x001x\usb.c
                                                *                          If this routine clears the only ACTIVIF,         C:\fw\midicontroller\x001x\usb.c
                                                *                          then it can never get out of the suspend         C:\fw\midicontroller\x001x\usb.c
                                                *                          mode.                                            C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
001924   8469     BSF       0x69,0x2,0x0       UIEbits.ACTVIE = 1;                     // Enable bus activity interrupt     C:\fw\midicontroller\x001x\usb.c
001926   9868     BCF       0x68,0x4,0x0       UIRbits.IDLEIF = 0;                                                          C:\fw\midicontroller\x001x\usb.c
001928   826d     BSF       0x6d,0x1,0x0       UCONbits.SUSPND = 1;                    // Put USB module in power conserve  C:\fw\midicontroller\x001x\usb.c
                                                                                       // mode, SIE clock inactive          C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * At this point the PIC can go into sleep,idle, or                          C:\fw\midicontroller\x001x\usb.c
                                                * switch to a slower clock, etc.                                            C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               /* Modifiable Section */                                                     C:\fw\midicontroller\x001x\usb.c
00192a   9aa1     BCF       0xa1,0x5,0x0       PIR2bits.USBIF = 0;                                                          C:\fw\midicontroller\x001x\usb.c
                                           /*                                                                               C:\fw\midicontroller\x001x\usb.c
                                           //2/15/05 JD This was causing problems with USBIE being enabled..                C:\fw\midicontroller\x001x\usb.c
                                               INTCONbits.RBIF = 0;                                                         C:\fw\midicontroller\x001x\usb.c
                                               PIE2bits.USBIE = 1;                     // Set USB wakeup source             C:\fw\midicontroller\x001x\usb.c
                                               INTCONbits.RBIE = 1;                    // Set sw2,3 wakeup source           C:\fw\midicontroller\x001x\usb.c
                                               Sleep();                                // Goto sleep                        C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                               if(INTCONbits.RBIF == 1)                // Check if external stimulus        C:\fw\midicontroller\x001x\usb.c
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   USBRemoteWakeup();                  // If yes, attempt RWU               C:\fw\midicontroller\x001x\usb.c
                                               }                                                                            C:\fw\midicontroller\x001x\usb.c
                                               PIE2bits.USBIE = 0;                                                          C:\fw\midicontroller\x001x\usb.c
                                               INTCONbits.RBIE = 0;                                                         C:\fw\midicontroller\x001x\usb.c
                                           */                                                                               C:\fw\midicontroller\x001x\usb.c
                                               /* End Modifiable Section */                                                 C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
00192c   0012     RETURN    0x0            }//end USBSuspend                                                                C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBWakeFromSuspend(void)                                C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:                                                                     C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBWakeFromSuspend(void)                                                    C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * If using clock switching, this is the place to restore the                C:\fw\midicontroller\x001x\usb.c
                                                * original clock frequency.                                                 C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
00192e   926d     BCF       0x6d,0x1,0x0       UCONbits.SUSPND = 0;                                                         C:\fw\midicontroller\x001x\usb.c
001930   9469     BCF       0x69,0x2,0x0       UIEbits.ACTVIE = 0;                                                          C:\fw\midicontroller\x001x\usb.c
001932   9468     BCF       0x68,0x2,0x0       UIRbits.ACTVIF = 0;                                                          C:\fw\midicontroller\x001x\usb.c
001934   0012     RETURN    0x0            }//end USBWakeFromSuspend                                                        C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBRemoteWakeup(void)                                   C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        This function should be called by user when the device       C:\fw\midicontroller\x001x\usb.c
                                            *                  is waken up by an external stimulus other than ACTIVIF.      C:\fw\midicontroller\x001x\usb.c
                                            *                  Please read the note below to understand the limitations.    C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            The modifiable section in this routine should be changed     C:\fw\midicontroller\x001x\usb.c
                                            *                  to meet the application needs. Current implementation        C:\fw\midicontroller\x001x\usb.c
                                            *                  temporary blocks other functions from executing for a        C:\fw\midicontroller\x001x\usb.c
                                            *                  period of 1-13 ms depending on the core frequency.           C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *                  According to USB 2.0 specification section 7.1.7.7,          C:\fw\midicontroller\x001x\usb.c
                                            *                  "The remote wakeup device must hold the resume signaling     C:\fw\midicontroller\x001x\usb.c
                                            *                  for at lest 1 ms but for no more than 15 ms."                C:\fw\midicontroller\x001x\usb.c
                                            *                  The idea here is to use a delay counter loop, using a        C:\fw\midicontroller\x001x\usb.c
                                            *                  common value that would work over a wide range of core       C:\fw\midicontroller\x001x\usb.c
                                            *                  frequencies.                                                 C:\fw\midicontroller\x001x\usb.c
                                            *                  That value selected is 1800. See table below:                C:\fw\midicontroller\x001x\usb.c
                                            *                  ==========================================================   C:\fw\midicontroller\x001x\usb.c
                                            *                  Core Freq(MHz)      MIP         RESUME Signal Period (ms)    C:\fw\midicontroller\x001x\usb.c
                                            *                  ==========================================================   C:\fw\midicontroller\x001x\usb.c
                                            *                      48              12          1.05                         C:\fw\midicontroller\x001x\usb.c
                                            *                       4              1           12.6                         C:\fw\midicontroller\x001x\usb.c
                                            *                  ==========================================================   C:\fw\midicontroller\x001x\usb.c
                                            *                  * These timing could be incorrect when using code            C:\fw\midicontroller\x001x\usb.c
                                            *                    optimization or extended instruction mode,                 C:\fw\midicontroller\x001x\usb.c
                                            *                    or when having other interrupts enabled.                   C:\fw\midicontroller\x001x\usb.c
                                            *                    Make sure to verify using the MPLAB SIM's Stopwatch        C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBRemoteWakeup(void)                                                       C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
                                               static word delay_count;                                                     C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001936   0100     MOVLB     0x0                if(usb_stat.RemoteWakeup == 1)          // Check if RemoteWakeup function    C:\fw\midicontroller\x001x\usb.c
001938   a1a2     BTFSS     0xa2,0x0,0x1                                                                                    
00193a   d00e     BRA       0x1958                                                                                          
                                               {                                       // has been enabled by the host.     C:\fw\midicontroller\x001x\usb.c
00193c   dff8     RCALL     0x192e                 USBWakeFromSuspend();               // Unsuspend USB modue               C:\fw\midicontroller\x001x\usb.c
00193e   846d     BSF       0x6d,0x2,0x0           UCONbits.RESUME = 1;                // Start RESUME signaling            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   /* Modifiable Section */                                                 C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001940   0100     MOVLB     0x0                    delay_count = 1800U;                // Set RESUME line for 1-13 ms       C:\fw\midicontroller\x001x\usb.c
001942   0e08     MOVLW     0x8                                                                                             
001944   6fad     MOVWF     0xad,0x1                                                                                        
001946   0e07     MOVLW     0x7                                                                                             
001948   6fae     MOVWF     0xae,0x1                                                                                        
                                                   do                                                                       C:\fw\midicontroller\x001x\usb.c
                                                   {                                                                        C:\fw\midicontroller\x001x\usb.c
00194a   07ad     DECF      0xad,0x1,0x1               delay_count--;                                                       C:\fw\midicontroller\x001x\usb.c
00194c   0e00     MOVLW     0x0                                                                                             
00194e   5bae     SUBWFB    0xae,0x1,0x1                                                                                    
001950   51ad     MOVF      0xad,0x0,0x1           }while(delay_count);                                                     C:\fw\midicontroller\x001x\usb.c
001952   11ae     IORWF     0xae,0x0,0x1                                                                                    
001954   e1fa     BNZ       0x194a                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   /* End Modifiable Section */                                             C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001956   946d     BCF       0x6d,0x2,0x0           UCONbits.RESUME = 0;                                                     C:\fw\midicontroller\x001x\usb.c
                                               }//endif                                                                     C:\fw\midicontroller\x001x\usb.c
001958   0012     RETURN    0x0            }//end USBRemoteWakeup                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USB_SOF_Handler(void)                                   C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        The USB host sends out a SOF packet to full-speed devices    C:\fw\midicontroller\x001x\usb.c
                                            *                  every 1 ms. This interrupt may be useful for isochronous     C:\fw\midicontroller\x001x\usb.c
                                            *                  pipes. End designers should implement callback routine       C:\fw\midicontroller\x001x\usb.c
                                            *                  as necessary.                                                C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USB_SOF_Handler(void)                                                       C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
                                               /* Callback routine here */                                                  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
00195a   9c68     BCF       0x68,0x6,0x0       UIRbits.SOFIF = 0;                                                           C:\fw\midicontroller\x001x\usb.c
00195c   0012     RETURN    0x0            }//end USB_SOF_Handler                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBStallHandler(void)                                   C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    A STALL packet is sent to the host by the SIE.               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        The STALLIF is set anytime the SIE sends out a STALL         C:\fw\midicontroller\x001x\usb.c
                                            *                  packet regardless of which endpoint causes it.               C:\fw\midicontroller\x001x\usb.c
                                            *                  A Setup transaction overrides the STALL function. A stalled  C:\fw\midicontroller\x001x\usb.c
                                            *                  endpoint stops stalling once it receives a setup packet.     C:\fw\midicontroller\x001x\usb.c
                                            *                  In this case, the SIE will accepts the Setup packet and      C:\fw\midicontroller\x001x\usb.c
                                            *                  set the TRNIF flag to notify the firmware. STALL function    C:\fw\midicontroller\x001x\usb.c
                                            *                  for that particular endpoint pipe will be automatically      C:\fw\midicontroller\x001x\usb.c
                                            *                  disabled (direction specific).                               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            *                  There are a few reasons for an endpoint to be stalled.       C:\fw\midicontroller\x001x\usb.c
                                            *                  1. When a non-supported USB request is received.             C:\fw\midicontroller\x001x\usb.c
                                            *                     Example: GET_DESCRIPTOR(DEVICE_QUALIFIER)                 C:\fw\midicontroller\x001x\usb.c
                                            *                  2. When an endpoint is currently halted.                     C:\fw\midicontroller\x001x\usb.c
                                            *                  3. When the device class specifies that an endpoint must     C:\fw\midicontroller\x001x\usb.c
                                            *                     stall in response to a specific event.                    C:\fw\midicontroller\x001x\usb.c
                                            *                     Example: Mass Storage Device Class                        C:\fw\midicontroller\x001x\usb.c
                                            *                              If the CBW is not valid, the device shall        C:\fw\midicontroller\x001x\usb.c
                                            *                              STALL the Bulk-In pipe.                          C:\fw\midicontroller\x001x\usb.c
                                            *                              See USB Mass Storage Class Bulk-only Transport   C:\fw\midicontroller\x001x\usb.c
                                            *                              Specification for more details.                  C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            UEPn.EPSTALL can be scanned to see which endpoint causes     C:\fw\midicontroller\x001x\usb.c
                                            *                  the stall event.                                             C:\fw\midicontroller\x001x\usb.c
                                            *                  If                                                           C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBStallHandler(void)                                                       C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
                                               /*                                                                           C:\fw\midicontroller\x001x\usb.c
                                                * Does not really have to do anything here,                                 C:\fw\midicontroller\x001x\usb.c
                                                * even for the control endpoint.                                            C:\fw\midicontroller\x001x\usb.c
                                                * All BDs of Endpoint 0 are owned by SIE right now,                         C:\fw\midicontroller\x001x\usb.c
                                                * but once a Setup Transaction is received, the ownership                   C:\fw\midicontroller\x001x\usb.c
                                                * for EP0_OUT will be returned to CPU.                                      C:\fw\midicontroller\x001x\usb.c
                                                * When the Setup Transaction is serviced, the ownership                     C:\fw\midicontroller\x001x\usb.c
                                                * for EP0_IN will then be forced back to CPU by firmware.                   C:\fw\midicontroller\x001x\usb.c
                                                */                                                                          C:\fw\midicontroller\x001x\usb.c
00195e   a070     BTFSS     0x70,0x0,0x0       if(UEP0bits.EPSTALL == 1)                                                    C:\fw\midicontroller\x001x\usb.c
001960   d002     BRA       0x1966                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
001962   df76     RCALL     0x1850                 USBPrepareForNextSetupTrf();        // Firmware work-around              C:\fw\midicontroller\x001x\usb.c
001964   9070     BCF       0x70,0x0,0x0           UEP0bits.EPSTALL = 0;                                                    C:\fw\midicontroller\x001x\usb.c
                                               }                                                                            C:\fw\midicontroller\x001x\usb.c
001966   9a68     BCF       0x68,0x5,0x0       UIRbits.STALLIF = 0;                                                         C:\fw\midicontroller\x001x\usb.c
001968   0012     RETURN    0x0            }//end USBStallHandler                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBErrorHandler(void)                                   C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        The purpose of this interrupt is mainly for debugging        C:\fw\midicontroller\x001x\usb.c
                                            *                  during development. Check UEIR to see which error causes     C:\fw\midicontroller\x001x\usb.c
                                            *                  the interrupt.                                               C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBErrorHandler(void)                                                       C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
00196a   9268     BCF       0x68,0x1,0x0       UIRbits.UERRIF = 0;                                                          C:\fw\midicontroller\x001x\usb.c
00196c   0012     RETURN    0x0            }//end USBErrorHandler                                                           C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\usb.c
                                            * Function:        void USBProtocolResetHandler(void)                           C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * PreCondition:    A USB bus reset is received from the host.                   C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Side Effects:    Currently, this routine flushes any pending USB              C:\fw\midicontroller\x001x\usb.c
                                            *                  transactions. It empties out the USTAT FIFO. This action     C:\fw\midicontroller\x001x\usb.c
                                            *                  might not be desirable in some applications.                 C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Overview:        Once a USB bus reset is received from the host, this         C:\fw\midicontroller\x001x\usb.c
                                            *                  routine should be called. It resets the device address to    C:\fw\midicontroller\x001x\usb.c
                                            *                  zero, disables all non-EP0 endpoints, initializes EP0 to     C:\fw\midicontroller\x001x\usb.c
                                            *                  be ready for default communication, clears all USB           C:\fw\midicontroller\x001x\usb.c
                                            *                  interrupt flags, unmasks applicable USB interrupts, and      C:\fw\midicontroller\x001x\usb.c
                                            *                  reinitializes internal state-machine variables.              C:\fw\midicontroller\x001x\usb.c
                                            *                                                                               C:\fw\midicontroller\x001x\usb.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\usb.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                           void USBProtocolResetHandler(void)                                               C:\fw\midicontroller\x001x\usb.c
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
00196e   6a6a     CLRF      0x6a,0x0           UEIR = 0;                       // Clear all USB error flags                 C:\fw\midicontroller\x001x\usb.c
001970   6a68     CLRF      0x68,0x0           UIR = 0;                        // Clears all USB interrupts                 C:\fw\midicontroller\x001x\usb.c
001972   0e9f     MOVLW     0x9f               UEIE = 0b10011111;              // Unmask all USB error interrupts           C:\fw\midicontroller\x001x\usb.c
001974   6e6b     MOVWF     0x6b,0x0                                                                                        
001976   0e7b     MOVLW     0x7b               UIE = 0b01111011;               // Enable all interrupts except ACTVIE       C:\fw\midicontroller\x001x\usb.c
001978   6e69     MOVWF     0x69,0x0                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
00197a   6a6e     CLRF      0x6e,0x0           UADDR = 0x00;                   // Reset to default address                  C:\fw\midicontroller\x001x\usb.c
00197c   0e0f     MOVLW     0xf                mDisableEP1to15();              // Reset all non-EP0 UEPn registers          C:\fw\midicontroller\x001x\usb.c
00197e   6ee6     MOVWF     0xe6,0x0                                                                                        
001980   0e71     MOVLW     0x71                                                                                            
001982   6ee6     MOVWF     0xe6,0x0                                                                                        
001984   0e0f     MOVLW     0xf                                                                                             
001986   6ee6     MOVWF     0xe6,0x0                                                                                        
001988   d811     RCALL     0x19ac                                                                                          
00198a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00198c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00198e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001990   0e16     MOVLW     0x16               UEP0 = EP_CTRL|HSHK_EN;         // Init EP0 as a Ctrl EP, see usbdrv.h       C:\fw\midicontroller\x001x\usb.c
001992   6e70     MOVWF     0x70,0x0                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
001994   a668     BTFSS     0x68,0x3,0x0       while(UIRbits.TRNIF == 1)       // Flush any pending transactions            C:\fw\midicontroller\x001x\usb.c
001996   d002     BRA       0x199c                                                                                          
00199a   d7fc     BRA       0x1994                                                                                          
001998   9668     BCF       0x68,0x3,0x0           UIRbits.TRNIF = 0;                                                       C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
00199c   986d     BCF       0x6d,0x4,0x0       UCONbits.PKTDIS = 0;            // Make sure packet processing is enabled    C:\fw\midicontroller\x001x\usb.c
00199e   df58     RCALL     0x1850             USBPrepareForNextSetupTrf();    // Declared in usbctrltrf.c                  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
0019a0   0100     MOVLB     0x0                usb_stat.RemoteWakeup = 0;      // Default status flag to disable            C:\fw\midicontroller\x001x\usb.c
0019a2   91a2     BCF       0xa2,0x0,0x1                                                                                    
0019a4   6ba3     CLRF      0xa3,0x1           usb_active_cfg = 0;             // Clear active configuration                C:\fw\midicontroller\x001x\usb.c
0019a6   0e03     MOVLW     0x3                usb_device_state = DEFAULT_STATE;                                            C:\fw\midicontroller\x001x\usb.c
0019a8   6fa1     MOVWF     0xa1,0x1                                                                                        
0019aa   0012     RETURN    0x0            }//end USBProtocolResetHandler                                                   C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /* Auxiliary Function */                                                         C:\fw\midicontroller\x001x\usb.c
0019ac   cfd9     MOVFF     0xfd9,0xfe6    void ClearArray(byte* startAdr,byte count)                                       C:\fw\midicontroller\x001x\usb.c
0019ae   ffe6                                                                                                               
0019b0   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
0019b2   ffd9                                                                                                               
                                           {                                                                                C:\fw\midicontroller\x001x\usb.c
0019b4   0efd     MOVLW     0xfd               *startAdr;                                                                   C:\fw\midicontroller\x001x\usb.c
0019b6   cfdb     MOVFF     0xfdb,0xfe9                                                                                     
0019b8   ffe9                                                                                                               
0019ba   0efe     MOVLW     0xfe                                                                                            
0019bc   cfdb     MOVFF     0xfdb,0xfea                                                                                     
0019be   ffea                                                                                                               
0019c0   0efc     MOVLW     0xfc               while(count)                                                                 C:\fw\midicontroller\x001x\usb.c
0019c2   50db     MOVF      0xdb,0x0,0x0                                                                                    
0019c4   e004     BZ        0x19ce                                                                                          
0019cc   d7f9     BRA       0x19c0                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\usb.c
                                                   _asm                                                                     C:\fw\midicontroller\x001x\usb.c
0019c6   6aee     CLRF      0xee,0x0               clrf POSTINC0,0                                                          C:\fw\midicontroller\x001x\usb.c
                                                   _endasm                                                                  C:\fw\midicontroller\x001x\usb.c
0019c8   0efc     MOVLW     0xfc                   count--;                                                                 C:\fw\midicontroller\x001x\usb.c
0019ca   06db     DECF      0xdb,0x1,0x0                                                                                    
                                               }//end while                                                                 C:\fw\midicontroller\x001x\usb.c
0019ce   52e5     MOVF      0xe5,0x1,0x0   }//end ClearArray                                                                C:\fw\midicontroller\x001x\usb.c
0019d0   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
0019d2   ffd9                                                                                                               
0019d4   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                           /** EOF usbdrv.c *************************************************************/  C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usb.c
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\midicontroller\x001x\usbapplet.c
                                           #include "p18f4455.h"                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           #include "c_system.h"                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           #include "typedefs.h"                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           #include "usb.h"                                                                 C:\fw\midicontroller\x001x\usbapplet.c
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           void PROCESS_COMM_REQUEST(void);                                                 C:\fw\midicontroller\x001x\usbapplet.c
                                           //void RemCapCalculation(void);                                                  C:\fw\midicontroller\x001x\usbapplet.c
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           void HIDSetReportHandler(void) {                                                 C:\fw\midicontroller\x001x\usbapplet.c
001e48   0102     MOVLB     0x2            	USBQuery = true;                                                                C:\fw\midicontroller\x001x\usbapplet.c
001e4a   89c3     BSF       0xc3,0x4,0x1                                                                                    
001e4c   ec16     CALL      0xa2c,0x0      	PROCESS_COMM_REQUEST();                                                         C:\fw\midicontroller\x001x\usbapplet.c
001e4e   f005                                                                                                               
001e50   0102     MOVLB     0x2            	USBQuery = false;	                                                              C:\fw\midicontroller\x001x\usbapplet.c
001e52   99c3     BCF       0xc3,0x4,0x1                                                                                    
001e54   0012     RETURN    0x0            }                                                                                C:\fw\midicontroller\x001x\usbapplet.c
                                           //-----------------------------------------------------------------------        C:\fw\midicontroller\x001x\usbapplet.c
                                           void HIDGetReportHandler(void) {                                                 C:\fw\midicontroller\x001x\usbapplet.c
                                           //load up CtrlTrfData with data.                                                 C:\fw\midicontroller\x001x\usbapplet.c
001e56   0102     MOVLB     0x2            	USBQuery = true;                                                                C:\fw\midicontroller\x001x\usbapplet.c
001e58   89c3     BSF       0xc3,0x4,0x1                                                                                    
001e5a   ec16     CALL      0xa2c,0x0      	PROCESS_COMM_REQUEST();                                                         C:\fw\midicontroller\x001x\usbapplet.c
001e5c   f005                                                                                                               
001e5e   0100     MOVLB     0x0            	ctrl_trf_session_owner = MUID_HID;                                              C:\fw\midicontroller\x001x\usbapplet.c
001e60   0e02     MOVLW     0x2                                                                                             
001e62   6fa6     MOVWF     0xa6,0x1                                                                                        
001e64   0100     MOVLB     0x0            	pSrc.bRam = (byte*)&CtrlTrfData;                                                C:\fw\midicontroller\x001x\usbapplet.c
001e66   0e18     MOVLW     0x18                                                                                            
001e68   6fa7     MOVWF     0xa7,0x1                                                                                        
001e6a   0e04     MOVLW     0x4                                                                                             
001e6c   6fa8     MOVWF     0xa8,0x1                                                                                        
001e6e   0100     MOVLB     0x0            	usb_stat.ctrl_trf_mem = _RAM;       // Set memory type                          C:\fw\midicontroller\x001x\usbapplet.c
001e70   93a2     BCF       0xa2,0x1,0x1                                                                                    
001e72   0102     MOVLB     0x2            	USBQuery = false;                                                               C:\fw\midicontroller\x001x\usbapplet.c
001e74   99c3     BCF       0xc3,0x4,0x1                                                                                    
001e76   0012     RETURN    0x0            }                                                                                C:\fw\midicontroller\x001x\usbapplet.c
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           unsigned char EP1Buffer[64];                                                     C:\fw\midicontroller\x001x\usbapplet.c
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           extern TwoBytes DataBuffer[220];                                                 C:\fw\midicontroller\x001x\usbapplet.c
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           unsigned char InputDataPointer;                                                  C:\fw\midicontroller\x001x\usbapplet.c
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
001e78   cfd9     MOVFF     0xfd9,0xfe6    void ServiceEP1(void) {                                                          C:\fw\midicontroller\x001x\usbapplet.c
001e7a   ffe6                                                                                                               
001e7c   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001e7e   ffd9                                                                                                               
001e80   0e04     MOVLW     0x4                                                                                             
001e82   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           	BitField ByteToSend, NumBytes;                                                  C:\fw\midicontroller\x001x\usbapplet.c
                                           	unsigned char tempvar1, tempvar0;                                               C:\fw\midicontroller\x001x\usbapplet.c
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           	                                                                                C:\fw\midicontroller\x001x\usbapplet.c
001e84   0102     MOVLB     0x2            	ServiceEP1Data = false;                                                         C:\fw\midicontroller\x001x\usbapplet.c
001e86   9bc3     BCF       0xc3,0x5,0x1                                                                                    
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           	//report ID 52                                                                  C:\fw\midicontroller\x001x\usbapplet.c
001e88   0100     MOVLB     0x0            	EP1Buffer[0] = 0xB0;				//0th byte is report id                                 C:\fw\midicontroller\x001x\usbapplet.c
001e8a   0eb0     MOVLW     0xb0                                                                                            
001e8c   6f60     MOVWF     0x60,0x1                                                                                        
001e8e   c0a0     MOVFF     0xa0,0x61      	EP1Buffer[1] = InputDataPointer;                                                C:\fw\midicontroller\x001x\usbapplet.c
001e90   f061                                                                                                               
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
001e92   0e02     MOVLW     0x2            	tempvar1 = 0;                                                                   C:\fw\midicontroller\x001x\usbapplet.c
001e94   6adb     CLRF      0xdb,0x0                                                                                        
001e96   0e03     MOVLW     0x3            	for (tempvar0 = 0;tempvar0 < 30;tempvar0++) {                                   C:\fw\midicontroller\x001x\usbapplet.c
001e98   6adb     CLRF      0xdb,0x0                                                                                        
001e9a   0e1e     MOVLW     0x1e                                                                                            
001e9c   6ef3     MOVWF     0xf3,0x0                                                                                        
001e9e   0e03     MOVLW     0x3                                                                                             
001ea0   cfdb     MOVFF     0xfdb,0xff4                                                                                     
001ea2   fff4                                                                                                               
001ea4   50f3     MOVF      0xf3,0x0,0x0                                                                                    
001ea6   5cf4     SUBWF     0xf4,0x0,0x0                                                                                    
001ea8   e234     BC        0x1f12                                                                                          
001f0c   0e03     MOVLW     0x3                                                                                             
001f0e   2adb     INCF      0xdb,0x1,0x0                                                                                    
001f10   d7c4     BRA       0x1e9a                                                                                          
001eaa   0e03     MOVLW     0x3            		EP1Buffer[tempvar1] = DataBuffer[tempvar0].b_form.low;                         C:\fw\midicontroller\x001x\usbapplet.c
001eac   6aea     CLRF      0xea,0x0                                                                                        
001eae   34db     RLCF      0xdb,0x0,0x0                                                                                    
001eb0   0bfe     ANDLW     0xfe                                                                                            
001eb2   36ea     RLCF      0xea,0x1,0x0                                                                                    
001eb4   6ee9     MOVWF     0xe9,0x0                                                                                        
001eb6   0e03     MOVLW     0x3                                                                                             
001eb8   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001eba   0e01     MOVLW     0x1                                                                                             
001ebc   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001ebe   50ef     MOVF      0xef,0x0,0x0                                                                                    
001ec0   6ee6     MOVWF     0xe6,0x0                                                                                        
001ec2   0e02     MOVLW     0x2                                                                                             
001ec4   50db     MOVF      0xdb,0x0,0x0                                                                                    
001ec6   6aea     CLRF      0xea,0x0                                                                                        
001ec8   0f60     ADDLW     0x60                                                                                            
001eca   6ee9     MOVWF     0xe9,0x0                                                                                        
001ecc   0e00     MOVLW     0x0                                                                                             
001ece   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001ed0   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001ed2   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001ed4   6eef     MOVWF     0xef,0x0                                                                                        
001ed6   0e02     MOVLW     0x2            		tempvar1++;                                                                    C:\fw\midicontroller\x001x\usbapplet.c
001ed8   2adb     INCF      0xdb,0x1,0x0                                                                                    
001eda   0e03     MOVLW     0x3            		EP1Buffer[tempvar1] = DataBuffer[tempvar0].b_form.high;                        C:\fw\midicontroller\x001x\usbapplet.c
001edc   6aea     CLRF      0xea,0x0                                                                                        
001ede   34db     RLCF      0xdb,0x0,0x0                                                                                    
001ee0   0bfe     ANDLW     0xfe                                                                                            
001ee2   36ea     RLCF      0xea,0x1,0x0                                                                                    
001ee4   6ee9     MOVWF     0xe9,0x0                                                                                        
001ee6   0e03     MOVLW     0x3                                                                                             
001ee8   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001eea   0e01     MOVLW     0x1                                                                                             
001eec   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001eee   52ee     MOVF      0xee,0x1,0x0                                                                                    
001ef0   50ef     MOVF      0xef,0x0,0x0                                                                                    
001ef2   6ee6     MOVWF     0xe6,0x0                                                                                        
001ef4   0e02     MOVLW     0x2                                                                                             
001ef6   50db     MOVF      0xdb,0x0,0x0                                                                                    
001ef8   6aea     CLRF      0xea,0x0                                                                                        
001efa   0f60     ADDLW     0x60                                                                                            
001efc   6ee9     MOVWF     0xe9,0x0                                                                                        
001efe   0e00     MOVLW     0x0                                                                                             
001f00   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001f02   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001f04   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001f06   6eef     MOVWF     0xef,0x0                                                                                        
001f08   0e02     MOVLW     0x2            		tempvar1++;                                                                    C:\fw\midicontroller\x001x\usbapplet.c
001f0a   2adb     INCF      0xdb,0x1,0x0                                                                                    
                                           	}                                                                               C:\fw\midicontroller\x001x\usbapplet.c
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
001f12   52de     MOVF      0xde,0x1,0x0   	NumBytes.byte = 64;                                                             C:\fw\midicontroller\x001x\usbapplet.c
001f14   0e40     MOVLW     0x40                                                                                            
001f16   6edd     MOVWF     0xdd,0x0                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
001f18   0104     MOVLB     0x4                if(!mHIDTxIsBusy()) {                                                        C:\fw\midicontroller\x001x\usbapplet.c
001f1a   bf0c     BTFSC     0xc,0x7,0x1                                                                                     
001f1c   d00c     BRA       0x1f36                                                                                          
                                           //put data on the endpoint:                                                      C:\fw\midicontroller\x001x\usbapplet.c
001f1e   0e01     MOVLW     0x1            		HIDTxReport((unsigned char *)&EP1Buffer[0],NumBytes.byte);                     C:\fw\midicontroller\x001x\usbapplet.c
001f20   cfdb     MOVFF     0xfdb,0xfe6                                                                                     
001f22   ffe6                                                                                                               
001f24   0e60     MOVLW     0x60                                                                                            
001f26   6ee6     MOVWF     0xe6,0x0                                                                                        
001f28   0e00     MOVLW     0x0                                                                                             
001f2a   6ee6     MOVWF     0xe6,0x0                                                                                        
001f2c   ec8d     CALL      0x1b1a,0x0                                                                                      
001f2e   f00d                                                                                                               
001f30   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001f32   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001f34   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           	}                                                                               C:\fw\midicontroller\x001x\usbapplet.c
001f36   0e04     MOVLW     0x4            }                                                                                C:\fw\midicontroller\x001x\usbapplet.c
001f38   5ce1     SUBWF     0xe1,0x0,0x0                                                                                    
001f3a   e202     BC        0x1f40                                                                                          
001f3c   6ae1     CLRF      0xe1,0x0                                                                                        
001f3e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001f40   6ee1     MOVWF     0xe1,0x0                                                                                        
001f42   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001f44   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001f46   ffd9                                                                                                               
001f48   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                                                                                                            C:\fw\midicontroller\x001x\usbapplet.c
                                           /*********************************************************************           C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            *                Microchip USB C18 Firmware Version 1.0                         C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            *********************************************************************           C:\fw\midicontroller\x001x\usbdescript.c
                                            * FileName:        usbdsc.c                                                     C:\fw\midicontroller\x001x\usbdescript.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\midicontroller\x001x\usbdescript.c
                                            * Processor:       PIC18                                                        C:\fw\midicontroller\x001x\usbdescript.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\midicontroller\x001x\usbdescript.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * Software License Agreement                                                    C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\midicontroller\x001x\usbdescript.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             C:\fw\midicontroller\x001x\usbdescript.c
                                            * supplied to you, the Company’s customer, for use solely and                   C:\fw\midicontroller\x001x\usbdescript.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\midicontroller\x001x\usbdescript.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\midicontroller\x001x\usbdescript.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\midicontroller\x001x\usbdescript.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\midicontroller\x001x\usbdescript.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\midicontroller\x001x\usbdescript.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\midicontroller\x001x\usbdescript.c
                                            * license.                                                                      C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             C:\fw\midicontroller\x001x\usbdescript.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\midicontroller\x001x\usbdescript.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\midicontroller\x001x\usbdescript.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\midicontroller\x001x\usbdescript.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\midicontroller\x001x\usbdescript.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            ********************************************************************/           C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           /*********************************************************************           C:\fw\midicontroller\x001x\usbdescript.c
                                            * -usbdsc.c-                                                                    C:\fw\midicontroller\x001x\usbdescript.c
                                            * This file contains the USB descriptor information. It is used                 C:\fw\midicontroller\x001x\usbdescript.c
                                            * in conjunction with the usbdsc.h file. When a descriptor is added             C:\fw\midicontroller\x001x\usbdescript.c
                                            * or removed from the main configuration descriptor, i.e. CFG01,                C:\fw\midicontroller\x001x\usbdescript.c
                                            * the user must also change the descriptor structure defined in                 C:\fw\midicontroller\x001x\usbdescript.c
                                            * the usbdsc.h file. The structure is used to calculate the                     C:\fw\midicontroller\x001x\usbdescript.c
                                            * descriptor size, i.e. sizeof(CFG01).                                          C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * A typical configuration descriptor consists of:                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * At least one configuration descriptor (USB_CFG_DSC)                           C:\fw\midicontroller\x001x\usbdescript.c
                                            * One or more interface descriptors (USB_INTF_DSC)                              C:\fw\midicontroller\x001x\usbdescript.c
                                            * One or more endpoint descriptors (USB_EP_DSC)                                 C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * Naming Convention:                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                            * To resolve ambiguity, the naming convention are as followed:                  C:\fw\midicontroller\x001x\usbdescript.c
                                            * - USB_CFG_DSC type should be named cdxx, where xx is the                      C:\fw\midicontroller\x001x\usbdescript.c
                                            *   configuration number. This number should match the actual                   C:\fw\midicontroller\x001x\usbdescript.c
                                            *   index value of this configuration.                                          C:\fw\midicontroller\x001x\usbdescript.c
                                            * - USB_INTF_DSC type should be named i<yy>a<zz>, where yy is the               C:\fw\midicontroller\x001x\usbdescript.c
                                            *   interface number and zz is the alternate interface number.                  C:\fw\midicontroller\x001x\usbdescript.c
                                            * - USB_EP_DSC type should be named ep<##><d>_i<yy>a<zz>, where                 C:\fw\midicontroller\x001x\usbdescript.c
                                            *   ## is the endpoint number and d is the direction of transfer.               C:\fw\midicontroller\x001x\usbdescript.c
                                            *   The interface name should also be listed as a suffix to identify            C:\fw\midicontroller\x001x\usbdescript.c
                                            *   which interface does the endpoint belong to.                                C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * Example:                                                                      C:\fw\midicontroller\x001x\usbdescript.c
                                            * If a device has one configuration, two interfaces; interface 0                C:\fw\midicontroller\x001x\usbdescript.c
                                            * has two endpoints (in and out), and interface 1 has one endpoint(in).         C:\fw\midicontroller\x001x\usbdescript.c
                                            * Then the CFG01 structure in the usbdsc.h should be:                           C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * #define CFG01 rom struct                            \                         C:\fw\midicontroller\x001x\usbdescript.c
                                            * {   USB_CFG_DSC             cd01;                   \                         C:\fw\midicontroller\x001x\usbdescript.c
                                            *     USB_INTF_DSC            i00a00;                 \                         C:\fw\midicontroller\x001x\usbdescript.c
                                            *     USB_EP_DSC              ep01o_i00a00;           \                         C:\fw\midicontroller\x001x\usbdescript.c
                                            *     USB_EP_DSC              ep01i_i00a00;           \                         C:\fw\midicontroller\x001x\usbdescript.c
                                            *     USB_INTF_DSC            i01a00;                 \                         C:\fw\midicontroller\x001x\usbdescript.c
                                            *     USB_EP_DSC              ep02i_i01a00;           \                         C:\fw\midicontroller\x001x\usbdescript.c
                                            * } cfg01                                                                       C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * Note the hierarchy of the descriptors above, it follows the USB               C:\fw\midicontroller\x001x\usbdescript.c
                                            * specification requirement. All endpoints belonging to an interface            C:\fw\midicontroller\x001x\usbdescript.c
                                            * should be listed immediately after that interface.                            C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * -------------------------------------------------------------------           C:\fw\midicontroller\x001x\usbdescript.c
                                            * Filling in the descriptor values in the usbdsc.c file:                        C:\fw\midicontroller\x001x\usbdescript.c
                                            * -------------------------------------------------------------------           C:\fw\midicontroller\x001x\usbdescript.c
                                            * Most items should be self-explanatory, however, a few will be                 C:\fw\midicontroller\x001x\usbdescript.c
                                            * explained for clarification.                                                  C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * [Configuration Descriptor(USB_CFG_DSC)]                                       C:\fw\midicontroller\x001x\usbdescript.c
                                            * The configuration attribute must always have the _DEFAULT                     C:\fw\midicontroller\x001x\usbdescript.c
                                            * definition at the minimum. Additional options can be ORed                     C:\fw\midicontroller\x001x\usbdescript.c
                                            * to the _DEFAULT attribute. Available options are _SELF and _RWU.              C:\fw\midicontroller\x001x\usbdescript.c
                                            * These definitions are defined in the usbdefs_std_dsc.h file. The              C:\fw\midicontroller\x001x\usbdescript.c
                                            * _SELF tells the USB host that this device is self-powered. The                C:\fw\midicontroller\x001x\usbdescript.c
                                            * _RWU tells the USB host that this device supports Remote Wakeup.              C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * [Endpoint Descriptor(USB_EP_DSC)]                                             C:\fw\midicontroller\x001x\usbdescript.c
                                            * Assume the following example:                                                 C:\fw\midicontroller\x001x\usbdescript.c
                                            * sizeof(USB_EP_DSC),DSC_EP,_EP01_OUT,_BULK,64,0x00                             C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * The first two parameters are self-explanatory. They specify the               C:\fw\midicontroller\x001x\usbdescript.c
                                            * length of this endpoint descriptor (7) and the descriptor type.               C:\fw\midicontroller\x001x\usbdescript.c
                                            * The next parameter identifies the endpoint, the definitions are               C:\fw\midicontroller\x001x\usbdescript.c
                                            * defined in usbdefs_std_dsc.h and has the following naming                     C:\fw\midicontroller\x001x\usbdescript.c
                                            * convention:                                                                   C:\fw\midicontroller\x001x\usbdescript.c
                                            * _EP<##>_<dir>                                                                 C:\fw\midicontroller\x001x\usbdescript.c
                                            * where ## is the endpoint number and dir is the direction of                   C:\fw\midicontroller\x001x\usbdescript.c
                                            * transfer. The dir has the value of either 'OUT' or 'IN'.                      C:\fw\midicontroller\x001x\usbdescript.c
                                            * The next parameter identifies the type of the endpoint. Available             C:\fw\midicontroller\x001x\usbdescript.c
                                            * options are _BULK, _INT, _ISO, and _CTRL. The _CTRL is not                    C:\fw\midicontroller\x001x\usbdescript.c
                                            * typically used because the default control transfer endpoint is               C:\fw\midicontroller\x001x\usbdescript.c
                                            * not defined in the USB descriptors. When _ISO option is used,                 C:\fw\midicontroller\x001x\usbdescript.c
                                            * addition options can be ORed to _ISO. Example:                                C:\fw\midicontroller\x001x\usbdescript.c
                                            * _ISO|_AD|_FE                                                                  C:\fw\midicontroller\x001x\usbdescript.c
                                            * This describes the endpoint as an isochronous pipe with adaptive              C:\fw\midicontroller\x001x\usbdescript.c
                                            * and feedback attributes. See usbdefs_std_dsc.h and the USB                    C:\fw\midicontroller\x001x\usbdescript.c
                                            * specification for details. The next parameter defines the size of             C:\fw\midicontroller\x001x\usbdescript.c
                                            * the endpoint. The last parameter in the polling interval.                     C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * -------------------------------------------------------------------           C:\fw\midicontroller\x001x\usbdescript.c
                                            * Adding a USB String                                                           C:\fw\midicontroller\x001x\usbdescript.c
                                            * -------------------------------------------------------------------           C:\fw\midicontroller\x001x\usbdescript.c
                                            * A string descriptor array should have the following format:                   C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * rom struct{byte bLength;byte bDscType;word string[size];}sdxxx={              C:\fw\midicontroller\x001x\usbdescript.c
                                            * sizeof(sdxxx),DSC_STR,<text>};                                                C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * The above structure provides a means for the C compiler to                    C:\fw\midicontroller\x001x\usbdescript.c
                                            * calculate the length of string descriptor sdxxx, where xxx is the             C:\fw\midicontroller\x001x\usbdescript.c
                                            * index number. The first two bytes of the descriptor are descriptor            C:\fw\midicontroller\x001x\usbdescript.c
                                            * length and type. The rest <text> are string texts which must be               C:\fw\midicontroller\x001x\usbdescript.c
                                            * in the unicode format. The unicode format is achieved by declaring            C:\fw\midicontroller\x001x\usbdescript.c
                                            * each character as a word type. The whole text string is declared              C:\fw\midicontroller\x001x\usbdescript.c
                                            * as a word array with the number of characters equals to <size>.               C:\fw\midicontroller\x001x\usbdescript.c
                                            * <size> has to be manually counted and entered into the array                  C:\fw\midicontroller\x001x\usbdescript.c
                                            * declaration. Let's study this through an example:                             C:\fw\midicontroller\x001x\usbdescript.c
                                            * if the string is "USB" , then the string descriptor should be:                C:\fw\midicontroller\x001x\usbdescript.c
                                            * (Using index 02)                                                              C:\fw\midicontroller\x001x\usbdescript.c
                                            * rom struct{byte bLength;byte bDscType;word string[3];}sd002={                 C:\fw\midicontroller\x001x\usbdescript.c
                                            * sizeof(sd002),DSC_STR,'U','S','B'};                                           C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * A USB project may have multiple strings and the firmware supports             C:\fw\midicontroller\x001x\usbdescript.c
                                            * the management of multiple strings through a look-up table.                   C:\fw\midicontroller\x001x\usbdescript.c
                                            * The look-up table is defined as:                                              C:\fw\midicontroller\x001x\usbdescript.c
                                            * rom const unsigned char *rom USB_SD_Ptr[]={&sd000,&sd001,&sd002};             C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * The above declaration has 3 strings, sd000, sd001, and sd002.                 C:\fw\midicontroller\x001x\usbdescript.c
                                            * Strings can be removed or added. sd000 is a specialized string                C:\fw\midicontroller\x001x\usbdescript.c
                                            * descriptor. It defines the language code, usually this is                     C:\fw\midicontroller\x001x\usbdescript.c
                                            * US English (0x0409). The index of the string must match the index             C:\fw\midicontroller\x001x\usbdescript.c
                                            * position of the USB_SD_Ptr array, &sd000 must be in position                  C:\fw\midicontroller\x001x\usbdescript.c
                                            * USB_SD_Ptr[0], &sd001 must be in position USB_SD_Ptr[1] and so on.            C:\fw\midicontroller\x001x\usbdescript.c
                                            * The look-up table USB_SD_Ptr is used by the get string handler                C:\fw\midicontroller\x001x\usbdescript.c
                                            * function in usb9.c.                                                           C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * -------------------------------------------------------------------           C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * The look-up table scheme also applies to the configuration                    C:\fw\midicontroller\x001x\usbdescript.c
                                            * descriptor. A USB device may have multiple configuration                      C:\fw\midicontroller\x001x\usbdescript.c
                                            * descriptors, i.e. CFG01, CFG02, etc. To add a configuration                   C:\fw\midicontroller\x001x\usbdescript.c
                                            * descriptor, user must implement a structure similar to CFG01.                 C:\fw\midicontroller\x001x\usbdescript.c
                                            * The next step is to add the configuration descriptor name, i.e.               C:\fw\midicontroller\x001x\usbdescript.c
                                            * cfg01, cfg02,.., to the look-up table USB_CD_Ptr. USB_CD_Ptr[0]               C:\fw\midicontroller\x001x\usbdescript.c
                                            * is a dummy place holder since configuration 0 is the un-configured            C:\fw\midicontroller\x001x\usbdescript.c
                                            * state according to the definition in the USB specification.                   C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            ********************************************************************/           C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           /*********************************************************************           C:\fw\midicontroller\x001x\usbdescript.c
                                            * Descriptor specific type definitions are defined in:                          C:\fw\midicontroller\x001x\usbdescript.c
                                            * system\usb\usbdefs\usbdefs_std_dsc.h                                          C:\fw\midicontroller\x001x\usbdescript.c
                                            *                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                            * Configuration information is defined in:                                      C:\fw\midicontroller\x001x\usbdescript.c
                                            * autofiles\usbcfg.h                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                            ********************************************************************/           C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           #define POLLING_INTERVAL	40                                                      C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           /** I N C L U D E S *************************************************/           C:\fw\midicontroller\x001x\usbdescript.c
                                           #include "typedefs.h"                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           #include "usb.h"                                                                 C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           /** C O N S T A N T S ************************************************/          C:\fw\midicontroller\x001x\usbdescript.c
                                           #pragma romdata                                                                  C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           /* Device Descriptor */                                                          C:\fw\midicontroller\x001x\usbdescript.c
                                           rom USB_DEV_DSC device_dsc=                                                      C:\fw\midicontroller\x001x\usbdescript.c
                                           {                                                                                C:\fw\midicontroller\x001x\usbdescript.c
                                               0x12,     	// bLength                                                        C:\fw\midicontroller\x001x\usbdescript.c
                                               0x01,     	// bDescriptorType                                                C:\fw\midicontroller\x001x\usbdescript.c
                                               0x0110,    	// bcdUSB (spec release #)                                       C:\fw\midicontroller\x001x\usbdescript.c
                                               0x00,     	// bDeviceClass                                                   C:\fw\midicontroller\x001x\usbdescript.c
                                               0x00,     	// bDeviceSubClass                                                C:\fw\midicontroller\x001x\usbdescript.c
                                               0x00,     	// bDeviceProtocol                                                C:\fw\midicontroller\x001x\usbdescript.c
                                               0x08,     	// bMaxPacketSize0                                                C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09AE,     // idVendor - 0x09AE is Tripplite's Vendor ID                    C:\fw\midicontroller\x001x\usbdescript.c
                                               0x4429,		// idProduct                                                        C:\fw\midicontroller\x001x\usbdescript.c
                                               0x0010,    	// bcdDevice : Project version = 0.10                            C:\fw\midicontroller\x001x\usbdescript.c
                                               INDEX_MANUFACTURER,	// Index of string Descriptor describing manufacturer      C:\fw\midicontroller\x001x\usbdescript.c
                                               INDEX_NAME,			// Index of string Descriptor describing product               C:\fw\midicontroller\x001x\usbdescript.c
                                               INDEX_SERIALNUM,	// Index of string Descriptor describing the device's serial number C:\fw\midicontroller\x001x\usbdescript.c
                                               0x01				// bNumConfigurations : renaud 1 configuration                       C:\fw\midicontroller\x001x\usbdescript.c
                                           };                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           /* Configuration 1 Descriptor */                                                 C:\fw\midicontroller\x001x\usbdescript.c
                                           CFG01={                                                                          C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x09,		// bLength: Configuration Descriptor size                                C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x02,		// bDescriptorType: Configuration                                        C:\fw\midicontroller\x001x\usbdescript.c
                                           	P1_CONFDESC_LEN,	//(word) Length of configuration descriptor. **Renaud : To update C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x01,		// bNumInterfaces: 1 interface.                                          C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x01,		// bConfigurationValue: Configuration value = 1                          C:\fw\midicontroller\x001x\usbdescript.c
                                           	0,			// iConfiguration: Index of string descriptor describing the configuration (None) C:\fw\midicontroller\x001x\usbdescript.c
                                           //	0x80,		// bmAttributes: Bus powered and NO Remote wakeup                      C:\fw\midicontroller\x001x\usbdescript.c
                                           	0xA0,		// bmAttributes: Bus powered and Remote wakeup ** Renaud : changed from 0xE0 C:\fw\midicontroller\x001x\usbdescript.c
                                           //	0xC0,		// bmAttributes: Self powered and NO Remote wakeup                     C:\fw\midicontroller\x001x\usbdescript.c
                                           //	0xE0,		// bmAttributes: Self powered and Remote wakeup                        C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x32,		// MaxPower 50 mA : ** Renaud : MaxPowerself-powered draws 0 mA from the bus.  C:\fw\midicontroller\x001x\usbdescript.c
                                           //	0x00,		// 0 mA power consumption.                                             C:\fw\midicontroller\x001x\usbdescript.c
                                           // Interface descriptor (Interface 0 = DemoKit)                                  C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x09,		// bLength: Interface Descriptor size                                    C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x04,		// bDescriptorType: Interface descriptor type  ** Renaud : to check      C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x00,		// bInterfaceNumber: Interface Number = 0                                C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x00,		// bAlternateSetting: No Alternate setting                               C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x01,		// bNumEndpoints: one endpoints used    ** Renaud : changed from 2 to 1  C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x03,		// bInterfaceClass: HID                                                  C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x00,		// bInterfaceSubClass: ** Renaud : changed from 1 (Boot Interface Subclass in tripplite descriptor)to 0 : no boot subclass C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x00,		// bInterfaceProtocol: ** Renaud : changed from 2 (protocol - mouse in tripplite descriptor) to 0 : no protocol  C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x00,		// iInterface: Index of string descriptor (No string value)              C:\fw\midicontroller\x001x\usbdescript.c
                                           // HID descriptor (Demokit)                                                      C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x09,		// bLength: HID Descriptor size                                          C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x21,		// bDescriptorType: HID                                                  C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x0110,		// (word) bcdHID: HID Class Spec release number (1.10) ** Renaud : I let rev 1.10, but Tripplite has HID class release number (1.00) C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x00,		// bCountryCode: Hardware target country US ** Renaud changed from 0x21 (US) to 0x00 (none specified) C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x01,		// bNumDescriptors: Number of HID class descriptors to follow            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x22,		// bDescriptorType: Report                                               C:\fw\midicontroller\x001x\usbdescript.c
                                           	HID_RPT_UPS_SIZE,	// (word) Length of report descriptor interface 0 (2 bytes) ** Renaud : To update C:\fw\midicontroller\x001x\usbdescript.c
                                           // Endpoint 1 descriptor (Demokit)                                               C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x07,		// bLength: Endpoint Descriptor size                                     C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x05,		// bDescriptorType: Endpoint descriptor type   ** Renaud : To check      C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x81,		// bEndpointAddress: Endpoint  1 IN                                      C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x03,		// bmAttributes: Interrupt endpoint                                      C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x0008,		// wMaxPacketSize(LSB):                                                C:\fw\midicontroller\x001x\usbdescript.c
                                           	POLLING_INTERVAL,       // bInterval: Polling Interval (40 ms = 0x28)           C:\fw\midicontroller\x001x\usbdescript.c
                                           };                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //2/8/05 JD language selection I think..                                         C:\fw\midicontroller\x001x\usbdescript.c
                                           rom struct{byte bLength;byte bDscType;word string[1];}sd000={                    C:\fw\midicontroller\x001x\usbdescript.c
                                           sizeof(sd000),DSC_STR,0x0409};                                                   C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //Manufacturer string                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           rom struct{byte bLength;byte bDscType;word string[11];}MfrString={               C:\fw\midicontroller\x001x\usbdescript.c
                                           sizeof(MfrString),DSC_STR,                                                       C:\fw\midicontroller\x001x\usbdescript.c
                                           'J','o','e'};                                                                    C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //Device Chemistry String                                                        C:\fw\midicontroller\x001x\usbdescript.c
                                           rom struct{byte bLength;byte bDscType;word string[4];}DevChem={                  C:\fw\midicontroller\x001x\usbdescript.c
                                           sizeof(DevChem),DSC_STR,                                                         C:\fw\midicontroller\x001x\usbdescript.c
                                           'P','b','A','C'};                                                                C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //Product String                                                                 C:\fw\midicontroller\x001x\usbdescript.c
                                           rom struct{byte bLength;byte bDscType;word string[21];}PrdString={               C:\fw\midicontroller\x001x\usbdescript.c
                                           sizeof(PrdString),DSC_STR,                                                       C:\fw\midicontroller\x001x\usbdescript.c
                                           'J','o','e',0x2019,'s',' ','S','c','o','p','e',' '};                             C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //Serial Number                                                                  C:\fw\midicontroller\x001x\usbdescript.c
                                           rom struct{byte bLength;byte bDscType;word string[16];}SerialNum={               C:\fw\midicontroller\x001x\usbdescript.c
                                           sizeof(SerialNum),DSC_STR,                                                       C:\fw\midicontroller\x001x\usbdescript.c
                                           '6','9','1','2','0','6','0','A',' '};                                            C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           /*                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x06,  0x00, 0xff          // USAGE_PAGE (Vendor Defined Page 1)                C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x09,  0x01               // USAGE (Vendor Usage 1)                             C:\fw\midicontroller\x001x\usbdescript.c
                                           	0xa1,  0x01               // COLLECTION (Application)                           C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x85,  RID_RECEIVE       // REPORT_ID (1)  - streaming UART rx data             C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x09,  0x01                // USAGE (Vendor Usage 1)                            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x15,  0x00                // LOGICAL_MINIMUM (0)                               C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x26,  0xff, 0x00           // LOGICAL_MAXIMUM (255)                            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x75,  0x08                // REPORT_SIZE (8) = bits                            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x95,  EP1_REPORT_LENGTH // REPORT_COUNT (7) = 1 report id byte + 7 data bytes  C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x81,  0x06                // INPUT (Data,Var,Rel)                              C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x09,  0x01                // USAGE (Vendor Usage 1)                            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0xb1,  0x06                // FEATURE (Data,Var,Rel)                            C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x85,  RID_COMMAND       // REPORT_ID (3) Command (setreport)                   C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x09,  0x01               // USAGE (Vendor Usage 1)                             C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x15,  0x00               // LOGICAL_MINIMUM (0)                                C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x26,  0x08, 0x00           // LOGICAL_MAXIMUM (255)                            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x75,  0x08               // REPORT_SIZE (8) bits                               C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x95,  0x01               // REPORT_COUNT (1) byte                              C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x09,  0x01               // USAGE (Vendor Usage 1)                             C:\fw\midicontroller\x001x\usbdescript.c
                                           	0xb1,  0x06               // FEATURE (Data,Var,Rel)                             C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x85,  RID_TRANSMIT      // REPORT_ID (2) serial transmit these bytes (SetReport) C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x09,  0x03               // USAGE (Vendor Usage 1)                             C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x96,  0x07, 0x00          // REPORT_COUNT (7) 1 count byte, 6 data             C:\fw\midicontroller\x001x\usbdescript.c
                                           	0xb1,  0x06               // FEATURE (Data,Var,Rel)                             C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0xc0                     // END_COLLECTION                                      C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           */                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //the reason for this structure is so that sizeof() returns a value.             C:\fw\midicontroller\x001x\usbdescript.c
                                           rom struct{byte report[HID_RPT_UPS_SIZE];}hid_rpt_UPS={                          C:\fw\midicontroller\x001x\usbdescript.c
                                           //Production test information                                                    C:\fw\midicontroller\x001x\usbdescript.c
                                               0x06, 0xff, 0xff,              //     USAGE_PAGE (Vendor Defined Page 0xffff) C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x09,  0x01,               		// USAGE (Vendor Usage 1)                          C:\fw\midicontroller\x001x\usbdescript.c
                                           	0xa1,  0x01,              	  // COLLECTION (Application)                        C:\fw\midicontroller\x001x\usbdescript.c
                                               0x75, 0x08,                    //       REPORT_SIZE (8)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x95, 0x01,                    //       REPORT_COUNT (1)                     C:\fw\midicontroller\x001x\usbdescript.c
                                               0x26, 0xff, 0x00,              //       LOGICAL_MAXIMUM (255)                C:\fw\midicontroller\x001x\usbdescript.c
                                               0x15, 0x00,                    //       LOGICAL_MINIMUM (0)                  C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //NVR Operations                                                                 C:\fw\midicontroller\x001x\usbdescript.c
                                               0x85, 0x96,                    //       REPORT_ID (150)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09, 0xC0,                    //       USAGE (***NVR Read/Write Data)       C:\fw\midicontroller\x001x\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                               0x75, 0x20,                    //       REPORT_SIZE (32)                     C:\fw\midicontroller\x001x\usbdescript.c
                                               0x85, 0xB4,                    //       REPORT_ID (180)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09, 0xD2,                    //       USAGE (***NVR Page Read/Write Data)  C:\fw\midicontroller\x001x\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                               0x75, 0x10,                    //       REPORT_SIZE (16)                     C:\fw\midicontroller\x001x\usbdescript.c
                                               0x85, 0x97,                    //       REPORT_ID (151)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09, 0xC1,                    //       USAGE (***NVR Address 16bit)         C:\fw\midicontroller\x001x\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\midicontroller\x001x\usbdescript.c
                                               0x75, 0x08,                    //       REPORT_SIZE (8)                      C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //RAM Operations                                                                 C:\fw\midicontroller\x001x\usbdescript.c
                                               0x85, 0x98,                    //       REPORT_ID (152)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09, 0xC2,                    //       USAGE (***RAM Read/Write Data)       C:\fw\midicontroller\x001x\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                               0x75, 0x10,                    //       REPORT_SIZE (16)                     C:\fw\midicontroller\x001x\usbdescript.c
                                               0x85, 0x99,                    //       REPORT_ID (153)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09, 0xC3,                    //       USAGE (***RAM Address 16bit)         C:\fw\midicontroller\x001x\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //ROM Operations                                                                 C:\fw\midicontroller\x001x\usbdescript.c
                                               0x85, 0x9C,                    //       REPORT_ID (156)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09, 0xD4,                    //       USAGE (***ROM Read/Write Data)       C:\fw\midicontroller\x001x\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                               0x75, 0x10,                    //       REPORT_SIZE (16)                     C:\fw\midicontroller\x001x\usbdescript.c
                                               0x85, 0x9D,                    //       REPORT_ID (157)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09, 0xD5,                    //       USAGE (***ROM Address 16bit)         C:\fw\midicontroller\x001x\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //Production test protocol #                                                     C:\fw\midicontroller\x001x\usbdescript.c
                                               0x85, 0x9B,                    //       REPORT_ID (155)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09, 0xC5,                    //       USAGE (***Production Test Protocol #) C:\fw\midicontroller\x001x\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                               0x85, 0xAF,                    //       REPORT_ID (175)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09, 0xE9,                    //       USAGE (***Voltage Data)              C:\fw\midicontroller\x001x\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                               0x85, 0xAF,                    //       REPORT_ID (175)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09, 0xE9,                    //       USAGE (***Voltage Data)              C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x81, 0xa2,					   //	 	INPUT (Data,Var,Abs, Vol, NPrf)                         C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //Firmware Partnumber                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x75, 0x20,						//	   REPORT_SIZE (32)                                         C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x85, 0xC2,						//	   REPORT_ID (194)                                          C:\fw\midicontroller\x001x\usbdescript.c
                                           	0x09, 0xD6,						//	   USAGE (***Firmware Partnumber 32bit)                     C:\fw\midicontroller\x001x\usbdescript.c
                                           	0xb1, 0x02,						//	   FEATURE (Data,Var,Abs)                                   C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           //Production test password = 866E1942                                            C:\fw\midicontroller\x001x\usbdescript.c
                                               0x85, 0x9A,                    //       REPORT_ID (154)                      C:\fw\midicontroller\x001x\usbdescript.c
                                               0x09, 0xC4,                    //       USAGE (***Production test Password - 32bit) C:\fw\midicontroller\x001x\usbdescript.c
                                               0xb1, 0x02,                    //       FEATURE (Data,Var,Abs)               C:\fw\midicontroller\x001x\usbdescript.c
                                               0xc0                          //     END_COLLECTION                          C:\fw\midicontroller\x001x\usbdescript.c
                                           };                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                           //** Renaud : end_ReportDescriptor                                               C:\fw\midicontroller\x001x\usbdescript.c
                                           	                                                                                C:\fw\midicontroller\x001x\usbdescript.c
                                           rom const unsigned char *rom USB_CD_Ptr[]={&cfg01,&cfg01};                       C:\fw\midicontroller\x001x\usbdescript.c
                                           rom const unsigned char *rom USB_SD_Ptr[]={&sd000,&MfrString,&PrdString,&SerialNum,&DevChem}; C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           rom pFunc ClassReqHandler[1]=                                                    C:\fw\midicontroller\x001x\usbdescript.c
                                           {                                                                                C:\fw\midicontroller\x001x\usbdescript.c
                                               &USBCheckHIDRequest                                                          C:\fw\midicontroller\x001x\usbdescript.c
                                           };                                                                               C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           #pragma code                                                                     C:\fw\midicontroller\x001x\usbdescript.c
                                                                                                                            C:\fw\midicontroller\x001x\usbdescript.c
                                           /** EOF usbdsc.c ****************************************************/           C:\fw\midicontroller\x001x\usbdescript.c
                                           //############################################################################### C:\fw\midicontroller\x001x\rs232.c
                                           //#										       						       		#                                             C:\fw\midicontroller\x001x\rs232.c
                                           //#			Author: Joe Dunne											 		#                                           C:\fw\midicontroller\x001x\rs232.c
                                           //#			RS232 Communication ROUTINE											#                                    C:\fw\midicontroller\x001x\rs232.c
                                           //#			File Name: RXCOMM.ASM												#                                         C:\fw\midicontroller\x001x\rs232.c
                                           //#																				#                                                         C:\fw\midicontroller\x001x\rs232.c
                                           //#			Updated 2/02/05 by JD												#                                         C:\fw\midicontroller\x001x\rs232.c
                                           //#									      	       	       	       	       		#                            C:\fw\midicontroller\x001x\rs232.c
                                           //############################################################################### C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           #include	"c_system.h"                                                            C:\fw\midicontroller\x001x\rs232.c
                                           #include "typedefs.h"                                                            C:\fw\midicontroller\x001x\rs232.c
                                           #include "usb.h"                                                                 C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           #define	FW_REV						0x10                                                         C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           #define	UPS_TYPE					(2|FW_REV)                                                  C:\fw\midicontroller\x001x\rs232.c
                                           #define	INVALID_REQUEST				0xff                                                  C:\fw\midicontroller\x001x\rs232.c
                                           #define	PRODUCTION_TEST_PROTOCOL	0x0003                                          C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           extern rom struct{byte bLength;byte bDscType;word string[];}SerialNum;           C:\fw\midicontroller\x001x\rs232.c
                                           extern rom struct{byte bLength;byte bDscType;word string[24];}MfrString;         C:\fw\midicontroller\x001x\rs232.c
                                           extern rom struct{byte bLength;byte bDscType;word string[10];}DevChem;           C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           void	RemCapCalculation(void);                                                    C:\fw\midicontroller\x001x\rs232.c
                                           void	EE_READ(void);                                                              C:\fw\midicontroller\x001x\rs232.c
                                           void	D_DIV(void);                                                                C:\fw\midicontroller\x001x\rs232.c
                                           void	SQRT_16BIT(void);		//result is stored in RES0.                              C:\fw\midicontroller\x001x\rs232.c
                                           void	HIDGetReportHandler(void);                                                  C:\fw\midicontroller\x001x\rs232.c
                                           unsigned char	READ_SYSTEM_NVR(void);                                             C:\fw\midicontroller\x001x\rs232.c
                                           void	EE_PAGE_WRITE(void);                                                        C:\fw\midicontroller\x001x\rs232.c
                                           void	BOOT_LOAD_MODE(void);                                                       C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           //--------------------------------------------------------------                 C:\fw\midicontroller\x001x\rs232.c
                                           //						Handle received query                                                    C:\fw\midicontroller\x001x\rs232.c
                                           //--------------------------------------------------------------                 C:\fw\midicontroller\x001x\rs232.c
000a2c   cfd9     MOVFF     0xfd9,0xfe6    void	PROCESS_COMM_REQUEST(void) {                                                C:\fw\midicontroller\x001x\rs232.c
000a2e   ffe6                                                                                                               
000a30   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
000a32   ffd9                                                                                                               
000a34   0e11     MOVLW     0x11                                                                                            
000a36   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           	unsigned char *RcvPtr;                                                          C:\fw\midicontroller\x001x\rs232.c
                                           	unsigned char tempvar1, tempvar0;                                               C:\fw\midicontroller\x001x\rs232.c
                                           	far unsigned char *Data;                                                        C:\fw\midicontroller\x001x\rs232.c
                                           	BitField ByteToSend;                                                            C:\fw\midicontroller\x001x\rs232.c
                                           	TwoBytes tempreg, tempnum0, value;                                              C:\fw\midicontroller\x001x\rs232.c
                                           	FourBytes longreg;                                                              C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
000a38   0102     MOVLB     0x2            	ResponseType = 0xFF;		//no response                                             C:\fw\midicontroller\x001x\rs232.c
000a3a   69c2     SETF      0xc2,0x1                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
000a3c   0102     MOVLB     0x2            	if (!USBQuery) {                                                                C:\fw\midicontroller\x001x\rs232.c
000a3e   b9c3     BTFSC     0xc3,0x4,0x1                                                                                    
000a40   d011     BRA       0xa64                                                                                           
                                           		//RS232 query                                                                  C:\fw\midicontroller\x001x\rs232.c
000a42   91c3     BCF       0xc3,0x0,0x1   		ProcessCommRequest = false;                                                    C:\fw\midicontroller\x001x\rs232.c
                                           		//Prevent any communication in progress from being messed up.                  C:\fw\midicontroller\x001x\rs232.c
000a44   0102     MOVLB     0x2            		if (TxBufPtr != 0) return;                                                     C:\fw\midicontroller\x001x\rs232.c
000a46   51bb     MOVF      0xbb,0x0,0x1                                                                                    
000a48   e002     BZ        0xa4e                                                                                           
000a4a   ef0e     GOTO      0x121c                                                                                          
000a4c   f009                                                                                                               
000a4e   0102     MOVLB     0x2            		SendingOutString = false;                                                      C:\fw\midicontroller\x001x\rs232.c
000a50   95c3     BCF       0xc3,0x2,0x1                                                                                    
000a52   97c3     BCF       0xc3,0x3,0x1   		StringInEEPROM = false;                                                        C:\fw\midicontroller\x001x\rs232.c
000a54   0102     MOVLB     0x2            		TxBufPtr = 4;			//the header will be written later.                            C:\fw\midicontroller\x001x\rs232.c
000a56   0e04     MOVLW     0x4                                                                                             
000a58   6fbb     MOVWF     0xbb,0x1                                                                                        
000a5a   0ed7     MOVLW     0xd7           		RcvPtr = (unsigned char *)&RxBuffer[4];                                        C:\fw\midicontroller\x001x\rs232.c
000a5c   6ede     MOVWF     0xde,0x0                                                                                        
000a5e   0e02     MOVLW     0x2                                                                                             
000a60   6edd     MOVWF     0xdd,0x0                                                                                        
                                           	}                                                                               C:\fw\midicontroller\x001x\rs232.c
000a62   d007     BRA       0xa72          	else {                                                                          C:\fw\midicontroller\x001x\rs232.c
                                           		//USB query                                                                    C:\fw\midicontroller\x001x\rs232.c
000a64   0102     MOVLB     0x2            		USBDataPointer = 1;		//the 0th byte is the reportid                            C:\fw\midicontroller\x001x\rs232.c
000a66   0e01     MOVLW     0x1                                                                                             
000a68   6fc4     MOVWF     0xc4,0x1                                                                                        
000a6a   0ecc     MOVLW     0xcc           		RcvPtr = (unsigned char *)&USBEP0DataInBuffer[1];                              C:\fw\midicontroller\x001x\rs232.c
000a6c   6ede     MOVWF     0xde,0x0                                                                                        
000a6e   0e02     MOVLW     0x2                                                                                             
000a70   6edd     MOVWF     0xdd,0x0                                                                                        
                                           	}                                                                               C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           //Polling command:                                                               C:\fw\midicontroller\x001x\rs232.c
000a72   0102     MOVLB     0x2            	if (!USBQuery && RxBuffer[1] == 0x03 || \                                       C:\fw\midicontroller\x001x\rs232.c
000a74   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000a76   0b10     ANDLW     0x10                                                                                            
000a78   e104     BNZ       0xa82                                                                                           
000a7a   0e03     MOVLW     0x3                                                                                             
000a7c   0102     MOVLB     0x2                                                                                             
000a7e   5dd4     SUBWF     0xd4,0x0,0x1                                                                                    
000a80   e009     BZ        0xa94                                                                                           
000a82   0102     MOVLB     0x2                                                                                             
000a84   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000a86   0b10     ANDLW     0x10                                                                                            
000a88   e101     BNZ       0xa8c                                                                                           
000a8a   d205     BRA       0xe96                                                                                           
000a8c   0104     MOVLB     0x4                                                                                             
000a8e   0511     DECF      0x11,0x0,0x1                                                                                    
000a90   e001     BZ        0xa94                                                                                           
000a92   d201     BRA       0xe96                                                                                           
                                           		USBQuery && SetupPkt.bRequest == GET_REPORT) {                                 C:\fw\midicontroller\x001x\rs232.c
000a94   0102     MOVLB     0x2            		switch ((USBQuery?SetupPkt._byte[2]:RxBuffer[3])) {                            C:\fw\midicontroller\x001x\rs232.c
000a96   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000a98   0b10     ANDLW     0x10                                                                                            
000a9a   e003     BZ        0xaa2                                                                                           
000a9c   0104     MOVLB     0x4                                                                                             
000a9e   5112     MOVF      0x12,0x0,0x1                                                                                    
000aa0   d002     BRA       0xaa6                                                                                           
000aa2   0102     MOVLB     0x2                                                                                             
000aa4   51d6     MOVF      0xd6,0x0,0x1                                                                                    
000aa6   0ab4     XORLW     0xb4                                                                                            
000aa8   e101     BNZ       0xaac                                                                                           
000aaa   d1dc     BRA       0xe64                                                                                           
000aac   0a04     XORLW     0x4                                                                                             
000aae   e101     BNZ       0xab2                                                                                           
000ab0   d196     BRA       0xdde                                                                                           
000ab2   0a1f     XORLW     0x1f                                                                                            
000ab4   e101     BNZ       0xab8                                                                                           
000ab6   d15b     BRA       0xd6e                                                                                           
000ab8   0a34     XORLW     0x34                                                                                            
000aba   e101     BNZ       0xabe                                                                                           
000abc   d14d     BRA       0xd58                                                                                           
000abe   0a06     XORLW     0x6                                                                                             
000ac0   e101     BNZ       0xac4                                                                                           
000ac2   d134     BRA       0xd2c                                                                                           
000ac4   0a01     XORLW     0x1                                                                                             
000ac6   e101     BNZ       0xaca                                                                                           
000ac8   d11d     BRA       0xd04                                                                                           
000aca   0a05     XORLW     0x5                                                                                             
000acc   e101     BNZ       0xad0                                                                                           
000ace   d104     BRA       0xcd8                                                                                           
000ad0   0a01     XORLW     0x1                                                                                             
000ad2   e101     BNZ       0xad6                                                                                           
000ad4   d0e6     BRA       0xca2                                                                                           
000ad6   0a0f     XORLW     0xf                                                                                             
000ad8   e101     BNZ       0xadc                                                                                           
000ada   d0cd     BRA       0xc76                                                                                           
000adc   0a01     XORLW     0x1                                                                                             
000ade   e101     BNZ       0xae2                                                                                           
000ae0   d0bf     BRA       0xc60                                                                                           
000ae2   0abc     XORLW     0xbc                                                                                            
000ae4   e101     BNZ       0xae8                                                                                           
000ae6   d08e     BRA       0xc04                                                                                           
000ae8   0a48     XORLW     0x48                                                                                            
000aea   e05d     BZ        0xba6                                                                                           
000aec   0a49     XORLW     0x49                                                                                            
000aee   e05b     BZ        0xba6                                                                                           
000af0   0a02     XORLW     0x2                                                                                             
000af2   e02a     BZ        0xb48                                                                                           
000af4   0a24     XORLW     0x24                                                                                            
000af6   e005     BZ        0xb02                                                                                           
000af8   0a03     XORLW     0x3                                                                                             
000afa   e003     BZ        0xb02                                                                                           
000afc   0a26     XORLW     0x26                                                                                            
000afe   e001     BZ        0xb02                                                                                           
000b00   d1c9     BRA       0xe94                                                                                           
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           		case 13:                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           		case 14:                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           		case 40:                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			//iProduct                                                                    C:\fw\midicontroller\x001x\rs232.c
000b02   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000b04   0e05     MOVLW     0x5                                                                                             
000b06   6fc2     MOVWF     0xc2,0x1                                                                                        
000b08   0102     MOVLB     0x2            			TxBuffer[2] = 22;			//number of bytes in response                             C:\fw\midicontroller\x001x\rs232.c
000b0a   0e16     MOVLW     0x16                                                                                            
000b0c   6fde     MOVWF     0xde,0x1                                                                                        
000b0e   0102     MOVLB     0x2            			if (USBQuery) {                                                               C:\fw\midicontroller\x001x\rs232.c
000b10   a9c3     BTFSS     0xc3,0x4,0x1                                                                                    
000b12   d005     BRA       0xb1e                                                                                           
000b14   0e02     MOVLW     0x2            				TXENQ(INDEX_NAME);                                                           C:\fw\midicontroller\x001x\rs232.c
000b16   6ee6     MOVWF     0xe6,0x0                                                                                        
000b18   db8b     RCALL     0x1230                                                                                          
000b1a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000b1c   d1bc     BRA       0xe96          				break;                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000b1e   0e04     MOVLW     0x4            			TxBufPtr = TxBuffer[2]+4;					//override txbuffer pointer.                    C:\fw\midicontroller\x001x\rs232.c
000b20   0102     MOVLB     0x2                                                                                             
000b22   25de     ADDWF     0xde,0x0,0x1                                                                                    
000b24   0102     MOVLB     0x2                                                                                             
000b26   6fbb     MOVWF     0xbb,0x1                                                                                        
000b28   0e04     MOVLW     0x4            			StringChksum = RxBuffer[3]+(TxBufPtr-4)+HEADER_CHAR+DATA_RETURNED;            C:\fw\midicontroller\x001x\rs232.c
000b2a   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
000b2c   0102     MOVLB     0x2                                                                                             
000b2e   25d6     ADDWF     0xd6,0x0,0x1                                                                                    
000b30   0f7e     ADDLW     0x7e                                                                                            
000b32   0f05     ADDLW     0x5                                                                                             
000b34   0102     MOVLB     0x2                                                                                             
000b36   6fc1     MOVWF     0xc1,0x1                                                                                        
000b38   0102     MOVLB     0x2            			SendingOutString = true;                                                      C:\fw\midicontroller\x001x\rs232.c
000b3a   85c3     BSF       0xc3,0x2,0x1                                                                                    
000b3c   87c3     BSF       0xc3,0x3,0x1   			StringInEEPROM = true;                                                        C:\fw\midicontroller\x001x\rs232.c
000b3e   9fc3     BCF       0xc3,0x7,0x1   			StringInRAM = false;                                                          C:\fw\midicontroller\x001x\rs232.c
000b40   0102     MOVLB     0x2            			StringPtr = EE_USB_ID_STRING+2;	//Send out product string.                    C:\fw\midicontroller\x001x\rs232.c
000b42   0e46     MOVLW     0x46                                                                                            
000b44   6fbf     MOVWF     0xbf,0x1                                                                                        
000b46   d1a7     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 41:                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			//iSerialNumber                                                               C:\fw\midicontroller\x001x\rs232.c
000b48   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000b4a   0e05     MOVLW     0x5                                                                                             
000b4c   6fc2     MOVWF     0xc2,0x1                                                                                        
000b4e   0102     MOVLB     0x2            			TxBuffer[2] = 17;			//number of bytes in response                             C:\fw\midicontroller\x001x\rs232.c
000b50   0e11     MOVLW     0x11                                                                                            
000b52   6fde     MOVWF     0xde,0x1                                                                                        
000b54   0102     MOVLB     0x2            			if (USBQuery) {                                                               C:\fw\midicontroller\x001x\rs232.c
000b56   a9c3     BTFSS     0xc3,0x4,0x1                                                                                    
000b58   d005     BRA       0xb64                                                                                           
000b5a   0e03     MOVLW     0x3            				TXENQ(INDEX_SERIALNUM);                                                      C:\fw\midicontroller\x001x\rs232.c
000b5c   6ee6     MOVWF     0xe6,0x0                                                                                        
000b5e   db68     RCALL     0x1230                                                                                          
000b60   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000b62   d199     BRA       0xe96          				break;                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000b64   0e04     MOVLW     0x4            			TxBufPtr = TxBuffer[2]+4;					//override txbuffer pointer.                    C:\fw\midicontroller\x001x\rs232.c
000b66   0102     MOVLB     0x2                                                                                             
000b68   25de     ADDWF     0xde,0x0,0x1                                                                                    
000b6a   0102     MOVLB     0x2                                                                                             
000b6c   6fbb     MOVWF     0xbb,0x1                                                                                        
000b6e   0e04     MOVLW     0x4            			StringChksum = RxBuffer[3]+(TxBufPtr-4)+HEADER_CHAR+DATA_RETURNED;            C:\fw\midicontroller\x001x\rs232.c
000b70   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
000b72   0102     MOVLB     0x2                                                                                             
000b74   25d6     ADDWF     0xd6,0x0,0x1                                                                                    
000b76   0f7e     ADDLW     0x7e                                                                                            
000b78   0f05     ADDLW     0x5                                                                                             
000b7a   0102     MOVLB     0x2                                                                                             
000b7c   6fc1     MOVWF     0xc1,0x1                                                                                        
000b7e   0102     MOVLB     0x2            			SendingOutString = true;                                                      C:\fw\midicontroller\x001x\rs232.c
000b80   85c3     BSF       0xc3,0x2,0x1                                                                                    
000b82   97c3     BCF       0xc3,0x3,0x1   			StringInEEPROM = false;                                                       C:\fw\midicontroller\x001x\rs232.c
000b84   8fc3     BSF       0xc3,0x7,0x1   			StringInRAM = true;                                                           C:\fw\midicontroller\x001x\rs232.c
000b86   50d9     MOVF      0xd9,0x0,0x0   			tempreg.s_form = (unsigned short)(&SerialNum)+2;                              C:\fw\midicontroller\x001x\rs232.c
000b88   0f07     ADDLW     0x7                                                                                             
000b8a   6ee9     MOVWF     0xe9,0x0                                                                                        
000b8c   cfda     MOVFF     0xfda,0xfea                                                                                     
000b8e   ffea                                                                                                               
000b90   0e98     MOVLW     0x98                                                                                            
000b92   6eee     MOVWF     0xee,0x0                                                                                        
000b94   0e1c     MOVLW     0x1c                                                                                            
000b96   6eed     MOVWF     0xed,0x0                                                                                        
000b98   0e08     MOVLW     0x8            			StringPtr_H = tempreg.b_form.high;                                            C:\fw\midicontroller\x001x\rs232.c
000b9a   cfdb     MOVFF     0xfdb,0x2c0                                                                                     
000b9c   f2c0                                                                                                               
000b9e   0e07     MOVLW     0x7            			StringPtr = tempreg.b_form.low;	//Send out serial string.                     C:\fw\midicontroller\x001x\rs232.c
000ba0   cfdb     MOVFF     0xfdb,0x2bf                                                                                     
000ba2   f2bf                                                                                                               
000ba4   d178     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 98:	//iOEMInformation                                                     C:\fw\midicontroller\x001x\rs232.c
                                           		case 43:	//iManufacturer                                                       C:\fw\midicontroller\x001x\rs232.c
000ba6   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000ba8   0e05     MOVLW     0x5                                                                                             
000baa   6fc2     MOVWF     0xc2,0x1                                                                                        
000bac   0102     MOVLB     0x2            			TxBuffer[2] = 12;			//number of bytes in response                             C:\fw\midicontroller\x001x\rs232.c
000bae   0e0c     MOVLW     0xc                                                                                             
000bb0   6fde     MOVWF     0xde,0x1                                                                                        
000bb2   0102     MOVLB     0x2            			if (USBQuery) {                                                               C:\fw\midicontroller\x001x\rs232.c
000bb4   a9c3     BTFSS     0xc3,0x4,0x1                                                                                    
000bb6   d005     BRA       0xbc2                                                                                           
000bb8   0e01     MOVLW     0x1            				TXENQ(INDEX_MANUFACTURER);                                                   C:\fw\midicontroller\x001x\rs232.c
000bba   6ee6     MOVWF     0xe6,0x0                                                                                        
000bbc   db39     RCALL     0x1230                                                                                          
000bbe   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000bc0   d16a     BRA       0xe96          				break;                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000bc2   0e04     MOVLW     0x4            			TxBufPtr = TxBuffer[2]+4;					//override txbuffer pointer.                    C:\fw\midicontroller\x001x\rs232.c
000bc4   0102     MOVLB     0x2                                                                                             
000bc6   25de     ADDWF     0xde,0x0,0x1                                                                                    
000bc8   0102     MOVLB     0x2                                                                                             
000bca   6fbb     MOVWF     0xbb,0x1                                                                                        
000bcc   0e04     MOVLW     0x4            			StringChksum = RxBuffer[3]+(TxBufPtr-4)+HEADER_CHAR+DATA_RETURNED;            C:\fw\midicontroller\x001x\rs232.c
000bce   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
000bd0   0102     MOVLB     0x2                                                                                             
000bd2   25d6     ADDWF     0xd6,0x0,0x1                                                                                    
000bd4   0f7e     ADDLW     0x7e                                                                                            
000bd6   0f05     ADDLW     0x5                                                                                             
000bd8   0102     MOVLB     0x2                                                                                             
000bda   6fc1     MOVWF     0xc1,0x1                                                                                        
000bdc   0102     MOVLB     0x2            			SendingOutString = true;                                                      C:\fw\midicontroller\x001x\rs232.c
000bde   85c3     BSF       0xc3,0x2,0x1                                                                                    
000be0   97c3     BCF       0xc3,0x3,0x1   			StringInEEPROM = false;                                                       C:\fw\midicontroller\x001x\rs232.c
000be2   9fc3     BCF       0xc3,0x7,0x1   			StringInRAM = false;                                                          C:\fw\midicontroller\x001x\rs232.c
000be4   50d9     MOVF      0xd9,0x0,0x0   			tempreg.s_form = (unsigned short)&MfrString;                                  C:\fw\midicontroller\x001x\rs232.c
000be6   0f07     ADDLW     0x7                                                                                             
000be8   6ee9     MOVWF     0xe9,0x0                                                                                        
000bea   cfda     MOVFF     0xfda,0xfea                                                                                     
000bec   ffea                                                                                                               
000bee   0e48     MOVLW     0x48                                                                                            
000bf0   6eee     MOVWF     0xee,0x0                                                                                        
000bf2   0e1c     MOVLW     0x1c                                                                                            
000bf4   6eed     MOVWF     0xed,0x0                                                                                        
000bf6   0e08     MOVLW     0x8            			StringPtr_H = tempreg.b_form.high;                                            C:\fw\midicontroller\x001x\rs232.c
000bf8   cfdb     MOVFF     0xfdb,0x2c0                                                                                     
000bfa   f2c0                                                                                                               
000bfc   0e07     MOVLW     0x7            			StringPtr = tempreg.b_form.low;	//Send out serial string.                     C:\fw\midicontroller\x001x\rs232.c
000bfe   cfdb     MOVFF     0xfdb,0x2bf                                                                                     
000c00   f2bf                                                                                                               
000c02   d149     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           		case 42:                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			//iDeviceChemistry                                                            C:\fw\midicontroller\x001x\rs232.c
000c04   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000c06   0e05     MOVLW     0x5                                                                                             
000c08   6fc2     MOVWF     0xc2,0x1                                                                                        
000c0a   0102     MOVLB     0x2            			TxBuffer[2] = 5;			//number of bytes in response                              C:\fw\midicontroller\x001x\rs232.c
000c0c   6fde     MOVWF     0xde,0x1                                                                                        
000c0e   0102     MOVLB     0x2            			if (USBQuery) {                                                               C:\fw\midicontroller\x001x\rs232.c
000c10   a9c3     BTFSS     0xc3,0x4,0x1                                                                                    
000c12   d005     BRA       0xc1e                                                                                           
000c14   0e04     MOVLW     0x4            				TXENQ(INDEX_DEVCHEM);                                                        C:\fw\midicontroller\x001x\rs232.c
000c16   6ee6     MOVWF     0xe6,0x0                                                                                        
000c18   db0b     RCALL     0x1230                                                                                          
000c1a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000c1c   d13c     BRA       0xe96          				break;                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			}			                                                                          C:\fw\midicontroller\x001x\rs232.c
000c1e   0e04     MOVLW     0x4            			TxBufPtr = TxBuffer[2]+4;					//override txbuffer pointer.                    C:\fw\midicontroller\x001x\rs232.c
000c20   0102     MOVLB     0x2                                                                                             
000c22   25de     ADDWF     0xde,0x0,0x1                                                                                    
000c24   0102     MOVLB     0x2                                                                                             
000c26   6fbb     MOVWF     0xbb,0x1                                                                                        
000c28   0e04     MOVLW     0x4            			StringChksum = RxBuffer[3]+(TxBufPtr-4)+HEADER_CHAR+DATA_RETURNED;            C:\fw\midicontroller\x001x\rs232.c
000c2a   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
000c2c   0102     MOVLB     0x2                                                                                             
000c2e   25d6     ADDWF     0xd6,0x0,0x1                                                                                    
000c30   0f7e     ADDLW     0x7e                                                                                            
000c32   0f05     ADDLW     0x5                                                                                             
000c34   0102     MOVLB     0x2                                                                                             
000c36   6fc1     MOVWF     0xc1,0x1                                                                                        
000c38   0102     MOVLB     0x2            			SendingOutString = true;                                                      C:\fw\midicontroller\x001x\rs232.c
000c3a   85c3     BSF       0xc3,0x2,0x1                                                                                    
000c3c   97c3     BCF       0xc3,0x3,0x1   			StringInEEPROM = false;                                                       C:\fw\midicontroller\x001x\rs232.c
000c3e   9fc3     BCF       0xc3,0x7,0x1   			StringInRAM = false;                                                          C:\fw\midicontroller\x001x\rs232.c
000c40   50d9     MOVF      0xd9,0x0,0x0   			tempreg.s_form = (unsigned short)(&DevChem)+2;                                C:\fw\midicontroller\x001x\rs232.c
000c42   0f07     ADDLW     0x7                                                                                             
000c44   6ee9     MOVWF     0xe9,0x0                                                                                        
000c46   cfda     MOVFF     0xfda,0xfea                                                                                     
000c48   ffea                                                                                                               
000c4a   0e62     MOVLW     0x62                                                                                            
000c4c   6eee     MOVWF     0xee,0x0                                                                                        
000c4e   0e1c     MOVLW     0x1c                                                                                            
000c50   6eed     MOVWF     0xed,0x0                                                                                        
000c52   0e08     MOVLW     0x8            			StringPtr_H = tempreg.b_form.high;	//(backwards for some crazy reason)        C:\fw\midicontroller\x001x\rs232.c
000c54   cfdb     MOVFF     0xfdb,0x2c0                                                                                     
000c56   f2c0                                                                                                               
000c58   0e07     MOVLW     0x7            			StringPtr = tempreg.b_form.low;	//Send out serial string.                     C:\fw\midicontroller\x001x\rs232.c
000c5a   cfdb     MOVFF     0xfdb,0x2bf                                                                                     
000c5c   f2bf                                                                                                               
000c5e   d11b     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           //production test commands:			                                                   C:\fw\midicontroller\x001x\rs232.c
                                           		case 150:		//NVR Read                                                          C:\fw\midicontroller\x001x\rs232.c
000c60   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000c62   0e05     MOVLW     0x5                                                                                             
000c64   6fc2     MOVWF     0xc2,0x1                                                                                        
000c66   a8a0     BTFSS     0xa0,0x4,0x0   			if (1 && !PIE2bits.EEIE) {                                                    C:\fw\midicontroller\x001x\rs232.c
                                           //				EEAddress = NVRCommAddr.b_form.low;                                        C:\fw\midicontroller\x001x\rs232.c
                                           //				DISABLE_ALL_INTERRUPTS();                                                  C:\fw\midicontroller\x001x\rs232.c
                                           //				Temp6 = READ_SYSTEM_NVR();		//returns data through wreg                    C:\fw\midicontroller\x001x\rs232.c
                                           //				ENABLE_ALL_INTERRUPTS();                                                   C:\fw\midicontroller\x001x\rs232.c
                                           //				TXENQ(Temp6);                                                              C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000c68   d005     BRA       0xc74          			else {                                                                        C:\fw\midicontroller\x001x\rs232.c
000c6a   0e01     MOVLW     0x1            				ResponseType = COMMAND_REJECTED;                                             C:\fw\midicontroller\x001x\rs232.c
000c6c   6fc2     MOVWF     0xc2,0x1                                                                                        
000c6e   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\midicontroller\x001x\rs232.c
000c70   dadf     RCALL     0x1230                                                                                          
000c72   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000c74   d110     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           			                                                                              C:\fw\midicontroller\x001x\rs232.c
                                           		case 151:		//NVR Address                                                       C:\fw\midicontroller\x001x\rs232.c
000c76   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000c78   0e05     MOVLW     0x5                                                                                             
000c7a   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\midicontroller\x001x\rs232.c
000c7c   c2c5     MOVFF     0x2c5,0xfe6    				TXENQ(NVRCommAddr.b_form.low);		//low byte                                   C:\fw\midicontroller\x001x\rs232.c
000c7e   ffe6                                                                                                               
000c80   dad7     RCALL     0x1230                                                                                          
000c82   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000c84   c2c6     MOVFF     0x2c6,0xfe6    				TXENQ(NVRCommAddr.b_form.high);		//high byte                                 C:\fw\midicontroller\x001x\rs232.c
000c86   ffe6                                                                                                               
000c88   dad3     RCALL     0x1230                                                                                          
000c8a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000c8c   d009     BRA       0xca0          			else {                                                                        C:\fw\midicontroller\x001x\rs232.c
000c8e   0102     MOVLB     0x2            				ResponseType = COMMAND_REJECTED;                                             C:\fw\midicontroller\x001x\rs232.c
000c90   0e01     MOVLW     0x1                                                                                             
000c92   6fc2     MOVWF     0xc2,0x1                                                                                        
000c94   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);		//low byte                                          C:\fw\midicontroller\x001x\rs232.c
000c96   dacc     RCALL     0x1230                                                                                          
000c98   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000c9a   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);		//high byte                                         C:\fw\midicontroller\x001x\rs232.c
000c9c   dac9     RCALL     0x1230                                                                                          
000c9e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000ca0   d0fa     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 152:		//RAM Read                                                          C:\fw\midicontroller\x001x\rs232.c
000ca2   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000ca4   0e05     MOVLW     0x5                                                                                             
000ca6   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\midicontroller\x001x\rs232.c
000ca8   0e04     MOVLW     0x4            				Data = (far unsigned char *)RAMCommAddr.s_form;                              C:\fw\midicontroller\x001x\rs232.c
000caa   c2c7     MOVFF     0x2c7,0xfdb                                                                                     
000cac   ffdb                                                                                                               
000cae   0e05     MOVLW     0x5                                                                                             
000cb0   c2c8     MOVFF     0x2c8,0xfdb                                                                                     
000cb2   ffdb                                                                                                               
000cb4   0e04     MOVLW     0x4            				TXENQ(*Data);                                                                C:\fw\midicontroller\x001x\rs232.c
000cb6   cfdb     MOVFF     0xfdb,0xfe9                                                                                     
000cb8   ffe9                                                                                                               
000cba   0e05     MOVLW     0x5                                                                                             
000cbc   cfdb     MOVFF     0xfdb,0xfea                                                                                     
000cbe   ffea                                                                                                               
000cc0   50ef     MOVF      0xef,0x0,0x0                                                                                    
000cc2   6ee6     MOVWF     0xe6,0x0                                                                                        
000cc4   dab5     RCALL     0x1230                                                                                          
000cc6   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000cc8   d006     BRA       0xcd6          			else {                                                                        C:\fw\midicontroller\x001x\rs232.c
000cca   0102     MOVLB     0x2            				ResponseType = COMMAND_REJECTED;                                             C:\fw\midicontroller\x001x\rs232.c
000ccc   0e01     MOVLW     0x1                                                                                             
000cce   6fc2     MOVWF     0xc2,0x1                                                                                        
000cd0   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\midicontroller\x001x\rs232.c
000cd2   daae     RCALL     0x1230                                                                                          
000cd4   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000cd6   d0df     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           	                                                                                C:\fw\midicontroller\x001x\rs232.c
                                           		case 153:		//RAM Address                                                       C:\fw\midicontroller\x001x\rs232.c
000cd8   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000cda   0e05     MOVLW     0x5                                                                                             
000cdc   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\midicontroller\x001x\rs232.c
000cde   c2c7     MOVFF     0x2c7,0xfe6    				TXENQ(RAMCommAddr.b_form.low);		//low byte                                   C:\fw\midicontroller\x001x\rs232.c
000ce0   ffe6                                                                                                               
000ce2   daa6     RCALL     0x1230                                                                                          
000ce4   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000ce6   c2c8     MOVFF     0x2c8,0xfe6    				TXENQ(RAMCommAddr.b_form.high);		//high byte                                 C:\fw\midicontroller\x001x\rs232.c
000ce8   ffe6                                                                                                               
000cea   daa2     RCALL     0x1230                                                                                          
000cec   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000cee   d009     BRA       0xd02          			else {                                                                        C:\fw\midicontroller\x001x\rs232.c
000cf0   0102     MOVLB     0x2            				ResponseType = COMMAND_REJECTED;                                             C:\fw\midicontroller\x001x\rs232.c
000cf2   0e01     MOVLW     0x1                                                                                             
000cf4   6fc2     MOVWF     0xc2,0x1                                                                                        
000cf6   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\midicontroller\x001x\rs232.c
000cf8   da9b     RCALL     0x1230                                                                                          
000cfa   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000cfc   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\midicontroller\x001x\rs232.c
000cfe   da98     RCALL     0x1230                                                                                          
000d00   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000d02   d0c9     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           	                                                                                C:\fw\midicontroller\x001x\rs232.c
                                           		case 156:		//ROM Read                                                          C:\fw\midicontroller\x001x\rs232.c
000d04   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000d06   0e05     MOVLW     0x5                                                                                             
000d08   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\midicontroller\x001x\rs232.c
000d0a   c2c9     MOVFF     0x2c9,0xff6    				TXENQ(*(near unsigned char rom *)ROMCommAddr.s_form);                        C:\fw\midicontroller\x001x\rs232.c
000d0c   fff6                                                                                                               
000d0e   c2ca     MOVFF     0x2ca,0xff7                                                                                     
000d10   fff7                                                                                                               
000d12   0008     TBLRD                                                                                                     
000d14   50f5     MOVF      0xf5,0x0,0x0                                                                                    
000d16   6ee6     MOVWF     0xe6,0x0                                                                                        
000d18   da8b     RCALL     0x1230                                                                                          
000d1a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000d1c   d006     BRA       0xd2a          			else {                                                                        C:\fw\midicontroller\x001x\rs232.c
000d1e   0102     MOVLB     0x2            				ResponseType = COMMAND_REJECTED;                                             C:\fw\midicontroller\x001x\rs232.c
000d20   0e01     MOVLW     0x1                                                                                             
000d22   6fc2     MOVWF     0xc2,0x1                                                                                        
000d24   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\midicontroller\x001x\rs232.c
000d26   da84     RCALL     0x1230                                                                                          
000d28   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000d2a   d0b5     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           	                                                                                C:\fw\midicontroller\x001x\rs232.c
                                           		case 157:		//ROM Address                                                       C:\fw\midicontroller\x001x\rs232.c
000d2c   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000d2e   0e05     MOVLW     0x5                                                                                             
000d30   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\midicontroller\x001x\rs232.c
000d32   c2c9     MOVFF     0x2c9,0xfe6    				TXENQ(ROMCommAddr.b_form.low);		//low byte                                   C:\fw\midicontroller\x001x\rs232.c
000d34   ffe6                                                                                                               
000d36   da7c     RCALL     0x1230                                                                                          
000d38   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000d3a   c2ca     MOVFF     0x2ca,0xfe6    				TXENQ(ROMCommAddr.b_form.high);		//high byte                                 C:\fw\midicontroller\x001x\rs232.c
000d3c   ffe6                                                                                                               
000d3e   da78     RCALL     0x1230                                                                                          
000d40   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000d42   d009     BRA       0xd56          			else {                                                                        C:\fw\midicontroller\x001x\rs232.c
000d44   0102     MOVLB     0x2            				ResponseType = COMMAND_REJECTED;                                             C:\fw\midicontroller\x001x\rs232.c
000d46   0e01     MOVLW     0x1                                                                                             
000d48   6fc2     MOVWF     0xc2,0x1                                                                                        
000d4a   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\midicontroller\x001x\rs232.c
000d4c   da71     RCALL     0x1230                                                                                          
000d4e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000d50   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\midicontroller\x001x\rs232.c
000d52   da6e     RCALL     0x1230                                                                                          
000d54   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000d56   d09f     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           		case 155:		//production test protocol                                          C:\fw\midicontroller\x001x\rs232.c
000d58   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000d5a   0e05     MOVLW     0x5                                                                                             
000d5c   6fc2     MOVWF     0xc2,0x1                                                                                        
000d5e   0e03     MOVLW     0x3            			TXENQ(PRODUCTION_TEST_PROTOCOL&255);                                          C:\fw\midicontroller\x001x\rs232.c
000d60   6ee6     MOVWF     0xe6,0x0                                                                                        
000d62   da66     RCALL     0x1230                                                                                          
000d64   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                           			//TXENQ(PRODUCTION_TEST_PROTOCOL/256);                                        C:\fw\midicontroller\x001x\rs232.c
000d66   6ae6     CLRF      0xe6,0x0       			TXENQ(PRODUCTION_TEST_PROTOCOL>>8);                                           C:\fw\midicontroller\x001x\rs232.c
000d68   da63     RCALL     0x1230                                                                                          
000d6a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000d6c   d094     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           	                                                                                C:\fw\midicontroller\x001x\rs232.c
                                           		case 175:		//voltage data                                                      C:\fw\midicontroller\x001x\rs232.c
000d6e   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000d70   0e05     MOVLW     0x5                                                                                             
000d72   6fc2     MOVWF     0xc2,0x1                                                                                        
000d74   c0a0     MOVFF     0xa0,0xfe6     			TXENQ(InputDataPointer);                                                      C:\fw\midicontroller\x001x\rs232.c
000d76   ffe6                                                                                                               
000d78   da5b     RCALL     0x1230                                                                                          
000d7a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000d7c   0100     MOVLB     0x0            			TXENQ(DataBuffer[InputDataPointer].b_form.low);                               C:\fw\midicontroller\x001x\rs232.c
000d7e   51a0     MOVF      0xa0,0x0,0x1                                                                                    
000d80   6ee9     MOVWF     0xe9,0x0                                                                                        
000d82   6aea     CLRF      0xea,0x0                                                                                        
000d84   90d8     BCF       0xd8,0x0,0x0                                                                                    
000d86   36e9     RLCF      0xe9,0x1,0x0                                                                                    
000d88   36ea     RLCF      0xea,0x1,0x0                                                                                    
000d8a   0e03     MOVLW     0x3                                                                                             
000d8c   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000d8e   0e01     MOVLW     0x1                                                                                             
000d90   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000d92   50ef     MOVF      0xef,0x0,0x0                                                                                    
000d94   6ee6     MOVWF     0xe6,0x0                                                                                        
000d96   da4c     RCALL     0x1230                                                                                          
000d98   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000d9a   0100     MOVLB     0x0            			TXENQ(DataBuffer[InputDataPointer].b_form.high);                              C:\fw\midicontroller\x001x\rs232.c
000d9c   51a0     MOVF      0xa0,0x0,0x1                                                                                    
000d9e   6ee9     MOVWF     0xe9,0x0                                                                                        
000da0   6aea     CLRF      0xea,0x0                                                                                        
000da2   90d8     BCF       0xd8,0x0,0x0                                                                                    
000da4   36e9     RLCF      0xe9,0x1,0x0                                                                                    
000da6   36ea     RLCF      0xea,0x1,0x0                                                                                    
000da8   0e03     MOVLW     0x3                                                                                             
000daa   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000dac   0e01     MOVLW     0x1                                                                                             
000dae   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000db0   52ee     MOVF      0xee,0x1,0x0                                                                                    
000db2   50ef     MOVF      0xef,0x0,0x0                                                                                    
000db4   6ee6     MOVWF     0xe6,0x0                                                                                        
000db6   da3c     RCALL     0x1230                                                                                          
000db8   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000dba   6ae6     CLRF      0xe6,0x0       			TXENQ(0);                                                                     C:\fw\midicontroller\x001x\rs232.c
000dbc   da39     RCALL     0x1230                                                                                          
000dbe   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
000dc0   0100     MOVLB     0x0            			InputDataPointer++;                                                           C:\fw\midicontroller\x001x\rs232.c
000dc2   2ba0     INCF      0xa0,0x1,0x1                                                                                    
000dc4   51a0     MOVF      0xa0,0x0,0x1   			if (InputDataPointer >= 200) InputDataPointer = 255;                          C:\fw\midicontroller\x001x\rs232.c
000dc6   6e02     MOVWF     0x2,0x0                                                                                         
000dc8   6a03     CLRF      0x3,0x0                                                                                         
000dca   90d8     BCF       0xd8,0x0,0x0                                                                                    
000dcc   5003     MOVF      0x3,0x0,0x0                                                                                     
000dce   e604     BN        0xdd8                                                                                           
000dd0   0ec8     MOVLW     0xc8                                                                                            
000dd2   5c02     SUBWF     0x2,0x0,0x0                                                                                     
000dd4   0e00     MOVLW     0x0                                                                                             
000dd6   5803     SUBWFB    0x3,0x0,0x0                                                                                     
000dd8   e301     BNC       0xddc                                                                                           
000dda   69a0     SETF      0xa0,0x1                                                                                        
000ddc   d05c     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           		case 176:		//voltage data bulk                                                 C:\fw\midicontroller\x001x\rs232.c
000dde   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000de0   0e05     MOVLW     0x5                                                                                             
000de2   6fc2     MOVWF     0xc2,0x1                                                                                        
000de4   c0a0     MOVFF     0xa0,0xfe6     			TXENQ(InputDataPointer);                                                      C:\fw\midicontroller\x001x\rs232.c
000de6   ffe6                                                                                                               
000de8   da23     RCALL     0x1230                                                                                          
000dea   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000dec   0e03     MOVLW     0x3            			for (tempvar0 = 0;tempvar0 < 30;tempvar0++) {                                 C:\fw\midicontroller\x001x\rs232.c
000dee   6adb     CLRF      0xdb,0x0                                                                                        
000df0   0e1e     MOVLW     0x1e                                                                                            
000df2   6ef3     MOVWF     0xf3,0x0                                                                                        
000df4   0e03     MOVLW     0x3                                                                                             
000df6   cfdb     MOVFF     0xfdb,0xff4                                                                                     
000df8   fff4                                                                                                               
000dfa   50f3     MOVF      0xf3,0x0,0x0                                                                                    
000dfc   5cf4     SUBWF     0xf4,0x0,0x0                                                                                    
000dfe   e224     BC        0xe48                                                                                           
000e42   0e03     MOVLW     0x3                                                                                             
000e44   2adb     INCF      0xdb,0x1,0x0                                                                                    
000e46   d7d4     BRA       0xdf0                                                                                           
000e00   0100     MOVLB     0x0            				TXENQ(DataBuffer[InputDataPointer].b_form.low);                              C:\fw\midicontroller\x001x\rs232.c
000e02   51a0     MOVF      0xa0,0x0,0x1                                                                                    
000e04   6ee9     MOVWF     0xe9,0x0                                                                                        
000e06   6aea     CLRF      0xea,0x0                                                                                        
000e08   90d8     BCF       0xd8,0x0,0x0                                                                                    
000e0a   36e9     RLCF      0xe9,0x1,0x0                                                                                    
000e0c   36ea     RLCF      0xea,0x1,0x0                                                                                    
000e0e   0e03     MOVLW     0x3                                                                                             
000e10   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000e12   0e01     MOVLW     0x1                                                                                             
000e14   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000e16   50ef     MOVF      0xef,0x0,0x0                                                                                    
000e18   6ee6     MOVWF     0xe6,0x0                                                                                        
000e1a   da0a     RCALL     0x1230                                                                                          
000e1c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e1e   0100     MOVLB     0x0            				TXENQ(DataBuffer[InputDataPointer].b_form.high);                             C:\fw\midicontroller\x001x\rs232.c
000e20   51a0     MOVF      0xa0,0x0,0x1                                                                                    
000e22   6ee9     MOVWF     0xe9,0x0                                                                                        
000e24   6aea     CLRF      0xea,0x0                                                                                        
000e26   90d8     BCF       0xd8,0x0,0x0                                                                                    
000e28   36e9     RLCF      0xe9,0x1,0x0                                                                                    
000e2a   36ea     RLCF      0xea,0x1,0x0                                                                                    
000e2c   0e03     MOVLW     0x3                                                                                             
000e2e   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000e30   0e01     MOVLW     0x1                                                                                             
000e32   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000e34   52ee     MOVF      0xee,0x1,0x0                                                                                    
000e36   50ef     MOVF      0xef,0x0,0x0                                                                                    
000e38   6ee6     MOVWF     0xe6,0x0                                                                                        
000e3a   d9fa     RCALL     0x1230                                                                                          
000e3c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e3e   0100     MOVLB     0x0            				InputDataPointer++;                                                          C:\fw\midicontroller\x001x\rs232.c
000e40   2ba0     INCF      0xa0,0x1,0x1                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000e48   0100     MOVLB     0x0            			if (InputDataPointer >= 200) InputDataPointer = 255;                          C:\fw\midicontroller\x001x\rs232.c
000e4a   51a0     MOVF      0xa0,0x0,0x1                                                                                    
000e4c   6e02     MOVWF     0x2,0x0                                                                                         
000e4e   6a03     CLRF      0x3,0x0                                                                                         
000e50   90d8     BCF       0xd8,0x0,0x0                                                                                    
000e52   5003     MOVF      0x3,0x0,0x0                                                                                     
000e54   e604     BN        0xe5e                                                                                           
000e56   0ec8     MOVLW     0xc8                                                                                            
000e58   5c02     SUBWF     0x2,0x0,0x0                                                                                     
000e5a   0e00     MOVLW     0x0                                                                                             
000e5c   5803     SUBWFB    0x3,0x0,0x0                                                                                     
000e5e   e301     BNC       0xe62                                                                                           
000e60   69a0     SETF      0xa0,0x1                                                                                        
000e62   d019     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           		case 180:		//NVR Page Read                                                     C:\fw\midicontroller\x001x\rs232.c
000e64   0102     MOVLB     0x2            			ResponseType = DATA_RETURNED;                                                 C:\fw\midicontroller\x001x\rs232.c
000e66   0e05     MOVLW     0x5                                                                                             
000e68   6fc2     MOVWF     0xc2,0x1                                                                                        
000e6a   b8a0     BTFSC     0xa0,0x4,0x0   			if (1 && !PIE2bits.EEIE) {                                                    C:\fw\midicontroller\x001x\rs232.c
000e6c   d004     BRA       0xe76                                                                                           
000e6e   9ef2     BCF       0xf2,0x7,0x0   				DISABLE_ALL_INTERRUPTS();                                                    C:\fw\midicontroller\x001x\rs232.c
000e70   9cf2     BCF       0xf2,0x6,0x0                                                                                    
                                           //				EEAddress = NVRCommAddr.b_form.low;                                        C:\fw\midicontroller\x001x\rs232.c
                                           //				Temp6 = READ_SYSTEM_NVR();                                                 C:\fw\midicontroller\x001x\rs232.c
                                           //				TXENQ(Temp6);                                                              C:\fw\midicontroller\x001x\rs232.c
                                           //				EEAddress++;                                                               C:\fw\midicontroller\x001x\rs232.c
                                           //				Temp6 = READ_SYSTEM_NVR();                                                 C:\fw\midicontroller\x001x\rs232.c
                                           //				TXENQ(Temp6);                                                              C:\fw\midicontroller\x001x\rs232.c
                                           //				EEAddress++;                                                               C:\fw\midicontroller\x001x\rs232.c
                                           //				Temp6 = READ_SYSTEM_NVR();                                                 C:\fw\midicontroller\x001x\rs232.c
                                           //				TXENQ(Temp6);                                                              C:\fw\midicontroller\x001x\rs232.c
                                           //				EEAddress++;                                                               C:\fw\midicontroller\x001x\rs232.c
                                           //				Temp6 = READ_SYSTEM_NVR();                                                 C:\fw\midicontroller\x001x\rs232.c
                                           //				TXENQ(Temp6);                                                              C:\fw\midicontroller\x001x\rs232.c
                                           //				ENABLE_ALL_INTERRUPTS();                                                   C:\fw\midicontroller\x001x\rs232.c
000e72   d011     BRA       0xe96          				break;                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000e74   d00f     BRA       0xe94          			else {                                                                        C:\fw\midicontroller\x001x\rs232.c
000e76   0e01     MOVLW     0x1            				ResponseType = COMMAND_REJECTED;                                             C:\fw\midicontroller\x001x\rs232.c
000e78   6fc2     MOVWF     0xc2,0x1                                                                                        
000e7a   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\midicontroller\x001x\rs232.c
000e7c   d9d9     RCALL     0x1230                                                                                          
000e7e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e80   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\midicontroller\x001x\rs232.c
000e82   d9d6     RCALL     0x1230                                                                                          
000e84   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e86   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\midicontroller\x001x\rs232.c
000e88   d9d3     RCALL     0x1230                                                                                          
000e8a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e8c   68e6     SETF      0xe6,0x0       				TXENQ(INVALID_REQUEST);                                                      C:\fw\midicontroller\x001x\rs232.c
000e8e   d9d0     RCALL     0x1230                                                                                          
000e90   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000e92   d001     BRA       0xe96          				break;                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			}				                                                                         C:\fw\midicontroller\x001x\rs232.c
                                           		default:                                                                       C:\fw\midicontroller\x001x\rs232.c
000e94   d000     BRA       0xe96          			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		}                                                                              C:\fw\midicontroller\x001x\rs232.c
                                           	}                                                                               C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           //Set command:                                                                   C:\fw\midicontroller\x001x\rs232.c
000e96   0102     MOVLB     0x2            	if (!USBQuery && RxBuffer[1] == 0x04 || \                                       C:\fw\midicontroller\x001x\rs232.c
000e98   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000e9a   0b10     ANDLW     0x10                                                                                            
000e9c   e104     BNZ       0xea6                                                                                           
000e9e   0e04     MOVLW     0x4                                                                                             
000ea0   0102     MOVLB     0x2                                                                                             
000ea2   5dd4     SUBWF     0xd4,0x0,0x1                                                                                    
000ea4   e00a     BZ        0xeba                                                                                           
000ea6   0102     MOVLB     0x2                                                                                             
000ea8   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000eaa   0b10     ANDLW     0x10                                                                                            
000eac   e101     BNZ       0xeb0                                                                                           
000eae   d15f     BRA       0x116e                                                                                          
000eb0   0e09     MOVLW     0x9                                                                                             
000eb2   0104     MOVLB     0x4                                                                                             
000eb4   5d11     SUBWF     0x11,0x0,0x1                                                                                    
000eb6   e001     BZ        0xeba                                                                                           
000eb8   d15a     BRA       0x116e                                                                                          
                                           		USBQuery && SetupPkt.bRequest == SET_REPORT) {                                 C:\fw\midicontroller\x001x\rs232.c
000eba   0102     MOVLB     0x2            		switch ((USBQuery?SetupPkt._byte[2]:RxBuffer[3])) {                            C:\fw\midicontroller\x001x\rs232.c
000ebc   51c3     MOVF      0xc3,0x0,0x1                                                                                    
000ebe   0b10     ANDLW     0x10                                                                                            
000ec0   e003     BZ        0xec8                                                                                           
000ec2   0104     MOVLB     0x4                                                                                             
000ec4   5112     MOVF      0x12,0x0,0x1                                                                                    
000ec6   d002     BRA       0xecc                                                                                           
000ec8   0102     MOVLB     0x2                                                                                             
000eca   51d6     MOVF      0xd6,0x0,0x1                                                                                    
000ecc   0ab4     XORLW     0xb4                                                                                            
000ece   e101     BNZ       0xed2                                                                                           
000ed0   d11e     BRA       0x110e                                                                                          
000ed2   0a29     XORLW     0x29                                                                                            
000ed4   e101     BNZ       0xed8                                                                                           
000ed6   d0ef     BRA       0x10b6                                                                                          
000ed8   0a01     XORLW     0x1                                                                                             
000eda   e101     BNZ       0xede                                                                                           
000edc   d0e0     BRA       0x109e                                                                                          
000ede   0a06     XORLW     0x6                                                                                             
000ee0   e101     BNZ       0xee4                                                                                           
000ee2   d083     BRA       0xfea                                                                                           
000ee4   0a03     XORLW     0x3                                                                                             
000ee6   e059     BZ        0xf9a                                                                                           
000ee8   0a01     XORLW     0x1                                                                                             
000eea   e041     BZ        0xf6e                                                                                           
000eec   0a0f     XORLW     0xf                                                                                             
000eee   e013     BZ        0xf16                                                                                           
000ef0   0a01     XORLW     0x1                                                                                             
000ef2   e001     BZ        0xef6                                                                                           
                                           /*                                                                               C:\fw\midicontroller\x001x\rs232.c
                                           		case 17:                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			//AudibleAlarmControl                                                         C:\fw\midicontroller\x001x\rs232.c
                                           			if (RcvPtr[0] == 3) {                                                         C:\fw\midicontroller\x001x\rs232.c
                                           				MuteBeeper = true;                                                           C:\fw\midicontroller\x001x\rs232.c
                                           				ResponseType = COMMAND_ACCEPTED;                                             C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			else ResponseType = COMMAND_REJECTED;                                         C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 16:		//Test                                                               C:\fw\midicontroller\x001x\rs232.c
                                           			if (MASTER_RELAY_LAT_BIT && LineValid) {	//check if Master receptacles off or Line invalid? C:\fw\midicontroller\x001x\rs232.c
                                           				if (RcvPtr[0] == 1) {                                                        C:\fw\midicontroller\x001x\rs232.c
                                           					RequestSelfTest = true;                                                     C:\fw\midicontroller\x001x\rs232.c
                                           					ResponseType = COMMAND_ACCEPTED;                                            C:\fw\midicontroller\x001x\rs232.c
                                           				}                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			else ResponseType = COMMAND_REJECTED;                                         C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 21:		//DelayBeforeShutdown                                                C:\fw\midicontroller\x001x\rs232.c
                                           			if (ContactClosureShutdownLatch || SelfTestMode) {                            C:\fw\midicontroller\x001x\rs232.c
                                           				ResponseType = COMMAND_REJECTED;                                             C:\fw\midicontroller\x001x\rs232.c
                                           				TXENQ(RcvPtr[0]);			//data                                                   C:\fw\midicontroller\x001x\rs232.c
                                           				TXENQ(RcvPtr[1]);			//data                                                   C:\fw\midicontroller\x001x\rs232.c
                                           				break;                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			else ResponseType = COMMAND_ACCEPTED;                                         C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           			PreDelayHighByte = RcvPtr[1];		//Store high byte value                        C:\fw\midicontroller\x001x\rs232.c
                                           			PreDelayLowByte = RcvPtr[0];		//Store low byte value                          C:\fw\midicontroller\x001x\rs232.c
                                           			PreDelayCntr_H = PreDelayHighByte;		//Load high byte counter                  C:\fw\midicontroller\x001x\rs232.c
                                           			PreDelayCntr_L = PreDelayLowByte;		//Load low byte counter                    C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           			if (RcvPtr[0] == 0xff && RcvPtr[1] == 0xff) {                                 C:\fw\midicontroller\x001x\rs232.c
                                           				//Abort the inverter shutdown command                                        C:\fw\midicontroller\x001x\rs232.c
                                           				CountOutPreDelay = false;                                                    C:\fw\midicontroller\x001x\rs232.c
                                           				RequestUnitShutDown = false;                                                 C:\fw\midicontroller\x001x\rs232.c
                                           				break;                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			if (RcvPtr[0] == 0 && RcvPtr[1] == 0) {                                       C:\fw\midicontroller\x001x\rs232.c
                                           				PreDelayLowByte = DEFAULT_PREDELAY;		//load default predelay                 C:\fw\midicontroller\x001x\rs232.c
                                           				PreDelayCntr_L = PreDelayLowByte;		//Load low byte counter                   C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			RequestUnitShutDown = true;                                                   C:\fw\midicontroller\x001x\rs232.c
                                           			CountOutPreDelay = true;                                                      C:\fw\midicontroller\x001x\rs232.c
                                           			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 23:		//DelayBeforeReboot                                                  C:\fw\midicontroller\x001x\rs232.c
                                           			if (InverterON || Standby) {                                                  C:\fw\midicontroller\x001x\rs232.c
                                           				ResponseType = COMMAND_REJECTED;                                             C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			else {                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           				ResponseType = COMMAND_ACCEPTED;                                             C:\fw\midicontroller\x001x\rs232.c
                                           				RebootCounter = RcvPtr[0];                                                   C:\fw\midicontroller\x001x\rs232.c
                                           				RebootCounter_H = RcvPtr[1];                                                 C:\fw\midicontroller\x001x\rs232.c
                                           				RequestReboot = true;		//Request all active power outlets be turned off for 10 seconds C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 22:	//DelayBeforeStartup (vendor defined) (minutes)                       C:\fw\midicontroller\x001x\rs232.c
                                           		case 97:	//DelayBeforeStartup (seconds)                                        C:\fw\midicontroller\x001x\rs232.c
                                           			if (ContactClosureShutdownLatch || SelfTestMode || !BatteryOK) {              C:\fw\midicontroller\x001x\rs232.c
                                           				ResponseType = COMMAND_REJECTED;                                             C:\fw\midicontroller\x001x\rs232.c
                                           				TXENQ(RcvPtr[0]);			//data                                                   C:\fw\midicontroller\x001x\rs232.c
                                           				TXENQ(RcvPtr[1]);			//data                                                   C:\fw\midicontroller\x001x\rs232.c
                                           				break;                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			else ResponseType = COMMAND_ACCEPTED;                                         C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           			if (RcvPtr[3] == 22) {				//data is in minutes, so convert to seconds.        C:\fw\midicontroller\x001x\rs232.c
                                           				tempreg.b_form.low = RcvPtr[0];                                              C:\fw\midicontroller\x001x\rs232.c
                                           				tempreg.b_form.high = RcvPtr[1];                                             C:\fw\midicontroller\x001x\rs232.c
                                           				longreg.l_form = tempreg.s_form*60;		//overflow not possible                 C:\fw\midicontroller\x001x\rs232.c
                                           				DelayedWUCntr_H = longreg.b_form.byte2;                                      C:\fw\midicontroller\x001x\rs232.c
                                           				DelayedWUCntr_M = longreg.b_form.byte1;                                      C:\fw\midicontroller\x001x\rs232.c
                                           				DelayedWUCntr_L = longreg.b_form.byte0;                                      C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			else {									//data is in seconds, so just copy it over.                    C:\fw\midicontroller\x001x\rs232.c
                                           				DelayedWUCntr_H = 0;                                                         C:\fw\midicontroller\x001x\rs232.c
                                           				DelayedWUCntr_M = RcvPtr[1];                                                 C:\fw\midicontroller\x001x\rs232.c
                                           				DelayedWUCntr_L = RcvPtr[0];                                                 C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			                                                                              C:\fw\midicontroller\x001x\rs232.c
                                           			if (RcvPtr[0] == 0xff && RcvPtr[1] == 0xff) {	//cancel command                C:\fw\midicontroller\x001x\rs232.c
                                           				CountOutPreDelay = false;                                                    C:\fw\midicontroller\x001x\rs232.c
                                           				RequestUnitShutDown = false;	//Abort the inverter shutdown command           C:\fw\midicontroller\x001x\rs232.c
                                           				DelayedWakeup = false;                                                       C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           			if (DelayedWUCntr_L == 0 && DelayedWUCntr_M == 0 && DelayedWUCntr_H == 0) {   C:\fw\midicontroller\x001x\rs232.c
                                           				DelayedWUCntr_L = 2;			//load default wakeup predelay                        C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           			if (PreDelayCntr_H == 0 && PreDelayCntr_L == 0 || !MASTER_RELAY_LAT_BIT || !RequestUnitShutDown) { C:\fw\midicontroller\x001x\rs232.c
                                           				PreDelayCntr_H = 0;                                                          C:\fw\midicontroller\x001x\rs232.c
                                           				PreDelayCntr_L = DEFAULT_PREDELAY;	//load default predelay                   C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			                                                                              C:\fw\midicontroller\x001x\rs232.c
                                           			if (!DelayedWakeup) {			//if we are not already in delayed wakeup..           C:\fw\midicontroller\x001x\rs232.c
                                           				RequestDelayedWakeUp = true;                                                 C:\fw\midicontroller\x001x\rs232.c
                                           				CountOutPreDelay = true;                                                     C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 82:	//Watchdog                                                            C:\fw\midicontroller\x001x\rs232.c
                                           			if (RcvPtr[0] != 0) {                                                         C:\fw\midicontroller\x001x\rs232.c
                                           				ResponseType = COMMAND_ACCEPTED;                                             C:\fw\midicontroller\x001x\rs232.c
                                           				ComWatchValue = RcvPtr[0];		//load watchdog counter.                         C:\fw\midicontroller\x001x\rs232.c
                                           				ComWatchCntr = ComWatchValue;                                                C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			else ResponseType = COMMAND_REJECTED;                                         C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 105:	//SwitchOutletControlMap                                             C:\fw\midicontroller\x001x\rs232.c
                                           			if (!CountOutPreDelay && !SelfTestMode) {                                     C:\fw\midicontroller\x001x\rs232.c
                                           				ResponseType = COMMAND_ACCEPTED;                                             C:\fw\midicontroller\x001x\rs232.c
                                           				ReceptacleStatus = ~RcvPtr[0];		//load desired outlet state.                 C:\fw\midicontroller\x001x\rs232.c
                                           				RequestOutletChange = true;                                                  C:\fw\midicontroller\x001x\rs232.c
                                           				CountOutPreDelay = true;                                                     C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			else ResponseType = COMMAND_REJECTED;                                         C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			break;	                                                                       C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           		case 193:	//EnterBootload mode                                                 C:\fw\midicontroller\x001x\rs232.c
                                           			if (Standby) {                                                                C:\fw\midicontroller\x001x\rs232.c
                                           				if (RcvPtr[0] == 0xF6 && \                                                   C:\fw\midicontroller\x001x\rs232.c
                                           					RcvPtr[1] == 0x8C && \                                                      C:\fw\midicontroller\x001x\rs232.c
                                           					RcvPtr[2] == 0x2A && \                                                      C:\fw\midicontroller\x001x\rs232.c
                                           					RcvPtr[3] == 0x6B) {                                                        C:\fw\midicontroller\x001x\rs232.c
                                           						                                                                           C:\fw\midicontroller\x001x\rs232.c
                                           //exit UPS functionality and enter bootload mode.                                C:\fw\midicontroller\x001x\rs232.c
                                           					DISABLE_ALL_INTERRUPTS();                                                   C:\fw\midicontroller\x001x\rs232.c
                                           					_asm	goto	BOOT_LOAD_MODE	_endasm                                            C:\fw\midicontroller\x001x\rs232.c
                                           						                                                                           C:\fw\midicontroller\x001x\rs232.c
                                           				}                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			ResponseType = COMMAND_REJECTED;                                              C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[2]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			TXENQ(RcvPtr[3]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
                                           			break;	                                                                       C:\fw\midicontroller\x001x\rs232.c
                                           */			                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           //Production test commands                                                       C:\fw\midicontroller\x001x\rs232.c
                                           		case 150:		//NVR Write                                                         C:\fw\midicontroller\x001x\rs232.c
000ef6   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\midicontroller\x001x\rs232.c
000ef8   0e02     MOVLW     0x2                                                                                             
000efa   6fc2     MOVWF     0xc2,0x1                                                                                        
000efc   a8a0     BTFSS     0xa0,0x4,0x0   			if (1 && !PIE2bits.EEIE) {                                                    C:\fw\midicontroller\x001x\rs232.c
                                           //				DISABLE_ALL_INTERRUPTS();                                                  C:\fw\midicontroller\x001x\rs232.c
                                           //				EECounterB = 1;						//Number of bytes to write.                           C:\fw\midicontroller\x001x\rs232.c
                                           //				EEAddress = NVRCommAddr.b_form.low;	//EEPROM register starting address byte. C:\fw\midicontroller\x001x\rs232.c
                                           //				EEData = RcvPtr[0];					//First byte of data to write.                     C:\fw\midicontroller\x001x\rs232.c
                                           //diag disable ee_page_write                                                     C:\fw\midicontroller\x001x\rs232.c
                                           //				EE_PAGE_WRITE();                                                           C:\fw\midicontroller\x001x\rs232.c
                                           //				ENABLE_ALL_INTERRUPTS();                                                   C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000efe   d002     BRA       0xf04          			else ResponseType = COMMAND_REJECTED;                                         C:\fw\midicontroller\x001x\rs232.c
000f00   0e01     MOVLW     0x1                                                                                             
000f02   6fc2     MOVWF     0xc2,0x1                                                                                        
000f04   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
000f06   ffe9                                                                                                               
000f08   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f0a   ffea                                                                                                               
000f0c   50ef     MOVF      0xef,0x0,0x0                                                                                    
000f0e   6ee6     MOVWF     0xe6,0x0                                                                                        
000f10   d98f     RCALL     0x1230                                                                                          
000f12   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000f14   d12c     BRA       0x116e         			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           			                                                                              C:\fw\midicontroller\x001x\rs232.c
                                           		case 151:		//NVR Address                                                       C:\fw\midicontroller\x001x\rs232.c
000f16   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\midicontroller\x001x\rs232.c
000f18   0e02     MOVLW     0x2                                                                                             
000f1a   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\midicontroller\x001x\rs232.c
000f1c   cfde     MOVFF     0xfde,0xfe9    				NVRCommAddr.b_form.low = RcvPtr[0];		//low byte                              C:\fw\midicontroller\x001x\rs232.c
000f1e   ffe9                                                                                                               
000f20   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f22   ffea                                                                                                               
000f24   cfef     MOVFF     0xfef,0x2c5                                                                                     
000f26   f2c5                                                                                                               
000f28   cfde     MOVFF     0xfde,0xfe9    				NVRCommAddr.b_form.high = RcvPtr[1];	//high byte                             C:\fw\midicontroller\x001x\rs232.c
000f2a   ffe9                                                                                                               
000f2c   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f2e   ffea                                                                                                               
000f30   0e01     MOVLW     0x1                                                                                             
000f32   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000f34   0e00     MOVLW     0x0                                                                                             
000f36   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000f38   cfef     MOVFF     0xfef,0x2c6                                                                                     
000f3a   f2c6                                                                                                               
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
000f3c   d003     BRA       0xf44          			else ResponseType = COMMAND_REJECTED;                                         C:\fw\midicontroller\x001x\rs232.c
000f3e   0102     MOVLB     0x2                                                                                             
000f40   0e01     MOVLW     0x1                                                                                             
000f42   6fc2     MOVWF     0xc2,0x1                                                                                        
000f44   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
000f46   ffe9                                                                                                               
000f48   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f4a   ffea                                                                                                               
000f4c   50ef     MOVF      0xef,0x0,0x0                                                                                    
000f4e   6ee6     MOVWF     0xe6,0x0                                                                                        
000f50   d96f     RCALL     0x1230                                                                                          
000f52   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000f54   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
000f56   ffe9                                                                                                               
000f58   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f5a   ffea                                                                                                               
000f5c   0e01     MOVLW     0x1                                                                                             
000f5e   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000f60   0e00     MOVLW     0x0                                                                                             
000f62   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000f64   50ef     MOVF      0xef,0x0,0x0                                                                                    
000f66   6ee6     MOVWF     0xe6,0x0                                                                                        
000f68   d963     RCALL     0x1230                                                                                          
000f6a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000f6c   d100     BRA       0x116e         			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 152:		//RAM Write                                                         C:\fw\midicontroller\x001x\rs232.c
000f6e   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\midicontroller\x001x\rs232.c
000f70   0e02     MOVLW     0x2                                                                                             
000f72   6fc2     MOVWF     0xc2,0x1                                                                                        
000f74   cfde     MOVFF     0xfde,0xfe9    			*(far unsigned char *)RAMCommAddr.s_form = RcvPtr[0];                         C:\fw\midicontroller\x001x\rs232.c
000f76   ffe9                                                                                                               
000f78   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f7a   ffea                                                                                                               
000f7c   50ef     MOVF      0xef,0x0,0x0                                                                                    
000f7e   c2c7     MOVFF     0x2c7,0xfe9                                                                                     
000f80   ffe9                                                                                                               
000f82   c2c8     MOVFF     0x2c8,0xfea                                                                                     
000f84   ffea                                                                                                               
000f86   6eef     MOVWF     0xef,0x0                                                                                        
000f88   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
000f8a   ffe9                                                                                                               
000f8c   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000f8e   ffea                                                                                                               
000f90   50ef     MOVF      0xef,0x0,0x0                                                                                    
000f92   6ee6     MOVWF     0xe6,0x0                                                                                        
000f94   d94d     RCALL     0x1230                                                                                          
000f96   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000f98   d0ea     BRA       0x116e         			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           	                                                                                C:\fw\midicontroller\x001x\rs232.c
                                           		case 153:		//RAM Address                                                       C:\fw\midicontroller\x001x\rs232.c
000f9a   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\midicontroller\x001x\rs232.c
000f9c   0e02     MOVLW     0x2                                                                                             
000f9e   6fc2     MOVWF     0xc2,0x1                                                                                        
000fa0   cfde     MOVFF     0xfde,0xfe9    			RAMCommAddr.b_form.low = RcvPtr[0];		//low byte                               C:\fw\midicontroller\x001x\rs232.c
000fa2   ffe9                                                                                                               
000fa4   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000fa6   ffea                                                                                                               
000fa8   cfef     MOVFF     0xfef,0x2c7                                                                                     
000faa   f2c7                                                                                                               
000fac   cfde     MOVFF     0xfde,0xfe9    			RAMCommAddr.b_form.high = RcvPtr[1];	//high byte                              C:\fw\midicontroller\x001x\rs232.c
000fae   ffe9                                                                                                               
000fb0   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000fb2   ffea                                                                                                               
000fb4   0e01     MOVLW     0x1                                                                                             
000fb6   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000fb8   0e00     MOVLW     0x0                                                                                             
000fba   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000fbc   cfef     MOVFF     0xfef,0x2c8                                                                                     
000fbe   f2c8                                                                                                               
000fc0   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
000fc2   ffe9                                                                                                               
000fc4   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000fc6   ffea                                                                                                               
000fc8   50ef     MOVF      0xef,0x0,0x0                                                                                    
000fca   6ee6     MOVWF     0xe6,0x0                                                                                        
000fcc   d931     RCALL     0x1230                                                                                          
000fce   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000fd0   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
000fd2   ffe9                                                                                                               
000fd4   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000fd6   ffea                                                                                                               
000fd8   0e01     MOVLW     0x1                                                                                             
000fda   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000fdc   0e00     MOVLW     0x0                                                                                             
000fde   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000fe0   50ef     MOVF      0xef,0x0,0x0                                                                                    
000fe2   6ee6     MOVWF     0xe6,0x0                                                                                        
000fe4   d925     RCALL     0x1230                                                                                          
000fe6   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000fe8   d0c2     BRA       0x116e         			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 154:		//Password write (starting with low byte)                           C:\fw\midicontroller\x001x\rs232.c
000fea   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\midicontroller\x001x\rs232.c
000fec   0e02     MOVLW     0x2                                                                                             
000fee   6fc2     MOVWF     0xc2,0x1                                                                                        
000ff0   cfde     MOVFF     0xfde,0xfe9    			if (RcvPtr[0] == 0x42 && \                                                    C:\fw\midicontroller\x001x\rs232.c
000ff2   ffe9                                                                                                               
000ff4   cfdd     MOVFF     0xfdd,0xfea                                                                                     
000ff6   ffea                                                                                                               
000ff8   50ef     MOVF      0xef,0x0,0x0                                                                                    
000ffa   0842     SUBLW     0x42                                                                                            
000ffc   e123     BNZ       0x1044                                                                                          
000ffe   cfde     MOVFF     0xfde,0xfe9                                                                                     
001000   ffe9                                                                                                               
001002   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001004   ffea                                                                                                               
001006   0e01     MOVLW     0x1                                                                                             
001008   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
00100a   0e00     MOVLW     0x0                                                                                             
00100c   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
00100e   50ef     MOVF      0xef,0x0,0x0                                                                                    
001010   0819     SUBLW     0x19                                                                                            
001012   e118     BNZ       0x1044                                                                                          
001014   cfde     MOVFF     0xfde,0xfe9                                                                                     
001016   ffe9                                                                                                               
001018   cfdd     MOVFF     0xfdd,0xfea                                                                                     
00101a   ffea                                                                                                               
00101c   0e02     MOVLW     0x2                                                                                             
00101e   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001020   0e00     MOVLW     0x0                                                                                             
001022   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001024   50ef     MOVF      0xef,0x0,0x0                                                                                    
001026   086e     SUBLW     0x6e                                                                                            
001028   e10d     BNZ       0x1044                                                                                          
00102a   cfde     MOVFF     0xfde,0xfe9                                                                                     
00102c   ffe9                                                                                                               
00102e   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001030   ffea                                                                                                               
001032   0e03     MOVLW     0x3                                                                                             
001034   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001036   0e00     MOVLW     0x0                                                                                             
001038   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
00103a   50ef     MOVF      0xef,0x0,0x0                                                                                    
00103c   0886     SUBLW     0x86                                                                                            
00103e   e102     BNZ       0x1044                                                                                          
                                           				RcvPtr[1] == 0x19 && \                                                       C:\fw\midicontroller\x001x\rs232.c
                                           				RcvPtr[2] == 0x6E && \                                                       C:\fw\midicontroller\x001x\rs232.c
                                           				RcvPtr[3] == 0x86) {                                                         C:\fw\midicontroller\x001x\rs232.c
001040   0102     MOVLB     0x2            				ProdTestCmdsAllowed = true;                                                  C:\fw\midicontroller\x001x\rs232.c
001042   8dc3     BSF       0xc3,0x6,0x1                                                                                    
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           			//don't report command rejected because it'll make it easy to break the password. C:\fw\midicontroller\x001x\rs232.c
001044   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
001046   ffe9                                                                                                               
001048   cfdd     MOVFF     0xfdd,0xfea                                                                                     
00104a   ffea                                                                                                               
00104c   50ef     MOVF      0xef,0x0,0x0                                                                                    
00104e   6ee6     MOVWF     0xe6,0x0                                                                                        
001050   d8ef     RCALL     0x1230                                                                                          
001052   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001054   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
001056   ffe9                                                                                                               
001058   cfdd     MOVFF     0xfdd,0xfea                                                                                     
00105a   ffea                                                                                                               
00105c   0e01     MOVLW     0x1                                                                                             
00105e   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001060   0e00     MOVLW     0x0                                                                                             
001062   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001064   50ef     MOVF      0xef,0x0,0x0                                                                                    
001066   6ee6     MOVWF     0xe6,0x0                                                                                        
001068   d8e3     RCALL     0x1230                                                                                          
00106a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00106c   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[2]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
00106e   ffe9                                                                                                               
001070   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001072   ffea                                                                                                               
001074   0e02     MOVLW     0x2                                                                                             
001076   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001078   0e00     MOVLW     0x0                                                                                             
00107a   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
00107c   50ef     MOVF      0xef,0x0,0x0                                                                                    
00107e   6ee6     MOVWF     0xe6,0x0                                                                                        
001080   d8d7     RCALL     0x1230                                                                                          
001082   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001084   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[3]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
001086   ffe9                                                                                                               
001088   cfdd     MOVFF     0xfdd,0xfea                                                                                     
00108a   ffea                                                                                                               
00108c   0e03     MOVLW     0x3                                                                                             
00108e   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001090   0e00     MOVLW     0x0                                                                                             
001092   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001094   50ef     MOVF      0xef,0x0,0x0                                                                                    
001096   6ee6     MOVWF     0xe6,0x0                                                                                        
001098   d8cb     RCALL     0x1230                                                                                          
00109a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00109c   d068     BRA       0x116e         			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		case 156:		//ROM Write (not supported)                                         C:\fw\midicontroller\x001x\rs232.c
                                           //Writing a single byte is not supported by the chip.                            C:\fw\midicontroller\x001x\rs232.c
00109e   0102     MOVLB     0x2            			ResponseType = COMMAND_REJECTED;                                              C:\fw\midicontroller\x001x\rs232.c
0010a0   0e01     MOVLW     0x1                                                                                             
0010a2   6fc2     MOVWF     0xc2,0x1                                                                                        
0010a4   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
0010a6   ffe9                                                                                                               
0010a8   cfdd     MOVFF     0xfdd,0xfea                                                                                     
0010aa   ffea                                                                                                               
0010ac   50ef     MOVF      0xef,0x0,0x0                                                                                    
0010ae   6ee6     MOVWF     0xe6,0x0                                                                                        
0010b0   d8bf     RCALL     0x1230                                                                                          
0010b2   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0010b4   d05c     BRA       0x116e         			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           	                                                                                C:\fw\midicontroller\x001x\rs232.c
                                           		case 157:		//ROM Address                                                       C:\fw\midicontroller\x001x\rs232.c
0010b6   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\midicontroller\x001x\rs232.c
0010b8   0e02     MOVLW     0x2                                                                                             
0010ba   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           			if (1) {                                                                      C:\fw\midicontroller\x001x\rs232.c
0010bc   cfde     MOVFF     0xfde,0xfe9    				ROMCommAddr.b_form.low = RcvPtr[0];		//low byte                              C:\fw\midicontroller\x001x\rs232.c
0010be   ffe9                                                                                                               
0010c0   cfdd     MOVFF     0xfdd,0xfea                                                                                     
0010c2   ffea                                                                                                               
0010c4   cfef     MOVFF     0xfef,0x2c9                                                                                     
0010c6   f2c9                                                                                                               
0010c8   cfde     MOVFF     0xfde,0xfe9    				ROMCommAddr.b_form.high = RcvPtr[1];	//high byte                             C:\fw\midicontroller\x001x\rs232.c
0010ca   ffe9                                                                                                               
0010cc   cfdd     MOVFF     0xfdd,0xfea                                                                                     
0010ce   ffea                                                                                                               
0010d0   0e01     MOVLW     0x1                                                                                             
0010d2   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
0010d4   0e00     MOVLW     0x0                                                                                             
0010d6   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
0010d8   cfef     MOVFF     0xfef,0x2ca                                                                                     
0010da   f2ca                                                                                                               
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
0010dc   d003     BRA       0x10e4         			else ResponseType = COMMAND_REJECTED;                                         C:\fw\midicontroller\x001x\rs232.c
0010de   0102     MOVLB     0x2                                                                                             
0010e0   0e01     MOVLW     0x1                                                                                             
0010e2   6fc2     MOVWF     0xc2,0x1                                                                                        
0010e4   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
0010e6   ffe9                                                                                                               
0010e8   cfdd     MOVFF     0xfdd,0xfea                                                                                     
0010ea   ffea                                                                                                               
0010ec   50ef     MOVF      0xef,0x0,0x0                                                                                    
0010ee   6ee6     MOVWF     0xe6,0x0                                                                                        
0010f0   d89f     RCALL     0x1230                                                                                          
0010f2   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0010f4   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[1]);			//data                                                    C:\fw\midicontroller\x001x\rs232.c
0010f6   ffe9                                                                                                               
0010f8   cfdd     MOVFF     0xfdd,0xfea                                                                                     
0010fa   ffea                                                                                                               
0010fc   0e01     MOVLW     0x1                                                                                             
0010fe   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001100   0e00     MOVLW     0x0                                                                                             
001102   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001104   50ef     MOVF      0xef,0x0,0x0                                                                                    
001106   6ee6     MOVWF     0xe6,0x0                                                                                        
001108   d893     RCALL     0x1230                                                                                          
00110a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00110c   d030     BRA       0x116e         			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           		case 180:		//NVR Page Write                                                    C:\fw\midicontroller\x001x\rs232.c
00110e   0102     MOVLB     0x2            			ResponseType = COMMAND_ACCEPTED;                                              C:\fw\midicontroller\x001x\rs232.c
001110   0e02     MOVLW     0x2                                                                                             
001112   6fc2     MOVWF     0xc2,0x1                                                                                        
                                           //			if (1 && !PIE2bits.EEIE && !RETRY_EEPROM_WRITE) {                           C:\fw\midicontroller\x001x\rs232.c
                                           //				DISABLE_ALL_INTERRUPTS();                                                  C:\fw\midicontroller\x001x\rs232.c
                                           //				EECounterB = 4;						//Number of bytes to write.                           C:\fw\midicontroller\x001x\rs232.c
                                           //				EEAddress = NVRCommAddr.b_form.low;	//EEPROM register starting address byte. C:\fw\midicontroller\x001x\rs232.c
                                           //				EEData = RcvPtr[0];					//First byte of data to write.                     C:\fw\midicontroller\x001x\rs232.c
                                           //				EEData1 = RcvPtr[1];				//Second byte of data to write.                    C:\fw\midicontroller\x001x\rs232.c
                                           //				EEData2 = RcvPtr[2];				//Third byte of data to write.                     C:\fw\midicontroller\x001x\rs232.c
                                           //				EEData3 = RcvPtr[3];				//Fourth byte of data to write.                    C:\fw\midicontroller\x001x\rs232.c
                                           //diag.. disable ee_page_write                                                   C:\fw\midicontroller\x001x\rs232.c
                                           //				EE_PAGE_WRITE();                                                           C:\fw\midicontroller\x001x\rs232.c
                                           //				ENABLE_ALL_INTERRUPTS();                                                   C:\fw\midicontroller\x001x\rs232.c
                                           //			}                                                                           C:\fw\midicontroller\x001x\rs232.c
                                           //			else ResponseType = COMMAND_REJECTED;                                       C:\fw\midicontroller\x001x\rs232.c
001114   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[0]);                                                             C:\fw\midicontroller\x001x\rs232.c
001116   ffe9                                                                                                               
001118   cfdd     MOVFF     0xfdd,0xfea                                                                                     
00111a   ffea                                                                                                               
00111c   50ef     MOVF      0xef,0x0,0x0                                                                                    
00111e   6ee6     MOVWF     0xe6,0x0                                                                                        
001120   d887     RCALL     0x1230                                                                                          
001122   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001124   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[1]);                                                             C:\fw\midicontroller\x001x\rs232.c
001126   ffe9                                                                                                               
001128   cfdd     MOVFF     0xfdd,0xfea                                                                                     
00112a   ffea                                                                                                               
00112c   0e01     MOVLW     0x1                                                                                             
00112e   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001130   0e00     MOVLW     0x0                                                                                             
001132   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001134   50ef     MOVF      0xef,0x0,0x0                                                                                    
001136   6ee6     MOVWF     0xe6,0x0                                                                                        
001138   d87b     RCALL     0x1230                                                                                          
00113a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00113c   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[2]);                                                             C:\fw\midicontroller\x001x\rs232.c
00113e   ffe9                                                                                                               
001140   cfdd     MOVFF     0xfdd,0xfea                                                                                     
001142   ffea                                                                                                               
001144   0e02     MOVLW     0x2                                                                                             
001146   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001148   0e00     MOVLW     0x0                                                                                             
00114a   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
00114c   50ef     MOVF      0xef,0x0,0x0                                                                                    
00114e   6ee6     MOVWF     0xe6,0x0                                                                                        
001150   d86f     RCALL     0x1230                                                                                          
001152   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001154   cfde     MOVFF     0xfde,0xfe9    			TXENQ(RcvPtr[3]);                                                             C:\fw\midicontroller\x001x\rs232.c
001156   ffe9                                                                                                               
001158   cfdd     MOVFF     0xfdd,0xfea                                                                                     
00115a   ffea                                                                                                               
00115c   0e03     MOVLW     0x3                                                                                             
00115e   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001160   0e00     MOVLW     0x0                                                                                             
001162   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001164   50ef     MOVF      0xef,0x0,0x0                                                                                    
001166   6ee6     MOVWF     0xe6,0x0                                                                                        
001168   d863     RCALL     0x1230                                                                                          
00116a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00116c   d000     BRA       0x116e         			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		default:                                                                       C:\fw\midicontroller\x001x\rs232.c
000ef4   d13c     BRA       0x116e         			break;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           		}                                                                              C:\fw\midicontroller\x001x\rs232.c
                                           	}                                                                               C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
00116e   0102     MOVLB     0x2            	if (USBQuery) {                                                                 C:\fw\midicontroller\x001x\rs232.c
001170   a9c3     BTFSS     0xc3,0x4,0x1                                                                                    
001172   d013     BRA       0x119a                                                                                          
001174   0eff     MOVLW     0xff           		if (ResponseType == 0xff) return;                                              C:\fw\midicontroller\x001x\rs232.c
001176   0102     MOVLB     0x2                                                                                             
001178   5dc2     SUBWF     0xc2,0x0,0x1                                                                                    
00117a   e101     BNZ       0x117e                                                                                          
00117c   d04f     BRA       0x121c                                                                                          
                                           //no response or ack?                                                            C:\fw\midicontroller\x001x\rs232.c
00117e   0e09     MOVLW     0x9            		if (SetupPkt.bRequest == SET_REPORT) return;		//no response to set_report      C:\fw\midicontroller\x001x\rs232.c
001180   0104     MOVLB     0x4                                                                                             
001182   5d11     SUBWF     0x11,0x0,0x1                                                                                    
001184   e101     BNZ       0x1188                                                                                          
001186   d04a     BRA       0x121c                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           		//USB query setup data:                                                        C:\fw\midicontroller\x001x\rs232.c
001188   c412     MOVFF     0x412,0x418    		CtrlTrfData._byte[0] = SetupPkt._byte[2];                                      C:\fw\midicontroller\x001x\rs232.c
00118a   f418                                                                                                               
00118c   0102     MOVLB     0x2            		wCount._word = USBDataPointer;		//Calculate number of bytes to send            C:\fw\midicontroller\x001x\rs232.c
00118e   51c4     MOVF      0xc4,0x0,0x1                                                                                    
001190   0100     MOVLB     0x0                                                                                             
001192   6fab     MOVWF     0xab,0x1                                                                                        
001194   6bac     CLRF      0xac,0x1                                                                                        
001196   d042     BRA       0x121c         		return;                                                                        C:\fw\midicontroller\x001x\rs232.c
                                           	}                                                                               C:\fw\midicontroller\x001x\rs232.c
001198   d040     BRA       0x121a         	else {                                                                          C:\fw\midicontroller\x001x\rs232.c
                                           		//RS232 query setup data:                                                      C:\fw\midicontroller\x001x\rs232.c
00119a   0102     MOVLB     0x2            		TxBuffer[0] = HEADER_CHAR;                                                     C:\fw\midicontroller\x001x\rs232.c
00119c   0e7e     MOVLW     0x7e                                                                                            
00119e   6fdc     MOVWF     0xdc,0x1                                                                                        
0011a0   c2c2     MOVFF     0x2c2,0x2dd    		TxBuffer[1] = ResponseType;                                                    C:\fw\midicontroller\x001x\rs232.c
0011a2   f2dd                                                                                                               
0011a4   c2d6     MOVFF     0x2d6,0x2df    		TxBuffer[3] = RxBuffer[3];				//report ID.                                     C:\fw\midicontroller\x001x\rs232.c
0011a6   f2df                                                                                                               
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
0011a8   0102     MOVLB     0x2            		if (!SendingOutString) TxBuffer[2] = TxBufPtr-3;			//calculate the length of data returned C:\fw\midicontroller\x001x\rs232.c
0011aa   b5c3     BTFSC     0xc3,0x2,0x1                                                                                    
0011ac   d005     BRA       0x11b8                                                                                          
0011ae   0e03     MOVLW     0x3                                                                                             
0011b0   0102     MOVLB     0x2                                                                                             
0011b2   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
0011b4   0102     MOVLB     0x2                                                                                             
0011b6   6fde     MOVWF     0xde,0x1                                                                                        
                                           		//else TxBuffer[2] already written                                             C:\fw\midicontroller\x001x\rs232.c
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           		//if we've enqueued a byte, this indicates that the command was accepted.      C:\fw\midicontroller\x001x\rs232.c
                                           		//In that case, we should compute the checksum and send the data out.          C:\fw\midicontroller\x001x\rs232.c
0011b8   0102     MOVLB     0x2            			if (!SendingOutString) {                                                      C:\fw\midicontroller\x001x\rs232.c
0011ba   b5c3     BTFSC     0xc3,0x2,0x1                                                                                    
0011bc   d028     BRA       0x120e                                                                                          
0011be   0102     MOVLB     0x2            				if (TxBufPtr > 2) {		                                                        C:\fw\midicontroller\x001x\rs232.c
0011c0   51bb     MOVF      0xbb,0x0,0x1                                                                                    
0011c2   0802     SUBLW     0x2                                                                                             
0011c4   e224     BC        0x120e                                                                                          
                                           				//We've enqueued all other bytes, so write the checksum:                     C:\fw\midicontroller\x001x\rs232.c
0011c6   0e03     MOVLW     0x3            					tempvar0 = 0;                                                               C:\fw\midicontroller\x001x\rs232.c
0011c8   6adb     CLRF      0xdb,0x0                                                                                        
0011ca   0e02     MOVLW     0x2            					for (tempvar1 = 0;tempvar1 < TxBufPtr;tempvar1++) {                         C:\fw\midicontroller\x001x\rs232.c
0011cc   6adb     CLRF      0xdb,0x0                                                                                        
0011ce   51bb     MOVF      0xbb,0x0,0x1                                                                                    
0011d0   6ef3     MOVWF     0xf3,0x0                                                                                        
0011d2   0e02     MOVLW     0x2                                                                                             
0011d4   cfdb     MOVFF     0xfdb,0xff4                                                                                     
0011d6   fff4                                                                                                               
0011d8   50f3     MOVF      0xf3,0x0,0x0                                                                                    
0011da   5cf4     SUBWF     0xf4,0x0,0x0                                                                                    
0011dc   e212     BC        0x1202                                                                                          
0011fc   0e02     MOVLW     0x2                                                                                             
0011fe   2adb     INCF      0xdb,0x1,0x0                                                                                    
001200   d7e6     BRA       0x11ce                                                                                          
0011de   0e02     MOVLW     0x2            						tempvar0 += TxBuffer[tempvar1];                                            C:\fw\midicontroller\x001x\rs232.c
0011e0   50db     MOVF      0xdb,0x0,0x0                                                                                    
0011e2   6aea     CLRF      0xea,0x0                                                                                        
0011e4   0fdc     ADDLW     0xdc                                                                                            
0011e6   6ee9     MOVWF     0xe9,0x0                                                                                        
0011e8   0e02     MOVLW     0x2                                                                                             
0011ea   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
0011ec   0e03     MOVLW     0x3                                                                                             
0011ee   cfdb     MOVFF     0xfdb,0xfe7                                                                                     
0011f0   ffe7                                                                                                               
0011f2   50ef     MOVF      0xef,0x0,0x0                                                                                    
0011f4   26e7     ADDWF     0xe7,0x1,0x0                                                                                    
0011f6   0e03     MOVLW     0x3                                                                                             
0011f8   cfe7     MOVFF     0xfe7,0xfdb                                                                                     
0011fa   ffdb                                                                                                               
                                           					}                                                                           C:\fw\midicontroller\x001x\rs232.c
001202   0e03     MOVLW     0x3            					TXENQ(tempvar0);			//enqueue checksum as final byte to send out.            C:\fw\midicontroller\x001x\rs232.c
001204   cfdb     MOVFF     0xfdb,0xfe6                                                                                     
001206   ffe6                                                                                                               
001208   d813     RCALL     0x1230                                                                                          
00120a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00120c   d007     BRA       0x121c         					return;		//and exit                                                         C:\fw\midicontroller\x001x\rs232.c
                                           				}                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           			}                                                                             C:\fw\midicontroller\x001x\rs232.c
                                           		//If the type of command received is neither a poll nor set command,           C:\fw\midicontroller\x001x\rs232.c
                                           		//or we dont recognize the reportID, cancel the command because it             C:\fw\midicontroller\x001x\rs232.c
                                           		//is not recognized.                                                           C:\fw\midicontroller\x001x\rs232.c
00120e   0102     MOVLB     0x2            		TildeFlg = false;					//reset colon-received flag.                             C:\fw\midicontroller\x001x\rs232.c
001210   93c3     BCF       0xc3,0x1,0x1                                                                                    
001212   0102     MOVLB     0x2            		RxBufPtr = 0;						//Reset buffer.                                             C:\fw\midicontroller\x001x\rs232.c
001214   6bbe     CLRF      0xbe,0x1                                                                                        
001216   0102     MOVLB     0x2            		CmdLength = 0;                                                                 C:\fw\midicontroller\x001x\rs232.c
001218   6bbd     CLRF      0xbd,0x1                                                                                        
                                           	}                                                                               C:\fw\midicontroller\x001x\rs232.c
00121a   d000     BRA       0x121c         	return;                                                                         C:\fw\midicontroller\x001x\rs232.c
00121c   0e11     MOVLW     0x11           }                                                                                C:\fw\midicontroller\x001x\rs232.c
00121e   5ce1     SUBWF     0xe1,0x0,0x0                                                                                    
001220   e202     BC        0x1226                                                                                          
001222   6ae1     CLRF      0xe1,0x0                                                                                        
001224   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001226   6ee1     MOVWF     0xe1,0x0                                                                                        
001228   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00122a   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
00122c   ffd9                                                                                                               
00122e   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\midicontroller\x001x\rs232.c
                                           //-----------------------------------------------------------------------        C:\fw\midicontroller\x001x\rs232.c
                                           //This routine will store a character into the TxBuffer.                         C:\fw\midicontroller\x001x\rs232.c
001230   cfd9     MOVFF     0xfd9,0xfe6    void	TXENQ(unsigned char Input) {                                                C:\fw\midicontroller\x001x\rs232.c
001232   ffe6                                                                                                               
001234   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001236   ffd9                                                                                                               
001238   0102     MOVLB     0x2            	if (!USBQuery) {                                                                C:\fw\midicontroller\x001x\rs232.c
00123a   b9c3     BTFSC     0xc3,0x4,0x1                                                                                    
00123c   d010     BRA       0x125e                                                                                          
                                           		//RS232 Query                                                                  C:\fw\midicontroller\x001x\rs232.c
00123e   0e09     MOVLW     0x9            		if (TxBufPtr >= MAX_TX_LENGTH) return;		//Exit if buffer full.                 C:\fw\midicontroller\x001x\rs232.c
001240   0102     MOVLB     0x2                                                                                             
001242   5dbb     SUBWF     0xbb,0x0,0x1                                                                                    
001244   e301     BNC       0x1248                                                                                          
001246   d01a     BRA       0x127c                                                                                          
001248   51bb     MOVF      0xbb,0x0,0x1   		TxBuffer[TxBufPtr] = Input;	//Store value in buffer.                           C:\fw\midicontroller\x001x\rs232.c
00124a   6aea     CLRF      0xea,0x0                                                                                        
00124c   0fdc     ADDLW     0xdc                                                                                            
00124e   6ee9     MOVWF     0xe9,0x0                                                                                        
001250   0e02     MOVLW     0x2                                                                                             
001252   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001254   0efe     MOVLW     0xfe                                                                                            
001256   cfdb     MOVFF     0xfdb,0xfef                                                                                     
001258   ffef                                                                                                               
00125a   2bbb     INCF      0xbb,0x1,0x1   		TxBufPtr++;					//Update input ptr.                                            C:\fw\midicontroller\x001x\rs232.c
                                           	}                                                                               C:\fw\midicontroller\x001x\rs232.c
00125c   d00f     BRA       0x127c         	else {                                                                          C:\fw\midicontroller\x001x\rs232.c
                                           		//USB Query                                                                    C:\fw\midicontroller\x001x\rs232.c
00125e   0e40     MOVLW     0x40           		if (USBDataPointer >= 64) return;		//Exit if buffer full.                      C:\fw\midicontroller\x001x\rs232.c
001260   0102     MOVLB     0x2                                                                                             
001262   5dc4     SUBWF     0xc4,0x0,0x1                                                                                    
001264   e301     BNC       0x1268                                                                                          
001266   d00a     BRA       0x127c                                                                                          
001268   51c4     MOVF      0xc4,0x0,0x1   		CtrlTrfData._byte[USBDataPointer] = Input;                                     C:\fw\midicontroller\x001x\rs232.c
00126a   6aea     CLRF      0xea,0x0                                                                                        
00126c   0f18     ADDLW     0x18                                                                                            
00126e   6ee9     MOVWF     0xe9,0x0                                                                                        
001270   0e04     MOVLW     0x4                                                                                             
001272   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001274   0efe     MOVLW     0xfe                                                                                            
001276   cfdb     MOVFF     0xfdb,0xfef                                                                                     
001278   ffef                                                                                                               
00127a   2bc4     INCF      0xc4,0x1,0x1   		USBDataPointer++;                                                              C:\fw\midicontroller\x001x\rs232.c
                                           	}                                                                               C:\fw\midicontroller\x001x\rs232.c
00127c   52e5     MOVF      0xe5,0x1,0x0   }                                                                                C:\fw\midicontroller\x001x\rs232.c
00127e   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001280   ffd9                                                                                                               
001282   0012     RETURN    0x0                                                                                             
                                           //-----------------------------------------------------------------------        C:\fw\midicontroller\x001x\rs232.c
                                           //Reset TX Buffer.                                                               C:\fw\midicontroller\x001x\rs232.c
                                           void	RTXB(void) {                                                                C:\fw\midicontroller\x001x\rs232.c
001284   0102     MOVLB     0x2            	TxBufPtr = 0;		//Point to buffer start.                                         C:\fw\midicontroller\x001x\rs232.c
001286   6bbb     CLRF      0xbb,0x1                                                                                        
001288   0102     MOVLB     0x2            	TxBufOutPtr = 0;		//Point to buffer start.                                      C:\fw\midicontroller\x001x\rs232.c
00128a   6bbc     CLRF      0xbc,0x1                                                                                        
00128c   0012     RETURN    0x0            }                                                                                C:\fw\midicontroller\x001x\rs232.c
                                           /*********************************************************************           C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            *             Microchip USB C18 Firmware -  HID Version 1.0                     C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            *********************************************************************           C:\fw\midicontroller\x001x\hid.c
                                            * FileName:        hid.c                                                        C:\fw\midicontroller\x001x\hid.c
                                            * Dependencies:    See INCLUDES section below                                   C:\fw\midicontroller\x001x\hid.c
                                            * Processor:       PIC18                                                        C:\fw\midicontroller\x001x\hid.c
                                            * Compiler:        C18 2.30.01+                                                 C:\fw\midicontroller\x001x\hid.c
                                            * Company:         Microchip Technology, Inc.                                   C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Software License Agreement                                                    C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * The software supplied herewith by Microchip Technology Incorporated           C:\fw\midicontroller\x001x\hid.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             C:\fw\midicontroller\x001x\hid.c
                                            * supplied to you, the Company’s customer, for use solely and                   C:\fw\midicontroller\x001x\hid.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               C:\fw\midicontroller\x001x\hid.c
                                            * software is owned by the Company and/or its supplier, and is                  C:\fw\midicontroller\x001x\hid.c
                                            * protected under applicable copyright laws. All rights are reserved.           C:\fw\midicontroller\x001x\hid.c
                                            * Any use in violation of the foregoing restrictions may subject the            C:\fw\midicontroller\x001x\hid.c
                                            * user to criminal sanctions under applicable laws, as well as to               C:\fw\midicontroller\x001x\hid.c
                                            * civil liability for the breach of the terms and conditions of this            C:\fw\midicontroller\x001x\hid.c
                                            * license.                                                                      C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             C:\fw\midicontroller\x001x\hid.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             C:\fw\midicontroller\x001x\hid.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   C:\fw\midicontroller\x001x\hid.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             C:\fw\midicontroller\x001x\hid.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    C:\fw\midicontroller\x001x\hid.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Author               Date        Comment                                      C:\fw\midicontroller\x001x\hid.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           C:\fw\midicontroller\x001x\hid.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    C:\fw\midicontroller\x001x\hid.c
                                            ********************************************************************/           C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           /** I N C L U D E S **********************************************************/  C:\fw\midicontroller\x001x\hid.c
                                           #include "p18f4455.h"                                                            C:\fw\midicontroller\x001x\hid.c
                                           #include "c_system.h"                                                            C:\fw\midicontroller\x001x\hid.c
                                           #include "typedefs.h"                                                            C:\fw\midicontroller\x001x\hid.c
                                           #include "usb.h"                                                                 C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           #ifdef USB_USE_HID                                                               C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  C:\fw\midicontroller\x001x\hid.c
                                           void HIDGetReportHandler(void);                                                  C:\fw\midicontroller\x001x\hid.c
                                           void HIDSetReportHandler(void);                                                  C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           /** V A R I A B L E S ********************************************************/  C:\fw\midicontroller\x001x\hid.c
                                           #pragma udata usb5                                                               C:\fw\midicontroller\x001x\hid.c
                                           byte idle_rate;                                                                  C:\fw\midicontroller\x001x\hid.c
                                           byte active_protocol;               // [0] Boot Protocol [1] Report Protocol     C:\fw\midicontroller\x001x\hid.c
                                           byte hid_rpt_rx_len;                                                             C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           /** D E C L A R A T I O N S **************************************************/  C:\fw\midicontroller\x001x\hid.c
                                           #pragma code                                                                     C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           /** C L A S S  S P E C I F I C  R E Q ****************************************/  C:\fw\midicontroller\x001x\hid.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\hid.c
                                            * Function:        void USBCheckHIDRequest(void)                                C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Overview:        This routine checks the setup data packet to see if it       C:\fw\midicontroller\x001x\hid.c
                                            *                  knows how to handle it                                       C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\hid.c
                                           void USBCheckHIDRequest(void)                                                    C:\fw\midicontroller\x001x\hid.c
                                           {                                                                                C:\fw\midicontroller\x001x\hid.c
0019d6   0104     MOVLB     0x4                if(SetupPkt.Recipient != RCPT_INTF) return;                                  C:\fw\midicontroller\x001x\hid.c
0019d8   5110     MOVF      0x10,0x0,0x1                                                                                    
0019da   0b1f     ANDLW     0x1f                                                                                            
0019dc   0801     SUBLW     0x1                                                                                             
0019de   e001     BZ        0x19e2                                                                                          
0019e0   d086     BRA       0x1aee                                                                                          
0019e2   5114     MOVF      0x14,0x0,0x1       if(SetupPkt.bIntfID != HID_INTF_ID) return;                                  C:\fw\midicontroller\x001x\hid.c
0019e4   e001     BZ        0x19e8                                                                                          
0019e6   d083     BRA       0x1aee                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                               /*                                                                           C:\fw\midicontroller\x001x\hid.c
                                                * There are two standard requests that hid.c may support.                   C:\fw\midicontroller\x001x\hid.c
                                                * 1. GET_DSC(DSC_HID,DSC_RPT,DSC_PHY);                                      C:\fw\midicontroller\x001x\hid.c
                                                * 2. SET_DSC(DSC_HID,DSC_RPT,DSC_PHY);                                      C:\fw\midicontroller\x001x\hid.c
                                                */                                                                          C:\fw\midicontroller\x001x\hid.c
0019e8   0e06     MOVLW     0x6                if(SetupPkt.bRequest == GET_DSC)                                             C:\fw\midicontroller\x001x\hid.c
0019ea   5d11     SUBWF     0x11,0x0,0x1                                                                                    
0019ec   e12e     BNZ       0x1a4a                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\hid.c
0019ee   5113     MOVF      0x13,0x0,0x1           switch(SetupPkt.bDscType)                                                C:\fw\midicontroller\x001x\hid.c
0019f0   0a23     XORLW     0x23                                                                                            
0019f2   e028     BZ        0x1a44                                                                                          
0019f4   0a01     XORLW     0x1                                                                                             
0019f6   e013     BZ        0x1a1e                                                                                          
0019f8   0a03     XORLW     0x3                                                                                             
0019fa   e001     BZ        0x19fe                                                                                          
0019fc   d024     BRA       0x1a46                                                                                          
                                                   {                                                                        C:\fw\midicontroller\x001x\hid.c
                                                       case DSC_HID:                                                        C:\fw\midicontroller\x001x\hid.c
0019fe   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_HID;                               C:\fw\midicontroller\x001x\hid.c
001a00   0e02     MOVLW     0x2                                                                                             
001a02   6fa6     MOVWF     0xa6,0x1                                                                                        
001a04   0100     MOVLB     0x0                            mUSBGetHIDDscAdr(pSrc.bRom);        // See usbcfg.h              C:\fw\midicontroller\x001x\hid.c
001a06   05a3     DECF      0xa3,0x0,0x1                                                                                    
001a08   e105     BNZ       0x1a14                                                                                          
001a0a   0100     MOVLB     0x0                                                                                             
001a0c   0e34     MOVLW     0x34                                                                                            
001a0e   6fa7     MOVWF     0xa7,0x1                                                                                        
001a10   0e1c     MOVLW     0x1c                                                                                            
001a12   6fa8     MOVWF     0xa8,0x1                                                                                        
001a14   0e09     MOVLW     0x9                            wCount._word = sizeof(USB_HID_DSC);                              C:\fw\midicontroller\x001x\hid.c
001a16   0100     MOVLB     0x0                                                                                             
001a18   6fab     MOVWF     0xab,0x1                                                                                        
001a1a   6bac     CLRF      0xac,0x1                                                                                        
001a1c   d014     BRA       0x1a46                         break;                                                           C:\fw\midicontroller\x001x\hid.c
                                                       case DSC_RPT:                                                        C:\fw\midicontroller\x001x\hid.c
001a1e   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_HID;                               C:\fw\midicontroller\x001x\hid.c
001a20   0e02     MOVLW     0x2                                                                                             
001a22   6fa6     MOVWF     0xa6,0x1                                                                                        
001a24   0100     MOVLB     0x0                            mUSBGetHIDRptDscAdr(pSrc.bRom);     // See usbcfg.h              C:\fw\midicontroller\x001x\hid.c
001a26   05a3     DECF      0xa3,0x0,0x1                                                                                    
001a28   e105     BNZ       0x1a34                                                                                          
001a2a   0100     MOVLB     0x0                                                                                             
001a2c   0eb8     MOVLW     0xb8                                                                                            
001a2e   6fa7     MOVWF     0xa7,0x1                                                                                        
001a30   0e1c     MOVLW     0x1c                                                                                            
001a32   6fa8     MOVWF     0xa8,0x1                                                                                        
001a34   0100     MOVLB     0x0                            mUSBGetHIDRptDscSize(wCount._word); // See usbcfg.h              C:\fw\midicontroller\x001x\hid.c
001a36   05a3     DECF      0xa3,0x0,0x1                                                                                    
001a38   e104     BNZ       0x1a42                                                                                          
001a3a   0e65     MOVLW     0x65                                                                                            
001a3c   0100     MOVLB     0x0                                                                                             
001a3e   6fab     MOVWF     0xab,0x1                                                                                        
001a40   6bac     CLRF      0xac,0x1                                                                                        
001a42   d001     BRA       0x1a46                         break;                                                           C:\fw\midicontroller\x001x\hid.c
                                                       case DSC_PHY:                                                        C:\fw\midicontroller\x001x\hid.c
                                                           // ctrl_trf_session_owner = MUID_HID;                            C:\fw\midicontroller\x001x\hid.c
001a44   d000     BRA       0x1a46                         break;                                                           C:\fw\midicontroller\x001x\hid.c
                                                   }//end switch(SetupPkt.bDscType)                                         C:\fw\midicontroller\x001x\hid.c
001a46   0100     MOVLB     0x0                    usb_stat.ctrl_trf_mem = _ROM;                                            C:\fw\midicontroller\x001x\hid.c
001a48   83a2     BSF       0xa2,0x1,0x1                                                                                    
                                               }//end if(SetupPkt.bRequest == GET_DSC)                                      C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
001a4a   0104     MOVLB     0x4                if(SetupPkt.RequestType != CLASS) return;                                    C:\fw\midicontroller\x001x\hid.c
001a4c   5110     MOVF      0x10,0x0,0x1                                                                                    
001a4e   0b60     ANDLW     0x60                                                                                            
001a50   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001a52   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001a54   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001a56   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001a58   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
001a5a   0801     SUBLW     0x1                                                                                             
001a5c   e001     BZ        0x1a60                                                                                          
001a5e   d047     BRA       0x1aee                                                                                          
001a60   5111     MOVF      0x11,0x0,0x1       switch(SetupPkt.bRequest)                                                    C:\fw\midicontroller\x001x\hid.c
001a62   0a0b     XORLW     0xb                                                                                             
001a64   e03e     BZ        0x1ae2                                                                                          
001a66   0a08     XORLW     0x8                                                                                             
001a68   e02e     BZ        0x1ac6                                                                                          
001a6a   0a09     XORLW     0x9                                                                                             
001a6c   e026     BZ        0x1aba                                                                                          
001a6e   0a08     XORLW     0x8                                                                                             
001a70   e016     BZ        0x1a9e                                                                                          
001a72   0a0b     XORLW     0xb                                                                                             
001a74   e006     BZ        0x1a82                                                                                          
001a76   0a08     XORLW     0x8                                                                                             
001a78   e001     BZ        0x1a7c                                                                                          
001a7a   d039     BRA       0x1aee                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\hid.c
                                                   case GET_REPORT:                                                         C:\fw\midicontroller\x001x\hid.c
001a7c   ec2b     CALL      0x1e56,0x0                 HIDGetReportHandler();                                               C:\fw\midicontroller\x001x\hid.c
001a7e   f00f                                                                                                               
001a80   d036     BRA       0x1aee                     break;                                                               C:\fw\midicontroller\x001x\hid.c
                                                   case SET_REPORT:                                                         C:\fw\midicontroller\x001x\hid.c
                                           //            HIDSetReportHandler();      //2/8/05 JD this was not at the right location. C:\fw\midicontroller\x001x\hid.c
001a82   0100     MOVLB     0x0            			pDst.bRam = (byte*)&USBEP0DataInBuffer;	//Set destination for report data.    C:\fw\midicontroller\x001x\hid.c
001a84   0ecb     MOVLW     0xcb                                                                                            
001a86   6fa9     MOVWF     0xa9,0x1                                                                                        
001a88   0e02     MOVLW     0x2                                                                                             
001a8a   6faa     MOVWF     0xaa,0x1                                                                                        
001a8c   0100     MOVLB     0x0            			usb_stat.ctrl_trf_mem = _RAM;		//Set memory type                              C:\fw\midicontroller\x001x\hid.c
001a8e   93a2     BCF       0xa2,0x1,0x1                                                                                    
001a90   0100     MOVLB     0x0            			wCount._word = 0;					//reset counter                                         C:\fw\midicontroller\x001x\hid.c
001a92   6bab     CLRF      0xab,0x1                                                                                        
001a94   6bac     CLRF      0xac,0x1                                                                                        
001a96   0100     MOVLB     0x0            			ctrl_trf_session_owner = MUID_HID;  //set owner to HID, service this when we have some data..	 C:\fw\midicontroller\x001x\hid.c
001a98   0e02     MOVLW     0x2                                                                                             
001a9a   6fa6     MOVWF     0xa6,0x1                                                                                        
001a9c   d028     BRA       0x1aee                     break;                                                               C:\fw\midicontroller\x001x\hid.c
                                                   case GET_IDLE:                                                           C:\fw\midicontroller\x001x\hid.c
001a9e   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_HID;                                   C:\fw\midicontroller\x001x\hid.c
001aa0   0e02     MOVLW     0x2                                                                                             
001aa2   6fa6     MOVWF     0xa6,0x1                                                                                        
001aa4   0100     MOVLB     0x0                        pSrc.bRam = (byte*)&idle_rate;      // Set source                    C:\fw\midicontroller\x001x\hid.c
001aa6   0eaf     MOVLW     0xaf                                                                                            
001aa8   6fa7     MOVWF     0xa7,0x1                                                                                        
001aaa   0e00     MOVLW     0x0                                                                                             
001aac   6fa8     MOVWF     0xa8,0x1                                                                                        
001aae   0100     MOVLB     0x0                        usb_stat.ctrl_trf_mem = _RAM;       // Set memory type               C:\fw\midicontroller\x001x\hid.c
001ab0   93a2     BCF       0xa2,0x1,0x1                                                                                    
001ab2   0100     MOVLB     0x0                        LSB(wCount) = 1;                    // Set data count                C:\fw\midicontroller\x001x\hid.c
001ab4   0e01     MOVLW     0x1                                                                                             
001ab6   6fab     MOVWF     0xab,0x1                                                                                        
001ab8   d01a     BRA       0x1aee                     break;                                                               C:\fw\midicontroller\x001x\hid.c
                                                   case SET_IDLE:                                                           C:\fw\midicontroller\x001x\hid.c
001aba   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_HID;                                   C:\fw\midicontroller\x001x\hid.c
001abc   0e02     MOVLW     0x2                                                                                             
001abe   6fa6     MOVWF     0xa6,0x1                                                                                        
001ac0   c413     MOVFF     0x413,0xaf                 idle_rate = MSB(SetupPkt.W_Value);                                   C:\fw\midicontroller\x001x\hid.c
001ac2   f0af                                                                                                               
001ac4   d014     BRA       0x1aee                     break;                                                               C:\fw\midicontroller\x001x\hid.c
                                                   case GET_PROTOCOL:                                                       C:\fw\midicontroller\x001x\hid.c
001ac6   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_HID;                                   C:\fw\midicontroller\x001x\hid.c
001ac8   0e02     MOVLW     0x2                                                                                             
001aca   6fa6     MOVWF     0xa6,0x1                                                                                        
001acc   0100     MOVLB     0x0                        pSrc.bRam = (byte*)&active_protocol;// Set source                    C:\fw\midicontroller\x001x\hid.c
001ace   0eb0     MOVLW     0xb0                                                                                            
001ad0   6fa7     MOVWF     0xa7,0x1                                                                                        
001ad2   0e00     MOVLW     0x0                                                                                             
001ad4   6fa8     MOVWF     0xa8,0x1                                                                                        
001ad6   0100     MOVLB     0x0                        usb_stat.ctrl_trf_mem = _RAM;       // Set memory type               C:\fw\midicontroller\x001x\hid.c
001ad8   93a2     BCF       0xa2,0x1,0x1                                                                                    
001ada   0100     MOVLB     0x0                        LSB(wCount) = 1;                    // Set data count                C:\fw\midicontroller\x001x\hid.c
001adc   0e01     MOVLW     0x1                                                                                             
001ade   6fab     MOVWF     0xab,0x1                                                                                        
001ae0   d006     BRA       0x1aee                     break;                                                               C:\fw\midicontroller\x001x\hid.c
                                                   case SET_PROTOCOL:                                                       C:\fw\midicontroller\x001x\hid.c
001ae2   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_HID;                                   C:\fw\midicontroller\x001x\hid.c
001ae4   0e02     MOVLW     0x2                                                                                             
001ae6   6fa6     MOVWF     0xa6,0x1                                                                                        
001ae8   c412     MOVFF     0x412,0xb0                 active_protocol = LSB(SetupPkt.W_Value);                             C:\fw\midicontroller\x001x\hid.c
001aea   f0b0                                                                                                               
001aec   d000     BRA       0x1aee                     break;                                                               C:\fw\midicontroller\x001x\hid.c
                                               }//end switch(SetupPkt.bRequest)                                             C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
001aee   0012     RETURN    0x0            }//end USBCheckHIDRequest                                                        C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           /** U S E R  A P I ***********************************************************/  C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\hid.c
                                            * Function:        void HIDInitEP(void)                                         C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * PreCondition:    None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Input:           None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Overview:        HIDInitEP initializes HID endpoints, buffer descriptors,     C:\fw\midicontroller\x001x\hid.c
                                            *                  internal state-machine, and variables.                       C:\fw\midicontroller\x001x\hid.c
                                            *                  It should be called after the USB host has sent out a        C:\fw\midicontroller\x001x\hid.c
                                            *                  SET_CONFIGURATION request.                                   C:\fw\midicontroller\x001x\hid.c
                                            *                  See USBStdSetCfgHandler() in usb9.c for examples.            C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\hid.c
                                           void HIDInitEP(void)                                                             C:\fw\midicontroller\x001x\hid.c
                                           {                                                                                C:\fw\midicontroller\x001x\hid.c
001af0   0100     MOVLB     0x0                hid_rpt_rx_len =0;                                                           C:\fw\midicontroller\x001x\hid.c
001af2   6bb1     CLRF      0xb1,0x1                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
001af4   0e1e     MOVLW     0x1e               HID_UEP = EP_OUT_IN|HSHK_EN;                // Enable 2 data pipes           C:\fw\midicontroller\x001x\hid.c
001af6   6e71     MOVWF     0x71,0x0                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
001af8   0104     MOVLB     0x4                HID_BD_OUT.Cnt = sizeof(hid_report_out);    // Set buffer size               C:\fw\midicontroller\x001x\hid.c
001afa   0e08     MOVLW     0x8                                                                                             
001afc   6f09     MOVWF     0x9,0x1                                                                                         
001afe   0e58     MOVLW     0x58               HID_BD_OUT.ADR = (byte*)&hid_report_out;    // Set buffer address            C:\fw\midicontroller\x001x\hid.c
001b00   6f0a     MOVWF     0xa,0x1                                                                                         
001b02   0e04     MOVLW     0x4                                                                                             
001b04   6f0b     MOVWF     0xb,0x1                                                                                         
001b06   0e88     MOVLW     0x88               HID_BD_OUT.Stat._byte = _USIE|_DAT0|_DTSEN; // Set status                    C:\fw\midicontroller\x001x\hid.c
001b08   6f08     MOVWF     0x8,0x1                                                                                         
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                               /*                                                                           C:\fw\midicontroller\x001x\hid.c
                                                * Do not have to init Cnt of IN pipes here.                                 C:\fw\midicontroller\x001x\hid.c
                                                * Reason:  Number of bytes to send to the host                              C:\fw\midicontroller\x001x\hid.c
                                                *          varies from one transaction to                                   C:\fw\midicontroller\x001x\hid.c
                                                *          another. Cnt should equal the exact                              C:\fw\midicontroller\x001x\hid.c
                                                *          number of bytes to transmit for                                  C:\fw\midicontroller\x001x\hid.c
                                                *          a given IN transaction.                                          C:\fw\midicontroller\x001x\hid.c
                                                *          This number of bytes will only                                   C:\fw\midicontroller\x001x\hid.c
                                                *          be known right before the data is                                C:\fw\midicontroller\x001x\hid.c
                                                *          sent.                                                            C:\fw\midicontroller\x001x\hid.c
                                                */                                                                          C:\fw\midicontroller\x001x\hid.c
001b0a   0104     MOVLB     0x4                HID_BD_IN.ADR = (byte*)&hid_report_in;      // Set buffer address            C:\fw\midicontroller\x001x\hid.c
001b0c   0e60     MOVLW     0x60                                                                                            
001b0e   6f0e     MOVWF     0xe,0x1                                                                                         
001b10   0e04     MOVLW     0x4                                                                                             
001b12   6f0f     MOVWF     0xf,0x1                                                                                         
001b14   0e40     MOVLW     0x40               HID_BD_IN.Stat._byte = _UCPU|_DAT1;         // Set status                    C:\fw\midicontroller\x001x\hid.c
001b16   6f0c     MOVWF     0xc,0x1                                                                                         
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
001b18   0012     RETURN    0x0            }//end HIDInitEP                                                                 C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\hid.c
                                            * Function:        void HIDTxReport(char *buffer, byte len)                     C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * PreCondition:    mHIDTxIsBusy() must return false.                            C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            *                  Value of 'len' must be equal to or smaller than              C:\fw\midicontroller\x001x\hid.c
                                            *                  HID_INT_IN_EP_SIZE                                           C:\fw\midicontroller\x001x\hid.c
                                            *                  For an interrupt endpoint, the largest buffer size is        C:\fw\midicontroller\x001x\hid.c
                                            *                  64 bytes.                                                    C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Input:           buffer  : Pointer to the starting location of data bytes     C:\fw\midicontroller\x001x\hid.c
                                            *                  len     : Number of bytes to be transferred                  C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Output:          None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Side Effects:    None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Overview:        Use this macro to transfer data located in data memory.      C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            *                  Remember: mHIDTxIsBusy() must return false before user       C:\fw\midicontroller\x001x\hid.c
                                            *                  can call this function.                                      C:\fw\midicontroller\x001x\hid.c
                                            *                  Unexpected behavior will occur if this function is called    C:\fw\midicontroller\x001x\hid.c
                                            *                  when mHIDTxIsBusy() == 0                                     C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            *                  Typical Usage:                                               C:\fw\midicontroller\x001x\hid.c
                                            *                  if(!mHIDTxIsBusy())                                          C:\fw\midicontroller\x001x\hid.c
                                            *                      HIDTxReport(buffer, 3);                                  C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Note:            None                                                         C:\fw\midicontroller\x001x\hid.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\hid.c
001b1a   cfd9     MOVFF     0xfd9,0xfe6    void HIDTxReport(char *buffer, byte len)                                         C:\fw\midicontroller\x001x\hid.c
001b1c   ffe6                                                                                                               
001b1e   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001b20   ffd9                                                                                                               
001b22   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           {                                                                                C:\fw\midicontroller\x001x\hid.c
                                           	byte i;                                                                         C:\fw\midicontroller\x001x\hid.c
                                           	                                                                                C:\fw\midicontroller\x001x\hid.c
                                               /*                                                                           C:\fw\midicontroller\x001x\hid.c
                                                * Value of len should be equal to or smaller than HID_INT_IN_EP_SIZE.       C:\fw\midicontroller\x001x\hid.c
                                                * This check forces the value of len to meet the precondition.              C:\fw\midicontroller\x001x\hid.c
                                                */                                                                          C:\fw\midicontroller\x001x\hid.c
001b24   0efc     MOVLW     0xfc           	if(len > HID_INT_IN_EP_SIZE)                                                    C:\fw\midicontroller\x001x\hid.c
001b26   50db     MOVF      0xdb,0x0,0x0                                                                                    
001b28   0808     SUBLW     0x8                                                                                             
001b2a   e205     BC        0x1b36                                                                                          
001b2c   0e08     MOVLW     0x8            	    len = HID_INT_IN_EP_SIZE;                                                   C:\fw\midicontroller\x001x\hid.c
001b2e   6ef3     MOVWF     0xf3,0x0                                                                                        
001b30   0efc     MOVLW     0xfc                                                                                            
001b32   cff3     MOVFF     0xff3,0xfdb                                                                                     
001b34   ffdb                                                                                                               
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                              /*                                                                            C:\fw\midicontroller\x001x\hid.c
                                               * Copy data from user's buffer to dual-ram buffer                            C:\fw\midicontroller\x001x\hid.c
                                               */                                                                           C:\fw\midicontroller\x001x\hid.c
001b36   6adf     CLRF      0xdf,0x0           for (i = 0; i < len; i++)                                                    C:\fw\midicontroller\x001x\hid.c
001b38   0efc     MOVLW     0xfc                                                                                            
001b3a   50db     MOVF      0xdb,0x0,0x0                                                                                    
001b3c   5cdf     SUBWF     0xdf,0x0,0x0                                                                                    
001b3e   e219     BC        0x1b72                                                                                          
001b6e   2adf     INCF      0xdf,0x1,0x0                                                                                    
001b70   d7e3     BRA       0x1b38                                                                                          
001b40   50df     MOVF      0xdf,0x0,0x0       	hid_report_in[i] = buffer[i];                                               C:\fw\midicontroller\x001x\hid.c
001b42   6ee7     MOVWF     0xe7,0x0                                                                                        
001b44   0efd     MOVLW     0xfd                                                                                            
001b46   cfdb     MOVFF     0xfdb,0xfe9                                                                                     
001b48   ffe9                                                                                                               
001b4a   0efe     MOVLW     0xfe                                                                                            
001b4c   cfdb     MOVFF     0xfdb,0xfea                                                                                     
001b4e   ffea                                                                                                               
001b50   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001b52   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001b54   0e00     MOVLW     0x0                                                                                             
001b56   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001b58   50ef     MOVF      0xef,0x0,0x0                                                                                    
001b5a   6ee6     MOVWF     0xe6,0x0                                                                                        
001b5c   50df     MOVF      0xdf,0x0,0x0                                                                                    
001b5e   6aea     CLRF      0xea,0x0                                                                                        
001b60   0f60     ADDLW     0x60                                                                                            
001b62   6ee9     MOVWF     0xe9,0x0                                                                                        
001b64   0e04     MOVLW     0x4                                                                                             
001b66   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001b68   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001b6a   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001b6c   6eef     MOVWF     0xef,0x0                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
001b72   0efc     MOVLW     0xfc               HID_BD_IN.Cnt = len;                                                         C:\fw\midicontroller\x001x\hid.c
001b74   cfdb     MOVFF     0xfdb,0x40d                                                                                     
001b76   f40d                                                                                                               
001b78   0e40     MOVLW     0x40               mUSBBufferReady(HID_BD_IN);                                                  C:\fw\midicontroller\x001x\hid.c
001b7a   0104     MOVLB     0x4                                                                                             
001b7c   170c     ANDWF     0xc,0x1,0x1                                                                                     
001b7e   7d0c     BTG       0xc,0x6,0x1                                                                                     
001b80   0e88     MOVLW     0x88                                                                                            
001b82   130c     IORWF     0xc,0x1,0x1                                                                                     
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
001b84   52e5     MOVF      0xe5,0x1,0x0   }//end HIDTxReport                                                               C:\fw\midicontroller\x001x\hid.c
001b86   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001b88   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001b8a   ffd9                                                                                                               
001b8c   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           /******************************************************************************  C:\fw\midicontroller\x001x\hid.c
                                            * Function:        byte HIDRxReport(char *buffer, byte len)                     C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * PreCondition:    Value of input argument 'len' should be smaller than the     C:\fw\midicontroller\x001x\hid.c
                                            *                  maximum endpoint size responsible for receiving report       C:\fw\midicontroller\x001x\hid.c
                                            *                  data from USB host for HID class.                            C:\fw\midicontroller\x001x\hid.c
                                            *                  Input argument 'buffer' should point to a buffer area that   C:\fw\midicontroller\x001x\hid.c
                                            *                  is bigger or equal to the size specified by 'len'.           C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Input:           buffer  : Pointer to where received bytes are to be stored   C:\fw\midicontroller\x001x\hid.c
                                            *                  len     : The number of bytes expected.                      C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Output:          The number of bytes copied to buffer.                        C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Side Effects:    Publicly accessible variable hid_rpt_rx_len is updated       C:\fw\midicontroller\x001x\hid.c
                                            *                  with the number of bytes copied to buffer.                   C:\fw\midicontroller\x001x\hid.c
                                            *                  Once HIDRxReport is called, subsequent retrieval of          C:\fw\midicontroller\x001x\hid.c
                                            *                  hid_rpt_rx_len can be done by calling macro                  C:\fw\midicontroller\x001x\hid.c
                                            *                  mHIDGetRptRxLength().                                        C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Overview:        HIDRxReport copies a string of bytes received through        C:\fw\midicontroller\x001x\hid.c
                                            *                  USB HID OUT endpoint to a user's specified location.         C:\fw\midicontroller\x001x\hid.c
                                            *                  It is a non-blocking function. It does not wait              C:\fw\midicontroller\x001x\hid.c
                                            *                  for data if there is no data available. Instead it returns   C:\fw\midicontroller\x001x\hid.c
                                            *                  '0' to notify the caller that there is no data available.    C:\fw\midicontroller\x001x\hid.c
                                            *                                                                               C:\fw\midicontroller\x001x\hid.c
                                            * Note:            If the actual number of bytes received is larger than the    C:\fw\midicontroller\x001x\hid.c
                                            *                  number of bytes expected (len), only the expected number     C:\fw\midicontroller\x001x\hid.c
                                            *                  of bytes specified will be copied to buffer.                 C:\fw\midicontroller\x001x\hid.c
                                            *                  If the actual number of bytes received is smaller than the   C:\fw\midicontroller\x001x\hid.c
                                            *                  number of bytes expected (len), only the actual number       C:\fw\midicontroller\x001x\hid.c
                                            *                  of bytes received will be copied to buffer.                  C:\fw\midicontroller\x001x\hid.c
                                            *****************************************************************************/  C:\fw\midicontroller\x001x\hid.c
001b8e   cfd9     MOVFF     0xfd9,0xfe6    byte HIDRxReport(char *buffer, byte len)                                         C:\fw\midicontroller\x001x\hid.c
001b90   ffe6                                                                                                               
001b92   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
001b94   ffd9                                                                                                               
                                           {                                                                                C:\fw\midicontroller\x001x\hid.c
001b96   0100     MOVLB     0x0                hid_rpt_rx_len = 0;                                                          C:\fw\midicontroller\x001x\hid.c
001b98   6bb1     CLRF      0xb1,0x1                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
001b9a   0104     MOVLB     0x4                if(!mHIDRxIsBusy())                                                          C:\fw\midicontroller\x001x\hid.c
001b9c   bf08     BTFSC     0x8,0x7,0x1                                                                                     
001b9e   d031     BRA       0x1c02                                                                                          
                                               {                                                                            C:\fw\midicontroller\x001x\hid.c
                                                   /*                                                                       C:\fw\midicontroller\x001x\hid.c
                                                    * Adjust the expected number of bytes to equal                          C:\fw\midicontroller\x001x\hid.c
                                                    * the actual number of bytes received.                                  C:\fw\midicontroller\x001x\hid.c
                                                    */                                                                      C:\fw\midicontroller\x001x\hid.c
001ba0   0efc     MOVLW     0xfc                   if(len > HID_BD_OUT.Cnt)                                                 C:\fw\midicontroller\x001x\hid.c
001ba2   cfdb     MOVFF     0xfdb,0x2                                                                                       
001ba4   f002                                                                                                               
001ba6   5109     MOVF      0x9,0x0,0x1                                                                                     
001ba8   80d8     BSF       0xd8,0x0,0x0                                                                                    
001baa   5402     SUBFWB    0x2,0x0,0x0                                                                                     
001bac   e203     BC        0x1bb4                                                                                          
001bae   0efc     MOVLW     0xfc                       len = HID_BD_OUT.Cnt;                                                C:\fw\midicontroller\x001x\hid.c
001bb0   c409     MOVFF     0x409,0xfdb                                                                                     
001bb2   ffdb                                                                                                               
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                                   /*                                                                       C:\fw\midicontroller\x001x\hid.c
                                                    * Copy data from dual-ram buffer to user's buffer                       C:\fw\midicontroller\x001x\hid.c
                                                    */                                                                      C:\fw\midicontroller\x001x\hid.c
001bb4   0100     MOVLB     0x0                    for(hid_rpt_rx_len = 0; hid_rpt_rx_len < len; hid_rpt_rx_len++)          C:\fw\midicontroller\x001x\hid.c
001bb6   6bb1     CLRF      0xb1,0x1                                                                                        
001bb8   0efc     MOVLW     0xfc                                                                                            
001bba   50db     MOVF      0xdb,0x0,0x0                                                                                    
001bbc   5db1     SUBWF     0xb1,0x0,0x1                                                                                    
001bbe   e219     BC        0x1bf2                                                                                          
001bee   2bb1     INCF      0xb1,0x1,0x1                                                                                    
001bf0   d7e3     BRA       0x1bb8                                                                                          
001bc0   51b1     MOVF      0xb1,0x0,0x1               buffer[hid_rpt_rx_len] = hid_report_out[hid_rpt_rx_len];             C:\fw\midicontroller\x001x\hid.c
001bc2   6aea     CLRF      0xea,0x0                                                                                        
001bc4   0f58     ADDLW     0x58                                                                                            
001bc6   6ee9     MOVWF     0xe9,0x0                                                                                        
001bc8   0e04     MOVLW     0x4                                                                                             
001bca   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001bcc   50ef     MOVF      0xef,0x0,0x0                                                                                    
001bce   6ee6     MOVWF     0xe6,0x0                                                                                        
001bd0   51b1     MOVF      0xb1,0x0,0x1                                                                                    
001bd2   6ee7     MOVWF     0xe7,0x0                                                                                        
001bd4   0efd     MOVLW     0xfd                                                                                            
001bd6   cfdb     MOVFF     0xfdb,0xfe9                                                                                     
001bd8   ffe9                                                                                                               
001bda   0efe     MOVLW     0xfe                                                                                            
001bdc   cfdb     MOVFF     0xfdb,0xfea                                                                                     
001bde   ffea                                                                                                               
001be0   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001be2   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
001be4   0e00     MOVLW     0x0                                                                                             
001be6   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
001be8   52e5     MOVF      0xe5,0x1,0x0                                                                                    
001bea   50e7     MOVF      0xe7,0x0,0x0                                                                                    
001bec   6eef     MOVWF     0xef,0x0                                                                                        
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                                   /*                                                                       C:\fw\midicontroller\x001x\hid.c
                                                    * Prepare dual-ram buffer for next OUT transaction                      C:\fw\midicontroller\x001x\hid.c
                                                    */                                                                      C:\fw\midicontroller\x001x\hid.c
001bf2   0104     MOVLB     0x4                    HID_BD_OUT.Cnt = sizeof(hid_report_out);                                 C:\fw\midicontroller\x001x\hid.c
001bf4   0e08     MOVLW     0x8                                                                                             
001bf6   6f09     MOVWF     0x9,0x1                                                                                         
001bf8   0e40     MOVLW     0x40                   mUSBBufferReady(HID_BD_OUT);                                             C:\fw\midicontroller\x001x\hid.c
001bfa   1708     ANDWF     0x8,0x1,0x1                                                                                     
001bfc   7d08     BTG       0x8,0x6,0x1                                                                                     
001bfe   0e88     MOVLW     0x88                                                                                            
001c00   1308     IORWF     0x8,0x1,0x1                                                                                     
                                               }//end if                                                                    C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
001c02   0100     MOVLB     0x0                return hid_rpt_rx_len;                                                       C:\fw\midicontroller\x001x\hid.c
001c04   51b1     MOVF      0xb1,0x0,0x1                                                                                    
001c06   d000     BRA       0x1c08                                                                                          
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
001c08   52e5     MOVF      0xe5,0x1,0x0   }//end HIDRxReport                                                               C:\fw\midicontroller\x001x\hid.c
001c0a   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
001c0c   ffd9                                                                                                               
001c0e   0012     RETURN    0x0                                                                                             
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           #endif //def USB_USE_HID                                                         C:\fw\midicontroller\x001x\hid.c
                                                                                                                            C:\fw\midicontroller\x001x\hid.c
                                           /** EOF hid.c ***************************************************************/   C:\fw\midicontroller\x001x\hid.c
                                           #include	"c_system.h"                                                            C:\fw\midicontroller\x001x\ram_def.c
                                                                                                                            C:\fw\midicontroller\x001x\ram_def.c
                                           //global ram                                                                     C:\fw\midicontroller\x001x\ram_def.c
                                                                                                                            C:\fw\midicontroller\x001x\ram_def.c
                                           #pragma udata RamData                                                            C:\fw\midicontroller\x001x\ram_def.c
                                                                                                                            C:\fw\midicontroller\x001x\ram_def.c
                                                                                                                            C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char Sample;                                                            C:\fw\midicontroller\x001x\ram_def.c
                                           TwoBytes SampleData;                                                             C:\fw\midicontroller\x001x\ram_def.c
                                           TwoBytes DataBuffer[220];                                                        C:\fw\midicontroller\x001x\ram_def.c
                                                                                                                            C:\fw\midicontroller\x001x\ram_def.c
                                                                                                                            C:\fw\midicontroller\x001x\ram_def.c
                                           //----------------------------USB stuff----------------------------------        C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char TxBufPtr;                                                          C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char TxBufOutPtr;                                                       C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char CmdLength;                                                         C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char RxBufPtr;                                                          C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char StringPtr;                                                         C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char StringPtr_H;                                                       C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char StringChksum;                                                      C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char ResponseType;                                                      C:\fw\midicontroller\x001x\ram_def.c
                                           BitField	CommFlags1;                                                             C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char USBDataPointer;                                                    C:\fw\midicontroller\x001x\ram_def.c
                                           TwoBytes NVRCommAddr;                                                            C:\fw\midicontroller\x001x\ram_def.c
                                           TwoBytes RAMCommAddr;                                                            C:\fw\midicontroller\x001x\ram_def.c
                                           TwoBytes ROMCommAddr;                                                            C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char USBEP0DataInBuffer[8];                                             C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char	RxBuffer[9];                                                       C:\fw\midicontroller\x001x\ram_def.c
                                           unsigned char	TxBuffer[64];                                                      C:\fw\midicontroller\x001x\ram_def.c
                                           #include "c_system.h"                                                            C:\fw\midicontroller\x001x\dummystart.c
                                                                                                                            C:\fw\midicontroller\x001x\dummystart.c
                                           void main(void);                                                                 C:\fw\midicontroller\x001x\dummystart.c
                                                                                                                            C:\fw\midicontroller\x001x\dummystart.c
                                           #pragma code RealInitVector = 0x00                                               C:\fw\midicontroller\x001x\dummystart.c
                                           void                                                                             C:\fw\midicontroller\x001x\dummystart.c
                                           RealInitVector (void)                                                            C:\fw\midicontroller\x001x\dummystart.c
                                           {                                                                                C:\fw\midicontroller\x001x\dummystart.c
                                             _asm                                                                           C:\fw\midicontroller\x001x\dummystart.c
000000   ef97     GOTO      0x1d2e         	goto main //jump to interrupt routine                                           C:\fw\midicontroller\x001x\dummystart.c
000002   f00e                                                                                                               
                                             _endasm                                                                        C:\fw\midicontroller\x001x\dummystart.c
000004   0012     RETURN    0x0            }                                                                                C:\fw\midicontroller\x001x\dummystart.c
                                                                                                                            C:\fw\midicontroller\x001x\dummystart.c
                                           /*                                                                               C:\fw\midicontroller\x001x\dummystart.c
                                           #pragma code RealInterruptVectorHigh = 0x08                                      C:\fw\midicontroller\x001x\dummystart.c
                                           void                                                                             C:\fw\midicontroller\x001x\dummystart.c
                                           RealInterruptVectorHigh (void)                                                   C:\fw\midicontroller\x001x\dummystart.c
                                           {                                                                                C:\fw\midicontroller\x001x\dummystart.c
                                             _asm                                                                           C:\fw\midicontroller\x001x\dummystart.c
                                           	goto InterruptHandlerHigh //jump to interrupt routine                           C:\fw\midicontroller\x001x\dummystart.c
                                             _endasm                                                                        C:\fw\midicontroller\x001x\dummystart.c
                                           }                                                                                C:\fw\midicontroller\x001x\dummystart.c
                                           */                                                                               C:\fw\midicontroller\x001x\dummystart.c
                                           ;contains configuration bits                                                     C:\fw\midicontroller\x001x\config.asm
                                                                                                                            C:\fw\midicontroller\x001x\config.asm
                                           ;300000                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG USBDIV=2, CPUDIV=OSC3_PLL4, PLLDIV=2                                     C:\fw\midicontroller\x001x\config.asm
                                           ;300001                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG FOSC=HSPLL_HS, FCMEM=OFF, IESO=OFF                                       C:\fw\midicontroller\x001x\config.asm
                                           ;300002                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG VREGEN=ON, PWRT=ON, BOR=ON, BORV=2		;2 = 2.7V..                          C:\fw\midicontroller\x001x\config.asm
                                           ;300003                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG WDT=OFF, WDTPS=128                                                       C:\fw\midicontroller\x001x\config.asm
                                           ;300005                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG CCP2MX=ON, PBADEN=OFF, LPT1OSC=OFF, MCLRE=ON                             C:\fw\midicontroller\x001x\config.asm
                                           ;300006                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG STVREN=ON, LVP=OFF, ICPRT=OFF, XINST=OFF, DEBUG=OFF                      C:\fw\midicontroller\x001x\config.asm
                                           ;300008                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG CP0=OFF, CP1=OFF, CP2=OFF                                                C:\fw\midicontroller\x001x\config.asm
                                           ;300009                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG CPB=OFF, CPD=OFF                                                         C:\fw\midicontroller\x001x\config.asm
                                           ;30000A                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG WRT0=OFF, WRT1=OFF, WRT2=OFF                                             C:\fw\midicontroller\x001x\config.asm
                                           ;30000B                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG WRTC=OFF, WRTB=OFF, WRTD=OFF                                             C:\fw\midicontroller\x001x\config.asm
                                           ;30000C                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG EBTR0=OFF, EBTR1=OFF, EBTR2=OFF                                          C:\fw\midicontroller\x001x\config.asm
                                           ;30000D                                                                          C:\fw\midicontroller\x001x\config.asm
                                           	CONFIG EBTRB=OFF                                                                C:\fw\midicontroller\x001x\config.asm
                                                                                                                            C:\fw\midicontroller\x001x\config.asm
                                           END                                                                              C:\fw\midicontroller\x001x\config.asm
